<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<script id="versionArea" type="text/javascript">
//<![CDATA[
var version = {title: "TiddlyWiki", major: 2, minor: 5, revision: 1, alpha: 1, date: new Date("Mar 9, 2009"), extensions: {}};
//]]>
</script>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="copyright" content="
TiddlyWiki created by Jeremy Ruston, (jeremy [at] osmosoft [dot] com)

Copyright (c) UnaMesa Association 2004-2009

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.

Redistributions in binary form must reproduce the above copyright notice, this
list of conditions and the following disclaimer in the documentation and/or other
materials provided with the distribution.

Neither the name of the UnaMesa Association nor the names of its contributors may be
used to endorse or promote products derived from this software without specific
prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS 'AS IS' AND ANY
EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGE.
" />
<!--PRE-HEAD-START-->
<!--{{{-->
<link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml' />
<!--}}}-->

<!--PRE-HEAD-END-->
<title> robson tree - get yours here </title>
<style id="styleArea" type="text/css">
#saveTest {display:none;}
#messageArea {display:none;}
#copyright {display:none;}
#storeArea {display:none;}
#storeArea div {padding:0.5em; margin:1em 0em 0em 0em; border-color:#fff #666 #444 #ddd; border-style:solid; border-width:2px; overflow:auto;}
#shadowArea {display:none;}
#javascriptWarning {width:100%; text-align:center; font-weight:bold; background-color:#dd1100; color:#fff; padding:1em 0em;}
</style>
<!--POST-HEAD-START-->

<!--POST-HEAD-END-->
</head>
<body onload="main();" onunload="if(window.unload) unload();">
<!--PRE-BODY-START-->

<!--PRE-BODY-END-->
<div id="copyright">
Welcome to TiddlyWiki created by Jeremy Ruston, Copyright &copy; 2007 UnaMesa Association
</div>
<noscript>
<div id="javascriptWarning">
This page requires JavaScript to function properly.<br /><br />If you are using Microsoft Internet Explorer you may need to click on the yellow bar above and select 'Allow Blocked Content'. You must then click 'Yes' on the following security warning.
</div>
</noscript>
<div id="saveTest"></div>
<div id="backstageCloak"></div>
<div id="backstageButton"></div>
<div id="backstageArea"><div id="backstageToolbar"></div></div>
<div id="backstage">
	<div id="backstagePanel"></div>
</div>
<div id="contentWrapper"></div>
<div id="contentStash"></div>
<div id="shadowArea">
<div title="MarkupPreHead">
<pre>&lt;!--{{{--&gt;
&lt;link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml' /&gt;
&lt;!--}}}--&gt;
</pre>
</div>
<div title="ColorPalette">
<pre>Background: #fff
Foreground: #000
PrimaryPale: #8cf
PrimaryLight: #18f
PrimaryMid: #04b
PrimaryDark: #014
SecondaryPale: #ffc
SecondaryLight: #fe8
SecondaryMid: #db4
SecondaryDark: #841
TertiaryPale: #eee
TertiaryLight: #ccc
TertiaryMid: #999
TertiaryDark: #666
Error: #f88
</pre>
</div>
<div title="StyleSheetColors">
<pre>/*{{{*/
body {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}

a {color:[[ColorPalette::PrimaryMid]];}
a:hover {background-color:[[ColorPalette::PrimaryMid]]; color:[[ColorPalette::Background]];}
a img {border:0;}

h1,h2,h3,h4,h5,h6 {color:[[ColorPalette::SecondaryDark]]; background:transparent;}
h1 {border-bottom:2px solid [[ColorPalette::TertiaryLight]];}
h2,h3 {border-bottom:1px solid [[ColorPalette::TertiaryLight]];}

.button {color:[[ColorPalette::PrimaryDark]]; border:1px solid [[ColorPalette::Background]];}
.button:hover {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::SecondaryLight]]; border-color:[[ColorPalette::SecondaryMid]];}
.button:active {color:[[ColorPalette::Background]]; background:[[ColorPalette::SecondaryMid]]; border:1px solid [[ColorPalette::SecondaryDark]];}

.header {background:[[ColorPalette::PrimaryMid]];}
.headerShadow {color:[[ColorPalette::Foreground]];}
.headerShadow a {font-weight:normal; color:[[ColorPalette::Foreground]];}
.headerForeground {color:[[ColorPalette::Background]];}
.headerForeground a {font-weight:normal; color:[[ColorPalette::PrimaryPale]];}

.tabSelected{color:[[ColorPalette::PrimaryDark]];
	background:[[ColorPalette::TertiaryPale]];
	border-left:1px solid [[ColorPalette::TertiaryLight]];
	border-top:1px solid [[ColorPalette::TertiaryLight]];
	border-right:1px solid [[ColorPalette::TertiaryLight]];
}
.tabUnselected {color:[[ColorPalette::Background]]; background:[[ColorPalette::TertiaryMid]];}
.tabContents {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::TertiaryPale]]; border:1px solid [[ColorPalette::TertiaryLight]];}
.tabContents .button {border:0;}

#sidebar {}
#sidebarOptions input {border:1px solid [[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel {background:[[ColorPalette::PrimaryPale]];}
#sidebarOptions .sliderPanel a {border:none;color:[[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel a:hover {color:[[ColorPalette::Background]]; background:[[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel a:active {color:[[ColorPalette::PrimaryMid]]; background:[[ColorPalette::Background]];}

.wizard {background:[[ColorPalette::PrimaryPale]]; border:1px solid [[ColorPalette::PrimaryMid]];}
.wizard h1 {color:[[ColorPalette::PrimaryDark]]; border:none;}
.wizard h2 {color:[[ColorPalette::Foreground]]; border:none;}
.wizardStep {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];
	border:1px solid [[ColorPalette::PrimaryMid]];}
.wizardStep.wizardStepDone {background:[[ColorPalette::TertiaryLight]];}
.wizardFooter {background:[[ColorPalette::PrimaryPale]];}
.wizardFooter .status {background:[[ColorPalette::PrimaryDark]]; color:[[ColorPalette::Background]];}
.wizard .button {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::SecondaryLight]]; border: 1px solid;
	border-color:[[ColorPalette::SecondaryPale]] [[ColorPalette::SecondaryDark]] [[ColorPalette::SecondaryDark]] [[ColorPalette::SecondaryPale]];}
.wizard .button:hover {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::Background]];}
.wizard .button:active {color:[[ColorPalette::Background]]; background:[[ColorPalette::Foreground]]; border: 1px solid;
	border-color:[[ColorPalette::PrimaryDark]] [[ColorPalette::PrimaryPale]] [[ColorPalette::PrimaryPale]] [[ColorPalette::PrimaryDark]];}

.wizard .notChanged {background:transparent;}
.wizard .changedLocally {background:#80ff80;}
.wizard .changedServer {background:#8080ff;}
.wizard .changedBoth {background:#ff8080;}
.wizard .notFound {background:#ffff80;}
.wizard .putToServer {background:#ff80ff;}
.wizard .gotFromServer {background:#80ffff;}

#messageArea {border:1px solid [[ColorPalette::SecondaryMid]]; background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]];}
#messageArea .button {color:[[ColorPalette::PrimaryMid]]; background:[[ColorPalette::SecondaryPale]]; border:none;}

.popupTiddler {background:[[ColorPalette::TertiaryPale]]; border:2px solid [[ColorPalette::TertiaryMid]];}

.popup {background:[[ColorPalette::TertiaryPale]]; color:[[ColorPalette::TertiaryDark]]; border-left:1px solid [[ColorPalette::TertiaryMid]]; border-top:1px solid [[ColorPalette::TertiaryMid]]; border-right:2px solid [[ColorPalette::TertiaryDark]]; border-bottom:2px solid [[ColorPalette::TertiaryDark]];}
.popup hr {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::PrimaryDark]]; border-bottom:1px;}
.popup li.disabled {color:[[ColorPalette::TertiaryMid]];}
.popup li a, .popup li a:visited {color:[[ColorPalette::Foreground]]; border: none;}
.popup li a:hover {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; border: none;}
.popup li a:active {background:[[ColorPalette::SecondaryPale]]; color:[[ColorPalette::Foreground]]; border: none;}
.popupHighlight {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}
.listBreak div {border-bottom:1px solid [[ColorPalette::TertiaryDark]];}

.tiddler .defaultCommand {font-weight:bold;}

.shadow .title {color:[[ColorPalette::TertiaryDark]];}

.title {color:[[ColorPalette::SecondaryDark]];}
.subtitle {color:[[ColorPalette::TertiaryDark]];}

.toolbar {color:[[ColorPalette::PrimaryMid]];}
.toolbar a {color:[[ColorPalette::TertiaryLight]];}
.selected .toolbar a {color:[[ColorPalette::TertiaryMid]];}
.selected .toolbar a:hover {color:[[ColorPalette::Foreground]];}

.tagging, .tagged {border:1px solid [[ColorPalette::TertiaryPale]]; background-color:[[ColorPalette::TertiaryPale]];}
.selected .tagging, .selected .tagged {background-color:[[ColorPalette::TertiaryLight]]; border:1px solid [[ColorPalette::TertiaryMid]];}
.tagging .listTitle, .tagged .listTitle {color:[[ColorPalette::PrimaryDark]];}
.tagging .button, .tagged .button {border:none;}

.footer {color:[[ColorPalette::TertiaryLight]];}
.selected .footer {color:[[ColorPalette::TertiaryMid]];}

.sparkline {background:[[ColorPalette::PrimaryPale]]; border:0;}
.sparktick {background:[[ColorPalette::PrimaryDark]];}

.error, .errorButton {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::Error]];}
.warning {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::SecondaryPale]];}
.lowlight {background:[[ColorPalette::TertiaryLight]];}

.zoomer {background:none; color:[[ColorPalette::TertiaryMid]]; border:3px solid [[ColorPalette::TertiaryMid]];}

.imageLink, #displayArea .imageLink {background:transparent;}

.annotation {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; border:2px solid [[ColorPalette::SecondaryMid]];}

.viewer .listTitle {list-style-type:none; margin-left:-2em;}
.viewer .button {border:1px solid [[ColorPalette::SecondaryMid]];}
.viewer blockquote {border-left:3px solid [[ColorPalette::TertiaryDark]];}

.viewer table, table.twtable {border:2px solid [[ColorPalette::TertiaryDark]];}
.viewer th, .viewer thead td, .twtable th, .twtable thead td {background:[[ColorPalette::SecondaryMid]]; border:1px solid [[ColorPalette::TertiaryDark]]; color:[[ColorPalette::Background]];}
.viewer td, .viewer tr, .twtable td, .twtable tr {border:1px solid [[ColorPalette::TertiaryDark]];}

.viewer pre {border:1px solid [[ColorPalette::SecondaryLight]]; background:[[ColorPalette::SecondaryPale]];}
.viewer code {color:[[ColorPalette::SecondaryDark]];}
.viewer hr {border:0; border-top:dashed 1px [[ColorPalette::TertiaryDark]]; color:[[ColorPalette::TertiaryDark]];}

.highlight, .marked {background:[[ColorPalette::SecondaryLight]];}

.editor input {border:1px solid [[ColorPalette::PrimaryMid]];}
.editor textarea {border:1px solid [[ColorPalette::PrimaryMid]]; width:100%;}
.editorFooter {color:[[ColorPalette::TertiaryMid]];}

#backstageArea {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::TertiaryMid]];}
#backstageArea a {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::Background]]; border:none;}
#backstageArea a:hover {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; }
#backstageArea a.backstageSelTab {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}
#backstageButton a {background:none; color:[[ColorPalette::Background]]; border:none;}
#backstageButton a:hover {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::Background]]; border:none;}
#backstagePanel {background:[[ColorPalette::Background]]; border-color: [[ColorPalette::Background]] [[ColorPalette::TertiaryDark]] [[ColorPalette::TertiaryDark]] [[ColorPalette::TertiaryDark]];}
.backstagePanelFooter .button {border:none; color:[[ColorPalette::Background]];}
.backstagePanelFooter .button:hover {color:[[ColorPalette::Foreground]];}
#backstageCloak {background:[[ColorPalette::Foreground]]; opacity:0.6; filter:'alpha(opacity=60)';}
/*}}}*/</pre>
</div>
<div title="StyleSheetLayout">
<pre>/*{{{*/
* html .tiddler {height:1%;}

body {font-size:.75em; font-family:arial,helvetica; margin:0; padding:0;}

h1,h2,h3,h4,h5,h6 {font-weight:bold; text-decoration:none;}
h1,h2,h3 {padding-bottom:1px; margin-top:1.2em;margin-bottom:0.3em;}
h4,h5,h6 {margin-top:1em;}
h1 {font-size:1.35em;}
h2 {font-size:1.25em;}
h3 {font-size:1.1em;}
h4 {font-size:1em;}
h5 {font-size:.9em;}

hr {height:1px;}

a {text-decoration:none;}

dt {font-weight:bold;}

ol {list-style-type:decimal;}
ol ol {list-style-type:lower-alpha;}
ol ol ol {list-style-type:lower-roman;}
ol ol ol ol {list-style-type:decimal;}
ol ol ol ol ol {list-style-type:lower-alpha;}
ol ol ol ol ol ol {list-style-type:lower-roman;}
ol ol ol ol ol ol ol {list-style-type:decimal;}

.txtOptionInput {width:11em;}

#contentWrapper .chkOptionInput {border:0;}

.externalLink {text-decoration:underline;}

.indent {margin-left:3em;}
.outdent {margin-left:3em; text-indent:-3em;}
code.escaped {white-space:nowrap;}

.tiddlyLinkExisting {font-weight:bold;}
.tiddlyLinkNonExisting {font-style:italic;}

/* the 'a' is required for IE, otherwise it renders the whole tiddler in bold */
a.tiddlyLinkNonExisting.shadow {font-weight:bold;}

#mainMenu .tiddlyLinkExisting,
	#mainMenu .tiddlyLinkNonExisting,
	#sidebarTabs .tiddlyLinkNonExisting {font-weight:normal; font-style:normal;}
#sidebarTabs .tiddlyLinkExisting {font-weight:bold; font-style:normal;}

.header {position:relative;}
.header a:hover {background:transparent;}
.headerShadow {position:relative; padding:4.5em 0 1em 1em; left:-1px; top:-1px;}
.headerForeground {position:absolute; padding:4.5em 0 1em 1em; left:0px; top:0px;}

.siteTitle {font-size:3em;}
.siteSubtitle {font-size:1.2em;}

#mainMenu {position:absolute; left:0; width:10em; text-align:right; line-height:1.6em; padding:1.5em 0.5em 0.5em 0.5em; font-size:1.1em;}

#sidebar {position:absolute; right:3px; width:16em; font-size:.9em;}
#sidebarOptions {padding-top:0.3em;}
#sidebarOptions a {margin:0 0.2em; padding:0.2em 0.3em; display:block;}
#sidebarOptions input {margin:0.4em 0.5em;}
#sidebarOptions .sliderPanel {margin-left:1em; padding:0.5em; font-size:.85em;}
#sidebarOptions .sliderPanel a {font-weight:bold; display:inline; padding:0;}
#sidebarOptions .sliderPanel input {margin:0 0 0.3em 0;}
#sidebarTabs .tabContents {width:15em; overflow:hidden;}

.wizard {padding:0.1em 1em 0 2em;}
.wizard h1 {font-size:2em; font-weight:bold; background:none; padding:0; margin:0.4em 0 0.2em;}
.wizard h2 {font-size:1.2em; font-weight:bold; background:none; padding:0; margin:0.4em 0 0.2em;}
.wizardStep {padding:1em 1em 1em 1em;}
.wizard .button {margin:0.5em 0 0; font-size:1.2em;}
.wizardFooter {padding:0.8em 0.4em 0.8em 0;}
.wizardFooter .status {padding:0 0.4em; margin-left:1em;}
.wizard .button {padding:0.1em 0.2em;}

#messageArea {position:fixed; top:2em; right:0; margin:0.5em; padding:0.5em; z-index:2000; _position:absolute;}
.messageToolbar {display:block; text-align:right; padding:0.2em;}
#messageArea a {text-decoration:underline;}

.tiddlerPopupButton {padding:0.2em;}
.popupTiddler {position: absolute; z-index:300; padding:1em; margin:0;}

.popup {position:absolute; z-index:300; font-size:.9em; padding:0; list-style:none; margin:0;}
.popup .popupMessage {padding:0.4em;}
.popup hr {display:block; height:1px; width:auto; padding:0; margin:0.2em 0;}
.popup li.disabled {padding:0.4em;}
.popup li a {display:block; padding:0.4em; font-weight:normal; cursor:pointer;}
.listBreak {font-size:1px; line-height:1px;}
.listBreak div {margin:2px 0;}

.tabset {padding:1em 0 0 0.5em;}
.tab {margin:0 0 0 0.25em; padding:2px;}
.tabContents {padding:0.5em;}
.tabContents ul, .tabContents ol {margin:0; padding:0;}
.txtMainTab .tabContents li {list-style:none;}
.tabContents li.listLink { margin-left:.75em;}

#contentWrapper {display:block;}
#splashScreen {display:none;}

#displayArea {margin:1em 17em 0 14em;}

.toolbar {text-align:right; font-size:.9em;}

.tiddler {padding:1em 1em 0;}

.missing .viewer,.missing .title {font-style:italic;}

.title {font-size:1.6em; font-weight:bold;}

.missing .subtitle {display:none;}
.subtitle {font-size:1.1em;}

.tiddler .button {padding:0.2em 0.4em;}

.tagging {margin:0.5em 0.5em 0.5em 0; float:left; display:none;}
.isTag .tagging {display:block;}
.tagged {margin:0.5em; float:right;}
.tagging, .tagged {font-size:0.9em; padding:0.25em;}
.tagging ul, .tagged ul {list-style:none; margin:0.25em; padding:0;}
.tagClear {clear:both;}

.footer {font-size:.9em;}
.footer li {display:inline;}

.annotation {padding:0.5em; margin:0.5em;}

* html .viewer pre {width:99%; padding:0 0 1em 0;}
.viewer {line-height:1.4em; padding-top:0.5em;}
.viewer .button {margin:0 0.25em; padding:0 0.25em;}
.viewer blockquote {line-height:1.5em; padding-left:0.8em;margin-left:2.5em;}
.viewer ul, .viewer ol {margin-left:0.5em; padding-left:1.5em;}

.viewer table, table.twtable {border-collapse:collapse; margin:0.8em 1.0em;}
.viewer th, .viewer td, .viewer tr,.viewer caption,.twtable th, .twtable td, .twtable tr,.twtable caption {padding:3px;}
table.listView {font-size:0.85em; margin:0.8em 1.0em;}
table.listView th, table.listView td, table.listView tr {padding:0px 3px 0px 3px;}

.viewer pre {padding:0.5em; margin-left:0.5em; font-size:1.2em; line-height:1.4em; overflow:auto;}
.viewer code {font-size:1.2em; line-height:1.4em;}

.editor {font-size:1.1em;}
.editor input, .editor textarea {display:block; width:100%; font:inherit;}
.editorFooter {padding:0.25em 0; font-size:.9em;}
.editorFooter .button {padding-top:0px; padding-bottom:0px;}

.fieldsetFix {border:0; padding:0; margin:1px 0px;}

.sparkline {line-height:1em;}
.sparktick {outline:0;}

.zoomer {font-size:1.1em; position:absolute; overflow:hidden;}
.zoomer div {padding:1em;}

* html #backstage {width:99%;}
* html #backstageArea {width:99%;}
#backstageArea {display:none; position:relative; overflow: hidden; z-index:150; padding:0.3em 0.5em;}
#backstageToolbar {position:relative;}
#backstageArea a {font-weight:bold; margin-left:0.5em; padding:0.3em 0.5em;}
#backstageButton {display:none; position:absolute; z-index:175; top:0; right:0;}
#backstageButton a {padding:0.1em 0.4em; margin:0.1em;}
#backstage {position:relative; width:100%; z-index:50;}
#backstagePanel {display:none; z-index:100; position:absolute; width:90%; margin-left:3em; padding:1em;}
.backstagePanelFooter {padding-top:0.2em; float:right;}
.backstagePanelFooter a {padding:0.2em 0.4em;}
#backstageCloak {display:none; z-index:20; position:absolute; width:100%; height:100px;}

.whenBackstage {display:none;}
.backstageVisible .whenBackstage {display:block;}
/*}}}*/
</pre>
</div>
<div title="StyleSheetLocale">
<pre>/***
StyleSheet for use when a translation requires any css style changes.
This StyleSheet can be used directly by languages such as Chinese, Japanese and Korean which need larger font sizes.
***/
/*{{{*/
body {font-size:0.8em;}
#sidebarOptions {font-size:1.05em;}
#sidebarOptions a {font-style:normal;}
#sidebarOptions .sliderPanel {font-size:0.95em;}
.subtitle {font-size:0.8em;}
.viewer table.listView {font-size:0.95em;}
/*}}}*/</pre>
</div>
<div title="StyleSheetPrint">
<pre>/*{{{*/
@media print {
#mainMenu, #sidebar, #messageArea, .toolbar, #backstageButton, #backstageArea {display: none !important;}
#displayArea {margin: 1em 1em 0em;}
noscript {display:none;} /* Fixes a feature in Firefox 1.5.0.2 where print preview displays the noscript content */
}
/*}}}*/</pre>
</div>
<div title="PageTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='header' macro='gradient vert [[ColorPalette::PrimaryLight]] [[ColorPalette::PrimaryMid]]'&gt;
&lt;div class='headerShadow'&gt;
&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;div class='headerForeground'&gt;
&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id='mainMenu' refresh='content' tiddler='MainMenu'&gt;&lt;/div&gt;
&lt;div id='sidebar'&gt;
&lt;div id='sidebarOptions' refresh='content' tiddler='SideBarOptions'&gt;&lt;/div&gt;
&lt;div id='sidebarTabs' refresh='content' force='true' tiddler='SideBarTabs'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id='displayArea'&gt;
&lt;div id='messageArea'&gt;&lt;/div&gt;
&lt;div id='tiddlerDisplay'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="ViewTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='toolbar' macro='toolbar [[ToolbarCommands::ViewToolbar]]'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='subtitle'&gt;&lt;span macro='view modifier link'&gt;&lt;/span&gt;, &lt;span macro='view modified date'&gt;&lt;/span&gt; (&lt;span macro='message views.wikified.createdPrompt'&gt;&lt;/span&gt; &lt;span macro='view created date'&gt;&lt;/span&gt;)&lt;/div&gt;
&lt;div class='tagging' macro='tagging'&gt;&lt;/div&gt;
&lt;div class='tagged' macro='tags'&gt;&lt;/div&gt;
&lt;div class='viewer' macro='view text wikified'&gt;&lt;/div&gt;
&lt;div class='tagClear'&gt;&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="EditTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='toolbar' macro='toolbar [[ToolbarCommands::EditToolbar]]'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit title'&gt;&lt;/div&gt;
&lt;div macro='annotations'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit text'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit tags'&gt;&lt;/div&gt;&lt;div class='editorFooter'&gt;&lt;span macro='message views.editor.tagPrompt'&gt;&lt;/span&gt;&lt;span macro='tagChooser excludeLists'&gt;&lt;/span&gt;&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="GettingStarted">
<pre>To get started with this blank [[TiddlyWiki]], you'll need to modify the following tiddlers:
* [[SiteTitle]] &amp; [[SiteSubtitle]]: The title and subtitle of the site, as shown above (after saving, they will also appear in the browser title bar)
* [[MainMenu]]: The menu (usually on the left)
* [[DefaultTiddlers]]: Contains the names of the tiddlers that you want to appear when the TiddlyWiki is opened
You'll also need to enter your username for signing your edits: &lt;&lt;option txtUserName&gt;&gt;</pre>
</div>
<div title="OptionsPanel">
<pre>These [[InterfaceOptions]] for customising [[TiddlyWiki]] are saved in your browser

Your username for signing your edits. Write it as a [[WikiWord]] (eg [[JoeBloggs]])

&lt;&lt;option txtUserName&gt;&gt;
&lt;&lt;option chkSaveBackups&gt;&gt; [[SaveBackups]]
&lt;&lt;option chkAutoSave&gt;&gt; [[AutoSave]]
&lt;&lt;option chkRegExpSearch&gt;&gt; [[RegExpSearch]]
&lt;&lt;option chkCaseSensitiveSearch&gt;&gt; [[CaseSensitiveSearch]]
&lt;&lt;option chkAnimate&gt;&gt; [[EnableAnimations]]

----
Also see [[AdvancedOptions]]</pre>
</div>
<div title="ImportTiddlers">
<pre>&lt;&lt;importTiddlers&gt;&gt;</pre>
</div>
</div>
<!--POST-SHADOWAREA-->
<div id="storeArea">
<div title=" Abraham Gartside (497)" modifier="YourName" modified="200909240839" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="1779-07-14" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John Gartside" mother="Mary Harrop">
<pre>Tanner and Yeoman.
	Adamin granted 1779.
	Date of death is burial date.
	Inherited Woodbrow estate and share in Bakestone pit from father 14 July 1731.</pre>
</div>
<div title=" Abraham Gartside (524)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1715-02-15" spouse="" sex="M" dod="1796-09-21" placeofbirth="Brimmycroft" occupation="" causeofdeath="" placeofdeath="" father=" James Gartside (512)" mother="Alice Buckley">
<pre>Clothier.
	Birth date = baptism, death date= burial.</pre>
</div>
<div title=" Abram Gartside (536)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1779-01-03" spouse="" sex="M" dod="1811-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" John Gartside (487)" mother=" Susanna Barker (492)">
<pre>DOB = baptism</pre>
</div>
<div title=" Agnes Vernon (229)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title=" Alfred Edward Lakeman (186)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="181" mother="Hutchinson Maxwell Oxx">
<pre></pre>
</div>
<div title=" Alice Bellwood (292)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1901-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Fred Bellwood" mother="Emma Thornton">
<pre></pre>
</div>
<div title=" Ann Brown (273)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1814-00-00" spouse="" sex="F" dod="1892-00-00" placeofbirth="Middleton Tyas, Yorkshire" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title=" Ann Gartside (489)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1754-00-00" spouse="" sex="F" dod="1803-03-15" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Benjamin Gartside 1715" mother="Alice Kershaw">
<pre>Baptised in 27 March 1754.
	Married 1775-01-02 to Henry Whitehead.</pre>
</div>
<div title=" Ann Gartside (514)" modifier="YourName" modified="200909240842" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John Gartside (3)" mother="Susannah Buckley">
<pre>Wife of John Scholefield of Grange.</pre>
</div>
<div title=" Ann Gartside (532)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1770-03-25" spouse="" sex="F" dod="0000-00-00" placeofbirth="1821-08-29" occupation="" causeofdeath="" placeofdeath="" father=" John Gartside (487)" mother=" Susanna Barker (492)">
<pre>DOB = baptism, DOD=burial.
	Maried James Mills of Wood - 20 Aug 1786
	He died 26 July 1832 in 72 year.</pre>
</div>
<div title=" Ann Mary Gartside (459)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1878-00-00" spouse="" sex="F" dod="1878-08-27" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Joseph Gartside" mother="Mary Alice Mallalieu">
<pre></pre>
</div>
<div title=" Ann Roberts Gartside (476)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1818-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="Linfitts" occupation="" causeofdeath="" placeofdeath="" father="Joseph Gartside 1794" mother="Ruth Roberts">
<pre>Baptised 2 Aug 1818 at St. Thomas, Friarmere.</pre>
</div>
<div title=" Ann SPEARMAN (211)" modifier="YourName" modified="200909221702" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Gilbert Illergy Spearman" mother="Anna CLARK">
<pre>Married William Clark a packer for pottery Rawmarsh.
	Had 3 children: unknown, James and Mary.</pre>
</div>
<div title=" Anna Patricia Wilford (589)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1973-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Michael J WILFORD" mother="Angela Spearman Oxx">
<pre></pre>
</div>
<div title=" Anna Scholefield (523)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1709-09-30" spouse="" sex="F" dod="1796-09-13" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre>Daughter of Francis Scholefield of Castleshaw.
	Yeoman.
	Died aged 88 years. Buried 21 Sept 1796.</pre>
</div>
<div title=" Anna Susanna Spearman (554)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="George Spearman" mother="">
<pre></pre>
</div>
<div title=" Annie Brew (377)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1873-03-30" spouse="" sex="F" dod="1873-03-30" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Robert Morgan Brew" mother="Esther Jones">
<pre></pre>
</div>
<div title=" Annie Hunter (569)" modifier="YourName" modified="200909251537" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1910-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Frederick Hunter" mother="Bertha UNKNOWN">
<pre></pre>
</div>
<div title=" Arthur Robson (402)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1900-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="Sunderland, Durham" occupation="" causeofdeath="" placeofdeath="" father=" John Thomas Robson (360)" mother=" Dorothy Unknown (361)">
<pre></pre>
</div>
<div title=" Barbara Robson (558)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1867-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="Sunderland, Durham, England" occupation="" causeofdeath="" placeofdeath="" father=" William Robson (340)" mother=" Jane Unknown (362)">
<pre></pre>
</div>
<div title=" Ben Gartside (542)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1788-08-30" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" John Gartside (487)" mother=" Susanna Barker (492)">
<pre>DOB = baptism.</pre>
</div>
<div title=" Benjamin Gartside (484)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1831-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="Linfitts" occupation="" causeofdeath="" placeofdeath="" father="Joseph Gartside 1794" mother="Ruth Roberts">
<pre>Baptised 3 July 1831 at St. Thomas, Friarmere. Died in Oldham.</pre>
</div>
<div title=" Benjamin Gartside (528)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1725-12-28" spouse="" sex="M" dod="1726-08-03" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" James Gartside (512)" mother="Alice Buckley">
<pre>DOB = baptism, DOD=burial</pre>
</div>
<div title=" Benjamin Gartside (537)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1765-05-27" spouse="" sex="M" dod="1765-05-29" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" John Gartside (487)" mother=" Susanna Barker (492)">
<pre>DOB = baptism, DOD=burial</pre>
</div>
<div title=" Benjamin Gartside (539)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1776-10-15" spouse="" sex="M" dod="1781-03-12" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" John Gartside (487)" mother=" Susanna Barker (492)">
<pre>DOB = baptism, DOD= burial.</pre>
</div>
<div title=" Benjamin Gartside (541)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1782-10-27" spouse="" sex="M" dod="1784-04-28" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" John Gartside (487)" mother=" Susanna Barker (492)">
<pre>DOB = baptism, DOD= burial.</pre>
</div>
<div title=" Bertha UNKNOWN (562)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="1954-00-00" placeofbirth="Ossett?" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title=" Beth Megan SHARMAN (564)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1972-07-26" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Alun Wynne Sharman" mother=" Lesley Ann CARTWRIGHT (31)">
<pre></pre>
</div>
<div title=" Betty Gartside (535)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1785-05-29" spouse="" sex="F" dod="1829-10-08" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" John Gartside (487)" mother=" Susanna Barker (492)">
<pre>DOB = baptism, DOD=burial.
	Married John Shaw of Hollinbank.</pre>
</div>
<div title=" Brendan Unknown (334)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="2006-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" Michael Hunter (78)" mother="">
<pre></pre>
</div>
<div title=" Brien Viscount Cullen COKAYNE (218)" modifier="YourName" modified="200909240753" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1629-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="128" mother="Mary Lady O'BRIEN">
<pre></pre>
</div>
<div title=" Carl Adrian Wilford (586)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1963-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Michael J WILFORD" mother="Angela Spearman Oxx">
<pre></pre>
</div>
<div title=" Cecilia VERNON (235)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1325-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title=" Charles COKAYNE (219)" modifier="YourName" modified="200909240753" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1629-00-00" spouse="" sex="M" dod="1657-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="128" mother="Mary Lady O'BRIEN">
<pre></pre>
</div>
<div title=" Charles Henry Brew (343)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1854-10-10" spouse="" sex="M" dod="1921-03-04" placeofbirth="Timber Yard,Chepstow,Monmouthshire,Wales" occupation="" causeofdeath="" placeofdeath="" father="George Brew 1826" mother="Jane Margaret Morgan">
<pre>Charles Henry Brew was born 10 October 1854 in the Timber Yard (His father was a Sawyer at the time), in Chepstow, Monmouthshire, Wales, and died 4 March 1921 in Pontypridd, Glamorgan, Wales. He married Mary Ann Smith on 10 May 1873 in Swindon, Wiltshire, England.</pre>
</div>
<div title=" Charles Newton (55)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1901-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="53" mother="52">
<pre></pre>
</div>
<div title=" Charlotte Mackenzie (644)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1894-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title=" Clifford Bellwood (291)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1898-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Fred Bellwood" mother="Emma Thornton">
<pre></pre>
</div>
<div title=" Cyril Baden Richard BREW (165)" modifier="YourName" modified="200909252200" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1900-00-00" spouse="" sex="M" dod="1959-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Richard Brew 1859" mother="Ellen Millet" latitude="" longitude="" dom="" placeofmarriage="">
<pre></pre>
</div>
<div title=" Doris WILSON UREN (166)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1900-00-00" spouse="" sex="F" dod="1979-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title=" Dorothy Robson (395)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1882-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="Sunderland, Durham, England" occupation="" causeofdeath="" placeofdeath="" father=" John Thomas Robson (360)" mother=" Dorothy Unknown (361)">
<pre>Possible christening..
	Christened 25 FEB 1883   	St Nicholas, Newcastle Upon Tyne, Northumberland, England
	mother: Dorothy Ann Colson father: John Robson</pre>
</div>
<div title=" Dorothy Unknown (361)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1858-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="Sunderland, Durham, England" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre>Married Thomas before 1881.</pre>
</div>
<div title=" Edith Hunter (573)" modifier="YourName" modified="200909251537" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1922-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Frederick Hunter" mother="Bertha UNKNOWN">
<pre></pre>
</div>
<div title=" Eliza Jane Brew (345)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1848-12-23" spouse="" sex="F" dod="0000-00-00" placeofbirth="Chepstow,Monmouthshire,Wales" occupation="" causeofdeath="" placeofdeath="" father="George Brew 1826" mother="Jane Margaret Morgan">
<pre></pre>
</div>
<div title=" Elizabeth Bellwood (256)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1849-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Richard Bellwood 1809" mother="Elizabeth Wilson">
<pre></pre>
</div>
<div title=" Elizabeth Bellwood (289)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1877-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="William Bellwood" mother="Ann Spence">
<pre></pre>
</div>
<div title=" Elizabeth Billingham (374)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="Swansea, Glamorgan, Wales" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title=" Elizabeth Buckley (504)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre>Sister of Edmund Buckley of Shelderslow.</pre>
</div>
<div title=" Elizabeth Bulmer (647)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1950-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" Kenneth Bulmer (645)" mother=" Joyce Raper (646)">
<pre></pre>
</div>
<div title=" Elizabeth Gartside (515)" modifier="YourName" modified="200909240842" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John Gartside (3)" mother="Susannah Buckley">
<pre>Wife of James Taylor of Ogden. Marriage settlement 7 Nov 1694.</pre>
</div>
<div title=" Elizabeth Hampson (470)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1814-04-20" spouse="" sex="F" dod="0000-00-00" placeofbirth="Ashton-u-Lyme" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title=" Elizabeth Honoria Spearman (553)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="George Spearman" mother="">
<pre>Source: http://www.british-history.ac.uk/report.asp?compid=42621

	Married Will John Spearman Wasey [http://genuki.cs.ncl.ac.uk/Transcriptions/DUR/BMI.html]</pre>
</div>
<div title=" Elizabeth Martha Ja(c)kman (619)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="1904-02-13" placeofbirth="" occupation="" causeofdeath="" placeofdeath="Plumstead" father="" mother="">
<pre></pre>
</div>
<div title=" Elizabeth UNKNOWN (305)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title=" Elizabeth UNKNOWN (315)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title=" Elizabeth Vipond (285)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1851-08-07" spouse="" sex="F" dod="1925-12-21" placeofbirth="Burton In Lonsdale, York, England" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre>Housekeeper in 1881 census to William Bellwood. Upon the death of Margaret Robson she was living in the house at the time in mechanic yard, East Thickley, Durham, England.</pre>
</div>
<div title=" Ellen DENBIE (231)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title=" Emily Isabella Lakeman (183)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="181" mother="Hutchinson Maxwell Oxx">
<pre></pre>
</div>
<div title=" Emily Robson (560)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1872-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="Sunderland, Durham, England" occupation="" causeofdeath="" placeofdeath="" father=" William Robson (340)" mother=" Jane Unknown (362)">
<pre></pre>
</div>
<div title=" Emma Brew (373)" modifier="YourName" modified="200909252139" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1835-02-26" spouse="" sex="F" dod="1881-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John Brew 1790" mother="Rachel Prickett">
<pre>She married 18 October 1854

	Emma Brew was born a &quot;base child&quot; (illegitimate) to Elizabeth Brew, John and Rachel&quot;s oldest daughter, in Caldicot, Monmouthshire, Wales, on 26 February 1835. On the birth certificate, Elizabeth&quot;s occupation is stated as a &quot;Charwoman&quot;. When Emma married on 18 October 1854, she is described as daughter of John Brew, which would apply Elizabeth&quot;s parents took in her daughter as if she were their own child. Perhaps they adopted her or perhaps it was a well-kept family secret. Interestingly, however, like her older &quot;brother&quot; (actually uncle), her mother&quot;s brother Thomas, Emma was also deaf. When Elizabeth married in 1838 (Emma was three years old), it appears she didn&quot;t take her daughter with her into the family, but rather left her in the care of her own parents, where she stayed until Emma herself married in 1854. Perhaps Emma grew up thinking her grandparents were her real parents, and never really knew the truth? We will never know.
	Source: Brew Family tree</pre>
</div>
<div title=" Eric Lyall Howells (60)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1906-10-23" spouse="" sex="M" dod="1998-02-16" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Daniel Howells" mother=" Mary Elizabeth Robson (48)">
<pre>17th February 1960 he received a settled quarter share of residue £117 from the deceased &quot;Helen Euphemia Robson&quot;. At the time he was living at 80 Victoria Avenue, Porthcawl, Glamorgan. Miss Connie Howells, John F. Darroch and Dr. Malcolm H Darroch also received equal amounts.

	He died in Porthcawl.</pre>
</div>
<div title=" Ethel Victoria BREW (163)" modifier="YourName" modified="200909252200" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1888-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Richard Brew 1859" mother="Ellen Millet" latitude="" longitude="" dom="" placeofmarriage="">
<pre></pre>
</div>
<div title=" Evelyn Spearman Oxx (205)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1928-00-00" spouse="" sex="F" dod="1996-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" Leonard Spearman OXX (195)" mother=" Hilda  (197)">
<pre></pre>
</div>
<div title=" Frederick Allen Lakeman (184)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="181" mother="Hutchinson Maxwell Oxx">
<pre></pre>
</div>
<div title=" Geoffrey Spearman OXX (206)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1932-00-00" spouse="" sex="M" dod="1953-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" Leonard Spearman OXX (195)" mother=" Hilda  (197)">
<pre></pre>
</div>
<div title=" Geoffrey W BREW (167)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1930-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" Hadyn Neville BREW (164)" mother=" Doris WILSON UREN (166)">
<pre></pre>
</div>
<div title=" George Bellwood (259)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1858-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Richard Bellwood 1809" mother="Elizabeth Wilson">
<pre></pre>
</div>
<div title=" George Gartside (467)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1854-00-00" spouse="" sex="M" dod="1885-00-00" placeofbirth="Denshaw" occupation="" causeofdeath="" placeofdeath="" father="John Gartside 1817" mother="Mary Dyson">
<pre>Died at Woolen Sizer.</pre>
</div>
<div title=" George Gartside (482)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1823-11-05" spouse="" sex="M" dod="0000-00-00" placeofbirth="Linfitts" occupation="" causeofdeath="" placeofdeath="" father="Joseph Gartside 1794" mother="Ruth Roberts">
<pre>Baptised 14 Mar 1824 at St. Thomas, Friarmere.</pre>
</div>
<div title=" George Hunter (574)" modifier="YourName" modified="200909251537" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1916-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Frederick Hunter" mother="Bertha UNKNOWN">
<pre></pre>
</div>
<div title=" George Mallalieu Gartside (461)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1875-00-00" spouse="" sex="M" dod="1896-00-00" placeofbirth="Denshaw, Saddleworth, York, England" occupation="" causeofdeath="" placeofdeath="" father="Joseph Gartside" mother="Mary Alice Mallalieu">
<pre>Died Ashton-u-Lyme. Buried 14 April 1896 at St Thomas Ashton-u-Lyme.</pre>
</div>
<div title=" George William Brew (342)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1857-01-19" spouse="" sex="M" dod="0000-00-00" placeofbirth="St. Woolos Paris,Newport,Monmouthshire,Wales" occupation="" causeofdeath="" placeofdeath="" father="George Brew 1826" mother="Jane Margaret Morgan">
<pre>He married Elizabeth Billingham, who was born ca. 1859 in Swansea, Glamorgan, Wales, the daughter of Eli Billingham, on 31 October 1880 in Christchurch Parish, Swansea, Glamorgan, Wales.</pre>
</div>
<div title=" Gilbert Spearman (214)" modifier="YourName" modified="200909221703" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Gilbert Illergy Spearman" mother="Anna CLARK">
<pre>Supposedly married an East Indian Woman. Had 3 children?
	Gilbert was an officer killed at Teinco Males.</pre>
</div>
<div title=" Gwladys Phillips (393)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1907-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="Glamorgan, Wales" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre>Daughter of Henry Phillips, married on 7 June 1930 in Port Talbot, Glamorganshire, Wales.</pre>
</div>
<div title=" Hadyn Neville BREW (164)" modifier="YourName" modified="200909252200" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1893-00-00" spouse="" sex="M" dod="1964-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Richard Brew 1859" mother="Ellen Millet" latitude="" longitude="" dom="" placeofmarriage="">
<pre></pre>
</div>
<div title=" Hamman Gartside (485)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1839-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="Linfitts" occupation="" causeofdeath="" placeofdeath="" father="Joseph Gartside 1794" mother="Ruth Roberts">
<pre>Baptised 31 Mar 1839 at St. Thomas, Friarmere.</pre>
</div>
<div title=" Hannah ? Brew (372)" modifier="YourName" modified="200909252139" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1831-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John Brew 1790" mother="Rachel Prickett">
<pre>The I.G.I. indicates John and Rachel also had other children, namely Mary, born 1821, Jane, born 1826, and Hannah, born 1831, but is most likely an error as John&quot;s brother Thomas had children by these names.</pre>
</div>
<div title=" Hannah Lees (544)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title=" Hannah SPEARMAN (209)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1790-00-00" spouse="" sex="F" dod="1861-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="George SPEARMAN 1760" mother="109">
<pre></pre>
</div>
<div title=" Harold Robson (396)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1884-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="Sunderland, Durham, England" occupation="" causeofdeath="" placeofdeath="" father=" John Thomas Robson (360)" mother=" Dorothy Unknown (361)">
<pre>Possibly born in September 1883.</pre>
</div>
<div title=" Helen Euphemia Spears (649)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1860-00-00" spouse="" sex="F" dod="1940-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre>In her will she lists the following relatives:
	John Mathie Darroch (nephew)
	James Darroch (nephew)
	Jennie Lewis (neice - sister&quot;s daughter)
	Jeanie Thorburn (neice - daughter of her late brother)
	Margaret Fife (daughter of her late brother)
	Nance Graham (daughter of her late brother)
	Nellie Spears (daughter of her late brother)
	Alexander Spears (son of late brother)
	Robert Spears (nephew)
	Connie/Eric Howells (neice/nephew - daughter/son of late husband&quot;s sister)
	John Robson (brother in law)

	She appears to have lived in Swansea as she donates money to Swansea Orphan Home for Girls,Swansea and Brecon Diocesan Trust, money for the upkeep of New Recreation Hall of St. Albans Church among many others.She donates £1000 for Swansea General and Eye Hospital in connection with a bed to be called the &quot;Adam Lyall Robson&quot; bed</pre>
</div>
<div title=" Henry Gartside (479)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1826-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="Linfitts" occupation="" causeofdeath="" placeofdeath="" father="Joseph Gartside 1794" mother="Ruth Roberts">
<pre>Baptised 2 Apr 1826 at St. Thomas, Friarmere.</pre>
</div>
<div title=" Henry Gartside (526)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1720-12-12" spouse="" sex="M" dod="1721-04-02" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" James Gartside (512)" mother="Alice Buckley">
<pre>DOB = baptism, DOD=burial</pre>
</div>
<div title=" Henry Gartside (527)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1723-04-10" spouse="" sex="M" dod="1726-03-05" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" James Gartside (512)" mother="Alice Buckley">
<pre>DOB = baptism, DOD=burial</pre>
</div>
<div title=" Henry Richardson Lakeman (182)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="181" mother="Hutchinson Maxwell Oxx">
<pre></pre>
</div>
<div title=" Hilda (197)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" joy="" freckleton="" dob="1892-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title=" Hilton Gartside (456)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1880-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Joseph Gartside" mother="Mary Alice Mallalieu">
<pre></pre>
</div>
<div title=" Ida Grey de Ruthyn (312)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title=" Ilbert Florence OXX (192)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1900-00-00" spouse="" sex="F" dod="1986-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="George Robert Oxx" mother="Elizabeth Sophia Ilbert CUTCLIFFE">
<pre></pre>
</div>
<div title=" Ilbert Mary Oxx (198)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1897-10-25" spouse="" sex="F" dod="1907-11-09" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="George Robert Oxx" mother="Elizabeth Sophia Ilbert CUTCLIFFE">
<pre></pre>
</div>
<div title=" Isaac Woodhouse SPEARMAN (207)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1785-00-00" spouse="" sex="M" dod="1828-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="George SPEARMAN 1760" mother="109">
<pre></pre>
</div>
<div title=" Isabel Gartside (531)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1768-01-02" spouse="" sex="F" dod="1795-04-07" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" John Gartside (487)" mother=" Susanna Barker (492)">
<pre>DOB = baptism, DOD=burial</pre>
</div>
<div title=" Isabella Jackson (617)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1832-11-10" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" Robert Jackson (608)" mother="">
<pre>Child out of wedlock.</pre>
</div>
<div title=" Isabella Robson (337)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1832-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="Northumberland, England" occupation="" causeofdeath="" placeofdeath="" father="John Robson" mother="Jane UNKNOWN">
<pre>Possibly christened 15 OCT 1831   	Newcastle Upon Tyne, Northumberland, England. Parents John and Jane at All Saints.

	In 1851, she cannot be found with the family. Possibly having married or died or gone to stay with relatives.</pre>
</div>
<div title=" Ivy Clarice Brew (390)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1898-03-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="Neath, Glamorganshire, Wales" occupation="" causeofdeath="" placeofdeath="" father=" John Charles Brew (388)" mother=" Sarah Short (389)">
<pre>married Reginald Mackworth Cotton in December 1919 in Neath, Glamorganshire, Wales </pre>
</div>
<div title=" Ivy Franklin (594)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1908-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="William (Billy) Franklin" mother="Louisa Gayler">
<pre>Spinster.</pre>
</div>
<div title=" James Gartside (481)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1834-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="Linfitts" occupation="" causeofdeath="" placeofdeath="" father="Joseph Gartside 1794" mother="Ruth Roberts">
<pre>Baptised 20 April 1834 at St. Thomas, Friarmere.</pre>
</div>
<div title=" James Gartside (512)" modifier="YourName" modified="200909240843" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1680-00-00" spouse="" sex="M" dod="1748-00-00" placeofbirth="Brimmycroft" occupation="" causeofdeath="" placeofdeath="" father="John Gartside (3)" mother="Susannah Buckley">
<pre>Yeoman.
	Buried 23 Sep 1748.
	Will proved 1748.
	Inherited Brimmycroft and Coatmans from father.</pre>
</div>
<div title=" James Gartside (516)" modifier="YourName" modified="200909240843" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1680-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John Gartside (3)" mother="Susannah Buckley">
<pre></pre>
</div>
<div title=" James Gartside (525)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1718-00-00" spouse="" sex="M" dod="1803-03-12" placeofbirth="Brimmycroft" occupation="" causeofdeath="" placeofdeath="" father=" James Gartside (512)" mother="Alice Buckley">
<pre>Sold half share in Brimmycroft c. 1760.
	Tame Croft, Tanner.</pre>
</div>
<div title=" James Jackson (623)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1834-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Adam Jackson" mother="Mary UNKNOWN">
<pre></pre>
</div>
<div title=" James Spearman OXX (188)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1854-00-00" spouse="" sex="M" dod="1921-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="George Spearman OXX" mother=" Mary Catherine MATHERS (180)">
<pre></pre>
</div>
<div title=" Jane ? Brew (371)" modifier="YourName" modified="200909252139" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1826-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John Brew 1790" mother="Rachel Prickett">
<pre>The I.G.I. indicates John and Rachel also had other children, namely Mary, born 1821, Jane, born 1826, and Hannah, born 1831, but is most likely an error as John&quot;s brother Thomas had children by these names.</pre>
</div>
<div title=" Jane A Robson (556)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1863-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" William Robson (340)" mother=" Jane Unknown (362)">
<pre></pre>
</div>
<div title=" Jane Anne Wilford (588)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1970-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Michael J WILFORD" mother="Angela Spearman Oxx">
<pre></pre>
</div>
<div title=" Jane Brew (347)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1849-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="Chepstow,Monmouth,Wales" occupation="" causeofdeath="" placeofdeath="" father="George Brew 1826" mother="Jane Margaret Morgan">
<pre></pre>
</div>
<div title=" Jane Robson (338)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1830-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="Northumberland, England" occupation="" causeofdeath="" placeofdeath="" father="John Robson" mother="Jane UNKNOWN">
<pre>Possibly christened 01 AUG 1829 Newcastle Upon Tyne, Northumberland, England. On familysearch there is an entry for christening with parents John and Jane at All Saints.</pre>
</div>
<div title=" Jane Unknown (362)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1832-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="Heaton, Northumberland," occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre>Possible marriage:  	
	03 DEC 1860   	All Saints, Newcastle Upon Tyne, Northumberland, England</pre>
</div>
<div title=" Jefrey Hutchinson Lakeman (185)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="181" mother="Hutchinson Maxwell Oxx">
<pre></pre>
</div>
<div title=" Jennie Robson (397)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1886-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="Sunderland, Durham, England" occupation="" causeofdeath="" placeofdeath="" father=" John Thomas Robson (360)" mother=" Dorothy Unknown (361)">
<pre></pre>
</div>
<div title=" Jessie Bellwood (265)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1887-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" Matthew Bellwood (257)" mother=" Mary Jones (260)">
<pre></pre>
</div>
<div title=" Jessie Hunter (571)" modifier="YourName" modified="200909251537" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1918-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Frederick Hunter" mother="Bertha UNKNOWN">
<pre></pre>
</div>
<div title=" Jim Gayler (597)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Unknown Gayler" mother="">
<pre>Died in World War. Memorial in Chelmsford / Stock area.</pre>
</div>
<div title=" Joan FitzMaurice (417)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title=" Joan Spearman Oxx (204)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1917-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" Leonard Spearman OXX (195)" mother=" Hilda  (197)">
<pre></pre>
</div>
<div title=" John (II) COKAYNE (236)" modifier="YourName" modified="200909271151" changecount="2" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1307-00-00" spouse="" sex="M" dod="1373-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John COKAYNE (1276)" mother="Lettice DE KNIVETON">
<pre></pre>
</div>
<div title=" John (IV) Chief Baron of Exchequer 1401 Cokayne (311)" modifier="YourName" modified="200909252145" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1370-00-00" spouse="" sex="M" dod="1429-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Sir John (III) COKAYNE" mother="Cecilia VERNON" latitude="" longitude="" dom="" placeofmarriage="">
<pre></pre>
</div>
<div title=" John Bellwood (252)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1840-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Richard Bellwood 1809" mother="Elizabeth Wilson">
<pre></pre>
</div>
<div title=" John Bellwood (279)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1853-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" William Bellwood (271)" mother=" Ann Brown (273)">
<pre></pre>
</div>
<div title=" John COKAYNE (224)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="140" mother="138">
<pre></pre>
</div>
<div title=" John Charles Brew (388)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1873-09-21" spouse="" sex="M" dod="1914-12-27" placeofbirth="Highworth, Swindon, Wiltshire" occupation="" causeofdeath="" placeofdeath="" father=" Charles Henry Brew (343)" mother=" Mary Ann Smith (387)">
<pre>Died 27 December 1914 in Aberavon, Glamorgan, Wales. He became a Police Constable, and married Sarah Short</pre>
</div>
<div title=" John Gartside (469)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="1850-05-20" placeofbirth="Tree House Bank" occupation="" causeofdeath="" placeofdeath="" father="Benjamin Gartside" mother="Mary Buckley">
<pre>Gent.
	Will proved 30 Nov 1850.</pre>
</div>
<div title=" John Gartside (487)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="1812-06-23" placeofbirth="Castleshaw" occupation="" causeofdeath="" placeofdeath="" father="Benjamin Gartside 1715" mother="Alice Kershaw">
<pre>Will proved 10 Sept 1812. Inherited Ocknell Lee. Later lived in Hough Yeoman.</pre>
</div>
<div title=" John Gartside (519)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1777-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" Abraham Gartside (497)" mother=" Sarah Shepley (517)">
<pre>Baptised 5th March 1777.</pre>
</div>
<div title=" John Gartside (522)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1712-09-12" spouse="" sex="M" dod="1788-01-31" placeofbirth="Brimmycroft" occupation="" causeofdeath="" placeofdeath="" father=" James Gartside (512)" mother="Alice Buckley">
<pre>Later of Castlehill Cote.
	Yeoman.
	Buried 2 Feb 1788.
	Sold a half share in Brimmy CVroft c. 1760.
	Inherits Coatman&quot;s from father.</pre>
</div>
<div title=" John Gartside (530)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1766-04-14" spouse="" sex="M" dod="1811-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" John Gartside (487)" mother=" Susanna Barker (492)">
<pre></pre>
</div>
<div title=" John Henry Gartside (468)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1856-00-00" spouse="" sex="M" dod="1927-02-22" placeofbirth="Denshaw" occupation="" causeofdeath="" placeofdeath="" father="John Gartside 1817" mother="Mary Dyson">
<pre>Life insurance agent.</pre>
</div>
<div title=" John Robson (339)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1822-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="Northumberland, England" occupation="Sawyer (1841)" causeofdeath="" placeofdeath="" father="John Robson" mother="Jane UNKNOWN">
<pre></pre>
</div>
<div title=" John Robson (638)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1855-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John Robson 1828" mother="">
<pre></pre>
</div>
<div title=" John Robson Newton (54)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1899-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="Trimsaran, Carmarthenshire, Wales" occupation="" causeofdeath="" placeofdeath="" father="53" mother="52">
<pre>By 31st December 1938 he appears to be living in Ontario Canada</pre>
</div>
<div title=" John Thomas Robson (360)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1859-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="Blythe, Northumberland" occupation="" causeofdeath="" placeofdeath="" father=" William Robson (340)" mother=" Jane Unknown (362)">
<pre>In the 1881 census he is living at 4 Coxon St with his wife.
	 John Thos. ROBSON  	 M  	 Male  	 22  	 Blythe, Northumberland, England  	 Timber Merchant (Manager) 
	 Dorothy ROBSON  	 M  	 Female  	 23  	 Sunderland, Durham, England  	  

	In 1891 census:
	1891 census
	View Record Dorothy Robson abt 1859 Sunderland, Durham, England Wife Bishop Wearmouth Durham
	View Record Dorothy Robson abt 1882 Sunderland, Durham, England Daughter Bishop Wearmouth Durham
	View Record Harold Robson abt 1884 Sunderland, Durham, England Son Bishop Wearmouth Durham
	View Record Jennie Robson abt 1886 Sunderland, Durham, England Daughter Bishop Wearmouth Durham
	View Record John Thomas Robson abt 1859 Blyth, Northumberland, England Head Bishop Wearmouth Durham
	View Record Kathleen Robson abt 1890 Sunderland, Durham, England Daughter Bishop Wearmouth Durham 

	In the 1901 census he is alive and living in the Sunderland parish
	 Arthur Robson abt 1900 Sunderland, Durham, England Son Sunderland Durham
	Dorothy Robson abt 1859 Sunderland, Durham, England Wife Sunderland Durham
	Dorothy Robson abt 1882 Sunderland, Durham, England Daughter Sunderland Durham
	Harold Robson abt 1884 Sunderland, Durham, England Son Sunderland Durham
	Jennie Robson abt 1886 Sunderland, Durham, England Daughter Sunderland Durham
	John S Robson abt 1859 Blyth, Northumberland, England Head Sunderland Durham
	John W Robson abt 1892 Sunderland, Durham, England Son Sunderland Durham
	Kathleen Robson abt 1890 Sunderland, Durham, England Daughter Sunderland Durham
	Martha Robson abt 1897 Sunderland, Durham, England Daughter Sunderland Durham
	Winnie Robson abt 1895 Sunderland, Durham, England Daughter Sunderland Durham 
	???
	Possible Marriage: Dorothy Coulson 04 OCT 1875  	All Saints, Newcastle Upon Tyne, Northumberland, England ?!?!</pre>
</div>
<div title=" John W Robson (399)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1892-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="Sunderland, Durham, England" occupation="" causeofdeath="" placeofdeath="" father=" John Thomas Robson (360)" mother=" Dorothy Unknown (361)">
<pre></pre>
</div>
<div title=" Joseph Bellwood (274)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1841-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" William Bellwood (271)" mother=" Ann Brown (273)">
<pre></pre>
</div>
<div title=" Joseph Gartside (477)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1820-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="Linfitts" occupation="" causeofdeath="" placeofdeath="" father="Joseph Gartside 1794" mother="Ruth Roberts">
<pre>Baptised 20 Oct 1820 at St. Thomas, Friarmere.</pre>
</div>
<div title=" Joseph Gartside (483)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1827-10-18" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Joseph Gartside 1794" mother="Ruth Roberts">
<pre>Baptised 1 Jan 1828 at St. Thomas, Friarmere.</pre>
</div>
<div title=" Joseph Spearman (212)" modifier="YourName" modified="200909221703" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Gilbert Illergy Spearman" mother="Anna CLARK">
<pre>Died a minor (fell backwards down a pit)</pre>
</div>
<div title=" Joseph William Bellwood (281)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1873-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="Royal Oak" occupation="" causeofdeath="" placeofdeath="" father=" William Bellwood (276)" mother=" Margaret Robson (280)">
<pre></pre>
</div>
<div title=" Joyce Raper (646)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1924-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title=" Judith Unknown (529)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="1804-05-08" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre>DOD=burial</pre>
</div>
<div title=" Kareena Jane Wilford (585)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1962-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Michael J WILFORD" mother="Angela Spearman Oxx">
<pre></pre>
</div>
<div title=" Kathleen Robson (398)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1890-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="Sunderland, Durham, England" occupation="" causeofdeath="" placeofdeath="" father=" John Thomas Robson (360)" mother=" Dorothy Unknown (361)">
<pre>Possibly born in September 1889</pre>
</div>
<div title=" Kathryn Margaret SHARMAN (27)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1939-08-02" spouse="" sex="F" dod="1940-00-00" placeofbirth="Shaohing, China" occupation="" causeofdeath="" placeofdeath="" father="26" mother="25">
<pre></pre>
</div>
<div title=" Kenneth Bulmer (645)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1919-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="124" mother=" Charlotte Mackenzie (644)">
<pre></pre>
</div>
<div title=" Leonard Spearman OXX (195)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1885-00-00" spouse="" sex="M" dod="1945-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" James Spearman OXX (188)" mother="Annie E MOORE">
<pre></pre>
</div>
<div title=" Lesley Ann CARTWRIGHT (31)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1945-10-02" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title=" Lucas Hunter (77)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1975-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="69" mother="">
<pre></pre>
</div>
<div title=" Lucy Gayler (596)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="Croydon, Essex ??" occupation="" causeofdeath="" placeofdeath="" father="Unknown Gayler" mother="">
<pre></pre>
</div>
<div title=" Margaret Bellwood (267)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1834-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Richard Bellwood 1809" mother=" Mary Jampson (266)">
<pre></pre>
</div>
<div title=" Margaret Bellwood (270)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1807-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Richard Bellwood 1784" mother="Mary Dowthwaite">
<pre></pre>
</div>
<div title=" Margaret Bellwood (282)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1874-08-02" spouse="" sex="F" dod="0000-00-00" placeofbirth="Red Mires, Durham" occupation="" causeofdeath="" placeofdeath="" father=" William Bellwood (276)" mother=" Margaret Robson (280)">
<pre></pre>
</div>
<div title=" Margaret Jackson (624)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1837-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Adam Jackson" mother="Mary UNKNOWN">
<pre></pre>
</div>
<div title=" Margaret Robson (280)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1844-00-00" spouse="" sex="F" dod="1881-02-01" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre>Died during child birth.</pre>
</div>
<div title=" Margaret Robson (325)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1867-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="Middlesborough, York, England" occupation="" causeofdeath="" placeofdeath="" father="Joseph Robson" mother="Ann Foster">
<pre></pre>
</div>
<div title=" Margaret Robson (363)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1860-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="Blyth, Northumberland, England" occupation="" causeofdeath="" placeofdeath="" father=" William Robson (340)" mother=" Jane Unknown (362)">
<pre></pre>
</div>
<div title=" Marjorie Isabell Robson (24)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1913-00-00" spouse="" sex="F" dod="2006-05-16" placeofbirth="" occupation="" causeofdeath="" placeofdeath="Port Talbot, buried at Goytre Cemetry." father="14" mother=" Violet Evelyn Brew (21)">
<pre>Funeral service was held on Wednesday 24th May 2006  at Bethlehem Evangelical Church. She was buried at Goytre Cemetery. The officiating minister was Reverend Jeremy Bailey.</pre>
</div>
<div title=" Martha Robson (400)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1897-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="Sunderland, Durham, England" occupation="" causeofdeath="" placeofdeath="" father=" John Thomas Robson (360)" mother=" Dorothy Unknown (361)">
<pre></pre>
</div>
<div title=" Mary ? Brew (369)" modifier="YourName" modified="200909252139" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1821-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John Brew 1790" mother="Rachel Prickett">
<pre>The I.G.I. indicates John and Rachel also had other children, namely Mary, born 1821, Jane, born 1826, and Hannah, born 1831, but is most likely an error as John&quot;s brother Thomas had children by these names.</pre>
</div>
<div title=" Mary A Robson (559)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1869-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="Sunderland, Durham, England" occupation="" causeofdeath="" placeofdeath="" father=" William Robson (340)" mother=" Jane Unknown (362)">
<pre></pre>
</div>
<div title=" Mary Ann Brew (375)" modifier="YourName" modified="200909252202" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1817-10-26" spouse="" sex="F" dod="0000-00-00" placeofbirth="Chepstow" occupation="" causeofdeath="" placeofdeath="" father="Thomas Brew 1791" mother="Honor Perry" latitude="" longitude="" dom="" placeofmarriage="">
<pre>who was christened in Chepstow on 26 October 1817, and married William Niblett in 1847 </pre>
</div>
<div title=" Mary Ann Byrom (227)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title=" Mary Ann Reed (521)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="1853-12-21" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre>Eldest daughter of William Reed Esq.
	Married at Tynemouth.
	Shipowner of Tynemouth, Northumberland.</pre>
</div>
<div title=" Mary Ann Smith (387)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title=" Mary Bellwood (254)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1846-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Richard Bellwood 1809" mother="Elizabeth Wilson">
<pre></pre>
</div>
<div title=" Mary Bellwood (264)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1884-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" Matthew Bellwood (257)" mother=" Mary Jones (260)">
<pre></pre>
</div>
<div title=" Mary Bellwood (272)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1815-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Richard Bellwood 1784" mother="Mary Dowthwaite">
<pre></pre>
</div>
<div title=" Mary Bellwood (278)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" William Bellwood (271)" mother=" Ann Brown (273)">
<pre></pre>
</div>
<div title=" Mary Bellwood (283)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1879-03-26" spouse="" sex="F" dod="1880-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" William Bellwood (276)" mother=" Margaret Robson (280)">
<pre></pre>
</div>
<div title=" Mary Bellwood (284)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1881-01-17" spouse="" sex="F" dod="1881-01-17" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" William Bellwood (276)" mother=" Margaret Robson (280)">
<pre></pre>
</div>
<div title=" Mary Brew (169)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1935-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" Cyril Baden Richard BREW (165)" mother=" Olwyn Verena WILKINSON (168)">
<pre></pre>
</div>
<div title=" Mary Catherine MATHERS (180)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1819-00-00" spouse="" sex="F" dod="1870-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title=" Mary Elizabeth Robson (48)" modifier="YourName" modified="200909231736" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1876-02-05" spouse="" sex="F" dod="1937-01-06" placeofbirth="Darlington, Durham, England" occupation="" causeofdeath="" placeofdeath="Porthcawl. Buried in Bridgend." father="John George Robson (2)" mother="Martha Isabell Lyall">
<pre>In 1901 census:
	View Record Maud Lloyd abt 1877 Shelton, Staffordshire, England Servant Aberavon Glamorgan
	View Record John G Robson abt 1843 Middlesbrough, Yorkshire, England Head Aberavon Glamorgan
	View Record Martha J Robson abt 1843 Cockfield, Durham, England Wife Aberavon Glamorgan
	View Record Mary J Robson abt 1876 Darlington, Durham, England Daughter Aberavon Glamorgan 

	Therefore Mary married after 1901.</pre>
</div>
<div title=" Mary Ellen PARTON (171)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1893-00-00" spouse="" sex="F" dod="1962-09-27" placeofbirth="Glamorgan, Wales" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre>Mary Ellen Parton, who was born ca. 1893 in Glamorgan, Wales, the daughter of William Henry Parton, on 27 July 1920 in Neath, Glamorganshire, Wales. Mary Ellen died 27 September 1962 in Swansea, Glamorgan, Wales</pre>
</div>
<div title=" Mary Gartside (478)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1822-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="Linfitts" occupation="" causeofdeath="" placeofdeath="" father="Joseph Gartside 1794" mother="Ruth Roberts">
<pre>Baptised 28 May 1822 at St. Thomas, Friarmere.</pre>
</div>
<div title=" Mary Gartside (491)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="1787-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Benjamin Gartside 1715" mother="Alice Kershaw">
<pre>Married Jame Shaw of Hollin Bank Yeoman (1749-1817)</pre>
</div>
<div title=" Mary Gartside (518)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1775-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" Abraham Gartside (497)" mother=" Sarah Shepley (517)">
<pre>Baptised 11 Jun 1775.</pre>
</div>
<div title=" Mary Gartside (533)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1774-04-21" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" John Gartside (487)" mother=" Susanna Barker (492)">
<pre>DOB = baptism
	Married William Waring.</pre>
</div>
<div title=" Mary Gayler (598)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Unknown Gayler" mother="">
<pre></pre>
</div>
<div title=" Mary Hunter (572)" modifier="YourName" modified="200909251537" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1922-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Frederick Hunter" mother="Bertha UNKNOWN">
<pre></pre>
</div>
<div title=" Mary Jampson (266)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1814-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title=" Mary Jones (260)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1851-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="Consett Co. Durham" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title=" Mary Robson (636)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1867-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John Robson 1828" mother="">
<pre></pre>
</div>
<div title=" Matthew Bellwood (257)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1851-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Richard Bellwood 1809" mother="Elizabeth Wilson">
<pre></pre>
</div>
<div title=" Matthew Bellwood (263)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1882-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" Matthew Bellwood (257)" mother=" Mary Jones (260)">
<pre></pre>
</div>
<div title=" Michael Hunter (78)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1984-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="70" mother=" Sally UNKNOWN (84)">
<pre></pre>
</div>
<div title=" Millicent BELLWOOD (88)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1886-00-00" spouse="" sex="F" dod="1973-00-00" placeofbirth="Middlesbrough" occupation="" causeofdeath="" placeofdeath="" father="Thomas Bellwood 1854" mother="Frances Isabella Woodhouse Robson">
<pre></pre>
</div>
<div title=" Nicola Broome (583)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1967-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Robert H Broome" mother="Sonia Spearman OXX">
<pre></pre>
</div>
<div title=" Nora Hunter (570)" modifier="YourName" modified="200909251537" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1914-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Frederick Hunter" mother="Bertha UNKNOWN">
<pre></pre>
</div>
<div title=" Norman Bellwood (262)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1877-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" Matthew Bellwood (257)" mother=" Mary Jones (260)">
<pre></pre>
</div>
<div title=" Olive UNKNOWN (547)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title=" Olwyn Verena WILKINSON (168)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1906-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title=" Paul Bulmer (648)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1957-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" Kenneth Bulmer (645)" mother=" Joyce Raper (646)">
<pre></pre>
</div>
<div title=" Rebecca Sarah Robson (5)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1987-06-11" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="2" mother="18">
<pre></pre>
</div>
<div title=" Reginald COKAYNE (225)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="140" mother="138">
<pre></pre>
</div>
<div title=" Richard Bellwood (258)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1844-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Richard Bellwood 1809" mother="Elizabeth Wilson">
<pre></pre>
</div>
<div title=" Richard Bellwood (275)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1843-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" William Bellwood (271)" mother=" Ann Brown (273)">
<pre></pre>
</div>
<div title=" Richard Bellwood (277)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1847-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" William Bellwood (271)" mother=" Ann Brown (273)">
<pre></pre>
</div>
<div title=" Richard Brew (356)" modifier="YourName" modified="200909252202" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1833-02-10" spouse="" sex="M" dod="1913-08-10" placeofbirth="Chepstow,Monmouthshire,Wales" occupation="" causeofdeath="" placeofdeath="" father="Thomas Brew 1791" mother="Honor Perry" latitude="" longitude="" dom="" placeofmarriage="">
<pre></pre>
</div>
<div title=" Richard Broome (582)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1966-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Robert H Broome" mother="Sonia Spearman OXX">
<pre></pre>
</div>
<div title=" Richard Byrom Gartside (465)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1846-00-00" spouse="" sex="M" dod="1918-09-13" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John Gartside 1817" mother="Mary Dyson">
<pre>A Jillot printer and draper. Married twice.</pre>
</div>
<div title=" Richard Robson (639)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1853-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John Robson 1828" mother="">
<pre></pre>
</div>
<div title=" Robert Jackson (608)" modifier="YourName" modified="200909221750" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1800-08-16" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Matthew Jackson" mother="Martha UNKNOWN">
<pre>Wrote a series of letters.
	Dec 27th 1820 he writes from Shadwell, London and is having trouble getting a ship and requesting money.
	Jan 8th 1821 he writes from London requesting money.
	Oct 17th 1822 he writes from Marunhorm on board a shooner (a ship)
	St Jago de Cuba March 24 1824 he talks of being in the Columbian service and had been taken prisoner for 4 months. He mentions a cousin Bella and Uncle James Atchison and Uncle William Silkson/Nicholson (the surnames aren&quot;t clear) and Aunt Jane as well as brothers William and Adam. He say he plans to live in Cuba for only 3/4 years.
	Sept 1824 he writes about how he has been in prison but is no longer, he also mentions his brother has married a French woman, and it seems this combined with him being in prison has upset the family.
	My 10th 1830 he writes from Cuba reporting that money is scarce.
	In 1831 he writes saying a war may be imminent. He also talks of negroe slaves being paid nothing for their labour.
	A letter received in UK Aug 21st 1833 (so probably sent 6 months before in Feb) he writes about how he is not yet married. He mentions his parents have moved and asks to know the day of the month in which he was born. HE has heard his sister Isabella has married which backs up that Isabella Lyall nee Jackson was his sister as she married Adam in 1831.
	17th Jan 1834 he is still not married and is asking to talk to his brother. It hints at a dispute in the family to do with him. He has however had a child Isabella.
	16th Dec 1836 he is still not married 
	In a damaged letter lots of which is missing (segments have just fallen off due to its age) with dates 11th May 1844/June 10th 1844 written on the envelope (maybe postmarks?) he is still working for Messrs Wright Brooks &amp; Co of St Jago de Cuba. We can assume it is Robert he seems to be well and happy and enquires about his father.


	In a later letter dated April 15th 1849 addressed to Messrs. Wright, Brooks &amp; Co (who he worked for in Cuba) asking if they know of whether he is living or dead. This letter is written by his nephew Robert Jackson (however it is unknown who&quot;s son he is - I however expect Adam).

	</pre>
</div>
<div title=" Robert Jackson (621)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1830-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Adam Jackson" mother="Mary UNKNOWN">
<pre>A Robert Jackson did exist and he was a nephew of Robert Jackson (1800-).

	Census from 1841 and 1861 suggest he was the son of Adam.</pre>
</div>
<div title=" Robert Morgan Brew (381)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1883-12-00" spouse="" sex="M" dod="1884-03-00" placeofbirth="Highworth, Swindon, Wiltshire" occupation="" causeofdeath="" placeofdeath="" father="Robert Morgan Brew" mother="Esther Jones">
<pre>Died in Highworth, Swindon, Wiltshire.</pre>
</div>
<div title=" Robert Robson (640)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1851-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John Robson 1828" mother="">
<pre></pre>
</div>
<div title=" Robert William Robson (51)" modifier="YourName" modified="200909231735" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1867-06-15" spouse="" sex="M" dod="1910-06-14" placeofbirth="Middlesbrough, York, England" occupation="Roll Turner in the steel industry (1901)" causeofdeath="" placeofdeath="Port Talbot" father="John George Robson (2)" mother="Martha Isabell Lyall">
<pre>The 1901 census shows him living with brother Matthew as boarders to the owners David Llond (born 1853 Pembrey, Carmathenshire Wales) and Mary Jane Llond (born 1858 Pembrey, Carmarthenshire, Wales). His profession is Roll Turner in the steel industry.</pre>
</div>
<div title=" Roger Cokayne (309)" modifier="YourName" modified="200909252156" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1370-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Sir Edmund COKAYNE" mother="Elizabeth de HERTHULL" latitude="" longitude="" dom="" placeofmarriage="">
<pre></pre>
</div>
<div title=" Ronald Spearman OXX (196)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1915-00-00" spouse="" sex="M" dod="1926-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" James Spearman OXX (188)" mother="Annie E MOORE">
<pre></pre>
</div>
<div title=" Ross Brydan SHARMAN (565)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1970-12-30" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Alun Wynne Sharman" mother=" Lesley Ann CARTWRIGHT (31)">
<pre></pre>
</div>
<div title=" Ruth Gartside (460)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1876-00-00" spouse="" sex="F" dod="1878-08-22" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Joseph Gartside" mother="Mary Alice Mallalieu">
<pre></pre>
</div>
<div title=" Ruth Gartside (466)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1849-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="Saddleworth" occupation="" causeofdeath="" placeofdeath="" father="John Gartside 1817" mother="Mary Dyson">
<pre></pre>
</div>
<div title=" Sally Gartside (534)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1776-10-15" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" John Gartside (487)" mother=" Susanna Barker (492)">
<pre>Married James Kershaw.
	DOB = baptism.</pre>
</div>
<div title=" Sally UNKNOWN (84)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title=" Samuel Robson (324)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1861-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="Middlesborough, York, England" occupation="" causeofdeath="" placeofdeath="" father="Joseph Robson" mother="Ann Foster">
<pre></pre>
</div>
<div title=" Sara Broome (584)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1971-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Robert H Broome" mother="Sonia Spearman OXX">
<pre></pre>
</div>
<div title=" Sarah Bellwood (261)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1876-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="Newcastle" occupation="" causeofdeath="" placeofdeath="" father=" Matthew Bellwood (257)" mother=" Mary Jones (260)">
<pre></pre>
</div>
<div title=" Sarah Gartside (475)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1799-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="Linfitts" occupation="" causeofdeath="" placeofdeath="" father="Benjamin Gartside" mother="Mary Buckley">
<pre>Baptised St. Thomas, Friarmere on 20 April 1799</pre>
</div>
<div title=" Sarah Gartside (490)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1759-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Benjamin Gartside 1715" mother="Alice Kershaw">
<pre>Baptised 8 April 1759.
	Married Rev James Mashister, Curate of Shaw (-1795)</pre>
</div>
<div title=" Sarah Jane Brew (379)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1876-06-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="Wells, Somerset, England" occupation="" causeofdeath="" placeofdeath="" father="Robert Morgan Brew" mother="Esther Jones">
<pre>Married Charles Padfield, born 1878 in Monmouthshire, Wales, the son of Thomas Padfield, on 16 July 1901 in Newport, Monmouthshire, Wales</pre>
</div>
<div title=" Sarah MERCATON (241)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title=" Sarah Robson (637)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1857-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John Robson 1828" mother="">
<pre></pre>
</div>
<div title=" Sarah Shepley (517)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1772-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre>Daughter of Thomas Shepley of Stalybridge.
	Living 1779.</pre>
</div>
<div title=" Sarah Short (389)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1872-00-00" spouse="" sex="F" dod="1930-03-15" placeofbirth="Zion Chapel, Aberavon, Neath, Glamorgan, Wales" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre>Daughter of Caleb Short. Died in Port Talbot, Glamorgan, Wales.</pre>
</div>
<div title=" Sharman Louise Robson (3)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1960-05-28" spouse="" sex="F" dod="0000-00-00" placeofbirth="Swansea" occupation="" causeofdeath="" placeofdeath="" father="1" mother="19">
<pre></pre>
</div>
<div title=" Sid Franklin (592)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1905-03-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="High Wycombe" occupation="" causeofdeath="" placeofdeath="" father="William (Billy) Franklin" mother="Louisa Gayler">
<pre></pre>
</div>
<div title=" Simon Spearman Oxx (580)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1964-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Clive Spearman Oxx" mother="Judith A Hunt">
<pre></pre>
</div>
<div title=" Sir Charles Spearman (551)" modifier="YourName" modified="200909251512" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Gilbert SPEARMAN" mother="Margaret PEARSON">
<pre>Magistrate of Elvit Durham.
	had 2 children. One of which lived at Newton Hall, the other at Scrunton as a solicitor.</pre>
</div>
<div title=" Sir Edmund COKAYNE (232)" modifier="YourName" modified="200909252145" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1345-00-00" spouse="" sex="M" dod="1403-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Sir John (III) COKAYNE" mother="Cecilia VERNON" latitude="" longitude="" dom="" placeofmarriage="">
<pre></pre>
</div>
<div title=" Sonia Broome (581)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1961-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Robert H Broome" mother="Sonia Spearman OXX">
<pre></pre>
</div>
<div title=" Susanna Barker (492)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title=" Susanna Barker (538)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1772-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" John Gartside (487)" mother=" Susanna Barker (492)">
<pre>DOB = baptism.</pre>
</div>
<div title=" Thomas (II) Cokayne (298)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1560-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Thomas Cokayne 1540" mother="Magdalen Towers">
<pre></pre>
</div>
<div title=" Thomas Cokayne (307)" modifier="YourName" modified="200909252155" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1370-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Sir Edmund COKAYNE" mother="Elizabeth de HERTHULL" latitude="" longitude="" dom="" placeofmarriage="">
<pre></pre>
</div>
<div title=" Thomas Gartside (520)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1779-00-00" spouse="" sex="M" dod="1859-05-10" placeofbirth="Woodbrow" occupation="" causeofdeath="" placeofdeath="" father=" Abraham Gartside (497)" mother=" Sarah Shepley (517)">
<pre>Baptised April 1779.
	Captain of Royal Lancashire Militia,
	Lieutenant of the 11th Light Dragoons.
	Woollen printer and cotton spinner.</pre>
</div>
<div title=" Thomas Henry BELLWOOD (87)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1882-00-00" spouse="" sex="" dod="1944-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Thomas Bellwood 1854" mother="Frances Isabella Woodhouse Robson">
<pre></pre>
</div>
<div title=" Thomas Jackson (622)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1832-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Adam Jackson" mother="Mary UNKNOWN">
<pre></pre>
</div>
<div title=" Thomas John Brew (346)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1850-06-30" spouse="" sex="M" dod="0000-00-00" placeofbirth="Chepstow,Monmouth,Wales" occupation="" causeofdeath="" placeofdeath="" father="George Brew 1826" mother="Jane Margaret Morgan">
<pre></pre>
</div>
<div title=" Thomas SPEARMAN (213)" modifier="YourName" modified="200909221704" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="1815-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Gilbert Illergy Spearman" mother="Anna CLARK">
<pre>Potter of Rawmarsh.
	Married in Rotherham.
	Married Elizabeth who had a 2nd husband Thomas Sharp (also a potter of Rawmarsh)</pre>
</div>
<div title=" Timothy Gartside (540)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1781-03-04" spouse="" sex="F" dod="1783-02-12" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" John Gartside (487)" mother=" Susanna Barker (492)">
<pre>DOB = baptism, DOD= burial.</pre>
</div>
<div title=" Violet Eva Brew (391)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1901-02-27" spouse="" sex="F" dod="0000-00-00" placeofbirth="Pontypridd, Glamorgan, Wales" occupation="" causeofdeath="" placeofdeath="" father=" John Charles Brew (388)" mother=" Sarah Short (389)">
<pre>married Edward John Walsingham, born ca. 1897 in Glamorgan, Wales, son of Frank Walsingham, on 8 September 1924 in Port Talbot, Glamorgan, Wales.</pre>
</div>
<div title=" Violet Evelyn Brew (21)" modifier="YourName" modified="200909252200" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1886-09-00" spouse="" sex="F" dod="1950-00-00" placeofbirth="Neath, Glamorganshire, Wales" occupation="" causeofdeath="" placeofdeath="" father="Richard Brew 1859" mother="Ellen Millet" latitude="" longitude="" dom="" placeofmarriage="">
<pre></pre>
</div>
<div title=" Walter Bellwood (288)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1875-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="William Bellwood" mother="Ann Spence">
<pre></pre>
</div>
<div title=" Walter Franklin (593)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1906-03-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="High Wycombe" occupation="" causeofdeath="" placeofdeath="" father="William (Billy) Franklin" mother="Louisa Gayler">
<pre></pre>
</div>
<div title=" Wilfred John Brew (392)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1905-08-06" spouse="" sex="M" dod="0000-00-00" placeofbirth="Pontypridd, Glamorgan, Wales" occupation="" causeofdeath="" placeofdeath="" father=" John Charles Brew (388)" mother=" Sarah Short (389)">
<pre></pre>
</div>
<div title=" William Bellwood (271)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1812-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Richard Bellwood 1784" mother="Mary Dowthwaite">
<pre></pre>
</div>
<div title=" William Bellwood (276)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1844-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="West Auckland, Durham, England" occupation="" causeofdeath="" placeofdeath="" father=" William Bellwood (271)" mother=" Ann Brown (273)">
<pre>The 1881 census shows him as a painter living at a mechanics yard, East Thickley, Durham, England.

	At the time his wife Margaret Robson has recently passed away and he is living with his future wife Elizabeth Vipond (26) who is currently the housekeeper. He lives with his 2 children Joseph William (7) and Mary Ann (6). </pre>
</div>
<div title=" William COKAYNE (132)" modifier="YourName" modified="200909252248" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="" dod="1599-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="135 Roger Cokayne" mother="Alice ALLSOP" latitude="" longitude="" dom="" placeofmarriage="">
<pre></pre>
</div>
<div title=" William COKAYNE (217)" modifier="YourName" modified="200909240752" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1629-00-00" spouse="" sex="M" dod="1630-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="128" mother="Mary Lady O'BRIEN">
<pre></pre>
</div>
<div title=" William Cokayne (299)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1559-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Thomas Cokayne 1540" mother="Magdalen Towers">
<pre></pre>
</div>
<div title=" William Gartside (480)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1830-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="Linfitts" occupation="" causeofdeath="" placeofdeath="" father="Joseph Gartside 1794" mother="Ruth Roberts">
<pre>Baptised 13 Aug 1830 at St. Thomas, Friarmere.</pre>
</div>
<div title=" William Robson (340)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1835-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="Walker?, Northumberland, England" occupation="" causeofdeath="" placeofdeath="" father="John Robson" mother="Jane UNKNOWN">
<pre>UNCONFIRMED:

	In 1851 census:
	Jane Robson abt 1832 Heaton, Northumberland, England Wife Bishopwearmouth
	Durham
	View Record John Thos Robson abt 1859 Blyth, Northumberland, England Son
	Bishopwearmouth Durham
	View Record Margaret Robson abt 1860 Blyth, Northumberland, England Daughter
	Bishopwearmouth Durham
	View Record William Robson abt 1835 Walker, Northumberland, England Head
	Bishopwearmouth Durham

	In 1861 census:
	Jane Robson abt 1832 Heaton, Northumberland, England Wife Bishopwearmouth Durham
	View Record John Thos Robson abt 1859 Blyth, Northumberland, England Son Bishopwearmouth Durham
	View Record Margaret Robson abt 1860 Blyth, Northumberland, England Daughter Bishopwearmouth Durham
	View Record William Robson abt 1835 Walker, Northumberland, England Head Bishopwearmouth Durham 

	In 1881 census living at 6 Harold Street (Bishopwearmouth, Durham, England census returns):
	William ROBSON  	 Head  	 M  	 Male  	 46  	 Walker, Northumberland, England  Timber Merchant (8 Men 1 Boy)  	  
	Jane ROBSON  	 Wife  	 M  	 Female  	 49  	 Heaton, Northumberland, England  	   	

	Margt. ROBSON  	 Daur  	 U  	 Female  	 21  	 Blythe, Northumberland, England  	     

	Jane A. ROBSON  	 Daur  	 U  	 Female  	 18  	 Sunderland, Durham, England  	   	

	 Isabella ROBSON  	 Daur  	 U  	 Female  	 16  	 Sunderland, Durham, England  	 Scholar  	  
	Barbara ROBSON  	 Daur  	 U  	 Female  	 14  	 Sunderland, Durham, England  	 Scholar  	  
	Mary A. ROBSON  	 Daur  	 U  	 Female  	 12  	 Sunderland, Durham, England  	 Scholar  	  
	Emily ROBSON  	 Daur  	 U  	 Female  	 9  	 Sunderland, Durham, England  	 Scholar
	  	William ROBSON  	 Son  	 U  	 Male  	 2  	 Sunderland, Durham, England  	  </pre>
</div>
<div title=" William Robson (561)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1879-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="Sunderland, Durham, England" occupation="" causeofdeath="" placeofdeath="" father=" William Robson (340)" mother=" Jane Unknown (362)">
<pre></pre>
</div>
<div title=" Winnie Robson (401)" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1895-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="Sunderland, Durham, England" occupation="" causeofdeath="" placeofdeath="" father=" John Thomas Robson (360)" mother=" Dorothy Unknown (361)">
<pre></pre>
</div>
<div title="About" modifier="YourName" modified="200910021555" tags="excludeTree" server.type="file" server.host="file:///Users/Jon/Documents/TiddlyWiki/Trunk/contributors/JonRobson/verticals/FamilyTree/index.html" server.page.revision="200903090000" dob="" placeofbirth="" spouse="" placeofmarriage="" occupation="" dod="" causeofdeath="" placeofdeath="" changecount="2" father="john ro">
<pre>Vismo Tree is a Family Tree vertical for [[TiddlyWiki|http://www.tiddlywiki.org]] created by Jon Robson.
It was first released October 2009. Read the corresponding blog post [[here|http://www.jonrobson.me.uk/posts/Family%20Trees%20for%20TiddlyWiki]]
If you want your own copy simply right click [[this link and select save target as|http://www.jonrobson.me.uk/development/familytree/index.html]]

!Instructions
!!Example
See [[Jon Robson's Family Tree|http://www.jonrobson.me.uk/FamilyTree]]
!!Tagging
Tagging a tiddler with rootTree will make them appear on startup.
Tagging a tiddler with excludeTree will stop it from appearing in the family tree visualisation.

!Feedback
I would love to hear your feedback - please post it [[here|http://groups.google.com/group/TiddlyWiki/topics]] or contact me through [[one of these mediums|http://www.jonrobson.me.uk/posts/AboutMe%20and%20Contact%20Me]]</pre>
</div>
<div title="Abraham Gartside 2" modifier="YourName" modified="200909282050" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Benjamin Gartside 1715" mother="Alice Kershaw" dom="" placeofmarriage="" changecount="1">
<pre>Soldier in Oxford Blues in 1771. Brothers inherited his estates.</pre>
</div>
<div title="Adam Jackson" modifier="YourName" modified="200909252235" changecount="3" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1806-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="Jarrow" occupation="Mason (1824-1861)" causeofdeath="" placeofdeath="" father="Matthew Jackson" mother="Martha UNKNOWN">
<pre>In Sept 1824 brother Robert writes &quot;The stone mason business is better in this country than any other mechanical business. I hope that my brother Adam will continue at his trade and that you will send him to some place where he will learn his business to perfection which if he does not wish to continue in his own country after he is free, the West Indies are far better wages given for men that follow that business than either Europe or America,&quot; - it&quot;s a bit unclear but it was possible that Adam was a stone mason apprentice.

	In 1834 a letter from Robert mentions that his brother Adam has said a married life is good&quot;, this hints that he has married.
	The way Robert talks about his brothers Matthew and Adam suggests he is looking out for them much like an older brother.

	This is the only Adam Jackson listed for Durham in 1841 and he IS a stone mason. He also has a son Robert Jackson, who could be the nephew of Robert that writes a letter asking for information on his uncle.

	Name: Adam Jackson
	Age: 35
	Estimated Birth Year: abt 1806
	Household:Mary 35, Robert 11,Thomas 9,James 7,Margaret 4, Adam 1
	Gender: Male
	Where born: Durham, England
	Civil parish: Gateshead
	Hundred: Chester (East Division)
	County/Island: Durham
	Country: England
	Street address:Hillgate
	Occupation: Mason
	Source information: HO107/296/14
	Registration district: Gateshead
	Sub-registration district: Gateshead
	ED, institution, or vessel: 13
	Folio: 5
	Page: 4 (click to see others on page)
	Line number: 9
	GSU Number: 241345 

	In 1861 the same Adam can be found, however his place of birth is more specific - Jarrow - just like his sister Isabella.
	Name: Adam Jackson
	Age: 55
	Estimated Birth Year: abt 1806
	Relation: Head
	Spouses&quot;s Name: Mary
	Gender: Male
	Where born: Jarrow, Durham, England
	Civil parish: Gateshead
	Ecclesiastical parish: St Mary
	Town: Gateshead
	County/Island: Durham
	Country: England
	Street address:
	Occupation: Stone Mason
	Registration district: Gateshead
	Sub-registration district: Gateshead
	ED, institution, or vessel: 2
	Neighbors: View others on page
	Household schedule number: 110
	Household Members: Name Age
	Adam Jackson 55
	Mary Jackson 56
	Robert Jackson 31 </pre>
</div>
<div title="Adam Jackson 1840" modifier="YourName" modified="200909282049" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1840-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Adam Jackson" mother="Mary UNKNOWN" dom="" placeofmarriage="" changecount="2">
<pre></pre>
</div>
<div title="Adam Lyall" modifier="YourName" modified="200909221742" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1809-00-00" spouse="" sex="M" dod="1881-00-00" placeofbirth="Killingworth, Northumberland" occupation="Blacksmith (1861), Inn Keeper (1871)" causeofdeath="" placeofdeath="" father="" mother="">
<pre>Possible baptism (but unconfirmed):
	1. Baptised 18/12/1808 Child&quot;s name Adam LYAL Father Adam Mother Martha Mother&quot;s Maiden name NISBET Place Gosford Occupation – Other info – Father --- Mother --- Notes John BROWNLEE John ANDERSON Birth date 18/11/1808 Parish Newcastle, High Bridge Meeting, Nbl Checked Checked
	Note Gosforth (possible mispelling is about 3 miles from Killingworth where he is said to be born.
	A Martha Nisbett and Adam &quot;Lyle&quot; married on 09 SEP 1798 at Warkworth, Northumberland, England/

	He is likely to be related to a THOMAS LYALL. In one of the letters sent from America to England from the JACKSONs the sender mentions him.

	1851
	Adam Lyall abt 1808 Northumberland, England Head Wingate Durham
	View Record Elizabeth Lyall abt 1846 Durham, England Daughter Wingate Durham
	View Record Isabell Lyall abt 1808 Durham, England Wife Wingate Durham
	View Record Margaret Lyall abt 1841 Durham, England Daughter Wingate Durham
	View Record Martha Lyall abt 1843 Durham, England Daughter Wingate Durham
	View Record Matthew Lyall abt 1833 Durham, England Son Wingate Durham 

	1861 he is living at Richardson Street and is a Blacksmith
	Adam Lyall abt 1809 Kellingworth, Nottinghamshire, England Head Middlesbrough Yorkshire
	View Record Isabella Lyall abt 1809 Jarrow, Durham, England Wife Middlesbrough Yorkshire
	View Record Margaret Lyall abt 1841 Butterkaowle, Durham, England Daughter Middlesbrough Yorkshire
	View Record Martha Lyall abt 1843 Butterkaowle, Durham, England Daughter Middlesbrough Yorkshire
	View Record Matthew Lyall abt 1833 Jarrow, Durham, England Son Middlesbrough Yorkshire 

	1871 he is living at lower East street and is an Inn keeper
	Adam Lyall abt 1809 Northumberland, England Head Middlesborough Durham
	View Record Elizabeth A Lyall abt 1846 Durham, England Daughter Middlesborough Durham
	View Record Isabell Lyall abt 1809 Durham, England Wife Middlesborough Durham
	View Record Margaret E Lyall abt 1841 Durham, England Daughter Middlesborough Durham 

	Source mispells his name as &quot;Lyill&quot; (familysearch.org).
	The 1881 census shows that his wife Isabella is widowed.

	Due to the fact Jackson is taken by Adam and Isabella&quot;s sons and then later by her grandson Matthew Jackson Robson it is likely Isabella&quot;s original name was Jackson. There are also letters in the family written by ancestors from the Jackson family. A marriage is recorded for Adam Lyall and Isabella Jackson at ST JOHN&quot;S CHURCH situated on the west side of Westgate-street, Durham. The marriage took place on 31 Dec 1831.</pre>
</div>
<div title="Adam Lyall Robson" modifier="YourName" created="200905050818" modified="200909231729" placeofdeath="Swansea" causeofdeath="" occupation="" placeofmarriage="" sex="M" dom="" placeofbirth="in Darlington, Durham" latitude="" longitude="" dob="1870-04-21" dod="1930-01-24" mother="Martha Isabell Lyall" father="John George Robson (2)" spouse="Helen Euphemia Spears" changecount="3">
<pre></pre>
</div>
<div title="AdvancedEditTemplatePlugin" modifier="JonRobson" created="200907301341" modified="200902231538" tags="systemConfig" server.type="file" server.host="file:///Users/Jon/Documents/TiddlyWiki/Trunk/contributors/JonRobson/verticals/FamilyTree/index.html" server.page.revision="200902231538">
<pre>/***
|''Name:''|AdvancedEditTemplatePlugin based on ValueSwitcherPlugin|
|''Description:''|Gather values from a definition tiddler, and present the user with a UI for setting a value from those available options as an extende field |
|''Version:''|0.4|
|''Date:''|02 March 2009|
|''Source:''|http://www.jonrobson.me.uk|
|''Author:''|Jon Robson : based on the work by PhilHawksworth (phawksworth (at) gmail (dot) com)|
|''License:''|[[BSD open source license]]|
|''CoreVersion:''|2.3|

Allows the adding of multiple level drop down menus and checkboxes to the edit template.
***/

//{{{
// Ensure that this Plugin is only installed once.

// create macro object
(function($) { // set up alias

if(store){
  config.shadowTiddlers.AdvancedEditTemplateStyle = &quot;/*{{{*/\n&quot; +
  &quot;.clearboth {clear:both;}\n&quot;+
  &quot;.aet_radioboxes label {width:auto;float:left;}\n&quot;+
  &quot;.aet_radioboxes input {width:auto;float:left;}\n&quot;+
  &quot;.tip {font-style:italic;font-weight:bold;}\n&quot;+
  &quot;.dp-popup {position:absolute;background-color:white;} a.dp-choose-date {	float: left;	width: 16px;	height: 16px;	padding: 0;	margin: 5px 3px 0;	display: block;	text-indent: -2000px;	overflow: hidden;	background: url(calendar.png) no-repeat; }a.dp-choose-date.dp-disabled {	background-position: 0 -20px;	cursor: default;}input.dp-applied {	width: 140px;	float: left;}\n&quot;+
  &quot;.filebrowser{background-color:white; border:solid 1px black;}\n&quot;+
  &quot;a.dp-choose-date {border:solid 1px black;}\n&quot;+
  &quot;.dp-nav-prev {float:left;}\n&quot;+
  &quot;.dp-nav-next {float:right;}\n&quot;+
  &quot;.dp-calendar {clear:both;}\n&quot;+
  &quot;.dp-popup {padding:10px;border:solid 1px black;}\n&quot;+
  &quot;.jCalendar .selected {background-color:gray;}\n&quot;+
  &quot;/*}}}*/&quot;
store.addNotification(&quot;AdvancedEditTemplateStyle&quot;, refreshStyles);
}

config.macros.viewimage ={    
     handler: function(place,macroName,params,wikifier,paramString,tiddler){

        var params = paramString.parseParams(&quot;anon&quot;,null,true,false,false);

    	var classname = getParam(params,&quot;class&quot;);
        if(!classname) classname = &quot;&quot;;

        var src = getParam(params,&quot;src&quot;);
        //alert(&quot;here&quot;);
        var fieldname = getParam(params,&quot;field&quot;);
        if(fieldname) src= tiddler.fields[fieldname];

        var maxw = getParam(params,&quot;maxwidth&quot;);
        var maxh = getParam(params,&quot;maxheight&quot;);
        
        var imagew,imageh;
        
        var html = &quot;&lt;img&quot;;
        if(classname)html+=&quot; class='&quot;+ classname+&quot;' &quot;;
        
        html += &quot; src='&quot;+src+&quot;'&quot;;
        
        if(maxw || maxh){
           
            var image = new Image();

            image.onload = function(){
           
                var ratio =   image.height/image.width;
                
                var largerW, largerH;
                
                if(image.height &gt; image.width){
                    largerH = true;
                }
                else {
                    largerW = true;
                }
                //console.log(&quot;maxw,maxh&quot;,maxw,maxh);
                if(largerW &amp;&amp; image.width &gt; maxw){
                    imagew = maxw;
                    imageh = parseInt(imagew * ratio);
                }
                else if(image.height &gt; maxh){
                    imageh = maxh;
                    imagew = parseInt(imageh / ratio);
                }
                	if(imagew) html += &quot; width='&quot;+imagew+&quot;'&quot;;
                	if(imageh) html += &quot; height='&quot;+imageh+&quot;'&quot;;
                
                html += &quot;/&gt;&quot;;
                //alert(html)\
               
                jQuery(place).append(html);
                	
            };
            image.src = src; //this must come after defining the onload event
        }
        else{
            html += &quot;/&gt;&quot;;
            //alert(html)
            jQuery(place).append(html);
        }

    
    	
   
	
    }
};




if(config.macros.view){
    if(!config.macros.view.views)config.macros.view.views={};
    config.macros.view.views.image = function(value,place,params,wikifier,paramString,tiddler) {
    var classname=&quot;&quot;;
    var params = paramString.parseParams(&quot;anon&quot;,null,true,false,false);
	
    if(params[2]) classname = getParam(params,&quot;class&quot;);
			jQuery(place).append(&quot;&lt;img class='&quot;+ classname+&quot;' src='&quot;+value+&quot;'/&gt;&quot;);
    
    
    
    };
    

    config.macros.view.views.linklist = function(value,place,params,wikifier,paramString,tiddler) {
        var classname=&quot;&quot;;
        var values = value.split(&quot;\n&quot;);
        for(var i=0; i &lt; values.length;i++){
            wikify(&quot;[[&quot;+values[i]+&quot;]]\n&quot;,place);
        }
        
    };
        
    config.macros.view.views.hiddeninput = function(value,place,params,wikifier,paramString,tiddler) {
        var classname=&quot;&quot;;
        if(params[2]) classname = params[2];
	    jQuery(place).append(&quot;&lt;input type='hidden' value='&quot;+value+&quot;'/&gt;&quot;);
    };
}

if(!version.extensions.AdvancedEditTemplatePlugin) 
{
  jQuery(&quot;#storeArea&quot;).append(&quot;&lt;iframe id='aet_iframe' name='aet_post_to' src='' style='display:none;'&gt;&lt;/iframe&gt;&quot;); 
  
	version.extensions.AdvancedEditTemplatePlugin = {installed:true};
	config.macros.aet_setcolor = {
	    	handler: function(place,macroName,params,wikifier,paramString,tiddler) {
	    	    var color =config.macros.AdvancedEditTemplate.getMetaData(tiddler.title,params[0]);
	    	    place.style.backgroundColor = color;
    	    }
	};
	
	config.macros.AdvancedEditTemplate = {
	    lingo:{
	        &quot;aet_upload&quot;:&quot;Upload a local file:&quot;,
	        &quot;aet_imgpreview&quot;:&quot;a preview of currently selected image will be shown here&quot;,
	        &quot;aet_select&quot;:&quot;Please select..&quot;
	    }
	    ,translate: function(id){
	        if(!config.macros.aet.lingo[id]) return id;
	        return config.macros.aet.lingo[id];
	    }
		,getVariableFromQueryString:function(varName){
			var qs = window.location.search.substring(1);
			var atts = qs.split(&quot;&amp;&quot;);

			for(var i =0; i &lt;atts.length; i++){
				var varVal = atts[i].split(&quot;=&quot;);
				if(varVal[0]==varName){

					return decodeURI(varVal[1]);
				}
			}
			return false;

		}
		,setupRadioboxes: function(place,source,selected,handler){
	
		    var lines = source.split(&quot;\n&quot;);
		    var radiogroupname = &quot;radiogroup&quot;+Math.random();
		    var radioHtml = &quot;&quot;;
		     var currentValue = selected;
		    var selected;
		    for(var i=0; i &lt; lines.length; i++){
		        var val = lines[i];
		        if(val != &quot;&quot;){
    		        if(val == currentValue){
    		            selected = &quot;checked=true&quot;;
    		        }
    		        else{
    		            selected = &quot;&quot;;
    		        }
    		        var label;
    		        var spl = val.split(&quot;:&quot;);
    		        if(spl[0] &amp;&amp; spl[1]){
    		            label = spl[0];
    		            val = spl[1];
    		        }
    		        else{
    		            label = val;
    		        }
    		        radioHtml += &quot;&lt;input class='aet_radiobutton' &quot;+selected+&quot; type='radio' value=\&quot;&quot;+val+&quot;\&quot; name='&quot;+radiogroupname+&quot;'/&gt;&lt;label&gt;&quot;+label+&quot;&lt;/label&gt;&quot;;
		        }
		    }
		    jQuery(place).append(&quot;&lt;div class='aet_radioboxes'&gt;&quot;+radioHtml+&quot;&lt;/div&gt;&lt;div class='clearboth'&gt;&lt;/div&gt;&quot;);
		    jQuery(&quot;.aet_radiobutton&quot;,place).click(handler);
		}
		,setupSearchbox: function(place,tiddlerobj,metaDataName,valueSource,handler,needsWikify){
		    if(!valueSource) {
				displayMessage(&quot;Please provide a parameter valuesSource telling me the name of the tiddler where your drop down is defined.&quot;);
				return;
			}
			var selected = store.getValue(tiddlerobj,metaDataName);
			if(!selected){
				var qsvalue =this.getVariableFromQueryString(metaDataName);
				if(qsvalue) selected = qsvalue;
			}
			var tiddlerobj =store.getTiddler(valueSource);
			
			var contents;
			if(needsWikify){
			    var div = document.createElement(&quot;div&quot;);
			    var source = tiddlerobj.text;
			    wikify(source,div,false,tiddlerobj);
			    var contents = div.innerHTML;
		
			    contents = contents.replace(/\&lt;br\/?\&gt;/gi,&quot;\n&quot;);
		    }
		    else{
		        contents = tiddlerobj.text;
		    }
		    
			if(tiddlerobj){
				var values = contents.split('\n');

				this.createSearchBox(place,metaDataName,values,selected,handler);
				jQuery(&quot;input&quot;,place).keypress(function (e) {
				    
        			if(e.which == 13){
        				var results = jQuery(&quot;.ac_over&quot;,&quot;.ac_results&quot;); //is anything highlighted in autocomplete plugin
        				if(results.length ==0)

        					handler(this.value);
        			}
        		});
        		jQuery(&quot;input&quot;,place).blur(function(e){
        		    handler(this.value);
        		});
			
			}
		}
		,setupDropdown: function(place,tiddlerobj,metaDataName,valueSource){
				if(!valueSource) {
					displayMessage(&quot;Please provide a parameter valuesSource telling me the name of the tiddler where your drop down is defined.&quot;);
					return;
				}
				
				if(metaDataName.indexOf(&quot;,&quot;) &gt; -1){
					fields = metaDataName.split(&quot;,&quot;);
					for(var j=0; j &lt; fields.length; j++){
						fields[j] = jQuery.trim(fields[j]);
					}
				}
				else{
					fields = [metaDataName];
				}
				
				var selected = store.getValue(tiddlerobj,fields[fields.length -1]);
				if(!selected){
					var qsvalue =this.getVariableFromQueryString(fields[fields.length-1]);
					if(qsvalue) selected = qsvalue;
				}
				var tiddlerobj =store.getTiddler(valueSource);
				
				if(tiddlerobj){
					var values = tiddlerobj.text.split('\n');
					var sorted = tiddlerobj.tags.contains(&quot;sorted&quot;);
					this.createDropDownMenu(place,fields,values,false,this.setDropDownMetaData,selected,sorted);
				}
		}
		
		,_doStatement: function(stmt,tiddler,or){
		        var delimiter = &quot;&amp;&quot;;
		        if(or){
		            delimiter = &quot;|&quot;;
		        }
		       var params = stmt.split(delimiter);
                var finalEval = true;
                if(or) finalEval = false;
                for(var i=0; i &lt; params.length; i++){
                     var evaluatesTo = true;
                    var arg = params[i];


                    if(arg.indexOf(&quot;!&quot;) == 0){
                        var x = tiddler.fields[arg.substr(1)];
                        //console.log(&quot;cool&quot;);
                        if(x){
                            evaluatesTo = false;
                        }
                        else{
                            evaluatesTo = true;
                        }
                    }
                    else{
                        var x = tiddler.fields[arg];
                        if(!x){
                            evaluatesTo = false;
                        }
                    }
                    if(or){
                        finalEval = evaluatesTo || finalEval;
                    }
                    else{
                        finalEval = evaluatesTo &amp;&amp; finalEval;
                    }//console.log(arg,evaluatesTo,finalEval);

                }
                return finalEval;
		}
		,doifstatement: function(place,stmt,tiddler){
		    var or = false;
		    if(stmt.indexOf(&quot;|&quot;) &gt; -1){
		        or= true;
		    }
		    var finalEval = config.macros.aet._doStatement(stmt,tiddler,or);
            
            if(!finalEval){
                place.innerHTML = &quot;&quot;;
             }
		    
		}
		,handler: function(place,macroName,p,wikifier,paramString,tiddler) {
			var tiddlerDom = story.findContainingTiddler(place);
			var params = paramString.parseParams(&quot;anon&quot;,null,true,false,false);
			var ifstmt = getParam(params,&quot;if&quot;,null);
			if(ifstmt){
                config.macros.aet.doifstatement(place,ifstmt,tiddler);
			    //place.appendChild(newdiv);
			    return;
			}
			var ctrlType = getParam(params,&quot;type&quot;,null);

			var title = tiddlerDom.getAttribute(&quot;tiddler&quot;);
			var tiddlerobj = store.getTiddler(title);
			var metaDataName = getParam(params,&quot;metaDataName&quot;, null);
			var needsWikify = getParam(params,&quot;wikify&quot;, null);
			// build a drop down control
			var valueSource = getParam(params,&quot;valuesSource&quot;, null);
			if(!valueSource) valueSource = metaDataName + &quot;Definition&quot;;
			
			if(ctrlType == 'dropdown') {
			    this.setupDropdown(place,tiddlerobj,metaDataName,valueSource);
			}
			else if(ctrlType == 'embedvideo'){
			    this.setupEmbeddedVideo(place,tiddlerobj,metaDataName,valueSource);
			}
			else if(ctrlType == 'search'){
			    var handler= function(value){
				
					config.macros.AdvancedEditTemplate.setMetaData(title,metaDataName,value);
				};
				this.setupSearchbox(place,tiddlerobj,metaDataName,valueSource,handler,needsWikify);
			}
			else if(ctrlType == 'checkbox'){      					
				this.createCheckBox(place,title,metaDataName);
				
			}
			else if(ctrlType == 'radio'){
			    var source = store.getTiddler(valueSource);
			    if(!source) source = &quot;&quot;;
			    else source = source.text;
			    
	    	    var aet = this;
                var handler = function(e){
		            var newval = this.value;
		            console.log(title,metaDataName,newval);
    		        aet.setMetaData(title,metaDataName,newval);
		        }
		        
            	var selected;
            	if(tiddlerobj)selected= tiddlerobj.fields[metaDataName];
			    this.setupRadioboxes(place,source,selected,handler);
			}
			else if(ctrlType == 'date'){
			        this.createDatePicker(place,title,metaDataName);
			}
			else if(ctrlType == 'color'){
				this.createColorBar(place,title,metaDataName);
			}
			else if(ctrlType == 'image'){
				var that = this;
				var handler = function(value){
					that.setMetaData(title,metaDataName,value);
				};
				var initialValue = &quot;&quot;;
				initialValue = this.getMetaData(title,metaDataName);
				var image = new config.macros.AdvancedEditTemplate.EditTemplateFile(place, paramString,initialValue,handler,true);
			}
			else if(ctrlType == 'text'){
			    var maxlength = getParam(params,&quot;maxlength&quot;, null);
			    var rows = getParam(params,&quot;rows&quot;, null);
			    params = [metaDataName];
			    if(rows) params.push(rows);
			    paramString =&quot;&quot;;
			    var e = config.macros.edit.handler(place,macroName,params,wikifier,paramString,tiddler);
			    if(maxlength) e.setAttribute(&quot;maxlength&quot;,maxlength); 
			}
			else if(ctrlType == 'file'){
				var that = this;
				var handler = function(value){
					that.setMetaData(title,metaDataName,value);
				};
				var initialValue = &quot;&quot;;
				initialValue = this.getMetaData(title,metaDataName);
				var image = new config.macros.AdvancedEditTemplate.EditTemplateFile(place, paramString,initialValue,handler,false);
			}
		}
		,createColorBar: function(place,tiddlerTitle,metaDataName){

			var aet = this;
			var curValue = this.getMetaData(tiddlerTitle,metaDataName);
			var changefunction = function(newcolor){
				aet.setMetaData(tiddlerTitle,metaDataName,newcolor)
			};
			
			var container = document.createElement(&quot;span&quot;);
			place.appendChild(container);
			var slider = new VismoColorSlider(container,200,15,changefunction);
			slider.setColor(curValue);
		}
		,createSearchBox: function(place,fieldName,values,initialValue,action){
		    var whatyousee=[];
			var whatyousave = {};
			for(var i=0; i &lt; values.length; i ++){
			    if(values[i] != &quot;&quot;){
    			    var name_value = values[i].split(&quot;:&quot;);
    			    var name = name_value[0];
    			    var value = name_value[1];
    			    if(!value) value = name;
			    
    			    name = name.replace(/[\&gt;|\&lt;]/ig, &quot;&quot;);
    			    value = value.replace(/[\&gt;|\&lt;]/ig, &quot;&quot;);
    			    whatyousee.push(decodeURI(name));
    			    whatyousave[name] = value;
    			    if(initialValue == value) initialValue = name;
			    }
			}
			var handler = function(event,targets){
			    
			    if(targets.length == 0) return;
			    var name = targets[0]
			    var save_this = whatyousave[name];
			    if(action)action(save_this);
			};
			
			if(!initialValue) initialValue = &quot;&quot;;
			var options = {matchContains: true,selectFirst:false};
		    jQuery(&quot;&lt;input type='text' value=\&quot;&quot;+initialValue +&quot;\&quot;/&gt;&quot;).autocomplete(whatyousee,options).result(handler).appendTo(place);
		
		}

		,_createMenus: function(menutextrepresentation){
			var chain = [0];
			var menus = [];
			var values = menutextrepresentation;
			var myparents = [];
			var depth = 0;
			for (var i=0; i &lt; values.length; i++) {
				
				var value;
				var caption = values[i];
				if(caption.indexOf(&quot;##&quot;) &gt; -1){ //remove any commenting
					caption = caption.substring(0,caption.indexOf(&quot;##&quot;));
				}
				value = caption;

				if(caption.indexOf(&quot;:&quot;) &gt; -1){
					var splitstr= caption.split(&quot;:&quot;);
					caption = splitstr[0];
					value = splitstr[1];
				}
				caption = caption.replace(&quot;&lt;&quot;,&quot;&quot;);
				caption = caption.replace(&quot;&gt;&quot;,&quot;&quot;);
		
				var chainid = chain.length -1;
				if(!menus[chain[chainid]]){
					menus[chain[chainid]] = {depth: depth};
					menus[chain[chainid]].options= [];
				}
	

				if(value.indexOf(&quot;&gt;&quot;) != -1){
					value = value.replace(&quot;&gt;&quot;,&quot;&quot;);
					var newmenuid = menus.length;
					menus[chain[chainid]].options.push({'caption': caption, 'value': value,'childMenu': newmenuid});
					chain.push(newmenuid);
					myparents.push(value+&quot;&gt;&quot;);
					depth += 1;	
			
				}
				else if(value.indexOf(&quot;&lt;&quot;) != -1){			
					value = value.replace(&quot;&lt;&quot;,&quot;&quot;);

					menus[chain[chainid]].options.push({'caption': caption,'value': value});
					myparents.pop();
					chain.pop();
					depth -= 1;	
				}
				else{
					menus[chain[chainid]].options.push({'caption': caption, 'value':value});
				}
			
						

								
			}
	
			return menus;
		}
		,createDropDownMenu: function(place,fieldName,values,initialValue,handler,selected,sort){
				if(typeof fieldName == 'object'){
					fields = fieldName;
				}
				else{
					fields = [fieldName];
				}
				
				
				if(!selected) selected = &quot;&quot;;
				if(!initialValue){
					initialValue = &quot;aet_select&quot;;
				}
				var menus = this._createMenus(values);
				
				var lastMenu, fieldid;
				var allMenus = [];
				var selectedItem = false;
				var nowtselected = true;
			
				
				
				for(var j=menus.length-1; j &gt;-1; j--){
					var newMenu = document.createElement(&quot;select&quot;);
					
					if(j &gt; 0){
						newMenu.style.display = &quot;none&quot;;
					}
					if(fields.length == 1){
						fieldid = 0;
					}
					else{
						fieldid = menus[j].depth;
					}
			
					newMenu.name = fields[fieldid];
					newMenu.associatedFields = fields;
					var menuoptions = menus[j].options;
    				for(var k=0; k&lt;menus[j].options.length;k++){
					    var translation = config.macros.aet.translate(menus[j].options[k].caption);
					    if(translation) menus[j].options[k].caption=translation;
					}
					
					if(sort){		 
						var sorter = function(a,b){if(a.caption &lt; b.caption){ return -1; }else return 1;};
						sorter =menuoptions.sort(sorter);
					}
					var firstCaption= config.macros.aet.translate(initialValue);
					if(!firstCaption)firstCaption = initialValue;
					var topitem = [{'caption': firstCaption, 'value': 'null', 'name': null}];
					menuoptions = topitem.concat(menuoptions);
					
					for(var k=0; k &lt;menuoptions.length; k++){
						var opt =menuoptions[k];
						
						if(opt.caption.replace(&quot; &quot;,&quot;&quot;) != &quot;&quot;){
							var optionEl = document.createElement(&quot;option&quot;);
							if(opt.childMenu) {
								optionEl.childMenu = allMenus[opt.childMenu];
								optionEl.childMenu.parentOption = optionEl;
							}
						
							if(opt.value){
								optionEl.value = opt.value;
							}
			
							if(nowtselected &amp;&amp; optionEl.value ==selected){
								optionEl.selected = true;
								newMenu.style.display = &quot;&quot;;
								selectedItem = optionEl;
								nowtselected = false;
							}
							optionEl.appendChild(document.createTextNode(opt.caption));
							newMenu.appendChild(optionEl);
						}
					}
					newMenu.onchange = function(e){
						

						/*toggle menu*/
						var opt =this[this.selectedIndex];
			
						if(opt.childMenu){
							opt.childMenu.style.display=&quot;&quot;
							if(this.expandedMenu) this.expandedMenu.style.display = &quot;none&quot;;
							this.expandedMenu = opt.childMenu;
						}
						else{
							if(this.expandedMenu) this.expandedMenu.style.display = &quot;none&quot;;
							this.expandedMenu = null;
						}
						
						handler(e,this);
					};
					
					allMenus[j] = newMenu;

					if(lastMenu){
						lastMenu.childMenu = newMenu;
					}
					
					lastMenu = newMenu;
					
				}
				for(var k=0; k &lt; allMenus.length; k++){
					place.appendChild(allMenus[k]);
				}
				
				if(nowtselected){
					selectedItem = allMenus[0].firstChild;
				}
				if(selectedItem){
					this._revealSelectMenus(selectedItem);
				}
		}

		,_revealSelectMenus: function(selecteditem){
			if(!selecteditem.selected) selecteditem.selected = true;
			
			var containingmenu = selecteditem.parentNode;
			
			
			if(selecteditem.childMenu){
				selecteditem.childMenu.style.display = &quot;&quot;;
				containingmenu.expandedMenu = selecteditem.childMenu;
			}
			if(containingmenu.style.display == &quot;none&quot;){
				containingmenu.style.display = &quot;&quot;;
			}
			while(containingmenu){
				var parentoption = containingmenu.parentOption;
				if(parentoption) {
					parentoption.selected = true;
					var parentmenu = parentoption.parentNode;
					if(parentmenu){ 
						parentmenu.style.display = &quot;&quot;;
						parentmenu.expandedMenu = containingmenu;
						containingmenu = parentmenu;
					}
					else{
						containingmenu = false;
					}
				}
				else{
					containingmenu = false;
				}

				
				
			}
			
			//containingmenu.parentMenu.style.display = &quot;&quot;;
		}



		// Ensure that changes to a dropdown field are stored as an extended field.
		,setDropDownMetaData: function(ev,el) {
      
			var e = ev ? ev : window.event;
			var taskTiddler = story.findContainingTiddler(el);
			
			if(taskTiddler &amp;&amp; taskTiddler != undefined) {
				var title = taskTiddler.getAttribute('tiddler');

				
				var selected = el[el.selectedIndex];
				var aet = config.macros.AdvancedEditTemplate;

				
				var fieldname = selected.parentNode.name;
				var fieldvalue = selected.value;
				for(var i=0; i &lt; el.associatedFields.length; i++){
					var fieldname =el.associatedFields[i];
					aet.setMetaData(title,fieldname,fieldvalue);
				}	
				var parent = selected.parentNode.parentOption;
				
				if(selected.value == 'null'){
					if(parent){
						selected = parent;
						fieldvalue = selected.value;	
					}
				}
				
				if(parent){
					aet.setDropDownMetaData(ev,parent.parentNode);
				}
				
				aet.setMetaData(title,fieldname,fieldvalue);
			}
		},
		
		getMetaData: function(title,extField){ 
			extField = extField.toLowerCase();
			var tiddler =  store.getTiddler(title);
			if(!tiddler) {
				return false;
			}
			else{
				if(!tiddler.fields[extField]){
					return false;
				}
				else{
					return tiddler.fields[extField];
				}
			}
		}
		
		,setMetaData: function(title,extField,extFieldVal){
		   
		    console.log(&quot;saving&quot;,title,extField,extFieldVal);
			extField = extField.toLowerCase();
			if(extFieldVal == &quot;null&quot;) {
				extFieldVal = &quot;&quot;;
			}
			var tiddler =  store.getTiddler(title);
			if(!tiddler) {
				store.saveTiddler(title,title,null,true,null,[],config.defaultCustomFields,null);
				tiddler =  store.getTiddler(title);
			}
			store.setValue(tiddler,extField,extFieldVal);	
			
		
		}
		,createDatePicker: function(place,title,metaDataName){
		        
		        var tiddler = store.getTiddler(title);
		        var params = [metaDataName];
		        
                        var div = document.createElement(&quot;div&quot;);
                        div.className  = &quot;datePicker&quot;;
                        var input = document.createElement(&quot;input&quot;);
                        input.className = &quot;date-pick&quot;;
                        jQuery(div).append(input);
                        jQuery(div).append(&quot;&lt;div class='clearboth'&gt;&lt;/div&gt;&quot;);
                        jQuery(place).append(div);
                        $(function()
                        {
                          var start =config.macros.AdvancedEditTemplate.getMetaData(title,metaDataName);
                          if(!start)start=&quot;&quot;;
                          else {
                            var y =start.substr(0,4);
                            var m = start.substr(4,2);
                            var d = start.substr(6,2)
                            start = d+&quot;/&quot;+m+&quot;/&quot;+y;
                          }
                          
                        	$(input).datePicker({startDate: '01/01/1600'}).val(start).trigger('change');
                        	$(input).change(function(e){
                        	    console.log(this.value,&quot;before&quot;);
                        	    var dmy = this.value.split(&quot;/&quot;);
                        	    console.log(dmy,&quot;after&quot;);
                        	    var d = dmy[0];
                        	    var m = dmy[1];
                        	    var y = dmy[2];
                        	    if(d.length == 1) d= &quot;0&quot;+d;
                        	    if(m.length == 1) m= &quot;0&quot;+m;
                        	    console.log(y,m,d,&quot;togo&quot;);
                        	    config.macros.AdvancedEditTemplate.setMetaData(title,metaDataName,y+m+d+&quot;0000&quot;);
                        	
                        	});
                        });
              
		        //config.macros.edit.handler(place,false,params,false,false,tiddler)
                        
		}
		,setupEmbeddedVideo: function(place){
		    place.append(&quot;video url:&lt;input type='text' class='videoinput'/&gt;&quot;);
		    jQuery(&quot;.videoinput&quot;,place).change(function(){
		        alert(&quot;cool&quot;);
		    });
		    
		}
		,createCheckBox: function(place,title,metaDataName){
		         
		        		var c = document.createElement(&quot;input&quot;);
		        		
					c.setAttribute(&quot;type&quot;,&quot;checkbox&quot;);
					c.value = &quot;false&quot;;
					   //    alert(&quot;!&quot;);
	                               place.appendChild(c);
					var selected =this.getMetaData(title,metaDataName);
				
					if(!selected){
						var qsvalue =this.getVariableFromQueryString(metaDataName);
						if(qsvalue) selected = qsvalue;
					}
				
					if(selected){
					        c.value = selected;
					        c.checked = true;
					  
					        
					}
			
					var that = this;
					
					jQuery(c).click(function(e){
					     
						var taskTiddler = story.findContainingTiddler(place);
						var title = taskTiddler.getAttribute(&quot;tiddler&quot;);
						
						if(this.checked){
							that.setMetaData(title,metaDataName,&quot;true&quot;);
						}
						else{
						  
							that.setMetaData(title,metaDataName,null);
						}
					});
						
					
		}
	};
	
	
	config.macros.AdvancedEditTemplate.EditTemplateFile = function(place,paramString,initial,handler,preview){
		this.init(place,paramString,initial,handler,preview);
	};
	config.macros.AdvancedEditTemplate.EditTemplateFile.prototype = {
		init: function(place,paramString,initial,handler,preview){
			var holder = document.createElement(&quot;div&quot;);
			holder.className = &quot;AdvancedEditTemplateImage&quot;;
			//JON
			
			var imageholder = document.createElement(&quot;div&quot;);
			imageholder.className = &quot;aet_ImageHolder&quot;;

			//image.src = initial;
			//image.alt = config.macros.aet.translate(&quot;aet_imgpreview&quot;);

			var params = paramString.parseParams(&quot;anon&quot;,null,true,false,false);
                	
			var root = getParam(params,&quot;root&quot;, null);
			var connector = getParam(params,&quot;browser&quot;, null);
			var uploader =getParam(params,&quot;uploader&quot;,null);
			var home = &quot;&quot;;
			place.appendChild(holder);
			if(preview){
			    holder.appendChild(imageholder);			
			    config.macros.viewimage.handler(imageholder,false,false,false,&quot;maxwidth:200 maxheight:200 src:&quot;+initial,tiddler);
			}

			

			
			var form = document.createElement(&quot;div&quot;);
			holder.appendChild(form);
			var filenameid = &quot;filename_&quot;+ Math.random();
            form.innerHTML = &quot;&lt;form target='aet_post_to' action='&quot;+uploader+&quot;?postbackto=&quot;+ filenameid +&quot;' id='submitter' enctype='multipart/form-data' name='mysexyform' action='/ilga/upload/image' method='POST'&gt;&quot;+config.macros.aet.translate(&quot;aet_upload&quot;)+&quot;url:&lt;input type='text' id='&quot;+filenameid+&quot;' name='NewFilename' class='filename' value=''/&gt;&lt;input type='file' class='file' id='NewFile' name='NewFile'/&gt;&lt;input type='submit' value='Send'&gt;&lt;/form&gt;&quot;;
         
            
            var jqFile = jQuery(&quot;.file&quot;,form);
			jqFile.change(function(e){
			    var newvalue = jQuery(e.target).val();
			    
			   jQuery(&quot;.filename&quot;,form).val(newvalue); 
			});
			  
                
			jQuery(holder).append(&quot;&lt;div class='leftcol'&gt;&lt;/div&gt;&lt;div class='rightcol'&gt;&lt;/div&gt;&quot;);

			var filename = jQuery(&quot;.filename&quot;,form)[0];		
			filename.onchange = function(e){
				var newsrc = this.value;
				//image.src=  &quot;&quot;;
				//image.src = newsrc;
				jQuery(imageholder).html(&quot;&quot;);
				config.macros.viewimage.handler(imageholder,false,false,false,&quot;maxwidth:200 maxheight:200 src:&quot;+newsrc,tiddler);
				if(handler)handler(newsrc);
			};
			if(initial)filename.value = initial;	
			jQuery(&quot;.rightcol&quot;,holder).append(&quot;&lt;div class='browserarea' style='position:relative;'&gt;&lt;input type='button' class='browsebutton' value='browse'&gt;&lt;div class='filebrowser' style='position:absolute;display:none;z-index:200'&gt;&lt;/div&gt;&lt;/div&gt;&quot;);
			var bb = jQuery(&quot;.browsebutton&quot;,holder);
			bb.click(function(e){
			    var browser =$(&quot;.filebrowser&quot;,$(this).parent());
			    browser.toggle();
		
			    browser.css({left:$(this).position().left});    
			})
			
			
			var browser = jQuery(&quot;.filebrowser&quot;);

			var r;
			if(!home) home = &quot;&quot;;
			if(root) r =root; else r =&quot;&quot;;
			/*browser.fileTree({ root: r, script: connector }, function(file) { 
						filename.value = file;
						filename.onchange();
			});*/
			
		}
	};
};
config.macros.aet = config.macros.AdvancedEditTemplate;

//}}}
document.styleSheets['vismoColorSlider'] = {cssText: &quot;.vismoColorSliderMixBox {border:solid 1px black;}&quot;};

var VismoColorSlider = function(wrapper,width,height,changefunction){	
	wrapper.style.position = &quot;absolute&quot;;
	if(!changefunction){
		changefunction = function(newcolor){
			alert(newcolor + &quot;is the new color. Please define a change function to replace this default function.&quot;);
		}
		this.setChangeFunction(changefunction);
	}
	
	//wrapper.style.position = &quot;absolute&quot;;
	var sliderheight = height / 3;
	
	this.sliders = {};
	this.bar = {};
	this.sliders.red = this._createSlider(wrapper,width,sliderheight,&quot;red&quot;);
	this.sliders.green =this._createSlider(wrapper,width,sliderheight,&quot;green&quot;);
	this.sliders.blue = this._createSlider(wrapper,width,sliderheight,&quot;blue&quot;);
	this.sliders.width = width;
	
	this.mixbox =this._createMixBox(wrapper,height,height);
	this.mixbox.style.left = parseInt(width + 5) + &quot;px&quot;;
	
	this.inputfield = this._createInputField(wrapper,width,height);
	this.inputfield.style.top = parseInt((sliderheight * 3) + 5) + &quot;px&quot;;
	this.rgb= {'red':0,'green':0,'blue':0};
	
};

VismoColorSlider.prototype = {
	setChangeFunction:function(change){
		this.changefunction = change;
	}
	,_createInputField: function(wrapper,width,height){
		var input= document.createElement(&quot;input&quot;);
		input.style.width = width + &quot;px&quot;;
		input.style.height = height + &quot;px&quot;;
		var ecs = this;
		input.onblur = function(e){
			ecs.setColor(this.value);
		}
		input.style.position = &quot;absolute&quot;;
		wrapper.appendChild(input);
		return input;
	}
	/* thank you http://www.javascripter.net/faq/hextorgb.htm*/
	,_cutHex: function(h) {return (h.charAt(0)==&quot;#&quot;) ? h.substring(1,7):h}
	,_hexToR:function(h){return parseInt((this._cutHex(h)).substring(0,2),16)}
	,_hexToG: function (h) {return parseInt((this._cutHex(h)).substring(2,4),16)}
	,_hexToB:function(h) {return parseInt((this._cutHex(h)).substring(4,6),16)}
	
	
	,setColor: function(rgb){
		if(rgb.indexOf(&quot;#&quot;) == 0 &amp;&amp; rgb.indexOf(&quot;,&quot;) == -1){ //hex code argument
			var hexcode = rgb.substring(1);
			this.rgb.red = this._hexToR(hexcode);
			this.rgb.blue = this._hexToB(hexcode);
			this.rgb.green = this._hexToG(hexcode);
		}
		else if(rgb.indexOf(&quot;rgb(&quot;) == 0){ //rgb argument
			var rgbstring = rgb.substring(4,rgb.length - 1);
			rgbstring = rgbstring.split(&quot;,&quot;);
			this.rgb.red = rgbstring[0];
			this.rgb.green = rgbstring[1];
			this.rgb.blue = rgbstring[2];
			
		}
		else{
			return false;
		}
	
		var redleft = parseFloat(this.rgb.red /255) * parseInt(this.sliders.width);
		var greenleft =  parseFloat(this.rgb.green /255) * parseInt(this.sliders.width);
		var blueleft = parseFloat(this.rgb.blue /255) * parseInt(this.sliders.width);
		//console.log(this.sliders.width,redleft,greenleft,blueleft,this.rgb,rgb);
		this.bar.red.style.left =  redleft + &quot;px&quot;;
		this.bar.green.style.left = greenleft + &quot;px&quot;;
		this.bar.blue.style.left =  blueleft  + &quot;px&quot;;
		this.mixColors();
		
	}
	,getColor: function(){
		this.mixColors();
		return this.currentColor;
	}
	,mixColors: function(){
		var rgb  = &quot;rgb(&quot;+this.rgb.red+&quot;,&quot;+ this.rgb.green+&quot;,&quot;+this.rgb.blue+&quot;)&quot;;
		this.currentColor = rgb;
		this.mixbox.style.background = rgb;
		this.inputfield.value = rgb;
		if(this.changefunction)this.changefunction(rgb);
	}
	,_createMixBox: function(wrapper,width,height){
		var s = document.createElement(&quot;div&quot;);
		s.className = &quot;vismoColorSliderMixBox&quot;;
		s.style.position = &quot;absolute&quot;;
		s.style.width = width + &quot;px&quot;;
		s.style.height = height + &quot;px&quot;;	
		wrapper.appendChild(s);
		return s;
				
	}
	,_createSlider: function(wrapper,width,height,color){
		var slidebar = document.createElement(&quot;div&quot;);
		slidebar.style.position = &quot;absolute&quot;;
		slidebar.style.height = parseInt(height/2) + &quot;px&quot;;
		slidebar.style.width = &quot;2px&quot;;
		slidebar.style.background = &quot;black&quot;;
		slidebar.style.border = &quot;solid 1px black&quot;;
		var s = document.createElement(&quot;div&quot;);
		//s.innerHTML = color;
		s.style.position = &quot;absolute&quot;;
		s.style.width = width + &quot;px&quot;;
		s.style.height = height + &quot;px&quot;;	
		s.style.background = color;
		s.className = &quot;vismoColorSlider&quot;;
		var vismocolorslider = this;
		s.onmousedown = function(e){
			var pos =VismoClickingUtils.getMouseFromEventRelativeToTarget(e,this);
			var newleft =pos.x + this.style.left;
			slidebar.style.left = newleft + &quot;px&quot;;
			var percentage = (pos.x / width)
			vismocolorslider.rgb[color] = parseInt(percentage * 255);		
			vismocolorslider.mixColors();	
		}
		wrapper.appendChild(s);
		wrapper.appendChild(slidebar);
		
		var top = 0;
		if(color =='red'){
			top = &quot;0px&quot;;
			slidebar.style.top = top;
			s.style.top = top;
			this.bar.red = slidebar;
		}
		else if(color =='blue'){
			top =height * 2;
			slidebar.style.top = top+&quot;px&quot;;
			s.style.top = top+&quot;px&quot;;
			this.bar.blue = slidebar;
		}
		else if(color = 'green'){
			top =height +&quot;px&quot;;
			slidebar.style.top = top;
			s.style.top = top;
			this.bar.green = slidebar;
		}
		return s;
	}
	
};var VismoClickingUtils = {
        //to be implemented..
        inVisibleArea: function(vismoCanvas,vismoShape){
                var bb = vismoShape.getBoundingBox();
                return true;
        }
        ,scrollXY: function(){
          var scrOfX = 0, scrOfY = 0;
          if( typeof( window.pageYOffset ) == 'number' ) {
            //Netscape compliant
            scrOfY = window.pageYOffset;
            scrOfX = window.pageXOffset;
          } else if( document.body &amp;&amp; ( document.body.scrollLeft || document.body.scrollTop ) ) {
            //DOM compliant
            scrOfY = document.body.scrollTop;
            scrOfX = document.body.scrollLeft;
          } else if( document.documentElement &amp;&amp; ( document.documentElement.scrollLeft || document.documentElement.scrollTop ) ) {
            //IE6 standards compliant mode
            scrOfY = document.documentElement.scrollTop;
            scrOfX = document.documentElement.scrollLeft;
          }
          return {x: scrOfX,y: scrOfY};
        }
	,getRealXYFromMouse: function(e,t){
		var newpos =VismoClickingUtils.getMouseFromEvent(e);
		newpos = VismoClickingUtils.undotransformation(newpos.x,newpos.y,t);
		return newpos;
	}
	
	,undotransformation: function(x,y,transformation){ //porting to VismoTransformations?
		return VismoTransformations.undoTransformation(x,y,transformation);
	}	
	,resolveTarget:function(e)
	{
		if(!e) e = window.event;
		var obj;
		
		if(e &amp;&amp; e.srcElement){
			obj = e.srcElement;
		}
	        else if(e.target)
        	        obj = e.target;
        	else{
	                obj = false;
	        }
	        try{
                        var x = obj.parentNode;
                }catch(e){return false;}
                /*
		if(obj &amp;&amp; obj.nodeType &amp;&amp; obj.nodeType == 3) // defeat Safari bug
			obj = obj.parentNode;
			*/
			
			/*try{
                                var x = obj.parentNode;
                        }
                        catch(e){return false;};*/
	        return obj;

		//return obj;
	}
	
	
	,getMouseFromEvent : function(e,target){
			if(!e) e = window.event;
			
			if(!target){
			       
			        var target = this.resolveTargetWithVismo(e);
			        if(!target)return false;
                        }
                        
			var offset = jQuery(target).offset();
               
                        var i;
          
			if(typeof(offset.left) != 'number') return false;
		
		        var scroll = this.scrollXY(e);
			x = e.clientX + scroll.x;
			y = e.clientY + scroll.y;
			//alert(x +&quot;/&quot;+y);
			x -= offset.left;
			y-=  offset.top;
			
			return {'x':x, 'y':y};		
			
	}
	,getMouseFromEventRelativeToTarget : function(e,target){
			if(!e) e = window.event;
			if(!target)return false;

			var offset = jQuery(target).offset();

			
			if(!offset.left) return false;
			var scroll = this.scrollXY();
			x = e.clientX + scroll.x - offset.left;
			y = e.clientY + scroll.y - offset.top;
			return {'x':x, 'y':y};		
			
	}

	,resolveTargetWithVismo: function(e)
	{
		var node = VismoClickingUtils.resolveTarget(e);
                

                
		if(!node)return false;
		var hasVismo = false;
     
                
		while(!hasVismo &amp;&amp; node != document &amp;&amp; node.parentNode &amp;&amp; node.parentNode != document){
		        
		        if(node.vismoCanvas || node.vismoController || node.vismoClicking){
		                hasVismo = true;
			}
			else{
			        node= node.parentNode;
			}
		}
		
		if(!node) return false;
		return node;
	}
	,getMouseFromEventRelativeToElement: function (e,x,y,target){
		if(!e) e = window.event;

		var offset = jQuery(target).offset();
		if(!offset.left) return false;
		
		var scroll = this.scrollXY();
		oldx = e.clientX + scroll.x - offset.left;
		oldy = e.clientY + scroll.y - offset.top;
		var pos = {'x':oldx, 'y':oldy};

		if(!pos) return false;
		pos.x -= x;
		pos.y -= y;
		

		return pos;
		
	}

	,getMouseFromEventRelativeTo: function (e,x,y){
	
		var pos = this.getMouseFromEvent(e);
		if(!pos) return false;
		pos.x -= x;
		pos.y -= y;

		return pos;
	
	}
	,getMouseFromEventRelativeToElementCenter: function(e){ /*redundant?? */
		var w,h;
		var target = this.resolveTargetWithVismo(e);
		if(!target)return;
		if(target.style.width)
			w = parseInt(target.style.width);
		else if(target.width)
			w =parseInt(target.width);

		if(target.style.height)
			h = parseInt(target.style.height);
		else if(target.height)
			h = parseInt(target.height);
	
		if(!w || !h) throw &quot;target has no width or height (vismomaputils)&quot;;
	
		return this.getMouseFromEventRelativeTo(e,w/2,h/2);
	}	
	

};

/* JQUERY PLUGINS GO HERE! */

/*
 * Date prototype extensions. Doesn't depend on any
 * other code. Doens't overwrite existing methods.
 *
 * Adds dayNames, abbrDayNames, monthNames and abbrMonthNames static properties and isLeapYear,
 * isWeekend, isWeekDay, getDaysInMonth, getDayName, getMonthName, getDayOfYear, getWeekOfYear,
 * setDayOfYear, addYears, addMonths, addDays, addHours, addMinutes, addSeconds methods
 *
 * Copyright (c) 2006 JÃ¶rn Zaefferer and Brandon Aaron (brandon.aaron@gmail.com || http://brandonaaron.net)
 *
 * Additional methods and properties added by Kelvin Luck: firstDayOfWeek, dateFormat, zeroTime, asString, fromString -
 * I've added my name to these methods so you know who to blame if they are broken!
 * 
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 */

/**
 * An Array of day names starting with Sunday.
 * 
 * @example dayNames[0]
 * @result 'Sunday'
 *
 * @name dayNames
 * @type Array
 * @cat Plugins/Methods/Date
 */
Date.dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

/**
 * An Array of abbreviated day names starting with Sun.
 * 
 * @example abbrDayNames[0]
 * @result 'Sun'
 *
 * @name abbrDayNames
 * @type Array
 * @cat Plugins/Methods/Date
 */
Date.abbrDayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

/**
 * An Array of month names starting with Janurary.
 * 
 * @example monthNames[0]
 * @result 'January'
 *
 * @name monthNames
 * @type Array
 * @cat Plugins/Methods/Date
 */
Date.monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];

/**
 * An Array of abbreviated month names starting with Jan.
 * 
 * @example abbrMonthNames[0]
 * @result 'Jan'
 *
 * @name monthNames
 * @type Array
 * @cat Plugins/Methods/Date
 */
Date.abbrMonthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

/**
 * The first day of the week for this locale.
 *
 * @name firstDayOfWeek
 * @type Number
 * @cat Plugins/Methods/Date
 * @author Kelvin Luck
 */
Date.firstDayOfWeek = 1;

/**
 * The format that string dates should be represented as (e.g. 'dd/mm/yyyy' for UK, 'mm/dd/yyyy' for US, 'yyyy-mm-dd' for Unicode etc).
 *
 * @name format
 * @type String
 * @cat Plugins/Methods/Date
 * @author Kelvin Luck
 */
Date.format = 'dd/mm/yyyy';
//Date.format = 'mm/dd/yyyy';
//Date.format = 'yyyy-mm-dd';
//Date.format = 'dd mmm yy';

/**
 * The first two numbers in the century to be used when decoding a two digit year. Since a two digit year is ambiguous (and date.setYear
 * only works with numbers &lt; 99 and so doesn't allow you to set years after 2000) we need to use this to disambiguate the two digit year codes.
 *
 * @name format
 * @type String
 * @cat Plugins/Methods/Date
 * @author Kelvin Luck
 */
Date.fullYearStart = '20';

(function() {

	/**
	 * Adds a given method under the given name 
	 * to the Date prototype if it doesn't
	 * currently exist.
	 *
	 * @private
	 */
	function add(name, method) {
		if( !Date.prototype[name] ) {
			Date.prototype[name] = method;
		}
	};
	
	/**
	 * Checks if the year is a leap year.
	 *
	 * @example var dtm = new Date(&quot;01/12/2008&quot;);
	 * dtm.isLeapYear();
	 * @result true
	 *
	 * @name isLeapYear
	 * @type Boolean
	 * @cat Plugins/Methods/Date
	 */
	add(&quot;isLeapYear&quot;, function() {
		var y = this.getFullYear();
		return (y%4==0 &amp;&amp; y%100!=0) || y%400==0;
	});
	
	/**
	 * Checks if the day is a weekend day (Sat or Sun).
	 *
	 * @example var dtm = new Date(&quot;01/12/2008&quot;);
	 * dtm.isWeekend();
	 * @result false
	 *
	 * @name isWeekend
	 * @type Boolean
	 * @cat Plugins/Methods/Date
	 */
	add(&quot;isWeekend&quot;, function() {
		return this.getDay()==0 || this.getDay()==6;
	});
	
	/**
	 * Check if the day is a day of the week (Mon-Fri)
	 * 
	 * @example var dtm = new Date(&quot;01/12/2008&quot;);
	 * dtm.isWeekDay();
	 * @result false
	 * 
	 * @name isWeekDay
	 * @type Boolean
	 * @cat Plugins/Methods/Date
	 */
	add(&quot;isWeekDay&quot;, function() {
		return !this.isWeekend();
	});
	
	/**
	 * Gets the number of days in the month.
	 * 
	 * @example var dtm = new Date(&quot;01/12/2008&quot;);
	 * dtm.getDaysInMonth();
	 * @result 31
	 * 
	 * @name getDaysInMonth
	 * @type Number
	 * @cat Plugins/Methods/Date
	 */
	add(&quot;getDaysInMonth&quot;, function() {
		return [31,(this.isLeapYear() ? 29:28),31,30,31,30,31,31,30,31,30,31][this.getMonth()];
	});
	
	/**
	 * Gets the name of the day.
	 * 
	 * @example var dtm = new Date(&quot;01/12/2008&quot;);
	 * dtm.getDayName();
	 * @result 'Saturday'
	 * 
	 * @example var dtm = new Date(&quot;01/12/2008&quot;);
	 * dtm.getDayName(true);
	 * @result 'Sat'
	 * 
	 * @param abbreviated Boolean When set to true the name will be abbreviated.
	 * @name getDayName
	 * @type String
	 * @cat Plugins/Methods/Date
	 */
	add(&quot;getDayName&quot;, function(abbreviated) {
		return abbreviated ? Date.abbrDayNames[this.getDay()] : Date.dayNames[this.getDay()];
	});

	/**
	 * Gets the name of the month.
	 * 
	 * @example var dtm = new Date(&quot;01/12/2008&quot;);
	 * dtm.getMonthName();
	 * @result 'Janurary'
	 *
	 * @example var dtm = new Date(&quot;01/12/2008&quot;);
	 * dtm.getMonthName(true);
	 * @result 'Jan'
	 * 
	 * @param abbreviated Boolean When set to true the name will be abbreviated.
	 * @name getDayName
	 * @type String
	 * @cat Plugins/Methods/Date
	 */
	add(&quot;getMonthName&quot;, function(abbreviated) {
		return abbreviated ? Date.abbrMonthNames[this.getMonth()] : Date.monthNames[this.getMonth()];
	});

	/**
	 * Get the number of the day of the year.
	 * 
	 * @example var dtm = new Date(&quot;01/12/2008&quot;);
	 * dtm.getDayOfYear();
	 * @result 11
	 * 
	 * @name getDayOfYear
	 * @type Number
	 * @cat Plugins/Methods/Date
	 */
	add(&quot;getDayOfYear&quot;, function() {
		var tmpdtm = new Date(&quot;1/1/&quot; + this.getFullYear());
		return Math.floor((this.getTime() - tmpdtm.getTime()) / 86400000);
	});
	
	/**
	 * Get the number of the week of the year.
	 * 
	 * @example var dtm = new Date(&quot;01/12/2008&quot;);
	 * dtm.getWeekOfYear();
	 * @result 2
	 * 
	 * @name getWeekOfYear
	 * @type Number
	 * @cat Plugins/Methods/Date
	 */
	add(&quot;getWeekOfYear&quot;, function() {
		return Math.ceil(this.getDayOfYear() / 7);
	});

	/**
	 * Set the day of the year.
	 * 
	 * @example var dtm = new Date(&quot;01/12/2008&quot;);
	 * dtm.setDayOfYear(1);
	 * dtm.toString();
	 * @result 'Tue Jan 01 2008 00:00:00'
	 * 
	 * @name setDayOfYear
	 * @type Date
	 * @cat Plugins/Methods/Date
	 */
	add(&quot;setDayOfYear&quot;, function(day) {
		this.setMonth(0);
		this.setDate(day);
		return this;
	});
	
	/**
	 * Add a number of years to the date object.
	 * 
	 * @example var dtm = new Date(&quot;01/12/2008&quot;);
	 * dtm.addYears(1);
	 * dtm.toString();
	 * @result 'Mon Jan 12 2009 00:00:00'
	 * 
	 * @name addYears
	 * @type Date
	 * @cat Plugins/Methods/Date
	 */
	add(&quot;addYears&quot;, function(num) {
		this.setFullYear(this.getFullYear() + num);
		return this;
	});
	
	/**
	 * Add a number of months to the date object.
	 * 
	 * @example var dtm = new Date(&quot;01/12/2008&quot;);
	 * dtm.addMonths(1);
	 * dtm.toString();
	 * @result 'Tue Feb 12 2008 00:00:00'
	 * 
	 * @name addMonths
	 * @type Date
	 * @cat Plugins/Methods/Date
	 */
	add(&quot;addMonths&quot;, function(num) {
		var tmpdtm = this.getDate();
		
		this.setMonth(this.getMonth() + num);
		
		if (tmpdtm &gt; this.getDate())
			this.addDays(-this.getDate());
		
		return this;
	});
	
	/**
	 * Add a number of days to the date object.
	 * 
	 * @example var dtm = new Date(&quot;01/12/2008&quot;);
	 * dtm.addDays(1);
	 * dtm.toString();
	 * @result 'Sun Jan 13 2008 00:00:00'
	 * 
	 * @name addDays
	 * @type Date
	 * @cat Plugins/Methods/Date
	 */
	add(&quot;addDays&quot;, function(num) {
		//this.setDate(this.getDate() + num);
		this.setTime(this.getTime() + (num*86400000) );
		return this;
	});
	
	/**
	 * Add a number of hours to the date object.
	 * 
	 * @example var dtm = new Date(&quot;01/12/2008&quot;);
	 * dtm.addHours(24);
	 * dtm.toString();
	 * @result 'Sun Jan 13 2008 00:00:00'
	 * 
	 * @name addHours
	 * @type Date
	 * @cat Plugins/Methods/Date
	 */
	add(&quot;addHours&quot;, function(num) {
		this.setHours(this.getHours() + num);
		return this;
	});

	/**
	 * Add a number of minutes to the date object.
	 * 
	 * @example var dtm = new Date(&quot;01/12/2008&quot;);
	 * dtm.addMinutes(60);
	 * dtm.toString();
	 * @result 'Sat Jan 12 2008 01:00:00'
	 * 
	 * @name addMinutes
	 * @type Date
	 * @cat Plugins/Methods/Date
	 */
	add(&quot;addMinutes&quot;, function(num) {
		this.setMinutes(this.getMinutes() + num);
		return this;
	});
	
	/**
	 * Add a number of seconds to the date object.
	 * 
	 * @example var dtm = new Date(&quot;01/12/2008&quot;);
	 * dtm.addSeconds(60);
	 * dtm.toString();
	 * @result 'Sat Jan 12 2008 00:01:00'
	 * 
	 * @name addSeconds
	 * @type Date
	 * @cat Plugins/Methods/Date
	 */
	add(&quot;addSeconds&quot;, function(num) {
		this.setSeconds(this.getSeconds() + num);
		return this;
	});
	
	/**
	 * Sets the time component of this Date to zero for cleaner, easier comparison of dates where time is not relevant.
	 * 
	 * @example var dtm = new Date();
	 * dtm.zeroTime();
	 * dtm.toString();
	 * @result 'Sat Jan 12 2008 00:01:00'
	 * 
	 * @name zeroTime
	 * @type Date
	 * @cat Plugins/Methods/Date
	 * @author Kelvin Luck
	 */
	add(&quot;zeroTime&quot;, function() {
		this.setMilliseconds(0);
		this.setSeconds(0);
		this.setMinutes(0);
		this.setHours(0);
		return this;
	});
	
	/**
	 * Returns a string representation of the date object according to Date.format.
	 * (Date.toString may be used in other places so I purposefully didn't overwrite it)
	 * 
	 * @example var dtm = new Date(&quot;01/12/2008&quot;);
	 * dtm.asString();
	 * @result '12/01/2008' // (where Date.format == 'dd/mm/yyyy'
	 * 
	 * @name asString
	 * @type Date
	 * @cat Plugins/Methods/Date
	 * @author Kelvin Luck
	 */
	add(&quot;asString&quot;, function(format) {
		var r = format || Date.format;
		return r
			.split('yyyy').join(this.getFullYear())
			.split('yy').join((this.getFullYear() + '').substring(2))
			.split('mmmm').join(this.getMonthName(false))
			.split('mmm').join(this.getMonthName(true))
			.split('mm').join(_zeroPad(this.getMonth()+1))
			.split('dd').join(_zeroPad(this.getDate()));
	});
	
	/**
	 * Returns a new date object created from the passed String according to Date.format or false if the attempt to do this results in an invalid date object
	 * (We can't simple use Date.parse as it's not aware of locale and I chose not to overwrite it incase it's functionality is being relied on elsewhere)
	 *
	 * @example var dtm = Date.fromString(&quot;12/01/2008&quot;);
	 * dtm.toString();
	 * @result 'Sat Jan 12 2008 00:00:00' // (where Date.format == 'dd/mm/yyyy'
	 * 
	 * @name fromString
	 * @type Date
	 * @cat Plugins/Methods/Date
	 * @author Kelvin Luck
	 */
	Date.fromString = function(s)
	{
		var f = Date.format;
		var d = new Date('01/01/1977');
		
		var mLength = 0;

		var iM = f.indexOf('mmmm');
		if (iM &gt; -1) {
			for (var i=0; i&lt;Date.monthNames.length; i++) {
				var mStr = s.substr(iM, Date.monthNames[i].length);
				if (Date.monthNames[i] == mStr) {
					mLength = Date.monthNames[i].length - 4;
					break;
				}
			}
			d.setMonth(i);
		} else {
			iM = f.indexOf('mmm');
			if (iM &gt; -1) {
				var mStr = s.substr(iM, 3);
				for (var i=0; i&lt;Date.abbrMonthNames.length; i++) {
					if (Date.abbrMonthNames[i] == mStr) break;
				}
				d.setMonth(i);
			} else {
				d.setMonth(Number(s.substr(f.indexOf('mm'), 2)) - 1);
			}
		}
		
		var iY = f.indexOf('yyyy');

		if (iY &gt; -1) {
			if (iM &lt; iY)
			{
				iY += mLength;
			}
			d.setFullYear(Number(s.substr(iY, 4)));
		} else {
			if (iM &lt; iY)
			{
				iY += mLength;
			}
			// TODO - this doesn't work very well - are there any rules for what is meant by a two digit year?
			d.setFullYear(Number(Date.fullYearStart + s.substr(f.indexOf('yy'), 2)));
		}
		var iD = f.indexOf('dd');
		if (iM &lt; iD)
		{
			iD += mLength;
		}
		d.setDate(Number(s.substr(iD, 2)));
		if (isNaN(d.getTime())) {
			return false;
		}
		return d;
	};
	
	// utility method
	var _zeroPad = function(num) {
		var s = '0'+num;
		return s.substring(s.length-2)
		//return ('0'+num).substring(-2); // doesn't work on IE :(
	};
	
})();

/**
 * Copyright (c) 2008 Kelvin Luck (http://www.kelvinluck.com/)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) 
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * $Id: jquery.datePicker.js 70 2009-04-05 19:25:15Z kelvin.luck $
 **/

(function($){
    
	$.fn.extend({
/**
 * Render a calendar table into any matched elements.
 * 
 * @param Object s (optional) Customize your calendars.
 * @option Number month The month to render (NOTE that months are zero based). Default is today's month.
 * @option Number year The year to render. Default is today's year.
 * @option Function renderCallback A reference to a function that is called as each cell is rendered and which can add classes and event listeners to the created nodes. Default is no callback.
 * @option Number showHeader Whether or not to show the header row, possible values are: $.dpConst.SHOW_HEADER_NONE (no header), $.dpConst.SHOW_HEADER_SHORT (first letter of each day) and $.dpConst.SHOW_HEADER_LONG (full name of each day). Default is $.dpConst.SHOW_HEADER_SHORT.
 * @option String hoverClass The class to attach to each cell when you hover over it (to allow you to use hover effects in IE6 which doesn't support the :hover pseudo-class on elements other than links). Default is dp-hover. Pass false if you don't want a hover class.
 * @type jQuery
 * @name renderCalendar
 * @cat plugins/datePicker
 * @author Kelvin Luck (http://www.kelvinluck.com/)
 *
 * @example $('#calendar-me').renderCalendar({month:0, year:2007});
 * @desc Renders a calendar displaying January 2007 into the element with an id of calendar-me.
 *
 * @example
 * var testCallback = function($td, thisDate, month, year)
 * {
 * if ($td.is('.current-month') &amp;&amp; thisDate.getDay() == 4) {
 *		var d = thisDate.getDate();
 *		$td.bind(
 *			'click',
 *			function()
 *			{
 *				alert('You clicked on ' + d + '/' + (Number(month)+1) + '/' + year);
 *			}
 *		).addClass('thursday');
 *	} else if (thisDate.getDay() == 5) {
 *		$td.html('Friday the ' + $td.html() + 'th');
 *	}
 * }
 * $('#calendar-me').renderCalendar({month:0, year:2007, renderCallback:testCallback});
 * 
 * @desc Renders a calendar displaying January 2007 into the element with an id of calendar-me. Every Thursday in the current month has a class of &quot;thursday&quot; applied to it, is clickable and shows an alert when clicked. Every Friday on the calendar has the number inside replaced with text.
 **/
		renderCalendar  :   function(s)
		{
			var dc = function(a)
			{
				return document.createElement(a);
			};

			s = $.extend({}, $.fn.datePicker.defaults, s);
			
			if (s.showHeader != $.dpConst.SHOW_HEADER_NONE) {
				var headRow = $(dc('tr'));
				for (var i=Date.firstDayOfWeek; i&lt;Date.firstDayOfWeek+7; i++) {
					var weekday = i%7;
					var day = Date.dayNames[weekday];
					headRow.append(
						jQuery(dc('th')).attr({'scope':'col', 'abbr':day, 'title':day, 'class':(weekday == 0 || weekday == 6 ? 'weekend' : 'weekday')}).html(s.showHeader == $.dpConst.SHOW_HEADER_SHORT ? day.substr(0, 1) : day)
					);
				}
			};
			
			var calendarTable = $(dc('table'))
									.attr(
										{
											'cellspacing':2
										}
									)
									.addClass('jCalendar')
									.append(
										(s.showHeader != $.dpConst.SHOW_HEADER_NONE ? 
											$(dc('thead'))
												.append(headRow)
											:
											dc('thead')
										)
									);
			var tbody = $(dc('tbody'));
			
			var today = (new Date()).zeroTime();
			
			var month = s.month == undefined ? today.getMonth() : s.month;
			var year = s.year || today.getFullYear();
			
			var currentDate = new Date(year, month, 1);
			
			
			var firstDayOffset = Date.firstDayOfWeek - currentDate.getDay() + 1;
			if (firstDayOffset &gt; 1) firstDayOffset -= 7;
			var weeksToDraw = Math.ceil(( (-1*firstDayOffset+1) + currentDate.getDaysInMonth() ) /7);
			currentDate.addDays(firstDayOffset-1);
			
			var doHover = function(firstDayInBounds)
			{
				return function()
				{
					if (s.hoverClass) {
						var $this = $(this);
						if (!s.selectWeek) {
							$this.addClass(s.hoverClass);
						} else if (firstDayInBounds &amp;&amp; !$this.is('.disabled')) {
							$this.parent().addClass('activeWeekHover');
						}
					}
				}
			};
			var unHover = function()
			{
				if (s.hoverClass) {
					var $this = $(this);
					$this.removeClass(s.hoverClass);
					$this.parent().removeClass('activeWeekHover');
				}
			};

			var w = 0;
			while (w++&lt;weeksToDraw) {
				var r = jQuery(dc('tr'));
				var firstDayInBounds = s.dpController ? currentDate &gt; s.dpController.startDate : false;
				for (var i=0; i&lt;7; i++) {
					var thisMonth = currentDate.getMonth() == month;
					var d = $(dc('td'))
								.text(currentDate.getDate() + '')
								.addClass((thisMonth ? 'current-month ' : 'other-month ') +
													(currentDate.isWeekend() ? 'weekend ' : 'weekday ') +
													(thisMonth &amp;&amp; currentDate.getTime() == today.getTime() ? 'today ' : '')
								)
								.data('datePickerDate', currentDate.asString())
								.hover(doHover(firstDayInBounds), unHover)
							;
					r.append(d);
					if (s.renderCallback) {
						s.renderCallback(d, currentDate, month, year);
					}
					// addDays(1) fails in some locales due to daylight savings. See issue 39.
					//currentDate.addDays(1);
					currentDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), currentDate.getDate()+1);
				}
				tbody.append(r);
			}
			calendarTable.append(tbody);
			
			return this.each(
				function()
				{
					$(this).empty().append(calendarTable);
				}
			);
		},
/**
 * Create a datePicker associated with each of the matched elements.
 *
 * The matched element will receive a few custom events with the following signatures:
 *
 * dateSelected(event, date, $td, status)
 * Triggered when a date is selected. event is a reference to the event, date is the Date selected, $td is a jquery object wrapped around the TD that was clicked on and status is whether the date was selected (true) or deselected (false)
 * 
 * dpClosed(event, selected)
 * Triggered when the date picker is closed. event is a reference to the event and selected is an Array containing Date objects.
 *
 * dpMonthChanged(event, displayedMonth, displayedYear)
 * Triggered when the month of the popped up calendar is changed. event is a reference to the event, displayedMonth is the number of the month now displayed (zero based) and displayedYear is the year of the month.
 *
 * dpDisplayed(event, $datePickerDiv)
 * Triggered when the date picker is created. $datePickerDiv is the div containing the date picker. Use this event to add custom content/ listeners to the popped up date picker.
 *
 * @param Object s (optional) Customize your date pickers.
 * @option Number month The month to render when the date picker is opened (NOTE that months are zero based). Default is today's month.
 * @option Number year The year to render when the date picker is opened. Default is today's year.
 * @option String startDate The first date date can be selected.
 * @option String endDate The last date that can be selected.
 * @option Boolean inline Whether to create the datePicker as inline (e.g. always on the page) or as a model popup. Default is false (== modal popup)
 * @option Boolean createButton Whether to create a .dp-choose-date anchor directly after the matched element which when clicked will trigger the showing of the date picker. Default is true.
 * @option Boolean showYearNavigation Whether to display buttons which allow the user to navigate through the months a year at a time. Default is true.
 * @option Boolean closeOnSelect Whether to close the date picker when a date is selected. Default is true.
 * @option Boolean displayClose Whether to create a &quot;Close&quot; button within the date picker popup. Default is false.
 * @option Boolean selectMultiple Whether a user should be able to select multiple dates with this date picker. Default is false.
 * @option Number numSelectable The maximum number of dates that can be selected where selectMultiple is true. Default is a very high number.
 * @option Boolean clickInput If the matched element is an input type=&quot;text&quot; and this option is true then clicking on the input will cause the date picker to appear.
 * @option Boolean rememberViewedMonth Whether the datePicker should remember the last viewed month and open on it. If false then the date picker will always open with the month for the first selected date visible.
 * @option Boolean selectWeek Whether to select a complete week at a time...
 * @option Number verticalPosition The vertical alignment of the popped up date picker to the matched element. One of $.dpConst.POS_TOP and $.dpConst.POS_BOTTOM. Default is $.dpConst.POS_TOP.
 * @option Number horizontalPosition The horizontal alignment of the popped up date picker to the matched element. One of $.dpConst.POS_LEFT and $.dpConst.POS_RIGHT.
 * @option Number verticalOffset The number of pixels offset from the defined verticalPosition of this date picker that it should pop up in. Default in 0.
 * @option Number horizontalOffset The number of pixels offset from the defined horizontalPosition of this date picker that it should pop up in. Default in 0.
 * @option (Function|Array) renderCallback A reference to a function (or an array of seperate functions) that is called as each cell is rendered and which can add classes and event listeners to the created nodes. Each callback function will receive four arguments; a jquery object wrapping the created TD, a Date object containing the date this TD represents, a number giving the currently rendered month and a number giving the currently rendered year. Default is no callback.
 * @option String hoverClass The class to attach to each cell when you hover over it (to allow you to use hover effects in IE6 which doesn't support the :hover pseudo-class on elements other than links). Default is dp-hover. Pass false if you don't want a hover class.
 * @type jQuery
 * @name datePicker
 * @cat plugins/datePicker
 * @author Kelvin Luck (http://www.kelvinluck.com/)
 *
 * @example $('input.date-picker').datePicker();
 * @desc Creates a date picker button next to all matched input elements. When the button is clicked on the value of the selected date will be placed in the corresponding input (formatted according to Date.format).
 *
 * @example demo/index.html
 * @desc See the projects homepage for many more complex examples...
 **/
		datePicker : function(s)
		{			
			if (!$.event._dpCache) $.event._dpCache = [];
			
			// initialise the date picker controller with the relevant settings...
			s = $.extend({}, $.fn.datePicker.defaults, s);
			
			return this.each(
				function()
				{
					var $this = $(this);
					var alreadyExists = true;
					
					if (!this._dpId) {
						this._dpId = $.event.guid++;
						$.event._dpCache[this._dpId] = new DatePicker(this);
						alreadyExists = false;
					}
					
					if (s.inline) {
						s.createButton = false;
						s.displayClose = false;
						s.closeOnSelect = false;
						$this.empty();
					}
					
					var controller = $.event._dpCache[this._dpId];
					
					controller.init(s);
					
					if (!alreadyExists &amp;&amp; s.createButton) {
						// create it!
						controller.button = $('&lt;a href=&quot;#&quot; class=&quot;dp-choose-date&quot; title=&quot;' + $.dpText.TEXT_CHOOSE_DATE + '&quot;&gt;' + $.dpText.TEXT_CHOOSE_DATE + '&lt;/a&gt;')
								.bind(
									'click',
									function()
									{
										$this.dpDisplay(this);
										this.blur();
										return false;
									}
								);
						$this.after(controller.button);
					}
					
					if (!alreadyExists &amp;&amp; $this.is(':text')) {
						$this
							.bind(
								'dateSelected',
								function(e, selectedDate, $td)
								{
									this.value = selectedDate.asString();
								}
							).bind(
								'change',
								function()
								{
									if (this.value == '') {
										controller.clearSelected();
									} else {
										var d = Date.fromString(this.value);
										if (d) {
											controller.setSelected(d, true, true);
										}
									}
								}
							);
						if (s.clickInput) {
							$this.bind(
								'click',
								function()
								{
									// The change event doesn't happen until the input loses focus so we need to manually trigger it...
									$this.trigger('change');
									$this.dpDisplay();
								}
							);
						}
						var d = Date.fromString(this.value);
						if (this.value != '' &amp;&amp; d) {
							controller.setSelected(d, true, true);
						}
					}
					
					$this.addClass('dp-applied');
					
				}
			)
		},
/**
 * Disables or enables this date picker
 *
 * @param Boolean s Whether to disable (true) or enable (false) this datePicker
 * @type jQuery
 * @name dpSetDisabled
 * @cat plugins/datePicker
 * @author Kelvin Luck (http://www.kelvinluck.com/)
 *
 * @example $('.date-picker').datePicker();
 * $('.date-picker').dpSetDisabled(true);
 * @desc Prevents this date picker from displaying and adds a class of dp-disabled to it (and it's associated button if it has one) for styling purposes. If the matched element is an input field then it will also set the disabled attribute to stop people directly editing the field.
 **/
		dpSetDisabled : function(s)
		{
			return _w.call(this, 'setDisabled', s);
		},
/**
 * Updates the first selectable date for any date pickers on any matched elements.
 *
 * @param String d A string representing the first selectable date (formatted according to Date.format).
 * @type jQuery
 * @name dpSetStartDate
 * @cat plugins/datePicker
 * @author Kelvin Luck (http://www.kelvinluck.com/)
 *
 * @example $('.date-picker').datePicker();
 * $('.date-picker').dpSetStartDate('01/01/2000');
 * @desc Creates a date picker associated with all elements with a class of &quot;date-picker&quot; then sets the first selectable date for each of these to the first day of the millenium.
 **/
		dpSetStartDate : function(d)
		{
			return _w.call(this, 'setStartDate', d);
		},
/**
 * Updates the last selectable date for any date pickers on any matched elements.
 *
 * @param String d A string representing the last selectable date (formatted according to Date.format).
 * @type jQuery
 * @name dpSetEndDate
 * @cat plugins/datePicker
 * @author Kelvin Luck (http://www.kelvinluck.com/)
 *
 * @example $('.date-picker').datePicker();
 * $('.date-picker').dpSetEndDate('01/01/2010');
 * @desc Creates a date picker associated with all elements with a class of &quot;date-picker&quot; then sets the last selectable date for each of these to the first Janurary 2010.
 **/
		dpSetEndDate : function(d)
		{
			return _w.call(this, 'setEndDate', d);
		},
/**
 * Gets a list of Dates currently selected by this datePicker. This will be an empty array if no dates are currently selected or NULL if there is no datePicker associated with the matched element.
 *
 * @type Array
 * @name dpGetSelected
 * @cat plugins/datePicker
 * @author Kelvin Luck (http://www.kelvinluck.com/)
 *
 * @example $('.date-picker').datePicker();
 * alert($('.date-picker').dpGetSelected());
 * @desc Will alert an empty array (as nothing is selected yet)
 **/
		dpGetSelected : function()
		{
			var c = _getController(this[0]);
			if (c) {
				return c.getSelected();
			}
			return null;
		},
/**
 * Selects or deselects a date on any matched element's date pickers. Deselcting is only useful on date pickers where selectMultiple==true. Selecting will only work if the passed date is within the startDate and endDate boundries for a given date picker.
 *
 * @param String d A string representing the date you want to select (formatted according to Date.format).
 * @param Boolean v Whether you want to select (true) or deselect (false) this date. Optional - default = true.
 * @param Boolean m Whether you want the date picker to open up on the month of this date when it is next opened. Optional - default = true.
 * @param Boolean e Whether you want the date picker to dispatch events related to this change of selection. Optional - default = true.
 * @type jQuery
 * @name dpSetSelected
 * @cat plugins/datePicker
 * @author Kelvin Luck (http://www.kelvinluck.com/)
 *
 * @example $('.date-picker').datePicker();
 * $('.date-picker').dpSetSelected('01/01/2010');
 * @desc Creates a date picker associated with all elements with a class of &quot;date-picker&quot; then sets the selected date on these date pickers to the first Janurary 2010. When the date picker is next opened it will display Janurary 2010.
 **/
		dpSetSelected : function(d, v, m, e)
		{
			if (v == undefined) v=true;
			if (m == undefined) m=true;
			if (e == undefined) e=true;
			return _w.call(this, 'setSelected', Date.fromString(d), v, m, e);
		},
/**
 * Sets the month that will be displayed when the date picker is next opened. If the passed month is before startDate then the month containing startDate will be displayed instead. If the passed month is after endDate then the month containing the endDate will be displayed instead.
 *
 * @param Number m The month you want the date picker to display. Optional - defaults to the currently displayed month.
 * @param Number y The year you want the date picker to display. Optional - defaults to the currently displayed year.
 * @type jQuery
 * @name dpSetDisplayedMonth
 * @cat plugins/datePicker
 * @author Kelvin Luck (http://www.kelvinluck.com/)
 *
 * @example $('.date-picker').datePicker();
 * $('.date-picker').dpSetDisplayedMonth(10, 2008);
 * @desc Creates a date picker associated with all elements with a class of &quot;date-picker&quot; then sets the selected date on these date pickers to the first Janurary 2010. When the date picker is next opened it will display Janurary 2010.
 **/
		dpSetDisplayedMonth : function(m, y)
		{
			return _w.call(this, 'setDisplayedMonth', Number(m), Number(y), true);
		},
/**
 * Displays the date picker associated with the matched elements. Since only one date picker can be displayed at once then the date picker associated with the last matched element will be the one that is displayed.
 *
 * @param HTMLElement e An element that you want the date picker to pop up relative in position to. Optional - default behaviour is to pop up next to the element associated with this date picker.
 * @type jQuery
 * @name dpDisplay
 * @cat plugins/datePicker
 * @author Kelvin Luck (http://www.kelvinluck.com/)
 *
 * @example $('#date-picker').datePicker();
 * $('#date-picker').dpDisplay();
 * @desc Creates a date picker associated with the element with an id of date-picker and then causes it to pop up.
 **/
		dpDisplay : function(e)
		{
			return _w.call(this, 'display', e);
		},
/**
 * Sets a function or array of functions that is called when each TD of the date picker popup is rendered to the page
 *
 * @param (Function|Array) a A function or an array of functions that are called when each td is rendered. Each function will receive four arguments; a jquery object wrapping the created TD, a Date object containing the date this TD represents, a number giving the currently rendered month and a number giving the currently rendered year.
 * @type jQuery
 * @name dpSetRenderCallback
 * @cat plugins/datePicker
 * @author Kelvin Luck (http://www.kelvinluck.com/)
 *
 * @example $('#date-picker').datePicker();
 * $('#date-picker').dpSetRenderCallback(function($td, thisDate, month, year)
 * {
 * 	// do stuff as each td is rendered dependant on the date in the td and the displayed month and year
 * });
 * @desc Creates a date picker associated with the element with an id of date-picker and then creates a function which is called as each td is rendered when this date picker is displayed.
 **/
		dpSetRenderCallback : function(a)
		{
			return _w.call(this, 'setRenderCallback', a);
		},
/**
 * Sets the position that the datePicker will pop up (relative to it's associated element)
 *
 * @param Number v The vertical alignment of the created date picker to it's associated element. Possible values are $.dpConst.POS_TOP and $.dpConst.POS_BOTTOM
 * @param Number h The horizontal alignment of the created date picker to it's associated element. Possible values are $.dpConst.POS_LEFT and $.dpConst.POS_RIGHT
 * @type jQuery
 * @name dpSetPosition
 * @cat plugins/datePicker
 * @author Kelvin Luck (http://www.kelvinluck.com/)
 *
 * @example $('#date-picker').datePicker();
 * $('#date-picker').dpSetPosition($.dpConst.POS_BOTTOM, $.dpConst.POS_RIGHT);
 * @desc Creates a date picker associated with the element with an id of date-picker and makes it so that when this date picker pops up it will be bottom and right aligned to the #date-picker element.
 **/
		dpSetPosition : function(v, h)
		{
			return _w.call(this, 'setPosition', v, h);
		},
/**
 * Sets the offset that the popped up date picker will have from it's default position relative to it's associated element (as set by dpSetPosition)
 *
 * @param Number v The vertical offset of the created date picker.
 * @param Number h The horizontal offset of the created date picker.
 * @type jQuery
 * @name dpSetOffset
 * @cat plugins/datePicker
 * @author Kelvin Luck (http://www.kelvinluck.com/)
 *
 * @example $('#date-picker').datePicker();
 * $('#date-picker').dpSetOffset(-20, 200);
 * @desc Creates a date picker associated with the element with an id of date-picker and makes it so that when this date picker pops up it will be 20 pixels above and 200 pixels to the right of it's default position.
 **/
		dpSetOffset : function(v, h)
		{
			return _w.call(this, 'setOffset', v, h);
		},
/**
 * Closes the open date picker associated with this element.
 *
 * @type jQuery
 * @name dpClose
 * @cat plugins/datePicker
 * @author Kelvin Luck (http://www.kelvinluck.com/)
 *
 * @example $('.date-pick')
 *		.datePicker()
 *		.bind(
 *			'focus',
 *			function()
 *			{
 *				$(this).dpDisplay();
 *			}
 *		).bind(
 *			'blur',
 *			function()
 *			{
 *				$(this).dpClose();
 *			}
 *		);
 * @desc Creates a date picker and makes it appear when the relevant element is focused and disappear when it is blurred.
 **/
		dpClose : function()
		{
			return _w.call(this, '_closeCalendar', false, this[0]);
		},
		// private function called on unload to clean up any expandos etc and prevent memory links...
		_dpDestroy : function()
		{
			// TODO - implement this?
		}
	});
	
	// private internal function to cut down on the amount of code needed where we forward
	// dp* methods on the jQuery object on to the relevant DatePicker controllers...
	var _w = function(f, a1, a2, a3, a4)
	{
		return this.each(
			function()
			{
				var c = _getController(this);
				if (c) {
					c[f](a1, a2, a3, a4);
				}
			}
		);
	};
	
	function DatePicker(ele)
	{
		this.ele = ele;
		
		// initial values...
		this.displayedMonth		=	null;
		this.displayedYear		=	null;
		this.startDate			=	null;
		this.endDate			=	null;
		this.showYearNavigation	=	null;
		this.closeOnSelect		=	null;
		this.displayClose		=	null;
		this.rememberViewedMonth=	null;
		this.selectMultiple		=	null;
		this.numSelectable		=	null;
		this.numSelected		=	null;
		this.verticalPosition	=	null;
		this.horizontalPosition	=	null;
		this.verticalOffset		=	null;
		this.horizontalOffset	=	null;
		this.button				=	null;
		this.renderCallback		=	[];
		this.selectedDates		=	{};
		this.inline				=	null;
		this.context			=	'#dp-popup';
		this.settings			=	{};
	};
	$.extend(
		DatePicker.prototype,
		{	
			init : function(s)
			{
				this.setStartDate(s.startDate);
				this.setEndDate(s.endDate);
				this.setDisplayedMonth(Number(s.month), Number(s.year));
				this.setRenderCallback(s.renderCallback);
				this.showYearNavigation = s.showYearNavigation;
				this.closeOnSelect = s.closeOnSelect;
				this.displayClose = s.displayClose;
				this.rememberViewedMonth =	s.rememberViewedMonth;
				this.selectMultiple = s.selectMultiple;
				this.numSelectable = s.selectMultiple ? s.numSelectable : 1;
				this.numSelected = 0;
				this.verticalPosition = s.verticalPosition;
				this.horizontalPosition = s.horizontalPosition;
				this.hoverClass = s.hoverClass;
				this.setOffset(s.verticalOffset, s.horizontalOffset);
				this.inline = s.inline;
				this.settings = s;
				if (this.inline) {
					this.context = this.ele;
					this.display();
				}
			},
			setStartDate : function(d)
			{
				if (d) {
					this.startDate = Date.fromString(d);
				}
				if (!this.startDate) {
					this.startDate = (new Date()).zeroTime();
				}
				this.setDisplayedMonth(this.displayedMonth, this.displayedYear);
			},
			setEndDate : function(d)
			{
				if (d) {
					this.endDate = Date.fromString(d);
				}
				if (!this.endDate) {
					this.endDate = (new Date('12/31/2999')); // using the JS Date.parse function which expects mm/dd/yyyy
				}
				if (this.endDate.getTime() &lt; this.startDate.getTime()) {
					this.endDate = this.startDate;
				}
				this.setDisplayedMonth(this.displayedMonth, this.displayedYear);
			},
			setPosition : function(v, h)
			{
				this.verticalPosition = v;
				this.horizontalPosition = h;
			},
			setOffset : function(v, h)
			{
				this.verticalOffset = parseInt(v) || 0;
				this.horizontalOffset = parseInt(h) || 0;
			},
			setDisabled : function(s)
			{
				$e = $(this.ele);
				$e[s ? 'addClass' : 'removeClass']('dp-disabled');
				if (this.button) {
					$but = $(this.button);
					$but[s ? 'addClass' : 'removeClass']('dp-disabled');
					$but.attr('title', s ? '' : $.dpText.TEXT_CHOOSE_DATE);
				}
				if ($e.is(':text')) {
					$e.attr('disabled', s ? 'disabled' : '');
				}
			},
			setDisplayedMonth : function(m, y, rerender)
			{
				if (this.startDate == undefined || this.endDate == undefined) {
					return;
				}
				var s = new Date(this.startDate.getTime());
				s.setDate(1);
				var e = new Date(this.endDate.getTime());
				e.setDate(1);
				
				var t;
				if ((!m &amp;&amp; !y) || (isNaN(m) &amp;&amp; isNaN(y))) {
					// no month or year passed - default to current month
					t = new Date().zeroTime();
					t.setDate(1);
				} else if (isNaN(m)) {
					// just year passed in - presume we want the displayedMonth
					t = new Date(y, this.displayedMonth, 1);
				} else if (isNaN(y)) {
					// just month passed in - presume we want the displayedYear
					t = new Date(this.displayedYear, m, 1);
				} else {
					// year and month passed in - that's the date we want!
					t = new Date(y, m, 1)
				}
				// check if the desired date is within the range of our defined startDate and endDate
				if (t.getTime() &lt; s.getTime()) {
					t = s;
				} else if (t.getTime() &gt; e.getTime()) {
					t = e;
				}
				var oldMonth = this.displayedMonth;
				var oldYear = this.displayedYear;
				this.displayedMonth = t.getMonth();
				this.displayedYear = t.getFullYear();

				if (rerender &amp;&amp; (this.displayedMonth != oldMonth || this.displayedYear != oldYear))
				{
					this._rerenderCalendar();
					$(this.ele).trigger('dpMonthChanged', [this.displayedMonth, this.displayedYear]);
				}
			},
			setSelected : function(d, v, moveToMonth, dispatchEvents)
			{
				if (d &lt; this.startDate || d &gt; this.endDate) {
					// Don't allow people to select dates outside range...
					return;
				}
				var s = this.settings;
				if (s.selectWeek)
				{
					d = d.addDays(- (d.getDay() - Date.firstDayOfWeek + 7) % 7);
					if (d &lt; this.startDate) // The first day of this week is before the start date so is unselectable...
					{
						return;
					}
				}
				if (v == this.isSelected(d)) // this date is already un/selected
				{
					return;
				}
				if (this.selectMultiple == false) {
					this.clearSelected();
				} else if (v &amp;&amp; this.numSelected == this.numSelectable) {
					// can't select any more dates...
					return;
				}
				if (moveToMonth &amp;&amp; (this.displayedMonth != d.getMonth() || this.displayedYear != d.getFullYear())) {
					this.setDisplayedMonth(d.getMonth(), d.getFullYear(), true);
				}
				this.selectedDates[d.toString()] = v;
				this.numSelected += v ? 1 : -1;
				var selectorString = 'td.' +( d.getMonth() == this.displayedMonth ? 'current-month' : 'other-month');
				var $td;
				$(selectorString, this.context).each(
					function()
					{
						if ($(this).data('datePickerDate') == d.asString()) {
							$td = $(this);
							if (s.selectWeek)
							{
								$td.parent()[v ? 'addClass' : 'removeClass']('selectedWeek');
							}
							$td[v ? 'addClass' : 'removeClass']('selected'); 
						}
					}
				);
				$('td', this.context).not('.selected')[this.selectMultiple &amp;&amp;  this.numSelected == this.numSelectable ? 'addClass' : 'removeClass']('unselectable');
				
				if (dispatchEvents)
				{
					var s = this.isSelected(d);
					$e = $(this.ele);
					var dClone = Date.fromString(d.asString());
					$e.trigger('dateSelected', [dClone, $td, s]);
					$e.trigger('change');
				}
			},
			isSelected : function(d)
			{
				return this.selectedDates[d.toString()];
			},
			getSelected : function()
			{
				var r = [];
				for(s in this.selectedDates) {
					if (this.selectedDates[s] == true) {
						r.push(Date.parse(s));
					}
				}
				return r;
			},
			clearSelected : function()
			{
				this.selectedDates = {};
				this.numSelected = 0;
				$('td.selected', this.context).removeClass('selected').parent().removeClass('selectedWeek');
			},
			display : function(eleAlignTo)
			{
				if ($(this.ele).is('.dp-disabled')) return;
				
				eleAlignTo = eleAlignTo || this.ele;
				var c = this;
				var $ele = $(eleAlignTo);
				var eleOffset = $ele.offset();
				
				var $createIn;
				var attrs;
				var attrsCalendarHolder;
				var cssRules;
				
				if (c.inline) {
					$createIn = $(this.ele);
					attrs = {
						'id'		:	'calendar-' + this.ele._dpId,
						'class'	:	'dp-popup dp-popup-inline'
					};

					$('.dp-popup', $createIn).remove();
					cssRules = {
					};
				} else {
					$createIn = $('body');
					attrs = {
						'id'		:	'dp-popup',
						'class'	:	'dp-popup'
					};
					cssRules = {
						'top'	:	eleOffset.top + c.verticalOffset,
						'left'	:	eleOffset.left + c.horizontalOffset
					};
					
					var _checkMouse = function(e)
					{
						var el = e.target;
						var cal = $('#dp-popup')[0];
						
						while (true){
							if (el == cal) {
								return true;
							} else if (el == document) {
								c._closeCalendar();
								return false;
							} else {
								el = $(el).parent()[0];
							}
						}
					};
					this._checkMouse = _checkMouse;
					
					c._closeCalendar(true);
					$(document).bind(
						'keydown.datepicker', 
						function(event)
						{
							if (event.keyCode == 27) {
								c._closeCalendar();
							}
						}
					);
				}
				
				if (!c.rememberViewedMonth)
				{
					var selectedDate = this.getSelected()[0];
					if (selectedDate) {
						selectedDate = new Date(selectedDate);
						this.setDisplayedMonth(selectedDate.getMonth(), selectedDate.getFullYear(), false);
					}
				}
				
				$createIn
					.append(
						$('&lt;div&gt;&lt;/div&gt;')
							.attr(attrs)
							.css(cssRules)
							.append(
//								$('&lt;a href=&quot;#&quot; class=&quot;selecteee&quot;&gt;aaa&lt;/a&gt;'),
								$('&lt;h2&gt;&lt;/h2&gt;'),
								$('&lt;div class=&quot;dp-nav-prev&quot;&gt;&lt;/div&gt;')
									.append(
										$('&lt;a class=&quot;dp-nav-prev-year&quot; href=&quot;#&quot; title=&quot;' + $.dpText.TEXT_PREV_YEAR + '&quot;&gt;&amp;lt;&amp;lt;&lt;/a&gt;')
											.bind(
												'click',
												function()
												{
													return c._displayNewMonth.call(c, this, 0, -1);
												}
											),
										$('&lt;a class=&quot;dp-nav-prev-month&quot; href=&quot;#&quot; title=&quot;' + $.dpText.TEXT_PREV_MONTH + '&quot;&gt;&amp;lt;&lt;/a&gt;')
											.bind(
												'click',
												function()
												{
													return c._displayNewMonth.call(c, this, -1, 0);
												}
											)
									),
								$('&lt;div class=&quot;dp-nav-next&quot;&gt;&lt;/div&gt;')
									.append(
										$('&lt;a class=&quot;dp-nav-next-year&quot; href=&quot;#&quot; title=&quot;' + $.dpText.TEXT_NEXT_YEAR + '&quot;&gt;&amp;gt;&amp;gt;&lt;/a&gt;')
											.bind(
												'click',
												function()
												{
													return c._displayNewMonth.call(c, this, 0, 1);
												}
											),
										$('&lt;a class=&quot;dp-nav-next-month&quot; href=&quot;#&quot; title=&quot;' + $.dpText.TEXT_NEXT_MONTH + '&quot;&gt;&amp;gt;&lt;/a&gt;')
											.bind(
												'click',
												function()
												{
													return c._displayNewMonth.call(c, this, 1, 0);
												}
											)
									),
								$('&lt;div class=&quot;dp-calendar&quot;&gt;&lt;/div&gt;')
							)
							.bgIframe()
						);
					
				var $pop = this.inline ? $('.dp-popup', this.context) : $('#dp-popup');
				
				if (this.showYearNavigation == false) {
					$('.dp-nav-prev-year, .dp-nav-next-year', c.context).css('display', 'none');
				}
				if (this.displayClose) {
					$pop.append(
						$('&lt;a href=&quot;#&quot; id=&quot;dp-close&quot;&gt;' + $.dpText.TEXT_CLOSE + '&lt;/a&gt;')
							.bind(
								'click',
								function()
								{
									c._closeCalendar();
									return false;
								}
							)
					);
				}
				c._renderCalendar();

				$(this.ele).trigger('dpDisplayed', $pop);
				
				if (!c.inline) {
					if (this.verticalPosition == $.dpConst.POS_BOTTOM) {
						$pop.css('top', eleOffset.top + $ele.height() - $pop.height() + c.verticalOffset);
					}
					if (this.horizontalPosition == $.dpConst.POS_RIGHT) {
						$pop.css('left', eleOffset.left + $ele.width() - $pop.width() + c.horizontalOffset);
					}
//					$('.selectee', this.context).focus();
					$(document).bind('mousedown.datepicker', this._checkMouse);
				}
				
			},
			setRenderCallback : function(a)
			{
				if (a == null) return;
				if (a &amp;&amp; typeof(a) == 'function') {
					a = [a];
				}
				this.renderCallback = this.renderCallback.concat(a);
			},
			cellRender : function ($td, thisDate, month, year) {
				var c = this.dpController;
				var d = new Date(thisDate.getTime());
				
				// add our click handlers to deal with it when the days are clicked...
				
				$td.bind(
					'click',
					function()
					{
						var $this = $(this);
						if (!$this.is('.disabled')) {
							c.setSelected(d, !$this.is('.selected') || !c.selectMultiple, false, true);
							if (c.closeOnSelect) {
								c._closeCalendar();
							}
							// TODO: Instead of this which doesn't work in IE anyway we should find the next focusable element in the document
							// and pass the focus onto that. That would allow the user to continue on the form as expected...
							if (!$.browser.msie)
							{
								$(c.ele).trigger('focus', [$.dpConst.DP_INTERNAL_FOCUS]);
							}
						}
					}
				);
				
				if (c.isSelected(d)) {
					$td.addClass('selected');
					if (c.settings.selectWeek)
					{
						$td.parent().addClass('selectedWeek');
					}
				} else  if (c.selectMultiple &amp;&amp; c.numSelected == c.numSelectable) {
					$td.addClass('unselectable');
				}
				
			},
			_applyRenderCallbacks : function()
			{
				var c = this;
				$('td', this.context).each(
					function()
					{
						for (var i=0; i&lt;c.renderCallback.length; i++) {
							$td = $(this);
							c.renderCallback[i].apply(this, [$td, Date.fromString($td.data('datePickerDate')), c.displayedMonth, c.displayedYear]);
						}
					}
				);
				return;
			},
			// ele is the clicked button - only proceed if it doesn't have the class disabled...
			// m and y are -1, 0 or 1 depending which direction we want to go in...
			_displayNewMonth : function(ele, m, y) 
			{
				if (!$(ele).is('.disabled')) {
					this.setDisplayedMonth(this.displayedMonth + m, this.displayedYear + y, true);
				}
				ele.blur();
				return false;
			},
			_rerenderCalendar : function()
			{
				this._clearCalendar();
				this._renderCalendar();
			},
			_renderCalendar : function()
			{
				// set the title...
				$('h2', this.context).html((new Date(this.displayedYear, this.displayedMonth, 1)).asString($.dpText.HEADER_FORMAT));
				
				// render the calendar...
				$('.dp-calendar', this.context).renderCalendar(
					$.extend(
						{},
						this.settings, 
						{
							month			: this.displayedMonth,
							year			: this.displayedYear,
							renderCallback	: this.cellRender,
							dpController	: this,
							hoverClass		: this.hoverClass
						})
				);
				
				// update the status of the control buttons and disable dates before startDate or after endDate...
				// TODO: When should the year buttons be disabled? When you can't go forward a whole year from where you are or is that annoying?
				if (this.displayedYear == this.startDate.getFullYear() &amp;&amp; this.displayedMonth == this.startDate.getMonth()) {
					$('.dp-nav-prev-year', this.context).addClass('disabled');
					$('.dp-nav-prev-month', this.context).addClass('disabled');
					$('.dp-calendar td.other-month', this.context).each(
						function()
						{
							var $this = $(this);
							if (Number($this.text()) &gt; 20) {
								$this.addClass('disabled');
							}
						}
					);
					var d = this.startDate.getDate();
					$('.dp-calendar td.current-month', this.context).each(
						function()
						{
							var $this = $(this);
							if (Number($this.text()) &lt; d) {
								$this.addClass('disabled');
							}
						}
					);
				} else {
					$('.dp-nav-prev-year', this.context).removeClass('disabled');
					$('.dp-nav-prev-month', this.context).removeClass('disabled');
					var d = this.startDate.getDate();
					if (d &gt; 20) {
						// check if the startDate is last month as we might need to add some disabled classes...
						var st = this.startDate.getTime();
						var sd = new Date(st);
						sd.addMonths(1);
						if (this.displayedYear == sd.getFullYear() &amp;&amp; this.displayedMonth == sd.getMonth()) {
							$('.dp-calendar td.other-month', this.context).each(
								function()
								{
									var $this = $(this);
									if (Date.fromString($this.data('datePickerDate')).getTime() &lt; st) {
										$this.addClass('disabled');
									}
								}
							);
						}
					}
				}
				if (this.displayedYear == this.endDate.getFullYear() &amp;&amp; this.displayedMonth == this.endDate.getMonth()) {
					$('.dp-nav-next-year', this.context).addClass('disabled');
					$('.dp-nav-next-month', this.context).addClass('disabled');
					$('.dp-calendar td.other-month', this.context).each(
						function()
						{
							var $this = $(this);
							if (Number($this.text()) &lt; 14) {
								$this.addClass('disabled');
							}
						}
					);
					var d = this.endDate.getDate();
					$('.dp-calendar td.current-month', this.context).each(
						function()
						{
							var $this = $(this);
							if (Number($this.text()) &gt; d) {
								$this.addClass('disabled');
							}
						}
					);
				} else {
					$('.dp-nav-next-year', this.context).removeClass('disabled');
					$('.dp-nav-next-month', this.context).removeClass('disabled');
					var d = this.endDate.getDate();
					if (d &lt; 13) {
						// check if the endDate is next month as we might need to add some disabled classes...
						var ed = new Date(this.endDate.getTime());
						ed.addMonths(-1);
						if (this.displayedYear == ed.getFullYear() &amp;&amp; this.displayedMonth == ed.getMonth()) {
							$('.dp-calendar td.other-month', this.context).each(
								function()
								{
									var $this = $(this);
									if (Number($this.text()) &gt; d) {
										$this.addClass('disabled');
									}
								}
							);
						}
					}
				}
				this._applyRenderCallbacks();
			},
			_closeCalendar : function(programatic, ele)
			{
				if (!ele || ele == this.ele)
				{
					$(document).unbind('mousedown.datepicker');
					$(document).unbind('keydown.datepicker');
					this._clearCalendar();
					$('#dp-popup a').unbind();
					$('#dp-popup').empty().remove();
					if (!programatic) {
						$(this.ele).trigger('dpClosed', [this.getSelected()]);
					}
				}
			},
			// empties the current dp-calendar div and makes sure that all events are unbound
			// and expandos removed to avoid memory leaks...
			_clearCalendar : function()
			{
				// TODO.
				$('.dp-calendar td', this.context).unbind();
				$('.dp-calendar', this.context).empty();
			}
		}
	);
	
	// static constants
	$.dpConst = {
		SHOW_HEADER_NONE	:	0,
		SHOW_HEADER_SHORT	:	1,
		SHOW_HEADER_LONG	:	2,
		POS_TOP				:	0,
		POS_BOTTOM			:	1,
		POS_LEFT			:	0,
		POS_RIGHT			:	1,
		DP_INTERNAL_FOCUS	:	'dpInternalFocusTrigger'
	};
	// localisable text
	$.dpText = {
		TEXT_PREV_YEAR		:	'Previous year',
		TEXT_PREV_MONTH		:	'Previous month',
		TEXT_NEXT_YEAR		:	'Next year',
		TEXT_NEXT_MONTH		:	'Next month',
		TEXT_CLOSE			:	'Close',
		TEXT_CHOOSE_DATE	:	'Choose date',
		HEADER_FORMAT		:	'mmmm yyyy'
	};
	// version
	$.dpVersion = '$Id: jquery.datePicker.js 70 2009-04-05 19:25:15Z kelvin.luck $';

	$.fn.datePicker.defaults = {
		month				: undefined,
		year				: undefined,
		showHeader			: $.dpConst.SHOW_HEADER_SHORT,
		startDate			: undefined,
		endDate				: undefined,
		inline				: false,
		renderCallback		: null,
		createButton		: true,
		showYearNavigation	: true,
		closeOnSelect		: true,
		displayClose		: false,
		selectMultiple		: false,
		numSelectable		: Number.MAX_VALUE,
		clickInput			: false,
		rememberViewedMonth	: true,
		selectWeek			: false,
		verticalPosition	: $.dpConst.POS_TOP,
		horizontalPosition	: $.dpConst.POS_LEFT,
		verticalOffset		: 0,
		horizontalOffset	: 0,
		hoverClass			: 'dp-hover'
	};

	function _getController(ele)
	{
		if (ele._dpId) return $.event._dpCache[ele._dpId];
		return false;
	};
	
	// make it so that no error is thrown if bgIframe plugin isn't included (allows you to use conditional
	// comments to only include bgIframe where it is needed in IE without breaking this plugin).
	if ($.fn.bgIframe == undefined) {
		$.fn.bgIframe = function() {return this; };
	};


	// clean-up
	$(window)
		.bind('unload', function() {
			var els = $.event._dpCache || [];
			for (var i in els) {
				$(els[i].ele)._dpDestroy();
			}
		});
		
	
})(jQuery);


// jQuery File Tree Plugin
//
// Version 1.01
//
// Cory S.N. LaViska
// A Beautiful Site (http://abeautifulsite.net/)
// 24 March 2008
//
// Visit http://abeautifulsite.net/notebook.php?article=58 for more information
//
// Usage: $('.fileTreeDemo').fileTree( options, callback )
//
// Options:  root           - root folder to display; default = /
//           script         - location of the serverside AJAX file to use; default = jqueryFileTree.php
//           folderEvent    - event to trigger expand/collapse; default = click
//           expandSpeed    - default = 500 (ms); use -1 for no animation
//           collapseSpeed  - default = 500 (ms); use -1 for no animation
//           expandEasing   - easing function to use on expand (optional)
//           collapseEasing - easing function to use on collapse (optional)
//           multiFolder    - whether or not to limit the browser to one subfolder at a time
//           loadMessage    - Message to display while initial tree loads (can be HTML)
//
// History:
//
// 1.01 - updated to work with foreign characters in directory/file names (12 April 2008)
// 1.00 - released (24 March 2008)
//
// TERMS OF USE
// 
// This plugin is dual-licensed under the GNU General Public License and the MIT License and
// is copyright 2008 A Beautiful Site, LLC. 
//
if(jQuery) (function($){
	
	$.extend($.fn, {
		fileTree: function(o, h) {
			// Defaults
			if( !o ) var o = {};
			if( o.root == undefined ) o.root = '/';
			if( o.script == undefined ) o.script = 'jqueryFileTree.php';
			if( o.folderEvent == undefined ) o.folderEvent = 'click';
			if( o.expandSpeed == undefined ) o.expandSpeed= 500;
			if( o.collapseSpeed == undefined ) o.collapseSpeed= 500;
			if( o.expandEasing == undefined ) o.expandEasing = null;
			if( o.collapseEasing == undefined ) o.collapseEasing = null;
			if( o.multiFolder == undefined ) o.multiFolder = true;
			if( o.loadMessage == undefined ) o.loadMessage = 'Loading...';
			
			$(this).each( function() {
				
				function showTree(c, t) {
					$(c).addClass('wait');
					$(&quot;.jqueryFileTree.start&quot;).remove();
					
					if(window.Components &amp;&amp; window.netscape &amp;&amp; window.netscape.security &amp;&amp; document.location.protocol.indexOf(&quot;http&quot;) == -1)
						window.netscape.security.PrivilegeManager.enablePrivilege(&quot;UniversalBrowserRead&quot;);
					
					//changed from post to get
					$.post(o.script, { dir: t }, function(data) {
						$(c).find('.start').html('');
						$(c).removeClass('wait').append(data);
						if( o.root == t ) $(c).find('UL:hidden').show(); else $(c).find('UL:hidden').slideDown({ duration: o.expandSpeed, easing: o.expandEasing });
						bindTree(c);
					});
				}
				
				function bindTree(t) {
					$(t).find('LI A').bind(o.folderEvent, function() {
						if( $(this).parent().hasClass('directory') ) {
							if( $(this).parent().hasClass('collapsed') ) {
								// Expand
								if( !o.multiFolder ) {
									$(this).parent().parent().find('UL').slideUp({ duration: o.collapseSpeed, easing: o.collapseEasing });
									$(this).parent().parent().find('LI.directory').removeClass('expanded').addClass('collapsed');
								}
								$(this).parent().find('UL').remove(); // cleanup
								showTree( $(this).parent(), escape($(this).attr('rel').match( /.*\// )) );
								$(this).parent().removeClass('collapsed').addClass('expanded');
							} else {
								// Collapse
								$(this).parent().find('UL').slideUp({ duration: o.collapseSpeed, easing: o.collapseEasing });
								$(this).parent().removeClass('expanded').addClass('collapsed');
							}
						} else {
							h($(this).attr('rel'));
						}
						return false;
					});
					// Prevent A from triggering the # on non-click events
					if( o.folderEvent.toLowerCase != 'click' ) $(t).find('LI A').bind('click', function() { return false; });
				}
				// Loading message
				$(this).html('&lt;ul class=&quot;jqueryFileTree start&quot;&gt;&lt;li class=&quot;wait&quot;&gt;' + o.loadMessage + '&lt;li&gt;&lt;/ul&gt;');
				// Get the initial file list
				showTree( $(this), escape(o.root) );
			});
		}
	});
	
})(jQuery);


/*
 * Autocomplete - jQuery plugin 1.0.2
 *
 * Copyright (c) 2007 Dylan Verheul, Dan G. Switzer, Anjesh Tuladhar, Jörn Zaefferer
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 * Revision: $Id: jquery.autocomplete.js 5747 2008-06-25 18:30:55Z joern.zaefferer $
 *
 */
 /* Copyright (c) 2006 Brandon Aaron (http://brandonaaron.net)
  * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) 
  * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
  *
  * $LastChangedDate: 2007-07-22 01:45:56 +0200 (Son, 22 Jul 2007) $
  * $Rev: 2447 $
  *
  * Version 2.1.1
  */
 (function($){$.fn.bgIframe=$.fn.bgiframe=function(s){if($.browser.msie&amp;&amp;/6.0/.test(navigator.userAgent)){s=$.extend({top:'auto',left:'auto',width:'auto',height:'auto',opacity:true,src:'javascript:false;'},s||{});var prop=function(n){return n&amp;&amp;n.constructor==Number?n+'px':n;},html='&lt;iframe class=&quot;bgiframe&quot;frameborder=&quot;0&quot;tabindex=&quot;-1&quot;src=&quot;'+s.src+'&quot;'+'style=&quot;display:block;position:absolute;z-index:-1;'+(s.opacity!==false?'filter:Alpha(Opacity=\'0\');':'')+'top:'+(s.top=='auto'?'expression(((parseInt(this.parentNode.currentStyle.borderTopWidth)||0)*-1)+\'px\')':prop(s.top))+';'+'left:'+(s.left=='auto'?'expression(((parseInt(this.parentNode.currentStyle.borderLeftWidth)||0)*-1)+\'px\')':prop(s.left))+';'+'width:'+(s.width=='auto'?'expression(this.parentNode.offsetWidth+\'px\')':prop(s.width))+';'+'height:'+(s.height=='auto'?'expression(this.parentNode.offsetHeight+\'px\')':prop(s.height))+';'+'&quot;/&gt;';return this.each(function(){if($('&gt; iframe.bgiframe',this).length==0)this.insertBefore(document.createElement(html),this.firstChild);});}return this;};})(jQuery);
 
 
eval(function(p,a,c,k,e,r){e=function(c){return(c&lt;a?'':e(parseInt(c/a)))+((c=c%a)&gt;35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)r[e(c)]=k[c]||e(c);k=[function(e){return r[e]}];e=function(){return'\\w+'};c=1};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p}(';(3($){$.31.1o({12:3(b,d){5 c=Y b==&quot;1w&quot;;d=$.1o({},$.D.1L,{11:c?b:14,w:c?14:b,1D:c?$.D.1L.1D:10,Z:d&amp;&amp;!d.1x?10:3U},d);d.1t=d.1t||3(a){6 a};d.1q=d.1q||d.1K;6 I.K(3(){1E $.D(I,d)})},M:3(a){6 I.X(&quot;M&quot;,a)},1y:3(a){6 I.15(&quot;1y&quot;,[a])},20:3(){6 I.15(&quot;20&quot;)},1Y:3(a){6 I.15(&quot;1Y&quot;,[a])},1X:3(){6 I.15(&quot;1X&quot;)}});$.D=3(o,r){5 t={2N:38,2I:40,2D:46,2x:9,2v:13,2q:27,2d:3x,2j:33,2o:34,2e:8};5 u=$(o).3f(&quot;12&quot;,&quot;3c&quot;).P(r.24);5 p;5 m=&quot;&quot;;5 n=$.D.2W(r);5 s=0;5 k;5 h={1z:B};5 l=$.D.2Q(r,o,1U,h);5 j;$.1T.2L&amp;&amp;$(o.2K).X(&quot;3S.12&quot;,3(){4(j){j=B;6 B}});u.X(($.1T.2L?&quot;3Q&quot;:&quot;3N&quot;)+&quot;.12&quot;,3(a){k=a.2F;3L(a.2F){Q t.2N:a.1d();4(l.L()){l.2y()}A{W(0,C)}N;Q t.2I:a.1d();4(l.L()){l.2u()}A{W(0,C)}N;Q t.2j:a.1d();4(l.L()){l.2t()}A{W(0,C)}N;Q t.2o:a.1d();4(l.L()){l.2s()}A{W(0,C)}N;Q r.19&amp;&amp;$.1p(r.R)==&quot;,&quot;&amp;&amp;t.2d:Q t.2x:Q t.2v:4(1U()){a.1d();j=C;6 B}N;Q t.2q:l.U();N;3A:1I(p);p=1H(W,r.1D);N}}).1G(3(){s++}).3v(3(){s=0;4(!h.1z){2k()}}).2i(3(){4(s++&gt;1&amp;&amp;!l.L()){W(0,C)}}).X(&quot;1y&quot;,3(){5 c=(1n.7&gt;1)?1n[1]:14;3 23(q,a){5 b;4(a&amp;&amp;a.7){16(5 i=0;i&lt;a.7;i++){4(a[i].M.O()==q.O()){b=a[i];N}}}4(Y c==&quot;3&quot;)c(b);A u.15(&quot;M&quot;,b&amp;&amp;[b.w,b.H])}$.K(1g(u.J()),3(i,a){1R(a,23,23)})}).X(&quot;20&quot;,3(){n.18()}).X(&quot;1Y&quot;,3(){$.1o(r,1n[1]);4(&quot;w&quot;2G 1n[1])n.1f()}).X(&quot;1X&quot;,3(){l.1u();u.1u();$(o.2K).1u(&quot;.12&quot;)});3 1U(){5 b=l.26();4(!b)6 B;5 v=b.M;m=v;4(r.19){5 a=1g(u.J());4(a.7&gt;1){v=a.17(0,a.7-1).2Z(r.R)+r.R+v}v+=r.R}u.J(v);1l();u.15(&quot;M&quot;,[b.w,b.H]);6 C}3 W(b,c){4(k==t.2D){l.U();6}5 a=u.J();4(!c&amp;&amp;a==m)6;m=a;a=1k(a);4(a.7&gt;=r.22){u.P(r.21);4(!r.1C)a=a.O();1R(a,2V,1l)}A{1B();l.U()}};3 1g(b){4(!b){6[&quot;&quot;]}5 d=b.1Z(r.R);5 c=[];$.K(d,3(i,a){4($.1p(a))c[i]=$.1p(a)});6 c}3 1k(a){4(!r.19)6 a;5 b=1g(a);6 b[b.7-1]}3 1A(q,a){4(r.1A&amp;&amp;(1k(u.J()).O()==q.O())&amp;&amp;k!=t.2e){u.J(u.J()+a.48(1k(m).7));$.D.1N(o,m.7,m.7+a.7)}};3 2k(){1I(p);p=1H(1l,47)};3 1l(){5 c=l.L();l.U();1I(p);1B();4(r.2U){u.1y(3(a){4(!a){4(r.19){5 b=1g(u.J()).17(0,-1);u.J(b.2Z(r.R)+(b.7?r.R:&quot;&quot;))}A u.J(&quot;&quot;)}})}4(c)$.D.1N(o,o.H.7,o.H.7)};3 2V(q,a){4(a&amp;&amp;a.7&amp;&amp;s){1B();l.2T(a,q);1A(q,a[0].H);l.1W()}A{1l()}};3 1R(f,d,g){4(!r.1C)f=f.O();5 e=n.2S(f);4(e&amp;&amp;e.7){d(f,e)}A 4((Y r.11==&quot;1w&quot;)&amp;&amp;(r.11.7&gt;0)){5 c={45:+1E 44()};$.K(r.2R,3(a,b){c[a]=Y b==&quot;3&quot;?b():b});$.43({42:&quot;41&quot;,3Z:&quot;12&quot;+o.3Y,2M:r.2M,11:r.11,w:$.1o({q:1k(f),3X:r.Z},c),3W:3(a){5 b=r.1r&amp;&amp;r.1r(a)||1r(a);n.1h(f,b);d(f,b)}})}A{l.2J();g(f)}};3 1r(c){5 d=[];5 b=c.1Z(&quot;\\n&quot;);16(5 i=0;i&lt;b.7;i++){5 a=$.1p(b[i]);4(a){a=a.1Z(&quot;|&quot;);d[d.7]={w:a,H:a[0],M:r.1v&amp;&amp;r.1v(a,a[0])||a[0]}}}6 d};3 1B(){u.1e(r.21)}};$.D.1L={24:&quot;3R&quot;,2H:&quot;3P&quot;,21:&quot;3O&quot;,22:1,1D:3M,1C:B,1a:C,1V:B,1j:10,Z:3K,2U:B,2R:{},1S:C,1K:3(a){6 a[0]},1q:14,1A:B,E:0,19:B,R:&quot;, &quot;,1t:3(b,a){6 b.2C(1E 3J(&quot;(?![^&amp;;]+;)(?!&lt;[^&lt;&gt;]*)(&quot;+a.2C(/([\\^\\$\\(\\)\\[\\]\\{\\}\\*\\.\\+\\?\\|\\\\])/2A,&quot;\\\\$1&quot;)+&quot;)(?![^&lt;&gt;]*&gt;)(?![^&amp;;]+;)&quot;,&quot;2A&quot;),&quot;&lt;2z&gt;$1&lt;/2z&gt;&quot;)},1x:C,1s:3I};$.D.2W=3(g){5 h={};5 j=0;3 1a(s,a){4(!g.1C)s=s.O();5 i=s.3H(a);4(i==-1)6 B;6 i==0||g.1V};3 1h(q,a){4(j&gt;g.1j){18()}4(!h[q]){j++}h[q]=a}3 1f(){4(!g.w)6 B;5 f={},2w=0;4(!g.11)g.1j=1;f[&quot;&quot;]=[];16(5 i=0,30=g.w.7;i&lt;30;i++){5 c=g.w[i];c=(Y c==&quot;1w&quot;)?[c]:c;5 d=g.1q(c,i+1,g.w.7);4(d===B)1P;5 e=d.3G(0).O();4(!f[e])f[e]=[];5 b={H:d,w:c,M:g.1v&amp;&amp;g.1v(c)||d};f[e].1O(b);4(2w++&lt;g.Z){f[&quot;&quot;].1O(b)}};$.K(f,3(i,a){g.1j++;1h(i,a)})}1H(1f,25);3 18(){h={};j=0}6{18:18,1h:1h,1f:1f,2S:3(q){4(!g.1j||!j)6 14;4(!g.11&amp;&amp;g.1V){5 a=[];16(5 k 2G h){4(k.7&gt;0){5 c=h[k];$.K(c,3(i,x){4(1a(x.H,q)){a.1O(x)}})}}6 a}A 4(h[q]){6 h[q]}A 4(g.1a){16(5 i=q.7-1;i&gt;=g.22;i--){5 c=h[q.3F(0,i)];4(c){5 a=[];$.K(c,3(i,x){4(1a(x.H,q)){a[a.7]=x}});6 a}}}6 14}}};$.D.2Q=3(e,g,f,k){5 h={G:&quot;3E&quot;};5 j,y=-1,w,1m=&quot;&quot;,1M=C,F,z;3 2r(){4(!1M)6;F=$(&quot;&lt;3D/&gt;&quot;).U().P(e.2H).T(&quot;3C&quot;,&quot;3B&quot;).1J(2p.2n);z=$(&quot;&lt;3z/&gt;&quot;).1J(F).3y(3(a){4(V(a).2m&amp;&amp;V(a).2m.3w()==\'2l\'){y=$(&quot;1F&quot;,z).1e(h.G).3u(V(a));$(V(a)).P(h.G)}}).2i(3(a){$(V(a)).P(h.G);f();g.1G();6 B}).3t(3(){k.1z=C}).3s(3(){k.1z=B});4(e.E&gt;0)F.T(&quot;E&quot;,e.E);1M=B}3 V(a){5 b=a.V;3r(b&amp;&amp;b.3q!=&quot;2l&quot;)b=b.3p;4(!b)6[];6 b}3 S(b){j.17(y,y+1).1e(h.G);2h(b);5 a=j.17(y,y+1).P(h.G);4(e.1x){5 c=0;j.17(0,y).K(3(){c+=I.1i});4((c+a[0].1i-z.1c())&gt;z[0].3o){z.1c(c+a[0].1i-z.3n())}A 4(c&lt;z.1c()){z.1c(c)}}};3 2h(a){y+=a;4(y&lt;0){y=j.1b()-1}A 4(y&gt;=j.1b()){y=0}}3 2g(a){6 e.Z&amp;&amp;e.Z&lt;a?e.Z:a}3 2f(){z.2B();5 b=2g(w.7);16(5 i=0;i&lt;b;i++){4(!w[i])1P;5 a=e.1K(w[i].w,i+1,b,w[i].H,1m);4(a===B)1P;5 c=$(&quot;&lt;1F/&gt;&quot;).3m(e.1t(a,1m)).P(i%2==0?&quot;3l&quot;:&quot;3k&quot;).1J(z)[0];$.w(c,&quot;2c&quot;,w[i])}j=z.3j(&quot;1F&quot;);4(e.1S){j.17(0,1).P(h.G);y=0}4($.31.2b)z.2b()}6{2T:3(d,q){2r();w=d;1m=q;2f()},2u:3(){S(1)},2y:3(){S(-1)},2t:3(){4(y!=0&amp;&amp;y-8&lt;0){S(-y)}A{S(-8)}},2s:3(){4(y!=j.1b()-1&amp;&amp;y+8&gt;j.1b()){S(j.1b()-1-y)}A{S(8)}},U:3(){F&amp;&amp;F.U();j&amp;&amp;j.1e(h.G);y=-1},L:3(){6 F&amp;&amp;F.3i(&quot;:L&quot;)},3h:3(){6 I.L()&amp;&amp;(j.2a(&quot;.&quot;+h.G)[0]||e.1S&amp;&amp;j[0])},1W:3(){5 a=$(g).3g();F.T({E:Y e.E==&quot;1w&quot;||e.E&gt;0?e.E:$(g).E(),2E:a.2E+g.1i,1Q:a.1Q}).1W();4(e.1x){z.1c(0);z.T({29:e.1s,3e:\'3d\'});4($.1T.3b&amp;&amp;Y 2p.2n.3T.29===&quot;3a&quot;){5 c=0;j.K(3(){c+=I.1i});5 b=c&gt;e.1s;z.T(\'3V\',b?e.1s:c);4(!b){j.E(z.E()-28(j.T(&quot;32-1Q&quot;))-28(j.T(&quot;32-39&quot;)))}}}},26:3(){5 a=j&amp;&amp;j.2a(&quot;.&quot;+h.G).1e(h.G);6 a&amp;&amp;a.7&amp;&amp;$.w(a[0],&quot;2c&quot;)},2J:3(){z&amp;&amp;z.2B()},1u:3(){F&amp;&amp;F.37()}}};$.D.1N=3(b,a,c){4(b.2O){5 d=b.2O();d.36(C);d.35(&quot;2P&quot;,a);d.4c(&quot;2P&quot;,c);d.4b()}A 4(b.2Y){b.2Y(a,c)}A{4(b.2X){b.2X=a;b.4a=c}}b.1G()}})(49);',62,261,'|||function|if|var|return|length|||||||||||||||||||||||||data||active|list|else|false|true|Autocompleter|width|element|ACTIVE|value|this|val|each|visible|result|break|toLowerCase|addClass|case|multipleSeparator|moveSelect|css|hide|target|onChange|bind|typeof|max||url|autocomplete||null|trigger|for|slice|flush|multiple|matchSubset|size|scrollTop|preventDefault|removeClass|populate|trimWords|add|offsetHeight|cacheLength|lastWord|hideResultsNow|term|arguments|extend|trim|formatMatch|parse|scrollHeight|highlight|unbind|formatResult|string|scroll|search|mouseDownOnSelect|autoFill|stopLoading|matchCase|delay|new|li|focus|setTimeout|clearTimeout|appendTo|formatItem|defaults|needsInit|Selection|push|continue|left|request|selectFirst|browser|selectCurrent|matchContains|show|unautocomplete|setOptions|split|flushCache|loadingClass|minChars|findValueCallback|inputClass||selected||parseInt|maxHeight|filter|bgiframe|ac_data|COMMA|BACKSPACE|fillList|limitNumberOfItems|movePosition|click|PAGEUP|hideResults|LI|nodeName|body|PAGEDOWN|document|ESC|init|pageDown|pageUp|next|RETURN|nullData|TAB|prev|strong|gi|empty|replace|DEL|top|keyCode|in|resultsClass|DOWN|emptyList|form|opera|dataType|UP|createTextRange|character|Select|extraParams|load|display|mustMatch|receiveData|Cache|selectionStart|setSelectionRange|join|ol|fn|padding|||moveStart|collapse|remove||right|undefined|msie|off|auto|overflow|attr|offset|current|is|find|ac_odd|ac_even|html|innerHeight|clientHeight|parentNode|tagName|while|mouseup|mousedown|index|blur|toUpperCase|188|mouseover|ul|default|absolute|position|div|ac_over|substr|charAt|indexOf|180|RegExp|100|switch|400|keydown|ac_loading|ac_results|keypress|ac_input|submit|style|150|height|success|limit|name|port||abort|mode|ajax|Date|timestamp||200|substring|jQuery|selectionEnd|select|moveEnd'.split('|'),0,{}))

})(jQuery); //end alias</pre>
</div>
<div title="Alan Lyall Robson" modifier="YourName" created="200905082240" modified="200909282049" father="John George Robson" mother="Violet Evelyn Brew" sex="M" placeofbirth="" latitude="" longitude="" dob="1917" dod="1986" spouse="" dom="" changecount="2" placeofmarriage="" occupation="" causeofdeath="" placeofdeath="">
<pre></pre>
</div>
<div title="Alastair Blackman" modifier="YourName" modified="200909282112" changecount="4" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1973-09-08" spouse="" sex="M" dod="0000-00-00" placeofbirth="Cragan?, Cardiff" occupation="" causeofdeath="" placeofdeath="" father="David Edward BLACKMAN" mother="Christine Lyall Thomas">
<pre></pre>
</div>
<div title="Albert (Bert) J Bulmer" modifier="YourName" modified="200909230802" mother="Hannah Mary Augusta Robson" placeofdeath="" causeofdeath="" occupation="Errand boy (1901)" placeofbirth="Darlington Durham" dod="0000-00-00" sex="M" spouse="" dob="1887-00-00" server.type="file" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.page.revision="200903090000" latitude="" longitude="" father="James Bulmer" dom="" placeofmarriage="" changecount="3">
<pre></pre>
</div>
<div title="Alexander Michael Sharman" modifier="YourName" modified="200909221657" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1987-06-01" spouse="" sex="M" dod="0000-00-00" placeofbirth="Aalborg, Denmark" occupation="" causeofdeath="" placeofdeath="" father="Hugh Martyn Sharman" mother="Jette MOHR">
<pre></pre>
</div>
<div title="Alice ALLSOP" modifier="YourName" modified="200909252247" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Alice Botham" modifier="YourName" modified="200909271045" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title="Alice Buckley" modifier="YourName" modified="200909282050" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1690-00-00" spouse="" sex="F" dod="1755-01-24" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" dom="" placeofmarriage="" changecount="1">
<pre>Marriage is license.
	Widow of William Buckley of New Tame. Date of death is burial date.</pre>
</div>
<div title="Alice Cokayne" modifier="YourName" created="200909131538" modified="200909271130" father="Sir John COKAYNE (-1447)" mother="Joan DABRIDGECOURT" sex="F" placeofbirth="" latitude="" longitude="" dob="" dod="" spouse="Sir Ralph SHIRLEY" dom="" changecount="2" placeofmarriage="" occupation="" causeofdeath="" placeofdeath="">
<pre></pre>
</div>
<div title="Alice Cokayne 1540" modifier="YourName" modified="200909271041" changecount="2" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1540-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Roger COKAYNE" mother="Alice ALLSOP">
<pre></pre>
</div>
<div title="Alice Cokayne 1562" modifier="YourName" modified="200909282130" changecount="8" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1562-00-00" spouse="Henry Sherat,Thomas Robinson" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Thomas Cokayne 1540" mother="Magdalen Towers">
<pre></pre>
</div>
<div title="Alice DE DALBURY" modifier="YourName" modified="200909271211" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title="Alice Gartside" modifier="YourName" modified="200909261400" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" John Gartside (487)" mother=" Susanna Barker (492)" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre>Married Scholefield.</pre>
</div>
<div title="Alice Kershaw" modifier="YourName" modified="200909252231" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="1782-04-01" placeofbirth="Rochdale" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre>Died aged 62 years.</pre>
</div>
<div title="Alice Mary BREW" modifier="YourName" modified="200909252220" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1861-09-29" spouse="" sex="F" dod="0000-00-00" placeofbirth="Llanstadwell,Pembrokeshire,Wales" occupation="" causeofdeath="" placeofdeath="" father="George Brew 1826" mother="Jane Margaret Morgan" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Alison Hook" modifier="YourName" modified="200909271033" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title="Alistair Bellwood" modifier="YourName" modified="200909271033" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John Bellwood 1942" mother="Helen URQUART">
<pre></pre>
</div>
<div title="Alun Wynne Sharman" modifier="YourName" modified="200909271031" changecount="2" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1943-11-05" spouse="Lesley Ann Cartwright" sex="M" dod="0000-00-00" placeofbirth="Shaohing, China" occupation="" causeofdeath="" placeofdeath="" father="William Kenneth (Jack) Sharman" mother="Margaret Valerie Millett (Pegi) Robson">
<pre></pre>
</div>
<div title="Amass Oxx" modifier="YourName" modified="200909261451" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1812-02-12" spouse="" sex="" dod="1812-02-14" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John Oxe" mother="Woodhouse Spearman" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Amelia Brew" modifier="YourName" modified="200909252223" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1831-07-17" spouse="" sex="F" dod="0000-00-00" placeofbirth="Chepstow, Monmouthshire, Wales" occupation="" causeofdeath="" placeofdeath="" father="Thomas Brew 1791" mother="Honor Perry" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre>Married Thomas Murphy in 1851</pre>
</div>
<div title="Andreas (Andrew) COKAYNE" modifier="YourName" created="200909131507" modified="200909271158" placeofdeath="" causeofdeath="" occupation="" placeofmarriage="" changecount="3" dom="" spouse="" dod="1189" dob="1126" longitude="" latitude="" placeofbirth="" sex="M" mother="" father="John Cokayne">
<pre></pre>
</div>
<div title="Andrew Lyall Robson" modifier="YourName" modified="200909230811" mother="Joan Bagg" father="Ian Lyall Robson" placeofbirth="Bridgend" latitude="" longitude="" dob="17/10/1956" dod="" spouse="Kathryn Anne Hunter, Julie Bull" changecount="6" dom="28/10/1978" sex="M" placeofmarriage="" occupation="Teacher" causeofdeath="" placeofdeath="">
<pre></pre>
</div>
<div title="Andrew William Rowe Douglass" modifier="YourName" modified="200909261031" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1946-00-00" spouse="Ceri Elizabeth Sharman" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="3">
<pre></pre>
</div>
<div title="Andrew Wills" modifier="YourName" modified="200909221718" changecount="2" placeofdeath="" causeofdeath="" occupation="" placeofmarriage="" dom="" sex="M" mother="Sharman Louise Robson" father="Peter William WILLS" placeofbirth="" latitude="" longitude="" dob="1986-03-31" dod="" spouse="" vismoxy="606,-273.6523829868861">
<pre></pre>
</div>
<div title="Angela Spearman Oxx" modifier="YourName" modified="200909271116" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1938-00-00" spouse="Michael J WILFORD" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="George Spearman Cullen OXX" mother="Ivy B CROOKS" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre>m. Michael J WILFORD 1960

	(5 children: Karenna, Carl Adrian, Paul Newton, Jane Anne, Anna Patricia)</pre>
</div>
<div title="Aniuan Prince of Munster" modifier="YourName" modified="200909282057" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Mahon (7th century)" mother="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Ann Bellwood" modifier="YourName" modified="200909252250" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1847-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Richard Bellwood 1809" mother="Elizabeth Wilson" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Ann Foster" modifier="YourName" modified="200909261436" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1826-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="Durham Stockton" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre>Possible surnames:
	Forster /Foster (middle name passed down)
	Shearer (married Joseph Robson Jun 1841 Durham area)
	Bell

	If surname = Foster then Daughter of Robert Foster.</pre>
</div>
<div title="Ann Gartside" modifier="YourName" modified="200909240839" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John Gartside" mother="Mary Harrop">
<pre>Wife of James Buckley of Heys in Crompton. Married 8 Jun 1738,
	His will proved 1759.</pre>
</div>
<div title="Ann SPEARMAN" modifier="YourName" created="200909131615" modified="200909131615" father="Gilbert Illegy SPEARMAN" mother="Anna CLARK" placeofbirth="" latitude="" longitude="" dob="" dod="" spouse="" dom="" changecount="1">
<pre>m. William CLARK
Three children: James Mary and ?</pre>
</div>
<div title="Ann Spence" modifier="YourName" modified="200909252246" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1835-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Anna CLARK" modifier="YourName" modified="200909221702" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title="Anne Lady O BRIEN" modifier="YourName" modified="200909240756" changecount="3" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="1645-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Henry (5th Earl of Thomond) O BRIEN" mother="Mary BRERETON">
<pre></pre>
</div>
<div title="Annie E MOORE" modifier="YourName" created="200909131627" modified="200909131627" dom="" spouse="" father="" mother="" dod="1935" dob="1857" longitude="" latitude="" placeofbirth="" sex="F" changecount="2">
<pre></pre>
</div>
<div title="Anthony Hunter" modifier="YourName" created="200905032200" modified="200909251542" placeofdeath="" causeofdeath="" occupation="" placeofmarriage="" sex="M" dom="" placeofbirth="Macclesfield" latitude="" longitude="" dob="1951-01-27" dod="" mother="Freda Gartside" father="Herbert Hunter" spouse="" changecount="3">
<pre></pre>
</div>
<div title="Anthony Michael Silver" modifier="YourName" modified="200909282114" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1946-00-00" spouse="Janet Margaret Gartside" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre>Lecturer. Married at Harrow Register Office.</pre>
</div>
<div title="Bankes Jackson" modifier="YourName" modified="200909221948" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="William Jackson" mother="French woman UNKNOWN" latitude="" longitude="" dom="" placeofmarriage="" changecount="3">
<pre>Could be James Banks as this person is referred to in one letter? However Joseph Jackson writes in a letter to Adam Lyall (uncle) &quot; Father is working with brother Bankes and I is working with brother Henry&quot;</pre>
</div>
<div title="Barnabas (6th Earl of Thomond) O BRIEN" modifier="YourName" modified="200909240759" changecount="3" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1590-00-00" spouse="" sex="M" dod="1657-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Donough (4th Earl of Thomond) O Brien" mother="Elizabeth Fitzgerald">
<pre></pre>
</div>
<div title="Benjamin Gartside" modifier="YourName" modified="200909252230" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1746-00-00" spouse="" sex="M" dod="1813-01-15" placeofbirth="Heyhouse, Denshaw, Yeoman" occupation="" causeofdeath="" placeofdeath="" father="Benjamin Gartside 1715" mother="Alice Kershaw" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre>Died aged 67. Will proved 1 Oct 1813. Inherited Ocknell Lee and purchased Bowhouse from Jonah Buckley in 1876. Married at St Chad, Rochdale.</pre>
</div>
<div title="Benjamin Gartside 1715" modifier="YourName" modified="200909252231" changecount="3" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="1795-05-04" placeofbirth="Ocknell Lee Yeoman" occupation="" causeofdeath="" placeofdeath="" father="John Gartside" mother="Mary Harrop">
<pre>Baptised 15 Oct 1715.
	Inherited one sixteenth part of Bakestone pit from father and purchased another sixteenth from brother James 8 Nov 1781.
	Purchased Heyhouse in Denshaw from Timothy Buckley in 1792.
	Will proved 11 May 1795.</pre>
</div>
<div title="Bertha Houghton" modifier="YourName" modified="200910032046" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1890-08-06" spouse="Harry Gartside" sex="F" dod="1973-05-07" placeofbirth="Ashton-u-Lyme" occupation="" causeofdeath="4 Buxton Close, East Runton, Norfolk" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="4">
<pre></pre>
</div>
<div title="Bethan Wills" modifier="YourName" created="200905032201" modified="200909221718" placeofdeath="" causeofdeath="" occupation="" placeofmarriage="" dom="" sex="F" placeofbirth="" latitude="" longitude="" dob="1983-07-25" dod="" mother="Sharman Louise Robson" father="Peter William WILLS" spouse="" changecount="3">
<pre></pre>
</div>
<div title="Brian Boru King of Ireland" modifier="YourName" created="200909131640" modified="200909282101" changecount="7" dom="" spouse="" father="Cennétig mac Lorcáin" mother="" dod="23/04/1014" dob="0941c" longitude="" latitude="" placeofbirth="Killaloe, Ireland" placeofmarriage="" occupation="" causeofdeath="" placeofdeath="The Battle of Clonarf" sex="M">
<pre>[img[files/brianboru.jpg]]
This King is the oldest member of my family tree. I will show you how you get from him to Robson at a later date. I'm still in progress of updating the information here.

Reigned 66 years, 12 as Monarch. He was 88 when slain at Clontarf. After his death in 1014, Malachi II was restored to the Monarchy and he ruled till his death in 1023.

Brian Bórúma mac Cennetig, known popularly as Brian Bórú, is undoubtedly the most well known ard-rí (ARD-ree) or High King of Ireland of Ireland and arguably the only ard-rí who, like Ælfred the Great of England, actually controlled the entire country.

Brian Bórú was born circa 941 at Béal Bórú (from which he received his name), near Killaloe, County Clare, at a time when the Norse had secured many seaports and frequently plundered and harried the neighbouring countryside. In 976 he succeeded his brother Mathúin as king of Dál gCais and claimant to the kingship of Munster. By 999, after a series of wars, he was acknowledged as High King of Ireland.

Brian Boruma mac Cennetig, known popularly as Brian Boru, is undoubtedly the most well known high king of Ireland. He held the title ard-ri Gaidel Erenn, Gall, Bretan, August iarthair tuaiscirt Eorpa uile (high king of the Irish of Ireland and of the Foreigners and the Welsh, the Augustus of the whole north-west Europe) from the year 1002 until his death at the battle of Clontorf in 1014 (Byrne 257). Boru's reputation as an innovative, disciplined warrior or chieftain confirmed by his many successes in battle, may have ultimately transformed him into an arrogant, selfish tyrant in his later years.

In the 900's the government of Munster was to be shared, with alternating rule between the southern Eoghanist clan and the northern Delcassian clan. The south had control for some time and were attempting to keep the rights of succession from the southern Delcassian. It was Brian Boru's grandfather, Lorcan mac Lachtna, king of Thomond and of historic O'Brien lineage, who would strive to bring the government of Munster back to the Delcassian clan. Lachtna's son, Cennetig, succeeded his father and attained kingship of Munster. Brian Boru, born during the 930's, was one of many sons of Cennetig. Cennetig taught his sons to live by the pledge of valor of the Delcassian tribe: first to the battlefield and the last to leave. 

In 960 Mahoun, the oldest son of Cennetig, obtained the crown of Munster (Cusack 121). Brian was given rule over Thomond, Northern Munster. During his reign, Mahoun sought to secure peace with the Vikings that had invaded Ireland in 793 and who were still living among the Irish (Foster 30). Small guerrilla activities against Mahoun's province were becoming a nuisance, but rather than countering their attacks, Mahoun preferred to amicably settle with the Viking rulers. Brian disagreed with his brother, urging armed violent retaliation.

Brian reproached Mahoun with cowardice; Mahoun reproached Brian with imprudence. Brian hints broadly that Mahoun had interested motives in making this truce, and declares that neither Cennetig their father, nor Lorcan their grandfather, would have been quite so quiescent towards the foreigners for the sake of wealth, nor would they have given them as much time as would have sufficed to play a game of chess on the green of Mogadare. Mahoun kept his temper, and contented himself with reproaching Brian for his recklessness, in sacrificing the lives of so many of his faithful followers to no purpose. Brian replied that he would never abandon his inheritance, without a contest to &quot;such foreigners as Black Grim Gentiles.&quot; (Cusack 122)

Mahoun agreed to hold a conference among his followers and they all agreed with Brian that they should declare war on their enemies. Brian consulted the nobles of the Delcassian and Eoghanist clans concerning strategies and logistics. He held musters to assemble and asses the strength of the forces and he designated the most worthy soldiers as unit leaders (Flanagan 53). United, the two clans defeated the Danes of Limerick and collected a remarkable amount of loot, which included young girls and women. This great victory was one of the first indications of Brian's true military genius. Brian's supporters, who had placed faith in his reputation as a determined and disciplined warrior, now had proof that he was capable of great feats. Perhaps he could unite Ireland under one kingdom.

Mahoun's armies, under Brian's direction, had many victories. Mahoun now had complete control over Munster and he made it clear to everyone in his province that he would never relinquish his position. The brothers' rule seemed invulnerable, their confidence made them arrogant. The Eoghanists withdrew their support and merged with their recent enemies, the Danes, in the assassination of Mahoun. Mahoun was invited to the house of Donovan, an Eoghanist prince that shared his own ancestors, and &quot;in violation of the rights of hospitality&quot; he was brutally murdered by Donovan and Moalmua, another prince of the region (Cusack 123). The assassins had forgotten Brian's ruthless nature and were not prepared for what was to come.

Brian assumed the crown and moved the kingship to Kincora, now known as Killaloe. In his first act as King of Munster he would avenge his brother's death. Driving straight into their territories, Brian's forces were able to destroy the majority of the princes' armies. Donovan was killed during the battle, but significantly, it was Brian's son, Morrough, who encountered Moalmua and had the glory of sacrificing him on the same spot as his murdered uncle (Moore 196). While still engaged in retribution against the Eoghanists, Brian committed armies to the isle of Iniscathy to retake possession of the land from the Danes who had been struggling without the aid of the Danes of Limerick. With another success in Iniscathy, he decided to push onto the remaining islands of the Shannon, plundering and devastating the remains of the Danes. Land and naval forces were summoned as part of the coordinated strategy of attacks successfully used by Brian (Flanagan 54).

In 984, Brian was given title as ruler of Leth Mogha, the southern half of Ireland. His reputation had preceded him throughout Ireland. Brian fought battles against the Danes at Tara, homeland to the ancient kings of Ireland, and besieges Dublin in 999. Brian was able to maintain a military presence in Dublin during the winter months after blocking all passages into the city and demolishing all foreign fortresses. Brian sought hostages and all the spoils of the city as tribute that would prevent further devastation. Brian's forces prove that a successful campaign is not dependent only on victories on the battlefield, but also on the their ability to maintain all strategic positions.

Brian expanded his authority into northern Ireland and to secure his position there he gave his daughter away in marriage to Sitric Silkbeard, King of Viking Dublin. Brian completed the family alliance by marrying Sitric's mother, Gormflaith, who had been divorced from her second husband, Malachy. Malachy and Brian had been in constant conflict with one another over the past years, each defeating the other in successive battles for control. Malachy was Brian's only obstacle to obtaining the crown of all of Ireland, and with Brian's new ally in the Vikings of Ireland, this obstacle would be easily overcome. Malachy, tired of the bloody battles, finally yielded to Brian, becoming one of his vassals.

In 1102, Brian marches into Tara again, this time not to fight but to be acknowledged as the High King (Ard-Righ) of all Ireland (Moore 202). Though he is known as a tyrant for his violent methods of persuasion, Brian had done more than any other person in the early history of Ireland to unite the people of the land. In his first years as the supreme sovereign of Ireland, he was credited with the rebuilding of schools and monasteries , which improved communication throughout the country.

Brian still required tributes, in any form, from the smaller kings and nobles in his domain, and for this he would provide them with protection from outside forces. During a visit by which Gormflaith's brother, Maelmurra (King of Leinster), was bringing his tributes to Brian in the form of pine to be used as masts for naval ships, Maelmurra was said to be deeply insulted by Brian's son Morrough. He left Kincora in a rage, and soon had his clan &quot;roused to avenge the insults offered to their chief&quot; (Cusack 129). With the help of the O'Rourkes, O'Niels, O'Flahertys and the Kearys, Maelmurra attacked homes throughout Brian's realm. The O'Rourkes attacked Malachy and killed his grandson Drumale, the heir-apparent. After his few good deeds in the reparation of Ireland, Brian easily returned to his vengeful, bloody battles against those who did not bow to his authority. Brian's armies stockaded Dublin for three months, and during Brian's absence Gormflaith grew angry at him for leaving her alone. She left Kincora and joined her brother Maelmurra and her son Sitric. Gormflaith and Maelmurra persuaded Sitric to rally his Viking allies from Scandinavia, to aid them in seizing the crown of Ireland from Brian. Sitric offered the treasure of his mother, Gormflaith, in marriage to anyone who could kill Brian.

The battle for the crown was to take place in Clontarf, four miles north of modern Dublin. Brian's forces plundered and destroyed every foreign town as they traveled to the site of the battle. The Battle of Clontarf began at sunrise on Good Friday, the 23rd of April, 1014. The 21,000 men of Brian's enemy was made up of Danes, Norwegians, Leinster men and other foreign auxiliaries. Brian's forces consisted of Dalcassians and the troops and nobles from Munster and Connaught. Brian, now an old man in his 80's, stayed in his tent praying as the battle ensued.

The battle was said to be &quot;so fierce that in places the trees wept blood and the nearby River Tolka turned red&quot; (O'Kelly). Brian, while sitting in his tent, foresaw his death even though the battle was in his favor, and he gave his attendant his will to be conveyed to his son, Donnough.

The security of the tent by Brian's forces was not maintained and a group of Danes retreating from the battle came upon Brian, kneeling in prayer, and their leader Brodir &quot;opened his head with his battle axe&quot; (Cusack 136). Brodir was slain immediately by the guards who had neglected their post outside the tent. The battle was ultimately won by Brian's forces. His wake ( ecnaire ) lasted 12 nights.

The Irish believe that no one deserves a place in history until the &quot;durability of his achievements has been attested by the success of his great-grandchildren&quot; (Byrne 70). Brian Boru has earned his place in history books because the O'Briens were able to maintain the kingship in Kincora for two centuries after the battle of Clontarf. He is remembered even today with his name being used for Irish pubs, beers, music bands and in their songs, and probably most amusing as the name of a champion Labrador.

The Battle of Clontarf

Brian Boru's reign was marked by continuous opposition. This came to a head in the early eleventh century. Máel Mórda, the king of Leinster, made an alliance with the Dublin Norse under Sigurd, Earl of Orkney and their overseas allies. Brian's forces defeated this union at Clontarf, about four miles north of modern Dublin, on Good Friday, April 23, 1014.  Brian, too aged to fight, was awaiting news of the battle when he was slain in his tent by a Viking intruder. The battle of Clontarf marked the end of any major Viking involvement in Irish wars.

From this point on, the role of the Norsemen in Ireland was largely peaceful, and they intermarried with the Irish and concentrated on developing trade.  However, with the death of Brian Bórú in 1014, Ireland once again became an island of conflicting dynasties, with the High King unable to enforce acceptance by all the provinces.</pre>
</div>
<div title="Brian Catha An Eanough King of Thomond" modifier="YourName" modified="200909240806" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="1399-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Mahon Manmay (King Mahon) King of Thomond" mother="">
<pre></pre>
</div>
<div title="Brien COKAYNE Viscount Cullen" modifier="YourName" created="200909131605" modified="200909131605" changecount="1" dom="" spouse="" dod="" dob="" longitude="" latitude="" placeofbirth="" mother="Mary O'BRIEN Lady " father="Charles COKAYNE 1st Viscount Cullen (1602-1686)">
<pre></pre>
</div>
<div title="Camilla Beth Sharman" modifier="YourName" modified="200909221657" changecount="2" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1983-02-13" spouse="" sex="F" dod="0000-00-00" placeofbirth="Puerto Rico" occupation="" causeofdeath="" placeofdeath="" father="Hugh Martyn Sharman" mother="Jette MOHR">
<pre></pre>
</div>
<div title="Cathal King of Thomond" modifier="YourName" modified="200909282051" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Fearchorb" mother="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Catherine Jackson" modifier="YourName" modified="200909221947" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="William Jackson" mother="French woman UNKNOWN" latitude="" longitude="" dom="" placeofmarriage="" changecount="3">
<pre>Unconfirmed.</pre>
</div>
<div title="Catherine WONTON 182" modifier="YourName" modified="200909282048" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="1596-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" dom="" placeofmarriage="" changecount="2">
<pre></pre>
</div>
<div title="Cecilia VERNON" modifier="YourName" created="200909131522" modified="200909261509" changecount="2" dom="" father="" mother="" dod="" dob="" longitude="" latitude="" placeofbirth="" spouse="Sir John COKAYNE" sex="F" placeofmarriage="" occupation="" causeofdeath="" placeofdeath="">
<pre></pre>
</div>
<div title="Cennétig mac Lorcáin" modifier="YourName" modified="200909282103" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0951-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Lorcan or Liccon King of Thomond" mother="" dom="" placeofmarriage="" changecount="2">
<pre></pre>
</div>
<div title="Ceri Elizabeth Sharman" modifier="YourName" created="200905082245" modified="200909261029" changecount="2" placeofdeath="" causeofdeath="" dod="" occupation="" placeofmarriage="" dom="" longitude="" latitude="" placeofbirth="Shaohing, China" dob="1948-11-07" mother="Margaret Valerie Millett (Pegi) Robson" father="William Kenneth (Jack) Sharman" spouse="Andrew William Rowe Douglass" sex="F">
<pre></pre>
</div>
<div title="Charles COKAYNE (- 1657)" modifier="YourName" created="200909131605" modified="200909131605" changecount="1" dom="" spouse="" dod="1657" dob="" longitude="" latitude="" placeofbirth="" mother="Mary O'BRIEN Lady " father="Charles COKAYNE 1st Viscount Cullen (1602-1686)">
<pre></pre>
</div>
<div title="Charles COKAYNE 1st Viscount Cullen (1602-1686)" modifier="YourName" created="200909131602" modified="200909221708" placeofdeath="" causeofdeath="" occupation="" placeofmarriage="" changecount="3" dom="24/06/1627" spouse="Mary O'BRIEN Lady " dod="1686" dob="1602" longitude="" latitude="" placeofbirth="" sex="M" mother="Mary MORRIS, Countess of Dover" father="Sir William Cokayne (Mayor)">
<pre>Charles was created Viscount Cullen in 1642.
	From: &quot;Parishes: Bishop Middleham&quot;, A History of the County of Durham: Volume 3 (1928), pp. 204-12. URL: http://www.british-history.ac.uk/report.asp?compid=42621. Date accessed: 07 August 2006.</pre>
</div>
<div title="Charles H (Charlie) Bulmer" modifier="YourName" modified="200909230803" mother="Hannah Mary Augusta Robson" placeofdeath="" causeofdeath="" occupation="" placeofbirth="" dod="0000-00-00" sex="M" spouse="" dob="1890-00-00" server.type="file" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.page.revision="200903090000" latitude="" longitude="" father="James Bulmer" dom="" placeofmarriage="" changecount="3">
<pre></pre>
</div>
<div title="Charles Henry Newton" modifier="YourName" modified="200909251540" changecount="3" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1866-00-00" spouse="Isabel Robson" sex="M" dod="0000-00-00" placeofbirth="Cradley, Worcestershire, England" occupation="Section Roller" causeofdeath="" placeofdeath="" father="Unknown Newton" mother="">
<pre>Date of marriage is unconfirmed and could be wrong. Place of suspected marriage was Llanelli.

	In 1901 census he is living at Holden Road, Wednesbury, Staffordshire:
	Civil parish: Wednesbury
	Ecclesiastical parish: St John
	County/Island: Staffordshire
	Country: England 

	Charles H Newton abt 1866 Cradley, Worcestershire, England Head Wednesbury Staffordshire
	Gladys Newton abt 1900 Trimsaran, Carmarthenshire, Wales Daughter Wednesbury Staffordshire
	Isabel Newton abt 1867 Middlesborough, Yorkshire, England Wife Wednesbury Staffordshire
	John R Newton abt 1899 Trimsaran, Carmarthenshire, Wales Son Wednesbury Staffordshire
	Maria Newton abt 1864 Crudley, Worcestershire, England Sister Wednesbury Staffordshire
	John G Robson abt 1885 Workington, Cumberland, England Cousin-in-law Wednesbury Staffordshire
	Sarah Sudler abt 1884 Trimsaran, Carmarthenshire, Wales Servant Wednesbury

	Interesting John G is incorrectly stated as a cousin-in-law. He should be a brother in law.</pre>
</div>
<div title="Charles Robson Bellwood" modifier="YourName" modified="200909261420" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1880-00-00" spouse="" sex="M" dod="1952-00-00" placeofbirth="MIDDLESBROUGH Cleveland England" occupation="" causeofdeath="" placeofdeath="" father="Thomas Bellwood 1854" mother="Frances Isabella Woodhouse Robson" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre>Charles Robson Bellwood
b. 1880 (7 months old at time of 1881 census) Middlesbro</pre>
</div>
<div title="Christine Lyall Thomas" modifier="YourName" created="200909020954" modified="200909271128" placeofdeath="" causeofdeath="" occupation="" placeofmarriage="" mother="Marjorie Isabell Robson" father="William Brinley Thomas" sex="F" placeofbirth="" latitude="" longitude="" dob="1945" dod="??/09/2006" spouse="Robert John ANDERSON" dom="" changecount="3">
<pre>	Christine Lyall THOMAS (1945-)
m. David Edward BLACKMAN (1944-) 24/05/69
m. Robert John Anderson (1938-) 24/07/92 </pre>
</div>
<div title="Clive Spearman Oxx" modifier="YourName" modified="200909271122" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1934-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="George Spearman Cullen OXX" mother="Ivy B CROOKS">
<pre></pre>
</div>
<div title="Conor (3rd Earl of Thomond) O BRIEN" modifier="YourName" modified="200909240802" changecount="2" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1535-00-00" spouse="" sex="M" dod="1581-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Donough (2nd Earl of Thomond) O BRIEN" mother="Helen Butler">
<pre>Possibly also married Eveleen MacCarthy</pre>
</div>
<div title="Conor (Prince of Thomond, Ireland then King of Thomond) O BRIEN" modifier="YourName" modified="200909240804" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1503-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Turlogh (Prince of Thomond, Ireland) O BRIEN" mother="">
<pre></pre>
</div>
<div title="Conor Na Suidane King of Thomond" modifier="YourName" modified="200909240808" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="1268-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Donough Courbreach King of Thomond" mother="">
<pre></pre>
</div>
<div title="Constance Elizabeth Lyall Howells" modifier="YourName" modified="200909261400" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1909-02-11" spouse="" sex="F" dod="2003-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Daniel Howells" mother=" Mary Elizabeth Robson (48)" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Corc or Coreach King of Munster" modifier="YourName" modified="200909282056" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Aniuan Prince of Munster" mother="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Daisy Margaret King" modifier="YourName" created="200905082202" modified="200909230753" placeofdeath="" causeofdeath="" occupation="" placeofmarriage="" changecount="2" dom="" spouse="" mother="Julia Hunter" dod="" dob="1995" longitude="" latitude="" placeofbirth="" sex="F" father="David King">
<pre></pre>
</div>
<div title="Daniel Howells" modifier="YourName" modified="200909261359" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1875-00-00" spouse="Mary Elizabeth Robson" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre></pre>
</div>
<div title="Daniel Robson" modifier="YourName" modified="200909252225" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1862-00-00" spouse="" sex="M" dod="1916-05-04" placeofbirth="Murton, Co. Durahm, England" occupation="Coal Miner" causeofdeath="" placeofdeath="Murton, Co. Durahm, England" father="John Robson 1828" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="David Bellwood" modifier="YourName" modified="200909271032" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1949-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Norman Robson Bellwood" mother="Freda Thompson">
<pre></pre>
</div>
<div title="David Edward BLACKMAN" modifier="YourName" modified="200909261509" changecount="2" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1945-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title="David King" modifier="YourName" created="200905082137" modified="200909131731" dom="" placeofbirth="" latitude="" longitude="" dob="" dod="" mother="" father="" spouse="" changecount="4" sex="M">
<pre></pre>
</div>
<div title="DefaultTiddlers" modifier="YourName" tags="excludeTree" server.type="file" server.host="file:///Users/Jon/Documents/TiddlyWiki/Trunk/contributors/JonRobson/verticals/FamilyTree/index.html" server.page.revision="200903090000">
<pre>&lt;&lt;bootUpFamilyTree&gt;&gt;
</pre>
</div>
<div title="Dermot King of Munster" modifier="YourName" modified="200909240813" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="1120-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Turough King of Munster" mother="">
<pre></pre>
</div>
<div title="Donnell More King of Thomond" modifier="YourName" modified="200909240811" changecount="2" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1178-00-00" spouse="" sex="M" dod="1194-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Turlough King of Thomond (2)" mother="">
<pre></pre>
</div>
<div title="Donough (2nd Earl of Thomond) O BRIEN" modifier="YourName" modified="200909240804" changecount="2" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1519-00-00" spouse="" sex="M" dod="1553-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Conor (Prince of Thomond, Ireland then King of Thomond) O BRIEN" mother="Raghnailt Macnamara">
<pre></pre>
</div>
<div title="Donough (4th Earl of Thomond) O Brien" modifier="YourName" modified="200909240800" changecount="2" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Conor (3rd Earl of Thomond) O BRIEN" mother="Una O BRIEN">
<pre></pre>
</div>
<div title="Donough Courbreach King of Thomond" modifier="YourName" modified="200909240812" changecount="2" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="1242-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Donnell More King of Thomond" mother="">
<pre></pre>
</div>
<div title="Dorothy Cokayne" modifier="YourName" modified="200909271139" changecount="2" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1530-00-00" spouse="Freeman" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Roger COKAYNE" mother="Alice ALLSOP">
<pre></pre>
</div>
<div title="EditTemplate" modifier="YourName" tags="excludeTree excludeLists" server.type="file" server.host="file:///Users/Jon/Documents/TiddlyWiki/Trunk/contributors/JonRobson/verticals/FamilyTree/index.html" server.page.revision="200903090000">
<pre>&lt;!--{{{--&gt;
&lt;div class='tiddlerContainer'&gt;
&lt;div class='toolbar' macro='toolbar [[ToolbarCommands::EditToolbar]]'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit title'&gt;&lt;/div&gt;
&lt;div macro='annotations'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit text'&gt;&lt;/div&gt;
&lt;div class='tagsection'&gt;
tags:&lt;span class='editor' macro='niceTagger'&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;h1&gt;Family Tree Specific&lt;/h1&gt;
sex (M or F): &lt;div class='editor' macro='AdvancedEditTemplate metaDataName:sex type:radio valuesSource:sexDefinition'&gt;&lt;/div&gt;
date of birth:&lt;div class='editor' macro='edit dob'&gt;&lt;/div&gt;
place of birth:&lt;div class='editor' macro='edit placeofbirth'&gt;&lt;/div&gt;
mother:&lt;div class='editor' macro='aet type:search metaDataName:mother valuesSource:ListOfWomen wikify:yes'&gt;&lt;/div&gt;
father:&lt;div class='editor' macro='aet type:search metaDataName:father valuesSource:ListOfMen wikify:yes'&gt;&lt;/div&gt;
spouse:&lt;div class='editor' macro='edit spouse'&gt;&lt;/div&gt;
date of marriage: &lt;div class='editor' macro='aet type:date metaDataName:dom'&gt;&lt;/div&gt;
where did they get married: &lt;div class='editor' macro='edit placeofmarriage'&gt;&lt;/div&gt;

occupation:&lt;div class='editor' macro='edit occupation'&gt;&lt;/div&gt;
date of death:&lt;div class='editor' macro='edit dod'&gt;&lt;/div&gt;
What did he/she die of?&lt;div class='editor' macro='edit causeofdeath'&gt;&lt;/div&gt;
where did they die?&lt;div class='editor' macro='edit placeofdeath'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;!--}}}--&gt;
</pre>
</div>
<div title="Edith Cokayne" modifier="YourName" modified="200909271137" changecount="4" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1530-00-00" spouse="Roger Hurt" sex="F" dod="1589-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Roger COKAYNE" mother="Alice ALLSOP">
<pre></pre>
</div>
<div title="Edmund Bentley" modifier="YourName" modified="200909221729" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1878-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="DARLINGTON County Durham England" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Edmund Bentley (1)" modifier="YourName" modified="200909221734" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1917-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="DARLINGTON County Durham England" occupation="" causeofdeath="" placeofdeath="" father="Edmund Bentley" mother="Emma Isabel Bulmer" latitude="" longitude="" dom="" placeofmarriage="" changecount="4">
<pre></pre>
</div>
<div title="Edmund COKAYNE" modifier="YourName" created="200909131553" modified="200909271145" placeofdeath="" causeofdeath="" occupation="" placeofmarriage="" sex="M" father="William Cokayne Snr" mother="" placeofbirth="" latitude="" longitude="" dob="" dod="1575" spouse="Ellen DENBIE" dom="28/01/1537" changecount="2">
<pre></pre>
</div>
<div title="Edmund Cokayne 1370" modifier="YourName" modified="200909252232" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1370-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Sir Edmund COKAYNE" mother="Elizabeth de HERTHULL" latitude="" longitude="" dom="" placeofmarriage="" changecount="3">
<pre></pre>
</div>
<div title="Edward Robson" modifier="YourName" modified="200910021558" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1834-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="3">
<pre>A letter is in possession of the family from an Edward Robson writing from Sydney Mines,Cape Breton (an Island off Canada not to be confused with Australia). It is unknown who he is writing to or how he is related. He addresses the recipitent as &quot;Sir&quot;. He writes about Canada and a murder trial.

	It is unknown how he is connected to the family, but one would guess he could possibly be a brother or cousin to [[Robert Robson]].</pre>
</div>
<div title="Eleanor Lloyd" modifier="YourName" modified="200909261500" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Eliza Brew" modifier="YourName" modified="200909252222" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1822-09-29" spouse="" sex="F" dod="1842-12-09" placeofbirth="Chepstow,Monmouthshire,Wales" occupation="" causeofdeath="" placeofdeath="" father="Thomas Brew 1791" mother="Honor Perry" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre>Christened 1822-09-29</pre>
</div>
<div title="Elizabeth  Lady O BRIEN" modifier="YourName" modified="200909240756" changecount="3" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1639-00-00" spouse="" sex="F" dod="1656-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Henry (5th Earl of Thomond) O BRIEN" mother="Mary BRERETON">
<pre></pre>
</div>
<div title="Elizabeth Anne Lyall" modifier="YourName" modified="200909221745" changecount="2" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1845-04-12" spouse="" sex="F" dod="0000-00-00" placeofbirth="Wingate, Durham" occupation="" causeofdeath="" placeofdeath="" father="Adam Lyall" mother="Isabella Jackson">
<pre>Christened 12 APR 1846 Wingate, Durham, England according to an IGI Individual Record on familysearch.org. In the IGI Individual Record the name is spelt &quot;Elizabeth Anne Lyill&quot; - a mistake?
	It states her mother as Isabella and her father as Adam.

	In 1881 she can be found living with her mother, sister and her niece. She is unlikely to have married.</pre>
</div>
<div title="Elizabeth Brew" modifier="YourName" modified="200909252139" changecount="3" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1814-04-10" spouse="" sex="F" dod="1881-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John Brew 1790" mother="Rachel Prickett">
<pre>Married 7 January 1838</pre>
</div>
<div title="Elizabeth Brew 1836" modifier="YourName" modified="200909261437" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1836-11-27" spouse="" sex="F" dod="1838-01-01" placeofbirth="Chepstow,Monmouthshire,Wales" occupation="" causeofdeath="" placeofdeath="" father="Thomas Brew 1791" mother="Honor Perry" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre>was christened in Chepstow on 27 November 1836, and died on 1 January 1838 </pre>
</div>
<div title="Elizabeth COKAYNE" modifier="YourName" modified="200909271148" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title="Elizabeth Fitzgerald" modifier="YourName" modified="200909240758" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title="Elizabeth Gartside" modifier="YourName" modified="200909240840" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="1729-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John Gartside" mother="Mary Harrop">
<pre>Buried 20 July 1729. 
	Admin 1730.
	Wife of John Lees of Hilltop, Yeoman.
	Wife of James Hohnson of Worsley, tanner. Married 9 Jan 1739.</pre>
</div>
<div title="Elizabeth Jackson" modifier="YourName" modified="200909231727" changecount="3" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Matthew Jackson" mother="Martha UNKNOWN">
<pre></pre>
</div>
<div title="Elizabeth MEDCALFE" modifier="YourName" modified="200909261403" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="William COKAYNE (132)" sex="F" dod="1589-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre></pre>
</div>
<div title="Elizabeth Rees" modifier="YourName" modified="200909261501" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1875-00-00" spouse="Frederick Charles Brew" sex="F" dod="0000-00-00" placeofbirth="Carmarthenshire, Wales" occupation="" causeofdeath="" placeofdeath="" father="Robert Rees" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre>Daughter of Robert Rees.</pre>
</div>
<div title="Elizabeth Robson 1876" modifier="YourName" modified="200909271034" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1876-00-00" spouse="" sex="F" dod="1911-11-02" placeofbirth="Hartlepool, Durham, England" occupation="" causeofdeath="" placeofdeath="Murton, Co. Durham" father="Robert Foster Robson" mother="Elizabeth Rowe">
<pre>Married in Hartlepool </pre>
</div>
<div title="Elizabeth Rowe" modifier="YourName" modified="200909271035" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1852-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="Hartlepool, Durham, England" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title="Elizabeth Sophia Ilbert CUTCLIFFE" modifier="YourName" created="200909131626" modified="200909261457" dom="" spouse="" father="" mother="" dod="1951" dob="1862" longitude="" latitude="" placeofbirth="" sex="F" changecount="5" placeofmarriage="" occupation="" causeofdeath="" placeofdeath="">
<pre></pre>
</div>
<div title="Elizabeth V. Brew" modifier="YourName" modified="200909261501" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1911-12-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="Newport, Monmouthshire, Wales" occupation="" causeofdeath="" placeofdeath="" father="Frederick Charles Brew" mother="Elizabeth Rees" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Elizabeth WILKINSON" modifier="YourName" modified="200909261402" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1796-00-00" spouse="" sex="F" dod="1817-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Elizabeth Wilson" modifier="YourName" modified="200909252241" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1819-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="Piercebridge" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Elizabeth de HERTHULL" modifier="YourName" created="200909131523" modified="200909261508" changecount="2" dom="" father="" mother="" dod="" dob="" longitude="" latitude="" placeofbirth="" spouse="Sir Edmund COKAYNE" sex="F" placeofmarriage="" occupation="" causeofdeath="" placeofdeath="">
<pre></pre>
</div>
<div title="Ellen Millett" modifier="YourName" modified="200909261508" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre></pre>
</div>
<div title="Emma Binns" modifier="YourName" modified="200909261508" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="Charles Robson Bellwood" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre></pre>
</div>
<div title="Emma Isabel Bulmer" modifier="YourName" created="200905082229" modified="200909201436" mother="Hannah Mary Augusta Robson" father="James Bulmer" sex="F" dob="24-02-1881" placeofbirth="Darlington" latitude="" longitude="" dod="22/06/1956" causeofdeath="" placeofdeath="" spouse="" dom="" placeofmarriage="" changecount="3" occupation="Drapers Assistant (1901)">
<pre></pre>
</div>
<div title="Emma Robson" modifier="YourName" modified="200909282108" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John Robson 1910" mother="Susan Preece" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre></pre>
</div>
<div title="Emma Thornton" modifier="YourName" modified="200909252246" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1875-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Esther Ceridnen Douglass" modifier="YourName" modified="200909261032" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Andrew William Rowe Douglass" mother="Ceri Elizabeth Sharman" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Esther Jones" modifier="YourName" modified="200909261502" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1852-00-00" spouse="" sex="F" dod="1921-05-07" placeofbirth="Carmarthenshire, Wales" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Ethel Bagg" modifier="YourName" modified="200909231726" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John David Bagg" mother="Katherine Anne UNKNOWN" latitude="" longitude="" dom="" placeofmarriage="" changecount="3">
<pre></pre>
</div>
<div title="Ethel M. Bulmer" modifier="YourName" created="200905082229" modified="200909201428" mother="Hannah Mary Augusta Robson" father="James Bulmer" sex="F" dob="23/01/1877" placeofbirth="Darlington" latitude="" longitude="" dod="1906" causeofdeath="" placeofdeath="" spouse="" dom="" placeofmarriage="" changecount="2">
<pre></pre>
</div>
<div title="Evan Stuart Lyall Blackman" modifier="YourName" modified="200909282109" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="2001-11-22" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Alastair Blackman" mother="Tara Samantha Andrews" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Explore" modifier="YourName" created="200909010944" modified="200909252236" tags="excludeTree" placeofbirth="" latitude="" longitude="" dob="" dod="" mother="" father="" spouse="" dom="" changecount="20" placeofmarriage="" occupation="" causeofdeath="" placeofdeath="">
<pre>{{{
var tiddlers =store.getTiddlers();for(var i=0; i &lt; tiddlers.length; i++){var tid=tiddlers[i]; if(tid.fields.father== '612') tid.fields.father =&quot;Adam Jackson&quot;;}
var tiddlers =store.getTiddlers();for(var i=0; i &lt; tiddlers.length; i++){var tid=tiddlers[i]; if(tid.fields.mother== '620') tid.fields.mother =&quot;Mary UNKNOWN&quot;;}

}}}

!My trees

[[John David Bagg]]
[[Edmund Bentley]]
[[Brian Boru King of Ireland]]
[[Thomas Bellwood]]
[[John Brew (1765)]]
[[James Bulmer]]
[[John Cokayne]]
[[Frieda Gartside]]
[[Herbert Hunter]]
[[Matthew Jackson]]
[[Adam Lyall]]
[[Turlogh (Prince of Thomond, Ireland) O BRIEN]]
[[John Oxe]]
[[John Robson]]
[[Gilbert SPEARMAN]]
[[Robert PEARSON]]

!To do
rename tiddler updates fields in children and there children etc.. owch!</pre>
</div>
<div title="FamilyTreePlugin" modifier="YourName" created="200910060922" tags="systemConfig" server.type="file" server.host="file:///Users/Jon/Documents/TiddlyWiki/Trunk/contributors/JonRobson/verticals/FamilyTree/index.html" server.page.revision="200910060922">
<pre>/***
|''Name:''|FamilyTreePlugin|
|''Description:''|Creates basic graphical representation of a family tree in TiddlyWiki |
|''Version:''|0.1|
|''Date:''|October 09|
|''Source:''|http://www.jonrobson.me.uk|
|''Author:''|Jon Robson |
|''Contributors:''|uses code from ECO Tree http://www.codeproject.com/KB/scripting/graphic_javascript_tree.aspx#quick|
|''License:''|[[BSD open source license]]|
|''CoreVersion:''|2.3|

Allows the adding of multiple level drop down menus and checkboxes to the edit template.
***/

var FamilyTreeInstance;
config.macros.FamilyTree = {
    tooltip:function(){
    
    }
    ,handler: function(place,macroName,params,wikifier,paramString,tiddler){
        var namedprms = paramString.parseParams(null, null, true);
        var nodes = store.getTiddlers();
        var n = [];
        var edges = [];
        var tempnodes = {};
        var femaleNodeColor =&quot;rgb(255,105,180)&quot;;
        var maleNodeColor = &quot;#71B4FF&quot;;
        
        for(var i=0; i&lt; nodes.length; i++){
            var node = nodes[i];
            var id1 = node.title;

            var tags = node.tags;
            if(tags.indexOf(&quot;systemConfig&quot;) == -1 &amp;&amp; tags.indexOf(&quot;excludeTree&quot;) == -1 &amp;&amp; tags.indexOf(&quot;excludeLists&quot;) == -1){ 
              var json={id:nodes[i].title,properties:{}};
              var properties = json.properties;
              if(node.fields.sex){
                  if(node.fields.sex == 'M'){
                      properties.sex= &quot;M&quot;;
                      properties.fill = maleNodeColor;
                  }
                  else if(node.fields.sex =='F'){
                      properties.sex = &quot;F&quot;;
                      properties.fill = femaleNodeColor;
                  }
              }
              properties.name = id1;
              if(!tempnodes[json.id])tempnodes[json.id] = json;
              
              if(node.fields.father) edges.push([node.fields.father,id1]);
              if(node.fields.mother) edges.push([node.fields.mother,id1]);
            }

        }
        
        for(var i in tempnodes){
            n.push(tempnodes[i]);
        }
        var graph = new VismoGraph({nodes:n,edges:edges});
        var div = document.createElement(&quot;div&quot;);
        place.className = &quot;FamilyTree&quot;
        place.appendChild(div);
        
        var w = jQuery(place).width();
        var h = jQuery(place).height();
        if(!w) w = 700;
        if(!h) h= 300;
        jQuery(div).css({width:w,height:h,&quot;position&quot;:&quot;relative&quot;});
        var rootid;
        if(getParam(namedprms,&quot;root&quot;)){
            rootid = getParam(namedprms,&quot;root&quot;);
        }
         else{
                var tiddlers = store.getTaggedTiddlers(&quot;rootTree&quot;);
                if(tiddlers.length &gt;0){
                    rootid = tiddlers[0].title;
                }

            }
    
        var root = store.getTiddler(rootid);
        var tooltip = document.createElement(&quot;div&quot;);
        tooltip.className = &quot;ft_tooltip&quot;;
        place.appendChild(tooltip);
        jQuery(tooltip).css({position:&quot;relative&quot;,border:&quot;red&quot;});

        var orphans = graph.getOrphans().sort();
        var str = &quot;&lt;select class='changeroot' style=''&gt;&lt;option value='-1'&gt;select a root&lt;/option&gt;&quot;;
        for(var i=0; i &lt; orphans.length;i++){
            var p=orphans[i];
            var node = graph.getNode(p);
            if(node.properties.sex != &quot;F&quot;){
                       str +=&quot;&lt;option value='&quot;+p+&quot;'&quot;;
                        if(p == rootid)  str += &quot; selected&quot;;
                        str += &quot;&gt;&quot;+p+&quot;&lt;/option&gt;&quot;;  
           }
            
     
        }
        str += &quot;&lt;/select&gt;&quot;;
        jQuery(div).append(str);
        jQuery(&quot;.changeroot&quot;,div).change(function(e){
            if(this.value == &quot;-1&quot;) return;
           that.vgr.clear();
           that.vgr.compute(this.value);
        });
        
        var options = {graph:graph,algorithm:FT_algorithm,nodeWidth:20,nodeHeight:10,defaultNodeColor:&quot;rgb(200,200,200)&quot;,lineColor:&quot;rgb(255,255,255)&quot;,lineWidth:&quot;4&quot;};
        
        if(rootid) options.root=rootid;
        var that = this;
        jQuery(tooltip).css({position:&quot;absolute&quot;,display:&quot;none&quot;});
        options.vismoController = {controlFill:&quot;rgb(255,255,255)&quot;,controlShape: &quot;circle&quot;,controlStroke:&quot;#39AC1B&quot;};
        options.move = function(e,s){ jQuery(tooltip).css({display:&quot;none&quot;});if(s){var bb = s.getBoundingBox();jQuery(tooltip).text(s.getProperty(&quot;name&quot;));jQuery(tooltip).css({top:e.screenY - e.clientY,left:0,display:&quot;&quot;});}};
        options.dblclick = function(e,s){story.displayTiddler(null,s.properties.name);};
        this.vgr = new VismoGraphRenderer(div,options);
        config.activeTree = this.vgr;
    }

};

/*
Algorithm hacked together from 
http://www.codeproject.com/KB/scripting/graphic_javascript_tree.aspx
*/
var FT_algorithm={   
    _MaxDepth: 100,
    reset: function(graph){
       var nodes = graph.getNodes();
       for(var i=0; i &lt; nodes.length; i++){
           var node = nodes[i];
           node.XPosition = false;
           node.YPosition = false;
           node.leftNeighbor = false;
           node.rightNeighbor = false;
           node.prelim = false;
           node.modifier = false;
       }
    }
    ,compute: function (graph,options) {	
        var root = options.root;
        this.nodeWidth = options.nodeWidth | 10;
        this.nodeHeight = options.nodeHeight | 10;
        ////////////console.log(&quot; lets _positiongraph (magic here)&quot;);
        this.nodeWidth +=5;
        this.nodeHeight += 5;
        this.reset(graph);
    	this.maxLevelHeight = [];
    	this.maxLevelWidth = [];			
    	this.previousLevelNode = [];
    	////////////console.log(root);
    	var rootnode = graph.getNode(root);		
    	this._firstWalk(graph,rootnode, 0);
	    this.rootXOffset = 0 + rootnode.XPosition;
    	this.rootYOffset = 0 + rootnode.YPosition;

    	this._secondWalk(graph, rootnode, 0, 0, 0);	
    },
    _setLevelHeight: function (node, level) {	
    	if (this.maxLevelHeight[level] == null) 
    		this.maxLevelHeight[level] = 0;
        if(this.maxLevelHeight[level] &lt; node.h)
            this.maxLevelHeight[level] = node.h;	
    },
    _setLevelWidth: function (node, level) {
    	if (this.maxLevelWidth[level] == null) 
    		this.maxLevelWidth[level] = 0;
        if(this.maxLevelWidth[level] &lt; this.nodeWidth)
            this.maxLevelWidth[level] =  this.nodeWidth;		
    },
    _setNeighbors: function(node, level) {
        node.leftNeighbor = this.previousLevelNode[level];
        if(node.leftNeighbor != null)
            node.leftNeighbor.rightNeighbor = node;
        this.previousLevelNode[level] = node;	
    },

    _getLeftSibling : function (node) {
        if(node.leftNeighbor != null &amp;&amp; node.leftNeighbor.nodeParent == node.nodeParent)
            return node.leftNeighbor;
        else
            return null;	
    },

    _getRightSibling: function (node) {
        if(node.rightNeighbor != null &amp;&amp; node.rightNeighbor.nodeParent == node.nodeParent)
            return node.rightNeighbor;
        else
            return null;	
    },
    _getChildrenCenter: function (graph,node) {
        ////////////console.log(&quot;getChildrenCenter&quot;,node.id);
        var children = graph.getChildren(node.id);
        ////////////console.log(&quot;children are &quot;,children,graph);
      
        var firstchild = graph.getNode(children[0]);
        var lastchild = graph.getNode(children[children.length-1]);
        ////////////console.log(&quot;kids are&quot;,firstchild,lastchild);
        return firstchild.prelim + ((lastchild.prelim - firstchild.prelim) + this.nodeWidth) / 2;	
    },
    

    _firstWalk: function (graph, node, level) {
    		////console.log(&quot;walking&quot;,node);
    		var leftSibling = null;
		
            node.XPosition = 0;
            node.YPosition = 0;
            
            node.prelim = 0;
            node.modifier = 0;
            node.leftNeighbor = null;
            node.rightNeighbor = null;
            this._setLevelHeight(node, level);
            this._setLevelWidth(node, level);
            this._setNeighbors(node, level);
            var children= graph.getChildren(node.id);
            var parents = graph.getParents(node.id);
            var parents_children=graph.getChildren(parents);
            var siblingid = parents_children.indexOf(node.id);
            //////////console.log(&quot;has children&quot;,children);
            if(children.length == 0 || level == this._MaxDepth)
            {
     
                leftSibling = this._getLeftSibling(node);
                if(leftSibling != null){
                     ////////console.log(&quot;left sibling prelim&quot;,leftSibling.prelim,&quot;size&quot;,this.nodeWidth(leftSibling));
                    
                    node.prelim = leftSibling.prelim + this.nodeWidth + 40;
                }
                else
                    node.prelim = 0;
            } 
            else
            {
                
                var n = graph.getChildren(node.id);
                for(var i = 0; i &lt; n.length; i++)
                {
                    var iChild = graph.getNode(n[i]);
                    iChild.nodeParent = node;
                    this._firstWalk(graph, iChild, level + 1);
                }
                var midPoint = this._getChildrenCenter(graph,node);
                midPoint -= this.nodeWidth / 2;
                leftSibling = this._getLeftSibling(node);
                ////////////console.log(&quot;have leftSibling&quot;,leftSibling,&quot;of &quot;,node);
                if(leftSibling != null)
                {
                    ////////console.log(&quot;prelim&quot;,leftSibling.prelim,&quot;size&quot;,this.nodeWidth(leftSibling));
                    node.prelim = leftSibling.prelim + this.nodeWidth + 40;
                    node.modifier = node.prelim - midPoint;
                    //////console.log(&quot;y&quot;,node.YPosition);
                    if(node.YPosition.toString() =='NaN') throw &quot;bad modifier&quot;;
                    this._apportion(graph, node, level);
                } 
                else
                {            	
                    node.prelim = midPoint;
                }
            }	
            //////////console.log(&quot;finished first walk&quot;);
    },
    _apportion: function (graph, node, level) {
        //////////console.log(&quot;in apportion&quot;);
        var children = graph.getChildren(node.id);
            var firstChild = graph.getNode(children[0]);
            var firstChildLeftNeighbor = firstChild.leftNeighbor;
            var j = 1;
            for(var k = this._MaxDepth - level; firstChild != null &amp;&amp; firstChildLeftNeighbor != null &amp;&amp; j &lt;= k;)
            {
              
                var modifierSumRight = 0;
                var modifierSumLeft = 0;
                var rightAncestor = firstChild;
                var leftAncestor = firstChildLeftNeighbor;
                for(var l = 0; l &lt; j; l++)
                {
                    
                    rightAncestor = rightAncestor.nodeParent;
                    leftAncestor = leftAncestor.nodeParent;
                    modifierSumRight += rightAncestor.modifier;
                    modifierSumLeft += leftAncestor.modifier;
  
                }
                ////console.log(&quot;the node is&quot;,node,&quot;left ancestor is&quot;,leftAncestor,&quot;right is &quot;,rightAncestor);
                var totalGap = (firstChildLeftNeighbor.prelim + modifierSumLeft + this.nodeWidth + 30) - (firstChild.prelim + modifierSumRight);
                if(totalGap &gt; 0)
                {
                    var subtreeAux = node;
                    var numSubtrees = 0;
                    for(; subtreeAux != null &amp;&amp; subtreeAux != leftAncestor; subtreeAux = this._getLeftSibling(subtreeAux))
                        numSubtrees++;

                    if(subtreeAux != null)
                    {
                        
                        var subtreeMoveAux = node;
                        ////console.log(&quot;subtree is&quot;,subtreeMoveAux);
                        var singleGap = totalGap / numSubtrees;
                        for(; subtreeMoveAux != leftAncestor; subtreeMoveAux = this._getLeftSibling(subtreeMoveAux))
                        {
                            ////console.log(&quot;left sibling is &quot;,subtreeMoveAux,&quot;looking for &quot;,leftAncestor,&quot; to stop&quot;);
                            subtreeMoveAux.prelim += totalGap;
                            subtreeMoveAux.modifier += totalGap;
                            totalGap -= singleGap;
                        }

                    }
                }
                j++;
                var firstChildChildren = graph.getChildren(firstChild.id);
                if(firstChildChildren.length == 0){
            
                    firstChild = this._getLeftmost(graph,node, 0, j);
                    }
                else
                    firstChild = graph.getNode(firstChildChildren[0]);
                if(firstChild != null)
                    firstChildLeftNeighbor = firstChild.leftNeighbor;
            }
    },
    _getLeftmost:function (graph,node, level, maxlevel) {
       
        if(level &gt;= maxlevel) return node;
        var children = graph.getChildren(node.id);
        
     
        if(children.length == 0) return null;

    
        for(var i = 0; i &lt; children.length; i++)
        {
            var iChild = graph.getNode(children[i]);
            var leftmostDescendant = this._getLeftmost(graph,iChild, level + 1, maxlevel);
            if(leftmostDescendant != null)
                return leftmostDescendant;
        }

        return null;	
    },
    _secondWalk: function (graph, node, level, X, Y) {
        ////console.log(&quot;doing _secondWalk&quot;,level,node,node.id,node.leftNeighbor,node.rightNeighbor);
            if(level &lt;= this._MaxDepth)
            {
                var xTmp = 0 + node.prelim + X;
                var yTmp = 0 + Y;
                var maxsizeTmp = 0;
                var nodesizeTmp = 0;
                var flag = false;
            
                 	            	    	
    	                maxsizeTmp = this.maxLevelHeight[level];
    	                nodesizeTmp = this.nodeHeight;	                
    	                node.XPosition = xTmp;
    	                node.YPosition = yTmp;
    	         
                if(flag)
                {
                    var swapTmp = node.XPosition;
                    node.XPosition = node.YPosition;
                    node.YPosition = swapTmp;
                    //////console.log(&quot;swapTmp&quot;,swapTmp,node.XPosition);
                    
                }
         
    	    node.YPosition = -node.YPosition - nodesizeTmp;
    	       //////console.log(&quot;nodesizeTmp&quot;,nodesizeTmp);
            
    	    ////////////console.log(&quot;getting Children&quot;,node);
    	     var Children = graph.getChildren(node.id);
    	     ////////////console.log(Children);
                if(Children.length != 0)
                    this._secondWalk(graph, graph.getNode(Children[0]), level + 1, X + node.modifier, Y + maxsizeTmp + 40);
                var rightSibling = this._getRightSibling(node);
                if(rightSibling != null)
                    this._secondWalk(graph, rightSibling, level, X, Y);
            }	
    ////////console.log(&quot;now&quot;,node.XPosition,node.YPosition);
    }
};TiddlyWiki.prototype.familytree_saveTiddler = TiddlyWiki.prototype.saveTiddler;
TiddlyWiki.prototype.saveTiddler = function(title,newTitle,newBody,modifier,modified,tags,fields,clearChangeCount,created)
{
    if(!newTitle) newTitle = title;
    //clean up children    
    if(newTitle &amp;&amp;newTitle != title){
        var tiddlers = store.getTiddlers();
        for(var i=0; i &lt; tiddlers.length; i++){
            var tid = tiddlers[i];
            if(tid.fields.mother ==title){
                tid.fields.mother = newTitle;
            }
            if(tid.fields.father ==title){
                tid.fields.father = newTitle;
            }
            if(tid.fields.spouse){
            var spouses = tid.fields.spouse.split(&quot;,&quot;);
            
            var update = spouses.indexOf(title);
            if(update !=-1){
                spouses[update]= newTitle;
                tid.fields.spouse = spouses.join(&quot;,&quot;);
            }
}
        }
        //do spouses

    }
    var newSpouseField, tiddlerSpouses;
    if(fields){
        newSpouseField =fields.spouse;
        if(newSpouseField &amp;&amp; newSpouseField.length &gt; 0){
            tiddlerSpouses = newSpouseField.split(&quot;,&quot;);
        }
        else{
            tiddlerSpouses = [];
        }
    }
    else{
        tiddlerSpouses = [];
    }

    
    
    //add the new spouses
       
        for(var i=0; i &lt; tiddlerSpouses.length; i++){
            var spouse = tiddlerSpouses[i];
            //console.log(&quot;spouse&quot;,i,spouse);
            var spouseTiddler = store.getTiddler(spouse);
            if(spouseTiddler){
            if(!spouseTiddler.fields.spouse)spouseTiddler.fields.spouse = &quot;&quot;;
            var spouseSpouses = spouseTiddler.fields.spouse.split(&quot;,&quot;);
            //console.log(spouseSpouses,newTitle);
            if(spouseSpouses.indexOf(newTitle) == -1){
                spouseSpouses.push(newTitle);
                spouseTiddler.fields.spouse = spouseSpouses.join(&quot;,&quot;);
                //console.log(&quot;save&quot;);
            }
            }
        }
    
    this.familytree_saveTiddler(title,newTitle,newBody,modifier,modified,tags,fields,clearChangeCount,created);

};
config.macros.familytreelist = {
    handler: function(place, macroName, params, wikifier, paramString, tiddler){
        var param = paramString.parseParams();
    	var sex= getParam(param,&quot;sex&quot;);
    	
    	var print =&quot;&quot;;
    	var tiddlers = store.getTiddlers();
    	for(var i=0; i &lt; tiddlers.length;i++){
    	    var tid = tiddlers[i];
    	    var good = false;
    	    if(tid.fields.sex &amp;&amp; tid.fields.sex == sex){
    	        good = true;
    	    }
    	    if(&quot;excludeTree&quot; in tiddler.tags){
    	        good = false;
    	    }
    	    if(good){
    	        print += tid.title+&quot;\n&quot;;
    	    }
    	}
    	wikify(print,place);
    }
};
config.macros.makeRootLink = {
    handler: function(place, macroName, params, wikifier, paramString, tiddler){
        jQuery(place).html(&quot;&lt;a class='button makeRoot' href=\&quot;#[[&quot;+tiddler.title+&quot;]]\&quot; name=\&quot;&quot;+escape(tiddler.title)+&quot;\&quot;&gt;make root&lt;/a&gt;&quot;);
        jQuery(&quot;.makeRoot&quot;,place).click(function(e){
            config.activeTree.compute(unescape(jQuery(this).attr(&quot;name&quot;)));
        })
    }
    
};
config.macros.listchildren ={
  handler: function(place, macroName, params, wikifier, paramString, tiddler){
    var parent = tiddler.title;
    var children = [];
    var t= store.getTiddlers();
    for(var i=0; i &lt; t.length; i++){
       var person = t[i];
       if(person.fields.father == parent){children.push(person);}
       else if(person.fields.mother == parent){children.push(person);}
    }

    if(children.length ==0){
      var div = document.createElement(&quot;div&quot;);
      div.innerHTML = &quot;No children.&quot;;
      place.appendChild(div);
    }
    else{
    var ul = document.createElement(&quot;ul&quot;);
    place.appendChild(ul);
    for(var i=0; i &lt; children.length; i++){
       var child = document.createElement(&quot;a&quot;);
       child.className=&quot;child&quot;;
       var name =children[i].title;
       child.innerHTML = name;
       child.title = name;
       var li = document.createElement(&quot;li&quot;);
       li.appendChild(child);
       ul.appendChild(li);
       
       jQuery(child).click(function(e){story.displayTiddler(e,this.title);});
    }
    }
  }

};
config.macros.tiddlerGender ={
  handler: function(place, macroName, params, wikifier, paramString, tiddler){
      var jqplace = jQuery(place);
      if(tiddler.fields[&quot;sex&quot;] == 'M'){
          jqplace.addClass(&quot;sexMale&quot;);
      }
      else if(tiddler.fields[&quot;sex&quot;] == 'F'){
          jqplace.addClass(&quot;sexFemale&quot;);
      }
      
  }

};

config.macros.ftview = {
    handler: function(place, macroName, params, wikifier, paramString, tiddler){
        var field = params[0];
        if(!tiddler.fields[field]) return;
        if(field == 'spouse'){
            var sp = tiddler.fields[&quot;spouse&quot;].split(&quot;,&quot;);
            var str = &quot;&quot;;
            
            for(var i=0; i &lt; sp.length;i++){
                var thisSpouse = sp[i];
                if(thisSpouse){
                    str += &quot;[[&quot;+thisSpouse + &quot;]]&quot;;
                    if(i &lt; sp.length-1) str += &quot; and &quot;;
                }
            }
            
            wikify(str,place);
        }

    }
    
};

config.commands.addMother = {
        text: &quot;Add Mother&quot;,
        tooltip: &quot;add a mother&quot;,
        
        handler:function(event,src,title){
                var motherName = prompt(&quot;Who is their mother?&quot;);
                if(motherName){
                        var tiddler = store.getTiddler(title);
                        tiddler.fields.mother = motherName;
                        if(!store.getTiddler(motherName))story.displayTiddler(null,motherName,DEFAULT_EDIT_TEMPLATE);        
                }
             
        }
};
config.commands.addSpouse = {
        text: &quot;Add Spouse&quot;,
        tooltip: &quot;add a spouse&quot;,
        
        handler:function(event,src,title){
                var spouse = prompt(&quot;What is the name of the spouse?&quot;);
                if(spouse){
                        var tiddler = store.getTiddler(title);
                        tiddler.fields.spouse = spouse;
                        
                        
                        var tiddler = store.getTiddler(spouse);
                        if(tiddler){
                                 tiddler.fields.spouse = title;
                                 store.saveTiddler(tiddler.title,tiddler.title,tiddler.text,tiddler.modifier,tiddler.modified,tiddler.tags,tiddler.fields,true,tiddler.created);
                               
                        }
                        else{
                                store.saveTiddler(spouse,spouse,&quot;&quot;,&quot;&quot;,new Date(),[],{spouse: title},true,new Date());
		                story.displayTiddler(null,spouse,DEFAULT_EDIT_TEMPLATE);
		        }
		        
                }
             
        }
};

config.commands.addChild = {
        text: &quot;Add Child&quot;,
        tooltip: &quot;add a child&quot;,
        
        handler: function(event,src,title){
                
                var parent = store.getTiddler(title);
                var sex = false;
                var spouse = &quot;&quot;;
                if(parent &amp;&amp; parent.fields.spouse)spouse = parent.fields.spouse;
                if(!parent) {
                        //try and work out the sex..
                        var tiddlers = store.getTiddlers();
                        
                        for(var i=0; i &lt; tiddlers.length; i++){
                                if(!sex &amp;&amp; tiddlers[i].fields.mother == title) sex = &quot;F&quot;;
                                if(!sex &amp;&amp; tiddlers[i].fields.father == title) sex = &quot;M&quot;;
                        }
                }
                else{
                        if(parent.fields.sex) sex =parent.fields.sex;
                }
                if(sex){

                        var childName = prompt(&quot;What is the name of the child?&quot;);
                        if(childName){
                                

                                
                               
                               var tiddler = store.getTiddler(childName);
                               if(!tiddler){
                                       
                                       var fields = {};
                                       if(sex == &quot;F&quot;) {
                                               fields.mother = title;
                                                fields.father = spouse;
                                       }
                                       else if(sex == &quot;M&quot;) {
                                               fields.father = title;
                                                fields.mother = spouse;
                                        }
                                       store.saveTiddler(childName,childName,&quot;&quot;,false,new Date(),[],fields,true,new Date());
                                       //childName,childName,&quot;&quot;,false,false,[],fields,true,new Date());
                                    
                                }
                                else{
                                        
                                                                    if(sex == &quot;F&quot;) {
                                                                               tiddler.fields.mother = title;
                                                                                tiddler.fields.father = spouse;
                                                                       }
                                                                       else if(sex == &quot;M&quot;) {
                                                                               tiddler.fields.father = title;
                                                                                tiddler.fields.mother = spouse;
                                                                        }
                                }
   
                        }
           
                       if(childName) story.displayTiddler(null,childName,DEFAULT_EDIT_TEMPLATE);
                }
                else{
                        alert(&quot;I can't do this until I know the sex of this person..&quot;);
                }
                
        }
};
config.commands.addFather = {
        text: &quot;Add Father&quot;,
        tooltip: &quot;add a father&quot;,
        
        handler: function(event,src,title){
                var fatherName = prompt(&quot;Who is their father?&quot;);
                if(fatherName){
                        var tiddler = store.getTiddler(title);
                        tiddler.fields.father = fatherName;
                        if(!store.getTiddler(fatherName))story.displayTiddler(null,fatherName,DEFAULT_EDIT_TEMPLATE);        
                }
        }
};merge(config.macros.newTiddler,{
	label: &quot;new person&quot;,
	prompt: &quot;Create a new person in your family tree&quot;,
	title: &quot;New Person&quot;,
	accessKey: &quot;N&quot;});

config.macros.bootUpFamilyTree = {
    handler: function(place,macroName,params,wikifier,paramString,tiddler){
        story.closeAllTiddlers();
          var tiddlers = store.getTaggedTiddlers(&quot;rootTree&quot;);
         for(var i=0; i &lt; tiddlers.length; i++){
             story.displayTiddler(null,tiddlers[i].title);
         }
        
        
    }
};</pre>
</div>
<div title="Fearchorb" modifier="YourName" modified="200909282054" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0320-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Modhchorb" mother="" dom="" placeofmarriage="" changecount="2">
<pre></pre>
</div>
<div title="Florence Mary Bellwood" modifier="YourName" modified="200909261448" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1878-00-00" spouse="" sex="F" dod="1948-00-00" placeofbirth="Middlesbrough" occupation="" causeofdeath="" placeofdeath="" father="Thomas Bellwood 1854" mother="Frances Isabella Woodhouse Robson" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre></pre>
</div>
<div title="Florence Robson" modifier="YourName" modified="200909271035" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1879-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="Swindon, Wiltshire, England" occupation="" causeofdeath="" placeofdeath="" father="Robert Foster Robson" mother="Elizabeth Rowe">
<pre></pre>
</div>
<div title="Frances Isabella Woodhouse Robson" modifier="YourName" modified="200909261504" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1854-06-04" spouse="Thomas Bellwood 1854" sex="F" dod="1943-12-14" placeofbirth="Middlesbrough /Buckinghamshire" occupation="" causeofdeath="" placeofdeath="Middlesbrough" father="Robert Robson" mother="Mary Holder Oxx" latitude="" longitude="" dom="" placeofmarriage="" changecount="3">
<pre>Born &quot;Emma Isabella&quot; with registered address Rostock Terrace Middlesbrough. Baptised &quot;Frances Isabella Woodhouse&quot; .

[img[files/frances.jpg]]
5 Siblings: John George (Senior), William Isaac, Harriett Jane, Robert Amos and Hannah Mary Augustus

Married Thomas Bellwood, an Iron Merchant Clerk, (born in Heigington Durham on 1st March 1877) at Bondgate Wesleyan Chapel, Darlington.

The Robson name like &quot;Lyall&quot; in the Robson family has been carried down the generations ever since. With Charles' son Norman Robson, and his grandson Thomas Robson

The 1881 census has Frances living at 73 Westward Street, Middlesbrough, Yorkshire, England

Frances died at 30 Woodlands Road, Middlesbrough on 14th December 1943 aged 89.
(Source: Robin Bellwood, 1881 census) 

Possibly born on 24th June?
	Married at Bondgate Wesleyan Chapel, Darlington.

	In 1877 living at 43 Guerney St, Darlington.</pre>
</div>
<div title="Frances Ladbrook" modifier="YourName" modified="200909261424" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Francis Gartside" modifier="YourName" modified="200909252152" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Henry Gartside (2)" mother="">
<pre>Mentioned as son of Henry Gartside (but apparently not his heir) in license of 1597. Possibly an illegitimate son. Probably purchased half of his father&quot;s estate from relative John Gartside.</pre>
</div>
<div title="Frank Mallalieu Gartside" modifier="YourName" modified="200910021548" mother="Bertha Houghton" placeofdeath="Harrow" causeofdeath="Cancer of the bowels" occupation="Chartered engineer of 82 Moss Lane Pinner" placeofbirth="110 Birch Street, Ashton-u-Lyme" dod="2005-01-23" sex="M" spouse="Margaret Joan Duffy" dob="1921-05-05" server.type="file" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.page.revision="200903090000" latitude="" longitude="" father="Harry Gartside" dom="" placeofmarriage="" changecount="4">
<pre></pre>
</div>
<div title="Fred Bellwood" modifier="YourName" modified="200909252246" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1873-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="William Bellwood" mother="Ann Spence" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Freda Gartside" modifier="YourName" modified="200910032043" placeofbirth="Holt" latitude="" longitude="" dob="1926-02-09" dod="1989-01-00" mother="Bertha Houghton" father="Harry Gartside" spouse="Herbert Hunter" changecount="6" sex="F" dom="" placeofmarriage="" occupation="" causeofdeath="Cancer" placeofdeath="Ashton-U-Lyme">
<pre></pre>
</div>
<div title="Freda Thompson" modifier="YourName" modified="200909261419" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="Norman Robson Bellwood" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre></pre>
</div>
<div title="Frederick Charles Brew" modifier="YourName" modified="200909261502" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1874-12-00" spouse="Elizabeth Rees" sex="M" dod="0000-00-00" placeofbirth="Clifton, Bristol, Gloucestershire, England" occupation="" causeofdeath="" placeofdeath="" father="Robert Morgan Brew" mother="Esther Jones" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre>He married Elizabeth Rees in All Saints Church, Llanelly, Carmarthenshire. They had one daughter: Elizabeth V. Brew, who was born December 1911 in Newport, Monmouthshire, Wales </pre>
</div>
<div title="Frederick Hunter" modifier="YourName" modified="200909251545" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="1973-00-00" placeofbirth="Ossett" occupation="" causeofdeath="" placeofdeath="Ossett" father="" mother="">
<pre></pre>
</div>
<div title="Frederick Ralph Richard(son) Bone" modifier="YourName" modified="200909261438" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1864-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="Durham" occupation="" causeofdeath="" placeofdeath="" father="John Blackbird Bone" mother="Maxwell Oxx" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Frederick Robson" modifier="YourName" modified="200909252225" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1864-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John Robson 1828" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="French woman UNKNOWN" modifier="YourName" modified="200909221944" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre>Was French and this appears to have caused much upset to the family.</pre>
</div>
<div title="Gareth Sharman" modifier="YourName" modified="200909282055" changecount="4" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1966-11-01" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Hugh Martyn Sharman" mother="Margaret Theresa Bewick">
<pre></pre>
</div>
<div title="Gemma Bellwood" modifier="YourName" modified="200909271033" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="David Bellwood" mother="Alison Hook">
<pre></pre>
</div>
<div title="George A PEARCE" modifier="YourName" modified="200909261500" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="George Brew 1826" modifier="YourName" modified="200909252218" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1826-01-08" spouse="" sex="M" dod="1908-02-02" placeofbirth="Chepstow, Monmouthshire, Wales" occupation="" causeofdeath="" placeofdeath="" father="Thomas Brew 1791" mother="Honor Perry" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre>Died 2nd February 1908 in Cardiff, Glamorgan, Wales. Son of Thomas Brew and Honor Perry.

	Christened 8th January 1826 in Chepstow.

	Married Jane Margaret Morgan in Chepstow 8th November 1847.
	George worked as a Sawyer/Railwayman

	[Bellwood Family Tree]</pre>
</div>
<div title="George Cokayne 1370" modifier="YourName" modified="200909252155" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1370-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Sir Edmund COKAYNE" mother="Elizabeth de HERTHULL" latitude="" longitude="" dom="" placeofmarriage="" changecount="3">
<pre></pre>
</div>
<div title="George Robert Oxx" modifier="YourName" modified="200909261458" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1851-05-22" spouse="Elizabeth Sophia Ilbert CUTCLIFFE" sex="M" dod="1927-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="George Spearman OXX" mother="Mary Catherine MATHERS" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre>Christened 11th June 1851 in Saint Mark, Kennington, London, England.</pre>
</div>
<div title="George Robson" modifier="YourName" modified="200909282123" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1825-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="Northumberland, England" occupation="Sawyer (1841)" causeofdeath="" placeofdeath="" father="John Robson" mother="Jane UNKNOWN" dom="" placeofmarriage="" changecount="1">
<pre>08 FEB 1824   	Allendale, Northumberland, England ?

	Possible marriage to Frances Turnbull:
	21 NOV 1857  	All Saints, Newcastle Upon Tyne, Northumberland, England
	Needs chasing up.</pre>
</div>
<div title="George SPEARMAN" modifier="YourName" created="200909131609" modified="200909131613" changecount="3" dom="" spouse="Margaret PEARSON" dod="" dob="" longitude="" latitude="" placeofbirth="" mother="" father="Gilbert SPEARMAN" sex="M">
<pre>Married Sarah.</pre>
</div>
<div title="George SPEARMAN (1760-1828)" modifier="YourName" created="200909131617" modified="200909131620" father="Gilbert Illegy SPEARMAN" mother="Anna CLARK" placeofbirth="" latitude="" longitude="" dob="1760" dod="1828" spouse="Hannah WOODHOUSE" dom="12/06/1763" changecount="2" sex="M">
<pre></pre>
</div>
<div title="George SPEARMAN 1760" modifier="YourName" modified="200909252257" changecount="2" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1760-06-10" spouse="" sex="M" dod="1828-11-19" placeofbirth="St Anthonys, Middleton, Yorkshire" occupation="" causeofdeath="" placeofdeath="" father="Gilbert Illergy Spearman" mother="Anna CLARK">
<pre>Christened: 1760-06-29?
	Buried at the Ballast Hills Cemetry Newcastle alongside Mr. Doeggs tablestone.</pre>
</div>
<div title="George Spearman" modifier="YourName" modified="200909252257" changecount="3" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1710-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Gilbert SPEARMAN" mother="Margaret PEARSON">
<pre>Gentlemen of Bishop Middleham.</pre>
</div>
<div title="George Spearman Cullen OXX" modifier="YourName" modified="200909271121" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1899-00-00" spouse="" sex="M" dod="1970-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="George Robert Oxx" mother="Elizabeth Sophia Ilbert CUTCLIFFE">
<pre></pre>
</div>
<div title="George Spearman Cullen OXX (1899-1970)" modifier="YourName" created="200909131632" modified="200909131634" changecount="1" dom="" spouse="Ivy B CROOKS (1931-)" dod="1970" dob="1899" longitude="" latitude="" placeofbirth="" mother="Elizabeth Sophia Ilbert CUTCLIFFE" father="George Robert OXX (1851-1927)">
<pre>Two known children:
1. Angela Spearman OXX (1938-)
m. Michael J WILFORD 1960
(whom had 5 children: Karenna, Carl Adrian, Paul Newton, Jane Anne, Anna Patricia)							
2. Sonia Spearman OXX (1938-)
m. Robert H Broome 1961
(whom had 4 children: Sonia, Richard, Nicola, Sara)

Possibly had a third child.</pre>
</div>
<div title="George Spearman OXX" modifier="YourName" modified="200909261452" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1807-08-27" spouse="Mary Catherine MATHERS" sex="M" dod="1862-10-16" placeofbirth="Quay Meeting House-Independent, Woodbridge, Suffolk, England" occupation="" causeofdeath="" placeofdeath="" father="John Oxe" mother="Woodhouse Spearman" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre>Christening: 01 SEP 1807 at Quay Meeting House-Independent, Woodbridge, Suffolk, England</pre>
</div>
<div title="George William Brew" modifier="YourName" modified="200909282056" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1905-09-00" spouse="" sex="M" dod="1905-09-00" placeofbirth="Carmarthen, Carmarthenshire, Wales" occupation="" causeofdeath="" placeofdeath="" father="George William Brew 1880" mother="Mary Jane Thomas" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="George William Brew 1880" modifier="YourName" modified="200909282048" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1880-04-11" spouse="" sex="M" dod="1931-12-27" placeofbirth="Bristol, Gloucestershire, England" occupation="" causeofdeath="" placeofdeath="" father="Robert Morgan Brew" mother="Esther Jones" dom="" placeofmarriage="" changecount="1">
<pre>Died in Carmarthenshire, Wales. He married Mary Jane Thomas, born ca. 1880 in Carmarthen, Carmarthenshire, Wales, daughter of John Thomas, on 21 September 1901 in the Registry Office, Carmarthen, Carmarthenshire.</pre>
</div>
<div title="George, of Mawley Hall Blount" modifier="YourName" modified="200909261500" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="1702-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="GettingStarted" modifier="YourName" created="200905082106" modified="200908311612" tags="excludeTree" placeofbirth="" latitude="" longitude="" dob="" dod="" mother="" father="" spouse="" changecount="2" dom="">
<pre>To get started with this blank [[TiddlyWiki]], you'll need to modify the following tiddlers:
* [[SiteTitle]] &amp; [[SiteSubtitle]]: The title and subtitle of the site, as shown above (after saving, they will also appear in the browser title bar)
* [[MainMenu]]: The menu (usually on the left)
* [[DefaultTiddlers]]: Contains the names of the tiddlers that you want to appear when the TiddlyWiki is opened
You'll also need to enter your username for signing your edits: &lt;&lt;option txtUserName&gt;&gt;

[[SideBarOptions]] and [[SideBarTabs]]</pre>
</div>
<div title="Gilbert Illegy SPEARMAN" modifier="YourName" created="200909131613" modified="200909131614" father="George SPEARMAN" mother="Margaret PEARSON" sex="M" placeofbirth="" latitude="" longitude="" dob="(c. 1734-)" dod="" spouse="Anna CLARK" dom="" changecount="1">
<pre></pre>
</div>
<div title="Gilbert Illergy Spearman" modifier="YourName" modified="200909252257" changecount="2" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1734-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="George Spearman" mother="Sarah UNKNOWN">
<pre>Coal viewer for brandlings of Wakefield.
	Baptised 16th April 1734 and again on 16th April 1735 at Church Merrington.
	Lived at Rotherham.</pre>
</div>
<div title="Gilbert SPEARMAN" modifier="YourName" created="200909131607" modified="200909251513" placeofdeath="" causeofdeath="" occupation="" placeofmarriage="" dom="" spouse="Margaret PEARSON" father="" mother="" dod="1738" dob="c1675" longitude="" latitude="" placeofbirth="" sex="M" changecount="7">
<pre>Gilbert Spearman was born somewhere around 1675. Died around 1738.

Married Margaret Pearson/Pierson at Parish Durham, Cathedral alternatively Durham, Christ Church &amp; BVM in county Durham 01/09/1701.
One known child: George

Was involved in a law suit against William Wilkinson and Edward Birkebeck concerning the estate of his wife Margaret's deceased father Robert which he appeared to have won (See below).

LAW SUIT
{{{
486/1-41.      29 October 1703 - 8 November 1705
File of documents relating to a suit in Chancery brought by Gilbert Spearman and his wife Margaret against William Wilkinson, Esq., Catterick Birkebeck, Esq., and Edward Birkebeck, concerning the estate of Robert Peirson, deceased, father of Spearman's wife, Margaret; and to a cross suit brought by the said William Wilkinson against Gilbert Spearman and his wife Margaret.
(The file has been re-arranged chronologically.)

486/1.      29 October 2 Anne (1703)
Spearman, plaintiff, v Wilkinson, defendant:
Affidavit of Robert Bell of the city of Durham, gent., that on 26 October the defendant, William Wilkinson, was served with a subpoena to rejoin to the plaintiffs' Replication on 28 October, and that at the request of the plaintiff, Gilbert Spearman, the said defendant consented to the establishment of a commission, waiving any rights to delay the same.
Paper     2ff.

486/2.      31 December 1703
Spearman, plaintiff v Wilkinson, defendant:
Copy of Catherick Birkbeck's consent, for himself and his son Edward Birkebeck, to make their defence to the charge of Gilbert Spearman and his wife Margaret &quot;without being served with usuail process of this Court.&quot;
Paper     2ff.
 
486/3.      22 January 2 Anne (1704)
Spearman, plaintiff v Wilkinson, defendant:
Copy of certificate of Michael Mickleton and John Crosby the Elder, commissioners to examine witnesses on behalf of the plaintiff, Gilbert Spearman, and in the cross case brought by the defendant, William Wilkinson, concerning the conduct of the commission and the refusal of the commissioners on the part of the defendant to produce witnesses other than two sons of the said William Wilkinson: Thomas and John Wilkinson.
Paper     2ff.
 
486/4.      25 January 2 Anne (1704)
Spearman, plaintiff v Wilkinson, defendant:
Copy of Affidavit of John Anderson of the city of Durham, gent., concerning Catterick Birkebeck's consent to defend his case in court and in commission without the service of subpoenas.
(See No. 486/2, originally attached).
Paper     1f.
 
86/5.      25 January 2 Anne (1704)
Spearman, plaintiff v Wilkinson, defendant:
Copy of Affidavit of the plaintiff Gilbert Spearman concerning declarations by the defendant of his intention to delay and prolong the case until his death, and the effect this death would have on the plaintiff's case.
Paper     2ff.
 
486/6.      7 February 2 Anne (1704)
Spearman, plaintiff v Wilkinson, defendant:
Copy of Affidavit of the defendant William Wilkinson that certain witnesses could not be procured for examination on his behalf in the plaintiff's commission, returnable 20 January last.
Paper     2ff.
 
486/7.      12 February 2 Anne (1704)
Spearman, plaintiff v Wilkinson, defendant:
Copy of Court Order permitting the establishment of a commission to examine witnesses on behalf of the defendant, William Wilkinson, unless good cause against such a commission can be shown by the plaintiff at &quot;ye first general Seal after this Terme&quot;.
Underneath:
17 February 1703 [1704]
Note from Mr. Edwards, clerk to Mr. Close, informing him that the above order, to be dealt with the following day, was served on him after 8 o'clock that evening.
Endorsement: Note of Mr. Close that more time should be obtained for making an objection to the above order.
Paper     1f.
 
486/8.      12 February 2 Anne (1704)
Spearman, plaintiff v Wilkinson, defendant:
Copy of Court Order as above (No. 486/7) except that the plaintiff's objection should be made &quot;at ye Second Generale Seale after this Terme.&quot;
Paper     1f.
 
486/9.      25 February 2 Anne (1704)
Spearman, plaintiff v Wilkinson, defendant:
Copy of Court Order referring the case to Sir Robert Legard, master of the court, to appoint a time and place for the execution of a Commission to examine witnesses on the part of the defendant, the plaintiff to have a duplicate of the said Commission; and laying down future procedure.
Paper     2ff.
 
486/10.      7 March 1703/1704
Spearman, plaintiff v Wilkinson, defendant:
Copy of Notification by Robert Legard that, in pursuance of the above Order of Reference (No. 486/9), a meeting of all parties in the case will take place the following Thursday.
Paper     ½f.
 
486/11.      14 (sic.) March 1703/1704
Spearman, plaintiff v Wilkinson, defendant:
Copy of Notification by Robert Legard as above.
Paper     ½f.
 
486/12.      7 March 1703/1704
Draft by William Lee, solicitor for the defendant, of the following agreement (No. 486/14).
Paper     1f.
 
486/13.      7 March 1703/1704
The same, by James Close, solicitor for the plaintiff, with amendments.
Paper     1f.
 
486/14.      9 March 1703/1704
Spearman, plaintiff v Wilkinson, defendant:
Agreement relating to the times and places for the execution of the commission for the examination of witnesses, with safeguards for the continuation of the commission should the defendant's commissioners refuse to attend or adjourn as agreed.
Signed: James Close (solicitor for the plaintiff), William Lee (solicitor for the defendant).
Paper     1f.
 
486/15.      9 March 1703/1704
Note from James Close to Mr. Edwards requesting him to make a duplicate of the above Agreement.
Paper     ½f.
 
486/16.      23 March 3 Anne (1704)
Spearman, plaintiff v Wilkinson, defendant:
Affidavit of Follansby Walton of the city of Durham that the plaintiff's proposal to change Mr. Mickleton, one of his commissioners for the examination of witnesses, was refused by the defendant; and that the said Mr. Mickleton is too ill to leave his house for at least two months.
Paper     2ff.
 
486/17.
Spearman, plaintiff v Wilkinson, defendant:
Draft Petition of the Plaintiff Gilbert Spearman to have the case heard at the beginning of the Easter Term.
Paper     1f.
 
486/18.
Spearman, plaintiff v Wilkinson, defendant:
Copy Petition of the defendant Gilbert Spearman, in the cross case brought by William Wilkinson laying claim to the estate of Robert Pearson, deceased, father of the defendant's wife Margaret, to have the case heard &quot;the first day of Causes after this Terme&quot;.
Paper     2ff.
 
486/19.
Draft of the above Petition.
Paper     1f.
 
486/20.      24 March 3 Anne (1704)
Spearman, plaintiff v Wilkinson, defendant:
Copy of Court Order for the case of Gilbert Spearman, plaintiff, against William Wilkinson, defendant, to be heard on 9 May next.
Underneath:
19 April 1704
Notification of the above order by James Close to Mr. Consett.
Paper     1f.
 
486/21.      28 March 3 Anne (1704)
Spearman, plaintiff v Wilkinson, defendant:
Copy of Court Order permitting the plaintiff Gilbert Spearman to change one of his commissioners for the examination of witnesses.
Paper     2ff.
 
486/22.      6 May 3 Anne (1704)
Spearman, plaintiff v Wilkinson, defendant:
Copy of Court Order, on the petition of the plaintiff William Wilkinson, that the original cross causes should both be heard on 15 May and that depositions taken in one cause might be used for the other.
Paper     2ff. pinned together.
 
486/23.      11 May 3 Anne (1704)
Spearman, plaintiff v Wilkinson, defendant:
Copy of Court Order permitting the defendant to use depositions taken in one case at the hearing of the other as the two cases are to be heard together.
Paper     2ff.
 
486/24.      16 May 3 Anne (1704)
Spearman, plaintiff v Wilkinson, defendant:
Copy of Court Order, permitting the defendant Gilbert Spearman to examine witnesses viva voce to prove a deed, dated 27 May 4 Wm. and Mary (1692) between:
(1) Robert Pearson and Caterick Birkbeck,
(2) the said William Wilkinson and Martin Wilkinson.
Endorsement: Note that the above Order was amended.
Paper     2ff.
 
486/25.      16 May 3 Anne (1704)
Spearman, plaintiff v Wilkinson, defendant:
Copy of amended version of the above Order allowing the defendant Gilbert Spearman to prove also and in the same way a letter, dated 10 July 1683,from the plaintiff Wilkinson to Robert Pearson.
Paper     2ff.
 
486/26 (i) and (ii).
Spearman, plaintiff v Wilkinson, defendant:
Copies of two documents sealed together and sent to Gilbert Spearman at London:
(i). 10 June 3 Anne (1704)
Affidavit of John Anderson of the city of Durham, gent., that the defendant William Wilkinson was served with a copy of the attached order.
(ii) 27 May 3 Anne (1704)
Court Order that, at the hearing of the above case, the defendant should produce a deed of settlement relating to the rectory of Bishopp Middleham dated 8 June 22 Chas. II (1670), between:
(1) Lord Cullen:
(2) Robert Pearson and his wife Mary (Cokayne):
(3) Nicholas Shuttleworth and George Iresham:
(4) George Blount (possibly a son of 2nd husband of Mary O'Brien) and John Vavasour.
Paper     1f. and 2ff.
 
486/27.      15 July 1704
Spearman, plaintiff v Wilkinson, defendant:
Minutes of the decree in favour of the plaintiff Gilbert Spearman.
Paper     2ff.
 
486/28.      9 November 1704
Spearman, plaintiff v Wilkinson, defendant:
Copy Petition of the plaintiff Gilbert Spearman to have a day appointed for the pronouncement of judgment; with note authorising order that judgment will be given 14 November.
Paper     2ff.
 
486/29.
Draft of the above petition.
Paper     2ff.
 
486/30.      11 November 1704
Spearman, plaintiff v Wilkinson, defendant:
Copy Petition of the defendant William Wilkinson that judgment should be postponed until, in pursuance of a decision of 15 July, the cases of both sides and the settlement deeds have been referred to judges.
f.2: Note of court decisions of 9, 11 and 18 November.
Paper     2ff.
 
486/31.      13 November 1704
Spearman, plaintiff v Wilkinson, defendant:
Affidavit of Theodore Johnson that copies of the plaintiff's petition (No. 486/28) and court order of 9 November were delivered to the defendant's clerk of court.
Paper     1f.
 
486/32.      18 November 3 Anne (1704)
Spearman, plaintiff v Wilkinson, defendant:
Copy of Court Order for judgment to be given on Wednesday next (22 November) and for the defendant's petition of 11 November (No. 486/30) to be heard at the same time.
Paper     2ff.
 
486/33.      18 November 1704
Spearman, plaintiff v Wilkinson, defendant:
Copy of Affidavit of William Lee, solicitor for the defendant, that he was not consulted by the plaintiff's solicitor Mr. Close about drawing up an order of Reference to the judges pursuant to the direction of the court, and that the judges were attended and their decision given in favour of the plaintiff without his knowledge.
Paper     2ff.
 
486/34.      18 November 1704
Spearman, plaintiff v Wilkinson, defendant:
Copy of Affidavit of William Midford, clerk to Mr. Lee, solicitor for the defendant, that he was informed by the plaintiff's solicitor Mr. Close on 27 September and on other occasions that there was no haste to prepare a case for reference to the judges pursuant to the direction of the court, and that a memorandum was made of this answer.
Paper     2ff.
 
486/35.      27 November 3 Anne (1704)
Spearman, plaintiff v Wilkinson, defendant:
Copy of Court Order dismissing a petition of the defendant William Wilkinson.
Paper     2ff.
 
486/36.      13 December (1704)
Spearman, plaintiff v Wilkinson, defendant:
Draft Petition on behalf of the plaintiff Gilbert Spearman to have judgment pronounced without further delays caused by the defendant.
Paper     1f. [Damaged.]
 
486/37.      13 December 3 Anne (1704)
Spearman, plaintiff v Wilkinson, defendant:
Copy of Court Order for judgment to be given the following Monday (18 December).
Paper     2ff.
 
486/38.      16 December 1704
Spearman, plaintiff v Wilkinson, defendant:
Affidavit of Theodore Johnson that the Order of 13 December (No. 486/37) was served on the defendant's clerk in court on 15 December.
Paper     2ff.
 
486/39.
Spearman, plaintiff v Wilkinson, defendant:
Draft Petition of the plaintiff Gilbert Spearman for the enrolment of the decree pronounced 18 December 1704.
Paper.     1f.
 
486/40.      26 October 4 Anne (1705)
Spearman, plaintiff v Wilkinson, defendant:
Copy of Court Order for the enrolment of the decree pronounced 18 December 1704.
Paper     2ff.
 
486/41.      8 November 4 Anne (1705)
Spearman, plaintiff v Wilkinson, defendant:
Copy of Court Order for the signing and enrolment of the decree (pronounced 18 December 1704).
Paper     1f.
}}}</pre>
</div>
<div title="Gilbert Spearman (II)" modifier="YourName" created="200909131617" modified="200909131617" father="Gilbert Illegy SPEARMAN" mother="Anna CLARK" placeofbirth="" latitude="" longitude="" dob="" dod="" spouse="" dom="" changecount="2">
<pre></pre>
</div>
<div title="Gladis Bagg" modifier="YourName" modified="200909231726" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John David Bagg" mother="Katherine Anne UNKNOWN" latitude="" longitude="" dom="" placeofmarriage="" changecount="3">
<pre>Died young.</pre>
</div>
<div title="Gladys Newton" modifier="YourName" modified="200909282120" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1900-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="Trimsaran, Carmarthenshire, Wales" occupation="" causeofdeath="" placeofdeath="" father="Charles Henry Newton" mother="Isabel Robson" dom="" placeofmarriage="" changecount="2">
<pre></pre>
</div>
<div title="Hannah (Anna) Brew" modifier="YourName" modified="200909252222" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1827-04-29" spouse="" sex="F" dod="0000-00-00" placeofbirth="Chepstow,Monmouthshire,Wales" occupation="" causeofdeath="" placeofdeath="" father="Thomas Brew 1791" mother="Honor Perry" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre>Christened in Chepstow on 29 April 1827, and married William Jones in 1848 </pre>
</div>
<div title="Hannah Frances Oxx" modifier="YourName" modified="200909261450" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1810-05-27" spouse="" sex="F" dod="1834-07-05" placeofbirth="Saint Mary, Woodbridge, Suffolk, England" occupation="" causeofdeath="" placeofdeath="" father="John Oxe" mother="Woodhouse Spearman" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre>Christened: 1810-10-21</pre>
</div>
<div title="Hannah Mary Augusta Robson" modifier="YourName" created="200905050816" modified="200909252235" placeofbirth="Nassau, Germany (British Subject) Deu Bj, Eassan" latitude="" longitude="" dob="1849-03-01" dod="1908-01-14" mother="Mary Holder Oxx" father="Robert Robson" spouse="James Bulmer" vismoxy="500,23.157894736842138" sex="F" changecount="4" dom="" placeofmarriage="" occupation="" causeofdeath="acute bronchitis and cardiac failure" placeofdeath="Darlington">
<pre>Born 1849 in Darlington, Durham. Daughter of  Robert Robson and Mary Holder Oxx.

5 Siblings: John George (Senior), William Isaac, Harriett Jane, Robert Amos and Frances Isabell Woodhouse.

Married James Bulmer March 1876 in Darlington.
2 known children: 

Ethel Mary Bulmer
BORN 23 JAN 1877 Darlington, Durham, England 
DIED about 1906

Emma Isabel Bulmer
Born 24 FEB 1881 Darlington, Durham, England / (B S), Germany
DIED 22 JUN 1956

The 1881 Census has her aged 32, dwelling at 40 Henry St, Darlington, Durham with husband James Bulmer, a 32 year old Bricklayer, born also in Darlington, Durham with 2 children Ethel M (4) and Emma J (1 month). She is also living with Robert Robson, her widowed father now aged 61.
	For 1891 see her husband James Bulmer.

	In 1901 she is widowed and living at 1 Close Street with her children Ethel M, Emma, May, Harriet H, Albert J and Charles H. They are living near to a Newton family (next door?)

	She died in 1908 according to a death certificate in possession of her great granddaughter [[Elizabeth Bulmer]].
It is not known when she died.</pre>
</div>
<div title="Hannah Mydanwy Douglass" modifier="YourName" modified="200909261032" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Andrew William Rowe Douglass" mother="Ceri Elizabeth Sharman" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Hannah SPEARMAN (1790-)" modifier="YourName" created="200909131621" modified="200909131622" father="George SPEARMAN (1760-1828)" mother="Hannah WOODHOUSE" placeofbirth="" latitude="" longitude="" dob="1790" dod="" spouse="John DOVE (1783-)" dom="05/03/1821" changecount="1">
<pre></pre>
</div>
<div title="Hannah WOODHOUSE" modifier="YourName" modified="200909251513" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1755-11-09" spouse="" sex="F" dod="1835-10-28" placeofbirth="Whitby, Yorkshire" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre>Died at 7.50pm aged nearly 80.
	Buried at the Ballast Hills Cemetry, Newcastle near the headstone of James Smith in the New Ground not far from the rails.</pre>
</div>
<div title="Harold Morley Millett Brew" modifier="YourName" modified="200909252233" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1892-08-07" spouse="" sex="M" dod="1863-03-31" placeofbirth="Port Talbot, Glamorganshire, Wales" occupation="" causeofdeath="" placeofdeath="" father="Richard Brew 1859" mother="Ellen Millet" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre>Died 31 March 1963 in Swansea, Glamorgan, Wales. Harold saw service in World War I as a 2nd Lieutenant in the South Wales Borderers. </pre>
</div>
<div title="Harriet H Bulmer" modifier="YourName" modified="200909230803" mother="Hannah Mary Augusta Robson" placeofdeath="" causeofdeath="" occupation="Domestic Servant? (1901)" placeofbirth="Darlington" dod="0000-00-00" sex="F" spouse="" dob="1886-00-00" server.type="file" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.page.revision="200903090000" latitude="" longitude="" father="James Bulmer" dom="" placeofmarriage="" changecount="4">
<pre></pre>
</div>
<div title="Harriett Jane Robson" modifier="YourName" modified="200909271056" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1846-12-19" spouse="Thomas C Hunter" sex="F" dod="1901-00-00" placeofbirth="Middlesbrough, Yorkshire, England" occupation="Draper" causeofdeath="" placeofdeath="West Hartlepool, Durham" father="Robert Robson" mother="Mary Holder Oxx" latitude="" longitude="" dom="" placeofmarriage="" changecount="3">
<pre>She married Thomas Hunter.

	In the 1881 census she is living at 8 Hanover St in Stranton, Durham, England:
	Thomas C. HUNTER   Head   M   Male   31   Scotland   Draper Employing 1 Boy     
	 Harriet J. HUNTER   Wife   M   Female   34   Middlesbro, York, England        
	 Alfred WILLIAMSON   Boarder   M   Male   29   Stokesley, York, England   Drapers Assistant     

	In 1891 she is a widow and a boarder at a Milleners shop:
	Household Members: Name Age 
	Harriet Jane Hunter 40 
	Sarah Saunders 49 
	Shown as a Drapers Assisant at Poplar Grove (a Milleners shop)

	In 1901 she is a widow living with nieces Florence Bellwood and Emma Bulmer:
	Harriet J Hunter 
	Age: 50 
	Estimated Birth Year: abt 1851 
	Relation: Head 
	Gender: Female 
	Where born: Middlesborough, Yorkshire, England 
	Civil parish: West Hartlepool 
	Ecclesiastical parish: St Paul 
	County/Island: Durham 
	Country: England 
	Registration district: Hartlepool 
	Sub-registration district: Hartlepool 
	ED, institution, or vessel: 48 
	Neighbors: View others on page 
	Household schedule number: 8 
	Household Members: Name Age 
	Florence M Bellwood 23 
	Emma Bulmer 20 
	Harriet J Hunter 50 

	Florence &amp; Emma are nieces &amp; Harriets occupation is shown as Ladies underclothing &amp; baby linens living at York Road.
	She was buried in West Hartlepool, Durham.</pre>
</div>
<div title="Harriett Woodhouse Oxx" modifier="YourName" modified="200909261450" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1817-12-28" spouse="" sex="F" dod="1887-02-23" placeofbirth="Saint Mary, Woodbridge, Suffolk, England" occupation="" causeofdeath="" placeofdeath="" father="John Oxe" mother="Woodhouse Spearman" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre>Christened  20 JAN 1821   	Saint Mary, Woodbridge, Suffolk, England</pre>
</div>
<div title="Harry Gartside" modifier="YourName" modified="200909252227" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1890-00-00" spouse=",Bertha Houghton" sex="M" dod="1957-09-29" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Joseph Gartside" mother="Mary Alice Mallalieu" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre>390 Groby Road, Leicester. Worked as a Foundry Worker and lived 15 Bradbury Street, Ashton-u-Lyme.</pre>
</div>
<div title="Hattie Ruth King" modifier="YourName" created="200905082202" modified="200909230754" placeofdeath="" causeofdeath="" occupation="" placeofmarriage="" changecount="2" dom="" spouse="" mother="Julia Hunter" dod="" dob="20/02/1991" longitude="" latitude="" placeofbirth="" sex="F" father="David King">
<pre></pre>
</div>
<div title="Helen / Ellen Roche" modifier="YourName" modified="200909240759" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title="Helen Butler" modifier="YourName" modified="200909240802" changecount="2" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="Donough (2nd Earl of Thomond) O BRIEN" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title="Helen Euphemia Spears" modifier="YourName" created="200905082216" modified="200909261404" placeofbirth="" latitude="" longitude="" dob="" dod="" mother="" father="" spouse="Adam Lyall Robson" changecount="4" dom="" placeofmarriage="" occupation="" causeofdeath="" placeofdeath="" sex="F">
<pre></pre>
</div>
<div title="Helen URQUART" modifier="YourName" modified="200909261459" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Henry (5th Earl of Thomond) O BRIEN" modifier="YourName" modified="200909240758" changecount="3" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1588-00-00" spouse="" sex="M" dod="1639-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Donough (4th Earl of Thomond) O Brien" mother="Elizabeth Fitzgerald">
<pre></pre>
</div>
<div title="Henry Cokayne" modifier="YourName" modified="200909271156" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1240-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Roger Cokayne" mother="Elizabeth COKAYNE">
<pre></pre>
</div>
<div title="Henry Gartside (2)" modifier="YourName" modified="200909252151" changecount="2" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="1596-12-25" placeofbirth="Denshaw" occupation="" causeofdeath="" placeofdeath="" father="Henry Gartside 1526" mother="">
<pre>Inquisition Post Mortem held 6 May 1597.
	Probably a different Henry Gartside, possibly the son of the one who purchased his farm in 1554/5.
	Estate described as in 1554/5 and held of the Queen by one thousandth part of a knights fee.</pre>
</div>
<div title="Henry Gartside (3)" modifier="YourName" modified="200909252152" changecount="2" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="1634-09-06" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Francis Gartside" mother="">
<pre>Senior in 1628 when by fine he conveyed to Henry Gartside, Junior, one messuage and garden, ten acres of land, ten acres of meadow, six acres of pasture, one acre of furze and an eight part of four acres of land with rights of pasture and turbary in Denshaw.
	Buried in Oldham 6 Sept 1634.</pre>
</div>
<div title="Henry Gartside 1526" modifier="YourName" modified="200909252151" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1526-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="Denshaw" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre>With son William Gartside also Richard Gartside and John Gartside leased farm called Denshaw (A half of Denshaw) together with a half of Bakestone Delph, from Roche Abbey by deed dated 23rd August 1526.
	Purchased the freehold of his farm at Denshaw (described as one messuage with outbuildings, 16 acres of land, 8 acres of meadow, 8 acres of pasture with rights of common and turbary etc together with one eighth of the bakestone mine at Delph, from Roger Gartside of Rochdale for £46 by deed dated 15 March 1554/5</pre>
</div>
<div title="Henry Gartside 1600" modifier="YourName" modified="200909252153" changecount="2" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1600-00-00" spouse="" sex="M" dod="1663-00-00" placeofbirth="Denshaw" occupation="" causeofdeath="" placeofdeath="" father="Henry Gartside (3)" mother="">
<pre>Party to fine of 1628 when he was described as Junior.
	Will proved 11 Aug 1663.
	With son purchased Coatmans or Over HevBarn.</pre>
</div>
<div title="Henry Jackson" modifier="YourName" modified="200909221944" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="William Jackson" mother="French woman UNKNOWN" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre>Unconfirmed child.</pre>
</div>
<div title="Henry Sherat" modifier="YourName" modified="200909282130" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="" spouse="Alice Cokayne 1562" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre></pre>
</div>
<div title="Herbert Hunter" modifier="YourName" modified="200909251545" mother="Bertha UNKNOWN" placeofdeath="Cromer" causeofdeath="heart attack" occupation="Public Health Inspector" placeofbirth="Ossett" dod="1983-03-00" sex="M" spouse=",Freda Gartside" dob="1912-11-29" server.type="file" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.page.revision="200903090000" latitude="" longitude="" father="Frederick Hunter" dom="" placeofmarriage="" changecount="3">
<pre></pre>
</div>
<div title="Herbert LAKEMAN" modifier="YourName" created="200909010931" modified="200909010931" spouse="Hutchinson Maxwell OXX" sex="M" placeofbirth="" latitude="" longitude="" dob="1823" dod="" mother="" father="" dom="" changecount="1">
<pre></pre>
</div>
<div title="Hilda &quot;Joy&quot; FRECKLETON" modifier="YourName" created="200909131631" modified="200909131631" dom="" spouse="" father="" mother="" dod="" dob="1892" longitude="" latitude="" placeofbirth="" sex="F" changecount="2">
<pre></pre>
</div>
<div title="Honor Perry" modifier="YourName" modified="200909252220" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1790-00-00" spouse="" sex="F" dod="1875-04-16" placeofbirth="Tintern, Monmouthshire, Wales" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre>Died in Chepstow, aged ca. 85, on 16 April 1875. </pre>
</div>
<div title="Honora Lady O BRIEN" modifier="YourName" modified="200909240757" changecount="3" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Henry (5th Earl of Thomond) O BRIEN" mother="Mary BRERETON">
<pre></pre>
</div>
<div title="Hugh Martyn Sharman" modifier="YourName" modified="200909221701" changecount="3" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1941-02-23" spouse="" sex="M" dod="0000-00-00" placeofbirth="Shaohing, China" occupation="" causeofdeath="" placeofdeath="" father="William Kenneth (Jack) Sharman" mother="Margaret Valerie Millett (Pegi) Robson">
<pre></pre>
</div>
<div title="Hutchinson Maxwell Oxx" modifier="YourName" modified="200909261445" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1820-12-25" spouse="Herbert LAKEMAN" sex="F" dod="1862-00-00" placeofbirth="Newcastle,Upon Tyne, , Northumberland, England" occupation="" causeofdeath="" placeofdeath="" father="John Oxe" mother="Woodhouse Spearman" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre>Two conflicting christenings:
	Christened: 20 JAN 1821    	Saint Mary, Woodbridge, Suffolk, England
	Christened: 26 NOV 1823    	All Saints, Newcastle Upon Tyne, Northumberland, England</pre>
</div>
<div title="Ian Lyall Robson" modifier="YourName" modified="200909221659" placeofdeath="" causeofdeath="" occupation="" placeofmarriage="" placeofbirth="Port Talbot" latitude="" longitude="" dob="1928-00-0" dod="" mother="Violet Evelyn Brew" father="John George Robson" spouse="Joan Bagg" vismoxy="681.9999999999993,393.1999969482422" dom="" changecount="4" sex="M">
<pre>Married Joan Bagg 20th February 1954.
Two children: Andrew Lyall and Sharman Louise

In his career has taught teaching apprenticeships in the steel industry in Port Talbot before moving to Swindon where he became manager of Bunce (Ashbury) Ltd making Snow Ploughs, gritting machines, snow blowers and mechanical sweepers.</pre>
</div>
<div title="Ida, Daughter of Lord Grey de Ruthyn" modifier="YourName" created="200909131528" modified="200909261507" changecount="2" dom="" father="" mother="" dod="" dob="" longitude="" latitude="" placeofbirth="" spouse="John COKAYNE (1370)" sex="F" placeofmarriage="" occupation="" causeofdeath="" placeofdeath="">
<pre></pre>
</div>
<div title="Ilbert Florence OXX (1900-1986)" modifier="YourName" created="200909131634" modified="200909131634" changecount="1" dom="1922" spouse="George A PEARCE" dod="" dob="" longitude="" latitude="" placeofbirth="" sex="F" mother="Elizabeth Sophia Ilbert CUTCLIFFE" father="George Robert OXX (1851-1927)">
<pre></pre>
</div>
<div title="Isaac Woodhouse SPEARMAN (1785-1828)" modifier="YourName" created="200909131620" modified="200909131620" father="George SPEARMAN (1760-1828)" mother="Hannah WOODHOUSE" placeofbirth="" latitude="" longitude="" dob="1785" dod="1828" spouse="Elizabeth WILKINSON" dom="" changecount="1">
<pre></pre>
</div>
<div title="Isabel Robson" modifier="YourName" created="200905050818" modified="200909251532" placeofdeath="Blemenayon (place of burial, possible mispelling)" causeofdeath="" occupation="" placeofmarriage="" dom="" sex="F" placeofbirth="Middlesbro, York, England" latitude="" longitude="" dob="20/03/1865" dod="11/04/1865" mother="Martha Isabell Lyall" father="John George Robson (2)" spouse="Charles Henry Newton" changecount="5">
<pre>Born 20th March 1865 in Darlington, Durham. Daughter of John George Robson and Martha Isabell Lyall. Christened 11th April 1865 in St John, Middlesbrough, Yorkshire England.

6 siblings: Robert William, Adam Lyall Margaret Elizabeth (died young aged 5),  Matthew Jackson, Mary Elizabeth and John George Robson (Junior).

Christened at St John, Middlesbrough, Yorkshire, England [familysearch.org]

The 1881 Census has shows she no longer lives with her parents. aged just 16. The 1881 census also shows an Isabella Robson (aged 16), a scholar, born in Middlesbrough, living at 11 Teresa Ter, Kirkleatham, Yorkshire, England. She is granddaughter to the head of the household Isabella LYALL and also living with her two aunts Margaret And Elizabeth. It seems coincidence that these are not the same people.

	Married after 1881 census - in which she was 16 and living with her grandmother.

	Living at Holden Road in 1901 census with Charles H Newton and 2 sons, cousin John G Robson and servant.</pre>
</div>
<div title="Isabel SHIRLEY" modifier="YourName" modified="200909261507" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre></pre>
</div>
<div title="Isabella Bulmer" modifier="YourName" modified="200909271108" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1834-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="James Bulmer Senior" mother="Mary Sargison" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre>Isabella Bulmer (born 1834) came from Darlington to Auckland NZ arriving on 4 nov 1877 on the ship &quot;Otaki&quot;.</pre>
</div>
<div title="Isabella Jackson" modifier="YourName" modified="200909221751" changecount="4" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1809-00-00" spouse="Adam Lyall" sex="F" dod="0000-00-00" placeofbirth="Jarrow, Durham" occupation="" causeofdeath="" placeofdeath="" father="Matthew Jackson" mother="Martha UNKNOWN">
<pre>See husband for early life.

	The 1881 census shows Isabella Lyall living at 11 Teresa Ter, Kirkleatham, Yorkshire, England. She is living with her two daughters Margaret And Elizabeth and her granddaughter Isabella Robson (aged 16). She is widowed.</pre>
</div>
<div title="Isabella Robson 1865" modifier="YourName" modified="200909282120" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1865-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="Sunderland, Durham, England" occupation="" causeofdeath="" placeofdeath="" father=" William Robson (340)" mother=" Jane Unknown (362)" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Ivor Bagg" modifier="YourName" modified="200909230807" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1905-00-00" spouse="Violet Franklin" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John David Bagg" mother="Katherine Anne UNKNOWN" latitude="" longitude="" dom="" placeofmarriage="" changecount="4">
<pre></pre>
</div>
<div title="Ivy B CROOKS" modifier="YourName" modified="200909271122" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title="James Bulmer" modifier="YourName" modified="200909261410" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1848-07-26" spouse="Hannah Mary Augusta Robson" sex="M" dod="1900-02-06" placeofbirth="Darlington" occupation="Bricklayer (1881) Builder (1891)" causeofdeath="" placeofdeath="" father="James Bulmer Senior" mother="Mary Sargison" latitude="" longitude="" dom="" placeofmarriage="" changecount="3">
<pre>The 1881 Census has him aged 32, dwelling at 40 Henry St, Darlington, Durham with wife Hannah, born also in Darlington, Durham with 2 children Ethel M (4) and Emma J (1 month). He is also living with Robert Robson, his widowed father-in-law now aged 61.

	In 1891 he is living at 3 Close Street - not too far from Henry St. with wife and children Ethel, Emma, May, Harriet, Albert and Charles H.

	In 1901 his wife Hannah is widowed.</pre>
</div>
<div title="James Bulmer Senior" modifier="YourName" modified="200909261409" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1805-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre>Marriage is approximate and took place in Darlington.</pre>
</div>
<div title="James Gartside" modifier="YourName" modified="200909240839" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1705-00-00" spouse="" sex="M" dod="1785-07-25" placeofbirth="Ben Greave, Marsden and Denshaw" occupation="" causeofdeath="" placeofdeath="" father="John Gartside" mother="Mary Harrop">
<pre>Yeoman.
	Will proved 24 Oct 1785. Buried in Marsden.</pre>
</div>
<div title="James Gartside -1596" modifier="YourName" modified="200909252153" changecount="2" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="1596-12-25" placeofbirth="Denshaw" occupation="" causeofdeath="" placeofdeath="" father="Henry Gartside 1526" mother="">
<pre>Died before 25 Dec 1596 mentioned in Inquisition Post Morterm of 1597 as deceased and as blood relative and next heir of Henry Gartside.</pre>
</div>
<div title="James Spearman OXX (1854-1921)" modifier="YourName" created="200909131626" modified="200909131627" changecount="1" dom="1883" spouse="Annie E MOORE" dod="1921" dob="1854" longitude="" latitude="" placeofbirth="" sex="M" mother="Mary Catherine MATHERS" father="George Spearman OXX">
<pre></pre>
</div>
<div title="Jane Ann Robson" modifier="YourName" modified="200909271035" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1874-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="Hartlepool, Durham, England" occupation="" causeofdeath="" placeofdeath="" father="Robert Foster Robson" mother="Elizabeth Rowe">
<pre></pre>
</div>
<div title="Jane Brew" modifier="YourName" modified="200909252222" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1819-06-20" spouse="" sex="F" dod="0000-00-00" placeofbirth="Chepstow,Monmouthshire,Wales" occupation="" causeofdeath="" placeofdeath="" father="Thomas Brew 1791" mother="Honor Perry" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre></pre>
</div>
<div title="Jane Margaret Morgan" modifier="YourName" modified="200909252219" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Jane UNKNOWN" modifier="YourName" modified="200909282125" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1798-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="Hacey? Northumberland, England" occupation="" causeofdeath="" placeofdeath="" father="" mother="" dom="" placeofmarriage="" changecount="3">
<pre>Possibly Edmunds if son John is John George and is born 10 DEC 1821    	Sunderland, Durham, England

	I have found a marriage for John ROBSON and Jane TODD, All Saints, Newcastle upon Tyne 1 Feb 1808, it may be worth following up.
	1841 census (Walker, Long Benton, Newcastle):
	George Robson abt 1825 Northumberland, England Long Benton Northumberland
	View Record Isabella Robson abt 1832 Northumberland, England Long Benton Northumberland
	View Record Jane Robson abt 1798 Northumberland, England Long Benton Northumberland
	View Record Jane Robson abt 1830 Northumberland, England Long Benton Northumberland
	View Record John Robson abt 1822 Northumberland, England Long Benton Northumberland
	View Record Robert Robson abt 1820 Northumberland, England Long Benton Northumberland
	View Record William Robson abt 1835 Northumberland, England Long Benton Northumberland
	It states that Jane is a pauper, possibly due to being widowed?

	1851 census (Wincomblee, Longbenton):
	June Robson abt 1787 Hacey, Northumberland, England Head Longbenton Northumberland
	William Robson abt 1835 Walker, Northumberland, England Son Longbenton Northumberland 
	A few mistakes here but it could be the same one..

	Her maiden name is NOT Stephenson.</pre>
</div>
<div title="Janet Margaret Gartside" modifier="YourName" modified="200909282116" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1946-00-00" spouse="Janet Margaret Gartside" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Frank Mallalieu Gartside" mother="Margaret Joan Duffy" latitude="" longitude="" dom="" placeofmarriage="" changecount="3">
<pre>Lecturer at Old Church House Stanmore.</pre>
</div>
<div title="Jessica (Jessie) Rees" modifier="YourName" modified="200909271131" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1878-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre>I wonder if Elizabeth Rees is Jessica&quot;s sister and her father is Robert Rees as these names crop up in the Brew family tree.</pre>
</div>
<div title="Jette MOHR" modifier="YourName" modified="200909261507" changecount="2" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title="Joan Bagg" modifier="YourName" modified="200909230807" spouse="Ian Lyall Robson" placeofbirth="" latitude="" longitude="" dob="02/08/1930" dod="" mother="Violet Franklin" father="Ivor Bagg" vismoxy="200,0" sex="F" dom="" changecount="2" placeofmarriage="" occupation="" causeofdeath="" placeofdeath="">
<pre></pre>
</div>
<div title="Joan DABRIDGECOURT" modifier="YourName" created="200909131539" placeofbirth="" latitude="" longitude="" dob="" dod="" mother="" father="" spouse="Sir John COKAYNE (-1447)" dom="" changecount="1">
<pre></pre>
</div>
<div title="John Amass Oxx" modifier="YourName" modified="200909261440" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1806-00-00" spouse="" sex="M" dod="1806-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John Oxe" mother="Woodhouse Spearman" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre></pre>
</div>
<div title="John Bagg" modifier="YourName" created="200909131654" modified="200909230807" father="Ivor Bagg" mother="Violet Franklin" sex="M" placeofbirth="" latitude="" longitude="" dob="" dod="" spouse="" dom="" changecount="2" placeofmarriage="" occupation="" causeofdeath="" placeofdeath="">
<pre></pre>
</div>
<div title="John Bellwood 1942" modifier="YourName" modified="200909261500" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1942-00-00" spouse="Helen URQUART" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Norman Robson Bellwood" mother="Freda Thompson" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre></pre>
</div>
<div title="John Blackbird Bone" modifier="YourName" modified="200909261437" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="John Bone" modifier="YourName" modified="200909261438" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1858-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="Tudhoe, Durham" occupation="" causeofdeath="" placeofdeath="" father="John Blackbird Bone" mother="Maxwell Oxx" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="John Brew 1763" modifier="YourName" modified="200909251516" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1765-00-00" spouse="" sex="M" dod="1805-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre>Born 1763/1765 and died before 1805. Son of an unknown father and unknown mother (first name Elizabeth).

	According to the Parish Register, their wedding banns were published on three consecutive Sundays, the 2 November, 9 November and 16 November 1788. John is listed as a bachelor and Mary a spinster. They were married by the minister, with Thomas and Hannah Ashburner as witnesses. Interesting to note is that both John and Mary were most probably illiterate as they both undersigned their names with an &quot;X&quot;. 

	vidence shows that John and Thomas&quot; father, John, was dead by 1805. A draft apprenticeship indenture for Thomas as a Ropemaker, from October 1809, shows that he was already in an apprenticeship agreement since 1805, for which he obtained the consent of his mother, Mary. &quot;...wh&quot;as by Ind&quot;re bearing Date the 2d Day of July 1805...it is witnessed that the sd. Ths. Brew with the Consent of his mother Mary Brew of Chepstow afsd. widow did put himself apprentice to Saml. Brookman of Chepstow afsd. Ropemaker....&quot;. There are no records of his death in the parish registers, this is the only clue.

	We believe that John (ca.1765-ca.1805) also had a brother called Thomas, as a Thomas Brew, also married to a Mary, is recorded as having christened a son, James, in Chepstow, on 8 June 1794. James would therefore have been a cousin to John and Thomas, born in 1790 and 1791. We find no further trace of James or his parents after this reference.

	SOURCES
	&lt;a href=&quot;http://brew.clients.ch/family.htm&quot;&gt;Brew family tree&lt;/a&gt;</pre>
</div>
<div title="John Brew 1790" modifier="YourName" modified="200909251552" changecount="4" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1790-02-21" spouse="" sex="M" dod="0000-00-00" placeofbirth="Chepstow, Monmouthshire, Wales" occupation="" causeofdeath="" placeofdeath="" father="John Brew 1763" mother="Mary Taylor">
<pre>Read more here: [[http://brew.clients.ch/john1790.htm#John%20Brew,%201790-1843]]</pre>
</div>
<div title="John Brew 1816" modifier="YourName" modified="200909252140" changecount="3" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1816-03-31" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John Brew 1790" mother="Rachel Prickett">
<pre></pre>
</div>
<div title="John Brew 1824" modifier="YourName" modified="200909271055" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1824-03-07" spouse="Elizabeth Martha Ja(c)kman" sex="M" dod="1904-09-14" placeofbirth="Chepstow,Monmouthshire,Wales" occupation="Blacksmith, Foreman at Woolwich Arsenal in London" s="" east,="" opened="" his="" own="" business="" as="" a="" coal="" merchant="" (1884-="" latitude="" longitude="" mother="Honor Perry" father="Thomas Brew 1791" dom="" placeofmarriage="" causeofdeath="" placeofdeath="" changecount="3">
<pre></pre>
</div>
<div title="John COKAYNE" modifier="YourName" created="200909131543" modified="200909271214" placeofdeath="" causeofdeath="" occupation="" placeofmarriage="" changecount="4" sex="M" placeofbirth="" latitude="" longitude="" dob="1230" dod="1305" mother="Alice DE DALBURY" father="William COKAYNE (II)" spouse="Maud DE OLDERNEY" dom="">
<pre></pre>
</div>
<div title="John COKAYNE (1276)" modifier="YourName" created="200909131515" modified="200909131515" father="William COKAYNE 1244" mother="Sarah MERCATON" sex="M" placeofbirth="" latitude="" longitude="" dob="1276" dod="1335" spouse="Lettice DE KNIVETON" dom="" changecount="1">
<pre></pre>
</div>
<div title="John COKAYNE (1370)" modifier="YourName" created="200909131527" modified="200909131528" changecount="1" dom="" spouse="Ida, Daughter of Lord Grey de Ruthyn" dod="1429" dob="1370" longitude="" latitude="" placeofbirth="" mother="Cecilia VERNON" father="Sir John COKAYNE">
<pre>Chief Baron of Exchequer 1401</pre>
</div>
<div title="John COKAYNE (III)" modifier="YourName" created="200909131512" modified="200909131544" changecount="4" dom="" spouse="" dod="" dob="" longitude="" latitude="" placeofbirth="" sex="M" mother="Isabel SHIRLEY" father="Sir John COKAYNE (-1447)">
<pre>Married Agnes Vernon.</pre>
</div>
<div title="John COKAYNE II (1307)" modifier="YourName" created="200909131518" modified="200909131519" father="John COKAYNE (1276)" mother="Lettice DE KNIVETON" spouse="Letitia WITHERS" sex="M" placeofbirth="" latitude="" longitude="" dob="1307" dod="1373" dom="" changecount="1">
<pre></pre>
</div>
<div title="John Cokayne" modifier="YourName" modified="200909261027" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1100-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="John David Bagg" modifier="YourName" modified="200909230806" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="John Dove" modifier="YourName" modified="200909221702" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1783-00-00" spouse="" sex="M" dod="1861-00-00" placeofbirth="Woodbridge Suffolk" occupation="" causeofdeath="" placeofdeath="Captain" father="" mother="">
<pre></pre>
</div>
<div title="John Gartside" modifier="YourName" modified="200909240843" changecount="3" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="1745-00-00" placeofbirth="Denshaw Fold" occupation="" causeofdeath="" placeofdeath="" father="John Gartside (3)" mother="Susannah Buckley">
<pre>id:493 
Yeoman.
	Marriage license 1697.
	Marriage settlement 20 Sept 1697.
	Buried 29 April 1745.
	Will proved 11 May 1745.</pre>
</div>
<div title="John Gartside (2)" modifier="YourName" modified="200909240840" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1722-00-00" spouse="" sex="M" dod="1724-02-28" placeofbirth="Denshaw" occupation="" causeofdeath="" placeofdeath="" father="John Gartside" mother="Mary Harrop">
<pre>Yeoman.
	Admin granted 26 May 1724.
	Commemorative plaque in Old Saddleworth Church.</pre>
</div>
<div title="John Gartside (3)" modifier="YourName" modified="200909252153" changecount="4" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1642-00-00" spouse="" sex="M" dod="1702-00-00" placeofbirth="Denshaw" occupation="" causeofdeath="" placeofdeath="" father="Henry Gartside 1600" mother="Elizabeth Buckley">
<pre>id:501
Yeoman.
	Will proved to be 9 May 1702.
	With father purchased Coatmans.</pre>
</div>
<div title="John Gartside 1568" modifier="YourName" modified="200909252154" changecount="2" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1568" spouse="" sex="M" dod="0000-00-00" placeofbirth="Denshaw" occupation="" causeofdeath="" placeofdeath="" father="James Gartside -1596" mother="">
<pre>Aged 28 years on 25 Dec 1596.
	Mentioned in Inquisition Post Morterm of Henry Gartside as son of James Gartside deceased and blood relative and heir of Henry Gartside. Inherited Henry&quot;s estate at Denshaw.
	Granted license to sell a half of the estate (Excluding Broadmeadow House, Broadmeadow, a quarter of the Hey and one eighth of the bakestone mine) to Francis Gartside 8 Nov 1597.
	Granted license to sell a house called Broadmeadow and 6/7 acres of land in Denshaw to Robert Gartside 2 Mar 1597/8.
	Admin granted 27 April 1627.</pre>
</div>
<div title="John Gartside 1817" modifier="YourName" modified="200909252229" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1817-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="Linfitts" occupation="" causeofdeath="" placeofdeath="" father="Joseph Gartside 1794" mother="Ruth Roberts" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre>Baptised 13th March 1817 at St. Thomas, Friarmere. Was an overseer in Woolen factory.
	Lived in Green Ash?</pre>
</div>
<div title="John George Robson" modifier="YourName" created="200905032225" modified="200909251526" placeofdeath="in Port Talbot. Buried with wife at Goytre." causeofdeath="" occupation="" placeofmarriage="" dom="" vismoxy="214,-364.73333740234375" placeofbirth="Workington" latitude="" longitude="" dob="1884-12-07" dod="1964-06-07" mother="Martha Isabell Lyall" father="John George Robson (2)" spouse="Violet Evelyn Brew" changecount="4" sex="M">
<pre>Born 1884 in Workington, Cumbria. Son of John George Robson and Martha Isabell Lyall.

John was the youngest of 7 children, his 6 siblings were: Isabell, Robert William, Adam Lyall, Margaret Elizabeth, Matthew Jackson and Mary Elizabeth.

Attended Lewis' School Pengam. (possibly: http://www.caerphilly.org.uk/lewisschoolpengam/homepage.htm)

Lived in Middlesborough, Scunthorpe and Trimsaran Wales.

One known address he lived at was:
Culla House,
Culla Rd,
Trimsaran,
Kidwelly Wales
Interestingly this is now a restaurant (in 2004) called Burdies.

Married 18th March 1908 in Neaf at English Baptist Church in Port Talbot.
Four children :Ian Lyall Robson, Alan Lyall, Marjorie Isabel, Margaret Valerie Millett

Took an engineering apprenticeship in Kilmarnock, Scotland.

Worked for a company called &quot;Andrew Barkley&quot; making steam engines.

Died 1964.</pre>
</div>
<div title="John George Robson (2)" modifier="YourName" created="200905032226" modified="200909261447" vismoxy="500,410" placeofbirth="Middlesex, York." latitude="" longitude="" dob="1843-03-02" dod="1923-04-19" mother="Mary Holder Oxx" father="Robert Robson" spouse="Martha Isabell Lyall" changecount="4" dom="" sex="M" placeofmarriage="" occupation="Roll Turner (1881)" causeofdeath="" placeofdeath="Port Talbot, buried at Chapel of Ease.">
<pre>The 1881 Census has him dwelling in Mossby Cottage, Workington, Cumberland, aged 38 with wife Martha Isabell (formerly Lyall), also 38 and children Robert William (13), Adam Lyall (10), Mary Elizabeth (5) and Mathew Jackson (3). Daughter Isabell would have been 16 and it is interesting to note that she is no longer registered to be living in the house. John George would not be due for 3 years, and Margaret Elizabeth would have sadly passed away only 3 years before.

	The 1881 census has him working as a Roll Turner in Steel Works. He is known to have worked at Rise Car Rolling Mills in the steel industry as he was presented with a clock upon leaving on 26th February 1876. Rise Car being a suburb in Darlington. The Rolling Mills were involved in the production of puddled iron, the re-rolling of steel bars and the manufacture of special sections. Along with other firms in town, it made Darlington important enough to attract foreign visitors. The Chinese Imperial commissioners visited in April 1906.

	The 1901 census shows him living with daughter Mary, wife and a servant Maud Lloyd. Interestingly, sons Robert and Matthew are living at Culla House, Pembrey, Llanelly, East Carmarthen as boarders in a house owned by LLOND. Probably not related, but I wondered if this was any relation to the servant.
	View Record Maud Lloyd abt 1877 Shelton, Staffordshire, England Servant Aberavon Glamorgan
	View Record John G Robson abt 1843 Middlesbrough, Yorkshire, England Head Aberavon Glamorgan
	View Record Martha J Robson abt 1843 Cockfield, Durham, England Wife Aberavon Glamorgan
	View Record Mary J Robson abt 1876 Darlington, Durham, England Daughter Aberavon Glamorgan 
	</pre>
</div>
<div title="John M Oxx" modifier="YourName" created="200910060957" modified="200910060958" changecount="3" sex="M" father="John Oxx Senior" dob="14/07/1950" placeofbirth="" spouse="" placeofmarriage="" occupation="" dod="" causeofdeath="" placeofdeath="">
<pre>http://en.wikipedia.org/wiki/John_Oxx</pre>
</div>
<div title="John Oxe" modifier="YourName" modified="200909261424" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1782-01-06" spouse="Woodhouse Spearman" sex="M" dod="1851-10-27" placeofbirth="Saint Mary, Woodbridge, Suffolk, England" occupation="Master Mariner (probably his entire life but definitely between 1811-1851)" causeofdeath="" placeofdeath="72 Sparling Street, Liverpool" father="John Oxe Senior" mother="Frances Ladbrook" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre>There is a christening for John Oxe on: 20 JAN 1782 Saint Mary, Woodbridge, Suffolk, England. Likely to be the same one.
	Parents are John Oxe and Frances.

	There was a school for seafarers in Woodbridge which John may have attended. 

	John was awarded a silver cup which is still in the family for being the first to bring coal from Newcastle to Woodbridge in 1811. The cup bears the inscription &quot;The gift of the owners of Fandon Colliery to Captn. John Oxx of the Commerce of Woodbridge, for introducing the first cargo of Newcastle Wallsend Coals into that Port in August 1811.&quot; The Commerce of Woodbridge is the name of the ship.

	A John Oxx married Mary Harris in St. Mary, Warwick on 4 November 1828 which would have been 2 years after Woodhouse&quot;s death in 1826. If it is the same John how did he get to Warwick? Was he a widower on marriage? Did he have any further children? A Mary Oxx, widow, later married William Hull, widower Feb 8 1857 in the district of Newport.

	At time of marriage of Robert Robson and his daughter Mary Oxx and his death his occupation is stated as &quot;Master Mariner&quot;.

	Spelling of the Oxx surname seems to have been standardised around 1800. Hence the change of surname from Oxe.

	He died of inflammation of the brain.</pre>
</div>
<div title="John Oxe Senior" modifier="YourName" created="200909261424" modified="200909261424" dob="" placeofbirth="" latitude="" longitude="" mother="" father="" spouse="" dom="" placeofmarriage="" occupation="" dod="" causeofdeath="" placeofdeath="" changecount="2" sex="M">
<pre></pre>
</div>
<div title="John Ramsay 1st Earl of Holdernesse" modifier="YourName" modified="200909271121" changecount="3" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1580" spouse="Martha COKAYNE (1605-1641)" sex="M" dod="28 February 1626" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre>[[http://en.wikipedia.org/wiki/John_Ramsay,_1st_Earl_of_Holderness]]</pre>
</div>
<div title="John Robson" modifier="YourName" created="200905041439" modified="200910050941" tags="rootTree" sex="M" placeofdeath="Walker, Newcastle" causeofdeath="" occupation="Labourer" placeofmarriage="" placeofbirth="Possibly Newcastle" latitude="" longitude="" dob="1791" dod="1836-00-00" mother="" father="" spouse="" vismoxy="300,410" dom="" changecount="12">
<pre>The marriage certificate of Robert Robson and Mary Holder Oxx states John Robson as father and deceased.

	Possible death from Long Benton parish records..
	14 Jan 1836  John Robson of Walker aged 44
	Familyhistoryonline.net says he was buried at St Bartholomew:
	Parish Longbenton, St. Bartholomew, NBL Buried 14/01/1836 Name John ROBSON aged 44 Abode Walker

	This would mean he was born before 14 Jan 1792. So it is likely he was born in 1791.

	&lt;h4&gt;Research into his birth..&lt;/h4&gt;
	If born in 1791:
	///////////////
	1. Baptised 17/04/1791 Child&quot;s name John ROBSON Father John Mother – Mother&quot;s Maiden name – Place Cocklaw St.John Lee Occupation – Other info – Father – Mother – Notes – Birth date –/–/– Parish Chollerton, Nbl Checked Checked
	Amount paid £0.07
	2. Baptised 17/Ap/1791 Child&quot;s name John ROBSON Father John Mother – Mother&quot;s Maiden name – Place Cocklaw St. John Lee Occupation – Other info – Father – Mother – Notes – Birth date –/–/– Parish Chollerton, Nbl Checked Checked
	Amount paid £0.07
	3. Baptised 29/05/1791 Child&quot;s name John ROBSON Father William Mother Jane Mother&quot;s Maiden name – Place Slaley Occupation – Other info – Father – Mother – Notes – Birth date –/–/– Parish Slaley, Nbl Checked Checked : checking on Familysearch.org shows mother maiden name to be ROBERTS, siblings Barbara, Mary, Jane, William.
	note this match is unlikely due to Slaley being 25miles away from Walker.
	4.  11 DEC 1791   	Harrington, Cumberland, England : parents John Robson and Jane
	5. 08 DEC 1791    	Bridlington, Yorkshire, England : parents Joseph and ?
	6.  Christening:  15 FEB 1791   	Sedgefield, Durham, England : George &amp; Mary
	7.  Birth: 04 SEP 1791  	Kirk Andrews Upon Esk, Cumberland, England Matthew Robson &amp; Mary Wright
	8. Christening:  	14 AUG 1791  	Stainton In Cleveland, Yorkshire, England parents: John Robson 
	If born in 1792
	/////////////////
	There is a christening at All Saints Church..
	25 MAR 1792  	All Saints, Newcastle Upon Tyne, Northumberland, England
	- this would mean however that John was approx 43 yr 11months when he died.. unless he was born in January over 2 months before the christening.
	Parents Thomas Robson &amp; Mary Anderson
	Thomas was born About 1760  	Of, Newcastle Upon Tyne, Northumberland, England  	Newcastle Upon Tyne, Northumberland, England and married Mary Anderson (born 	About 1764  	Of, Newcastle Upon Tyne, Northumberland, England) on 06 FEB 1791   	Newcastle Upon Tyne, Northumberland, England
	They had at least one more child Elizabeth born 	08 JUL 1798  	Newcastle Upon Tyne, Northumberland, England.
	Another..
	  	22 DEC 1793  	All Saints, Newcastle Upon Tyne, Northumberland, England
	Parents John and Margaret



	///
	Possible marriages:
	8. Parish Horton alternatively – in county Nbl Married on 12/03/1820 Groom John Robson residence GOS other – Bride Jane Watson.
	Probably not though - as Robert was born in January 1820. A possible baptism of George however can be found in Durham: 23 Jan 1825  ROBSON, George Watson; child of John and Jane


It is believed he had a wife Jane. Jane can be seen as widowed in an early census with the children.

He is believed to have died the year before the census's began. :( I seem to have lost the source of this information. Believe the death was recorded in a parish record.</pre>
</div>
<div title="John Robson 1828" modifier="YourName" modified="200909252224" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1828-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="Washington, Co. Durham" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre>Married Mary.

	This family tree line is NOT known to be directly connected to my line.</pre>
</div>
<div title="John Robson 1910" modifier="YourName" modified="200909271132" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Matthew Jackson Robson" mother="Jessica (Jessie) Rees" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre>Births from 1910-1920:
	9 Robson John H Rees Neath.11a 1886 Birth 4 1911 
	10 Robson Walter R Rees Cardiff.11a 811 Birth 4 1919</pre>
</div>
<div title="John Wakerley" modifier="YourName" modified="200909271103" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="Isabella Bulmer" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="John William Oxx" modifier="YourName" modified="200910060956" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1826-01-15" spouse="" sex="M" dod="1826-06-29" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John Oxe" mother="Woodhouse Spearman " placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Jonathan Bellwood" modifier="YourName" modified="200909271033" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John Bellwood 1942" mother="Helen URQUART">
<pre></pre>
</div>
<div title="Jonathan David Lyall Robson" modifier="YourName" modified="200909252315" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1985-02-20" spouse="" sex="M" dod="0000-00-00" placeofbirth="Gravesend" occupation="" causeofdeath="" placeofdeath="" father="Andrew Lyall Robson" mother="Kathryn Anne Hunter" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre></pre>
</div>
<div title="Jonathan Spearman Oxx" modifier="YourName" modified="200909271122" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1961-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Clive Spearman Oxx" mother="Judith A Hunt">
<pre></pre>
</div>
<div title="Joseph Cuthbert" modifier="YourName" modified="200909271217" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Joseph Gartside" modifier="YourName" modified="200910032050" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1853-03-13" spouse="Mary Alice Mallalieu" sex="M" dod="1923-06-02" placeofbirth="Denshaw, Saddleworth, York, England" occupation="" causeofdeath="" placeofdeath="" father="John Gartside 1817" mother="Mary Dyson" latitude="" longitude="" dom="" placeofmarriage="" changecount="3">
<pre>Died at 96 Fitzroy Street, Ashton-u-Lyme. Was buried 5th February at St.Thomas.

	In 1881 census:
	 Name   	Relation  	Marital Status  	Gender  	Age  	Birthplace  	Occupation 	Disability
	 Joseph GARTSIDE  	 Head  	 M  	 Male  	 28  	 Saddleworth, York, England  	 Overseer In Woollen Mill  	  
	 Mary Alice GARTSIDE  	 Wife  	 M  	 Female  	 28  	 Saddleworth, York, England  	   	  
	 George Mallebieu GARTSIDE  	 Son  	 U  	 Male  	 5  	 Saddleworth, York, England  	 Scholar  	  
	 Hilton GARTSIDE  	 Son  	 U  	 Male  	 1  	 Saddleworth, York, England  	   	  

	Married at Christ Church, Denshaw.</pre>
</div>
<div title="Joseph Gartside 1794" modifier="YourName" modified="200909252230" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1794-00-00" spouse="" sex="M" dod="1873-09-00" placeofbirth="Linfitts" occupation="" causeofdeath="" placeofdeath="" father="Benjamin Gartside" mother="Mary Buckley" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre>Handweaver. Baptised 8 Jun 1794 at St. Thomas, Friarmere.
	Married at St Chad Rochdale.</pre>
</div>
<div title="Joseph Jackson" modifier="YourName" modified="200909221948" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="William Jackson" mother="French woman UNKNOWN" latitude="" longitude="" dom="" placeofmarriage="" changecount="3">
<pre></pre>
</div>
<div title="Joseph Peter Robson" modifier="YourName" modified="200909261436" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1849-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="Yorks, Middlesbrough" occupation="" causeofdeath="" placeofdeath="" father="Joseph Robson" mother="Ann Foster" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Joseph Robson" modifier="YourName" modified="200909261435" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1823-00-00" spouse="" sex="M" dod="1907-00-00" placeofbirth="Newcastle On Tyne" occupation="" causeofdeath="" placeofdeath="" father="Unknown Robson" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre>Suspected to be a relation of Robert Robson... Interestingly in 1851 census he is living next door to Robert Robson and Mary Oxx.
	It is possible he married ANN FORSTER 30 APR 1843 Middlesbrough, Yorkshire, England. If this is the case his father is Solomon Robson.
	It may have been Ann Bell he married on 20 FEB 1842 All Saints, Newcastle Upon Tyne, Northumberland, England. If this is the case is father is Joseph Robson.
	The conclusion drawn is that his wife was Ann Forster/Foster as son Robert takes Foster as a middle name.

	1881 census has him living at No 15 William St, Swindon with following residents..
	Joseph ROBSON  	 M  	 Male  	 58  	 Newcastle On Tyne  	 Iron Moulder 
	 Ann ROBSON  	 M  	 Female  	 55  	 Stockton On Tees  	  
	 Saml. ROBSON  	 U  	 Male  	 20  	 Middlesborough, York, England  	 Boiler Maker 
	 Margaret ROBSON  	 U  	 Female  	 14  	 Middlesborough, York, England  	  
	 Martha KEEL  	 M  	 Female  	 23  	 Middlesborough, York, England  	  
	 Robert KEEL  	 M  	 Male  	 23  	 New Swindon, Wiltshire, England  	 Erector Engine (Fitter) 
	 Francis POWER  	   	 Male  	 2  	 London, London, Middlesex, England  	  </pre>
</div>
<div title="Joseph Spearman" modifier="YourName" created="200909131616" modified="200909131616" father="Gilbert Illegy SPEARMAN" mother="Anna CLARK" placeofbirth="" latitude="" longitude="" dob="" dod="" spouse="" dom="" changecount="1">
<pre></pre>
</div>
<div title="Judith A Hunt" modifier="YourName" modified="200909271122" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title="Julia Hunter" modifier="YourName" modified="200909230754" placeofdeath="" causeofdeath="" occupation="" placeofmarriage="" dom="" sex="F" mother="Freda Gartside" father="Herbert Hunter" placeofbirth="" latitude="" longitude="" dob="1963-10-08" dod="" spouse="David King" vismoxy="400,-248.57142857142856" changecount="3">
<pre></pre>
</div>
<div title="Katherine Anne UNKNOWN" modifier="YourName" modified="200909230804" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Kathryn Anne Hunter" modifier="YourName" modified="200910032043" sex="F" mother="Freda Gartside" father="Herbert Hunter" placeofbirth="" latitude="" longitude="" dob="1955" dod="" spouse="Andrew Lyall Robson,Keith Richard Herlock" vismoxy="400,-114.28571428571428" dom="28/10/78" changecount="6" placeofmarriage="" occupation="Teacher" causeofdeath="" placeofdeath="">
<pre></pre>
</div>
<div title="Kathryn Margaret Sharman" modifier="YourName" created="200905082244" modified="200909282108" placeofdeath="" causeofdeath="" occupation="" placeofmarriage="" mother="Margaret Valerie Millett (Pegi) Robson" father="William Kenneth (Jack) Sharman" placeofbirth="" latitude="" longitude="" dob="1939" dod="1940" spouse="" dom="" changecount="3" sex="F">
<pre></pre>
</div>
<div title="Kay Bellwood" modifier="YourName" modified="200909271032" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Robin Bellwood" mother="Mary Sillitoe">
<pre></pre>
</div>
<div title="Keith Richard Herlock" modifier="YourName" created="200909131733" modified="200910032043" changecount="3" dom="" spouse="Kathryn Anne Hunter" father="" mother="" dod="" dob="" longitude="" latitude="" placeofbirth="" sex="M" placeofmarriage="" occupation="" causeofdeath="" placeofdeath="">
<pre></pre>
</div>
<div title="Lachtna King of Thomond" modifier="YourName" modified="200909282058" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Corc or Coreach King of Munster" mother="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Leonard Spearman OXX (1885-1945)" modifier="YourName" created="200909131628" modified="200909131632" changecount="3" dom="1913" spouse="Hilda &quot;Joy&quot; FRECKLETON" dod="1945" dob="1885" longitude="" latitude="" placeofbirth="" sex="M" mother="Annie E MOORE" father="James Spearman OXX (1854-1921)">
<pre>Three children..
Joan Spearman OXX (1917-)				
Evelyn Spearman OXX (1928-1996)				
Geoffrey Spearman OXX (1932-1953)</pre>
</div>
<div title="Lesley Ann Cartwright" modifier="YourName" created="200905082245" modified="200909261406" spouse="Alun Wynne Sharman" placeofbirth="" latitude="" longitude="" dob="1945" dod="" mother="" father="" dom="" changecount="2" sex="F" placeofmarriage="" occupation="" causeofdeath="" placeofdeath="">
<pre></pre>
</div>
<div title="Letitia WITHERS" modifier="YourName" modified="200909271147" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1307-00-00" spouse="John COKAYNE II (1307)" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre></pre>
</div>
<div title="Lettice DE KNIVETON" modifier="YourName" created="200909131515" modified="200909271153" placeofdeath="" causeofdeath="" occupation="" placeofmarriage="" spouse="John COKAYNE (1276)" sex="F" placeofbirth="" latitude="" longitude="" dob="1276" dod="" mother="" father="" dom="" changecount="2">
<pre></pre>
</div>
<div title="Lewis Wills" modifier="YourName" created="200905032201" modified="200909221718" placeofdeath="" causeofdeath="" occupation="" placeofmarriage="" dom="" sex="M" placeofbirth="" latitude="" longitude="" dob="1994-11-17" dod="0000-00-00" mother="Sharman Louise Robson" father="Peter William WILLS" spouse="" changecount="3">
<pre></pre>
</div>
<div title="ListOfMen" modifier="YourName" tags="excludeTree" server.type="file" server.host="file:///Users/Jon/Documents/TiddlyWiki/Trunk/contributors/JonRobson/verticals/FamilyTree/index.html" server.page.revision="200903090000">
<pre>&lt;&lt;familytreelist sex:M&gt;&gt;
</pre>
</div>
<div title="ListOfWomen" tags="excludeTree" server.type="file" server.host="file:///Users/Jon/Documents/TiddlyWiki/Trunk/contributors/JonRobson/verticals/FamilyTree/index.html" server.page.revision="200903090000">
<pre>&lt;&lt;familytreelist sex:F&gt;&gt;
</pre>
</div>
<div title="Lorcan or Liccon King of Thomond" modifier="YourName" modified="200909282059" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Lachtna King of Thomond" mother="" dom="" placeofmarriage="" changecount="2">
<pre></pre>
</div>
<div title="Lord Cullen" modifier="YourName" modified="200909252150" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1658-00-00" spouse="" sex="M" dod="1726-00-00" placeofbirth="Bishop Middleham" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre>Lord Cullen is an ancestor of this Robson family. He is somehow related to the Spearmans/ Oxx&quot;s.

	Link still to be confirmed.</pre>
</div>
<div title="Louisa Gayler" modifier="YourName" modified="200909252313" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1884-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Unknown Gayler" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre>Lived in Essex. Married in Chelmsford.

	Possibly related to this families:
	http://www.familysearch.org/Eng/search/frameset_search.asp?PAGE=ancestorsearchresults.asp http://www.familysearch.org/Eng/search/census/household_record.asp?HOUSEHOLD_CODE=1881BR_1807320&amp;HOUSEHOLD_SUB=1&amp;frompage=5
	http://www.familysearch.org/Eng/search/frameset_search.asp?PAGE=ancestorsearchresults.asp

	May have had older siblings unknown to us?</pre>
</div>
<div title="Lucas Hunter" modifier="YourName" created="200905032203" modified="200910021601" placeofbirth="" latitude="" longitude="" dob="" dod="" mother="" father="Anthony Hunter" spouse="" changecount="2" sex="M" placeofmarriage="" occupation="" causeofdeath="" placeofdeath="">
<pre></pre>
</div>
<div title="Lucy Child" modifier="YourName" modified="200909282116" mother="Janet Margaret Gartside" placeofdeath="" causeofdeath="" occupation="" placeofbirth="" dod="0000-00-00" sex="F" spouse="" dob="0000-00-00" server.type="file" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.page.revision="200903090000" latitude="" longitude="" father="Robert Child" dom="" placeofmarriage="" changecount="2">
<pre></pre>
</div>
<div title="Magdalen Towers" modifier="YourName" modified="200909271112" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Mahon (7th century)" modifier="YourName" modified="200909282057" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Turlogh Theodoras King of Munster" mother="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Mahon Manmay (King Mahon) King of Thomond" modifier="YourName" modified="200909240807" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="1369-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Mortogh King of Thomond" mother="">
<pre></pre>
</div>
<div title="MainMenu" modifier="YourName" created="200909230809" modified="200909252252" tags="excludeTree" dob="" placeofbirth="" latitude="" longitude="" mother="" father="" spouse="" dom="" placeofmarriage="" occupation="" dod="" causeofdeath="" placeofdeath="" changecount="2">
<pre>[[Explore]]</pre>
</div>
<div title="Margaret Cokayne" modifier="YourName" modified="200909271155" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1240-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Roger Cokayne" mother="Elizabeth COKAYNE">
<pre></pre>
</div>
<div title="Margaret Elizabeth Robson" modifier="YourName" modified="200909251528" changecount="3" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1873-01-11" spouse="" sex="F" dod="1878-12-31" placeofbirth="Darlington" occupation="" causeofdeath="" placeofdeath="Darlington" father="John George Robson (2)" mother="Martha Isabell Lyall">
<pre></pre>
</div>
<div title="Margaret Joan Duffy" modifier="YourName" modified="200909201444" mother="" placeofdeath="" causeofdeath="" occupation="" placeofbirth="Stoke-on-Trent" dod="1997-05-23" sex="F" spouse=",Frank Mallalieu Gartside" dob="1918-04-14" server.type="file" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.page.revision="200903090000" latitude="" longitude="" father="" dom="" placeofmarriage="" changecount="1">
<pre>Died at Hillingdon Hospital, North London.</pre>
</div>
<div title="Margaret Lady O BRIEN" modifier="YourName" modified="200909240755" changecount="3" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1624-00-00" spouse="" sex="F" dod="1681-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Henry (5th Earl of Thomond) O BRIEN" mother="Mary BRERETON">
<pre></pre>
</div>
<div title="Margaret Lyall" modifier="YourName" modified="200909221741" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1841-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="Cockfield, Durham" occupation="" causeofdeath="" placeofdeath="" father="Adam Lyall" mother="Isabella Jackson">
<pre>Father believed to be Adam Lyall.</pre>
</div>
<div title="Margaret O BRIEN" modifier="YourName" modified="200909240759" changecount="3" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Donough (4th Earl of Thomond) O Brien" mother="Helen / Ellen Roche">
<pre></pre>
</div>
<div title="Margaret O Brien" modifier="YourName" modified="200909240802" changecount="3" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Donough (2nd Earl of Thomond) O BRIEN" mother="Helen Butler">
<pre></pre>
</div>
<div title="Margaret PEARSON" modifier="YourName" modified="200909261033" changecount="3" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1675-00-00" spouse="Gilbert SPEARMAN" sex="F" dod="1731-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Robert PEARSON" mother="Mary COKAYNE (- 1682)">
<pre>Was involved in a law suit  concerning the estate of her deceased father Robert which he appeared to have won. (Please see [[Gilbert SPEARMAN]] for documentation).</pre>
</div>
<div title="Margaret Savage" modifier="YourName" modified="200909231736" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title="Margaret Theresa Bewick" modifier="YourName" modified="200909282105" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1937-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre></pre>
</div>
<div title="Margaret Valerie Millett (Pegi) Robson" modifier="YourName" modified="200909231712" changecount="2" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1910-00-00" spouse="William Kenneth (Jack) Sharman" sex="F" dod="1998-00-00" placeofbirth="Neath, Glamorganshire, Wales" occupation="" causeofdeath="" placeofdeath="" father="John George Robson" mother="Violet Evelyn Brew">
<pre></pre>
</div>
<div title="Maria Newton" modifier="YourName" modified="200909251533" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1864-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="Crudley, Worcestershire, England" occupation="" causeofdeath="" placeofdeath="" father="Unknown Newton" mother="">
<pre></pre>
</div>
<div title="Marjorie Isabell Robson" modifier="GUEST" created="200905082240" modified="200905082242" father="John George Robson" mother="Violet Evelyn Brew" spouse="William Brinley Thomas" sex="F" placeofbirth="" latitude="" longitude="" dob="1913" dod="X" dom="" changecount="1">
<pre></pre>
</div>
<div title="Martha COKAYNE (1605-1641)" modifier="YourName" created="200909131603" modified="200909271121" placeofdeath="" causeofdeath="" occupation="" placeofmarriage="" sex="F" changecount="5" dom="" spouse="Montagu Bertie 2nd Earl of Lindsey,John Ramsay 1st Earl of Holdernesse" dod="" dob="" longitude="" latitude="" placeofbirth="" mother="Mary MORRIS, Countess of Dover" father="Sir William Cokayne (Mayor)">
<pre>m. Ramsay, John, Earl of Holdernesse 1st
m. Bertie, Montagu, Earl of Lindsey 2nd 18/04/162</pre>
</div>
<div title="Martha Isabell Lyall" modifier="YourName" modified="200909221743" changecount="4" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1844-00-00" spouse="John George Robson (2)" sex="F" dod="1928-01-08" placeofbirth="Butterknowie, Durham, England" occupation="" causeofdeath="" placeofdeath="" father="Adam Lyall" mother="Isabella Jackson">
<pre>Father believed to be Adam Lyall.
Born 1844/1842 in Batterknowie, Durham, England. Mother Isabella LYALL (born 1809 Jarrow, Durham) and she is believed to have at least 2 siblings Margaret (born 1841 in Cockfield, Durham) and Elizabeth Ann (born 1845 Wingate, Durham).

Married John George Robson.
Seven known children: Isabel, Robert William, Adam Lyall, Margaret Elizabeth (died young aged 5), Matthew Jackson, Mary Elizabeth and John George Robson (Junior).

The 1881 Census has her dwelling in Mossby Cottage, Workington, Cumberland, aged 38 with husband John George Robson and 4 of her children. See John George Robson for more details.

Died around 1928.

(Source: 1881 Census)
	The 1881 Census has her dwelling in Mossby Cottage, Workington, Cumberland, aged 38 with husband John George Robson and 4 of her children.

	Buried at Port Talbot.


</pre>
</div>
<div title="Martha Robson" modifier="YourName" modified="200909271125" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1858-00-00" spouse="Robert Keel" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Joseph Robson" mother="Ann Foster">
<pre></pre>
</div>
<div title="Martha UNKNOWN" modifier="YourName" modified="200909221750" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title="Mary Alice Mallalieu" modifier="YourName" modified="200910032049" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1852-12-08" spouse=",Joseph Gartside" sex="F" dod="1917-01-31" placeofbirth="Runninghill Head, Denshaw, Saddleworth, York, England" occupation="" causeofdeath="" placeofdeath="" father="" mother="" placeofmarriage="" changecount="1">
<pre>Died at 96 Fitzroy Street, Ashton-u-Lyme and buried 5th February at St. Thomas, Friarmere</pre>
</div>
<div title="Mary BRERETON" modifier="YourName" modified="200909240756" changecount="2" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="" spouse="Henry (5th Earl of Thomond) O BRIEN" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title="Mary Buckley" modifier="YourName" modified="200909252230" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1750-00-00" spouse="" sex="F" dod="1802-08-12" placeofbirth="Crompton" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre>Died in 52nd year.

	Possibly married twice? Marriage 1 James WRIGLEY b: 11 Mar 1753 in Oldham - Married: 15 Sep 1772 in Oldham</pre>
</div>
<div title="Mary COKAYNE (- 1682)" modifier="YourName" created="200909131603" modified="200909261417" placeofdeath="" causeofdeath="" occupation="" placeofmarriage="" sex="F" changecount="4" dom="" spouse="Robert PEARSON" dod="1682-00-00" dob="1620-00-00" longitude="" latitude="" placeofbirth="" mother="Mary Lady O'BRIEN" father="Charles COKAYNE 1st Viscount Cullen (1602-1686)">
<pre>Details of marriage:
&quot;Charles was created Viscount Cullen in 1642 (fn. 231) and was in sole possession of the rectory in 1644, when his farmer was John Ward. (fn. 232) His son Brian, second viscount, (fn. 233) settled it in 1679 on the marriage of Mary, his daughter or sister, with Robert Peirson. &quot;
From: &quot;Parishes: Bishop Middleham&quot;, A History of the County of Durham: Volume 3 (1928), pp. 204-12. URL: http://www.british-history.ac.uk/report.asp?compid=42621. Date accessed: 07 August</pre>
</div>
<div title="Mary Catherine MATHERS" modifier="YourName" created="200909010923" modified="200909010924" spouse="George Spearman OXX" sex="F" placeofbirth="" latitude="" longitude="" dob="1819" dod="1870" mother="" father="" dom="" changecount="1">
<pre></pre>
</div>
<div title="Mary Dowthwaite" modifier="YourName" modified="200909252243" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1786-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="South Cowton, Yorkshire" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Mary Dyson" modifier="YourName" modified="200909252228" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1821-00-00" spouse="" sex="F" dod="1887-08-01" placeofbirth="Saddleworth" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre>surname Dyson may be incorrect.</pre>
</div>
<div title="Mary Elizabeth Robson" modifier="YourName" created="200905050822" modified="200909282108" placeofdeath="" causeofdeath="" occupation="" placeofmarriage="" dom="" placeofbirth="" latitude="" longitude="" dob="" dod="" mother="Martha Isabell Lyall" father="John George Robson (2)" spouse="" changecount="3" sex="F">
<pre></pre>
</div>
<div title="Mary Gartside" modifier="YourName" modified="200909240839" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John Gartside" mother="Mary Harrop">
<pre></pre>
</div>
<div title="Mary Harrop" modifier="YourName" modified="200909240841" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="1746-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre>Daughter of David Harrop of Bardsley.
	Buried 13 October 1746</pre>
</div>
<div title="Mary Holder Oxx" modifier="YourName" modified="200909261442" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1814-08-13" spouse="Robert Robson" sex="F" dod="1876-11-16" placeofbirth="" occupation="Dress maker (1842)" causeofdeath="" placeofdeath="" father="John Oxe" mother="Woodhouse Spearman" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre></pre>
</div>
<div title="Mary Jane Thomas" modifier="YourName" modified="200909282055" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1880-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="Carmarthen, Carmarthenshire, Wales" occupation="" causeofdeath="" placeofdeath="" father="" mother="" dom="" placeofmarriage="" changecount="1">
<pre>Daughter of John Thomas.</pre>
</div>
<div title="Mary Lady O'BRIEN" modifier="YourName" modified="200909261416" changecount="4" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Henry (5th Earl of Thomond) O BRIEN" mother="Margaret Savage">
<pre></pre>
</div>
<div title="Mary MORRIS, Countess of Dover" modifier="YourName" created="200909221707" modified="200909221707" placeofdeath="" causeofdeath="" dod="1649-01-00" occupation="" placeofmarriage="" dom="" spouse="" father="" mother="" longitude="" latitude="" placeofbirth="" dob="1573-05-10" sex="F" changecount="2">
<pre></pre>
</div>
<div title="Mary Sargison" modifier="YourName" modified="200909261410" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1811-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre></pre>
</div>
<div title="Mary Sillitoe" modifier="YourName" modified="200909271032" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title="Mary Taylor" modifier="YourName" modified="200909251552" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1766-00-00" spouse="" sex="F" dod="1831-08-31" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title="Mary UNKNOWN" modifier="YourName" modified="200909252236" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1806-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre>Unconfirmed.</pre>
</div>
<div title="Matthew Jackson" modifier="YourName" modified="200909221748" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="1847-09-20" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre>Death mentioned in a letter written by Robert Jackson.

	He seems to have sent money July 31st to Nov 31 1820 of £1 5 shillings - possibly for his son Robert?</pre>
</div>
<div title="Matthew Jackson (2)" modifier="YourName" modified="200909231727" changecount="3" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1811-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="Jarrow?" occupation="Unemployed? (1824)" causeofdeath="" placeofdeath="" father="Matthew Jackson" mother="Martha UNKNOWN">
<pre>In Sept 1824 his brother Robert in a letter says &quot;I hope you will put my brother Matthew to serve trade which a man in this country are nothing thought of without he has a trade&quot; this suggests to me that Matthew was unemployed.

	A Matthew Jackson appears in the 1861 census:
	Age: 50
	Estimated Birth Year: abt 1811
	Relation: Head
	Spouses&quot;s Name: Elizabeth
	Gender: Male
	Where born: Jarrow, Durham, England

	Civil parish: Willington
	Ecclesiastical parish: Howdon
	County/Island: Northumberland
	Country: England

	Street address:Willington Quay

	Occupation: Stone Mason
	Elizabeth Jackson 48
	Margaret Ann Jackson 16
	Mary Jane Jackson 12
	Matthew Jackson 50
	Matthew Jackson 9

	The occupation and place of birth sounds correct.</pre>
</div>
<div title="Matthew Jackson Lyall" modifier="YourName" modified="200909221745" changecount="2" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1833-00-00" spouse="" sex="M" dod="1918-12-08" placeofbirth="Wingate/Jarrow, Durham" occupation="Blacksmith (1851), Iron founder (1881-death)" causeofdeath="Hypostatic conjestion of lumps and senile decay" placeofdeath="11 Teresa Terrace, Coatham, Redcar" father="Adam Lyall" mother="Isabella Jackson">
<pre>In 1851:
	182 Wing Col Name Matthew LYALL Relationship So Condition U Age 18 Occupation blacksmith Birth place – DUR Piece 2392 Folio 153 Page – Place Easington District Easington Sub district Wingate County DUR Checked N

	In 1881 there is a Matthew Jackson Lyall an Iron Founder Master 40 Men Forge 50 Men 20 Boys Earthenware Manuf 48 Women lodging in 13 Hedworth Ter Bishopwearmouth, Durham, England with a family by the name of HUNTER:

	1. Name Thomas HUNTER Relationship Head Condition U Gender M Age 76 Occupation House Proprietor Birthplace Sunderland, Durham, England Address 13 Hedworth Ter, Bishopwearmouth, Durham, England PRO ref RG11/4997 Folio 62 Page 13 FHL film no. 1342202
	2. Name Mary HUNTER Relationship Widow Condition W Gender F Age 62 Occupation House Proprietor Birthplace Witton Gil...t, Durham, England Address 13 Hedworth Ter, Bishopwearmouth, Durham, England PRO ref RG11/4997 Folio 62 Page 13 FHL film no. 1342202
	3. Name Mary Jane HUNTER Relationship Daur Condition U Gender F Age 44 Occupation Shop Assistant Birthplace Sunderland, Durham, England Address 13 Hedworth Ter, Bishopwearmouth, Durham, England PRO ref RG11/4997 Folio 62 Page 13 FHL film no. 1342202
	4. Name Sarah HUNTER Relationship Daur Condition U Gender F Age 30 Occupation Teacher Of Music Birthplace Sunderland, Durham, England Address 13 Hedworth Ter, Bishopwearmouth, Durham, England PRO ref RG11/4997 Folio 62 Page 13 FHL film no. 1342202
	5. Name Joseph HUNTER Relationship Son Condition U Gender M Age 28 Occupation Mariner Birthplace Sunderland, Durham, England Address 13 Hedworth Ter, Bishopwearmouth, Durham, England PRO ref RG11/4997 Folio 62 Page 13 FHL film no. 1342202
	6. Name Ann HUNTER Relationship Daur Condition U Gender F Age 25 Occupation Seamstress Birthplace Sunderland, Durham, England Address 13 Hedworth Ter, Bishopwearmouth, Durham, England PRO ref RG11/4997 Folio 62 Page 13 FHL film no. 1342202
	7. Name Catherine HUNTER Relationship Daur Condition – Gender F Age 23 Occupation Shop Assistant Birthplace Sunderland, Durham, England Address 13 Hedworth Ter, Bishopwearmouth, Durham, England PRO ref RG11/4997 Folio 62 Page 13 FHL film no. 1342202
	8. Name Louisa HUNTER Relationship Daur Condition – Gender F Age 20 Occupation Milliner Birthplace Sunderland, Durham, England Address 13 Hedworth Ter, Bishopwearmouth, Durham, England PRO ref RG11/4997 Folio 62 Page 13 FHL film no. 1342202
	9. Name Elizabeth Moor HUNTER Relationship Daur Condition – Gender F Age 19 Occupation Shop Assistant Birthplace Sunderland, Durham, England Address 13 Hedworth Ter, Bishopwearmouth, Durham, England PRO ref RG11/4997 Folio 62 Page 13 FHL film no. 1342202

	He is unmarried and is said to have been born in Jarrow. This is likely to be the same one.

	In his life a John Brewis, solicitor, caused many problems for him regarding a sum of £350. The dispute is outlined in several letters still in possession in the family, which I am planning to transcribe and put on this website.

	A death certificate shows a Mathew Jackson Lyall died at 11 Teresa Terrace, Coatham, Redcar. He was an Iron founder and died of Hypostatic conjestion of lumps and senile decay. Interestingly, this is the house he was brought up in and he must have returned to it.

	Isabel Newton his neice was present at the death. She lived at 6 Gill Crescent, Risca, Monmouthshire.</pre>
</div>
<div title="Matthew Jackson Robson" modifier="YourName" modified="200909271135" changecount="6" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1878-00-00" spouse="Jessica (Jessie) Rees" sex="M" dod="0000-00-00" placeofbirth="Middlesborough, Yorkshire" occupation="Roll Turner in the steel industry (1901)" causeofdeath="" placeofdeath="" father="John George Robson (2)" mother="Martha Isabell Lyall">
<pre>The 1881 Census has him dwelling in Mossby Cottage, Workington, Cumberland, aged 3 with 3 siblings, mother and father.

	In 1901 he is living with his brother Robert William at Culla House as boarders to the owners David Llond (born 1853 Pembrey, Carmathenshire Wales) and Mary Jane Llond (born 1858 Pembrey, Carmarthenshire, Wales).</pre>
</div>
<div title="Matthew Wills" modifier="YourName" created="200905032201" modified="200909221718" placeofdeath="" causeofdeath="" occupation="" placeofmarriage="" dom="" sex="M" placeofbirth="" latitude="" longitude="" dob="1991-05-28" dod="" mother="Sharman Louise Robson" father="Peter William WILLS" spouse="" changecount="3">
<pre></pre>
</div>
<div title="Maud DE OLDERNEY" modifier="YourName" created="200909131512" modified="200909261507" changecount="2" dom="" father="" mother="" dod="" dob="" longitude="" latitude="" placeofbirth="" spouse="John COKAYNE" sex="F" placeofmarriage="" occupation="" causeofdeath="" placeofdeath="">
<pre></pre>
</div>
<div title="Maxwell Oxx" modifier="YourName" modified="200909261439" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1823-10-09" spouse="John Blackbird Bone" sex="F" dod="1875-06-00" placeofbirth="Newcastle,Upon Tyne, , Northumberland, England" occupation="" causeofdeath="" placeofdeath="" father="John Oxe" mother="Woodhouse Spearman" latitude="" longitude="" dom="" placeofmarriage="" changecount="4">
<pre></pre>
</div>
<div title="May Bagg" modifier="YourName" modified="200909231726" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John David Bagg" mother="Katherine Anne UNKNOWN" latitude="" longitude="" dom="" placeofmarriage="" changecount="3">
<pre></pre>
</div>
<div title="May Bulmer" modifier="YourName" modified="200909230802" mother="Hannah Mary Augusta Robson" placeofdeath="" causeofdeath="" occupation="Knitting Machinist (1901)" placeofbirth="Darlington, Durham" dod="0000-00-00" sex="F" spouse="" dob="1884-00-00" server.type="file" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.page.revision="200903090000" latitude="" longitude="" father="James Bulmer" dom="" placeofmarriage="" changecount="4">
<pre></pre>
</div>
<div title="Mervin Bagg" modifier="YourName" modified="200909231726" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John David Bagg" mother="Katherine Anne UNKNOWN" latitude="" longitude="" dom="" placeofmarriage="" changecount="3">
<pre></pre>
</div>
<div title="Michael Hunter" modifier="YourName" created="200905041400" modified="200910021602" placeofbirth="" latitude="" longitude="" dob="" dod="" mother="" father="Richard Hunter" spouse="" changecount="2" sex="M" placeofmarriage="" occupation="" causeofdeath="" placeofdeath="">
<pre></pre>
</div>
<div title="Michael J WILFORD" modifier="YourName" modified="200909271115" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="Angela Spearman Oxx" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Modhchorb" modifier="YourName" created="200909282053" modified="200909282053" dob="" placeofbirth="" spouse="" dom="" placeofmarriage="" occupation="" dod="" causeofdeath="" placeofdeath="" changecount="2">
<pre></pre>
</div>
<div title="Montagu Bertie 2nd Earl of Lindsey" modifier="YourName" modified="200909271120" changecount="2" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="Martha COKAYNE (1605-1641)" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title="More/Maud O BRIEN" modifier="YourName" modified="200909240803" changecount="3" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Donough (2nd Earl of Thomond) O BRIEN" mother="Helen Butler">
<pre></pre>
</div>
<div title="Mortogh King of Thomond" modifier="YourName" modified="200909240807" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="1343-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Turlough King of Thomond" mother="">
<pre></pre>
</div>
<div title="Natasha Bellwood" modifier="YourName" modified="200909271033" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="David Bellwood" mother="Alison Hook">
<pre></pre>
</div>
<div title="NiceTaggingPlugin" created="200910020940" tags="systemConfig" server.type="file" server.host="file:///Users/Jon/Documents/TiddlyWiki/Trunk/contributors/JonRobson/verticals/FamilyTree/index.html" server.page.revision="200910020940">
<pre>/***
|''Name:''| NiceTaggingPlugin|
|''Description:''| creates a nicer interface for adding and removing TiddlyWiki. Ideal for tiddly novices. |
|''Version:''|0.5|
|''Date:''|8 September 2009|
|''Source:''|http://www.jonrobson.me.uk/development/niceTagging|
|''Author:''|Jon Robson|
|''License:''|[[BSD open source license]]|
|''CoreVersion:''|2.3|
|''Dependencies:''|AdvancedEditTemplatePlugin|
***/

if(store){
  config.shadowTiddlers.NiceTaggingStyle = &quot;/*{{{*/\n&quot; +
  &quot;.tip {font-style:italic;font-weight:bold;}\n&quot;+
  &quot;.dp-popup {position:absolute;background-color:white;} a.dp-choose-date {	float: left;	width: 16px;	height: 16px;	padding: 0;	margin: 5px 3px 0;	display: block;	text-indent: -2000px;	overflow: hidden;	background: url(calendar.png) no-repeat; }a.dp-choose-date.dp-disabled {	background-position: 0 -20px;	cursor: default;}input.dp-applied {	width: 140px;	float: left;}\n&quot;+
  &quot;.niceTagger input {width:200px; float:left;}\n&quot;+
  &quot;.deleter {color:red; font-weight:bold; padding:2px; cursor:pointer;}\n&quot;+
  &quot;/*}}}*/&quot;;
store.addNotification(&quot;NiceTaggingStyle&quot;, refreshStyles);
}


config.macros.niceTagger = {
	lingo:{
		add: &quot;add&quot;
	}
    ,saveTags: function(title,tags){
		var tiddler =  store.getTiddler(title);
		if(!tiddler) {
			store.saveTiddler(title,title,null,true,null,tags,config.defaultCustomFields,null);
			tiddler =  store.getTiddler(title);
		}
		store.setValue(tiddler,&quot;tags&quot;,tags);
    }
    ,refreshTagDisplay: function(place,tiddler){
        jQuery(place).html(&quot;&quot;);
        var tags = tiddler.tags;
        for(var t=0; t &lt; tags.length; t++){
            var tag = tags[t];
            jQuery(place).append(&quot; &lt;span class='tag'&gt;&quot;+tag+&quot;&lt;/span&gt; &lt;span class='deleter' deletes='&quot;+escape(tag)+&quot;'&gt;x&lt;/span&gt;&quot;);
        }
        
        jQuery(&quot;.deleter&quot;,place).click(function(e){
            var todelete = jQuery(this).attr(&quot;deletes&quot;);
            var newtags = [];
            for(var i=0; i &lt; tags.length; i++){
                if(escape(tags[i]) != todelete){
                   newtags.push(tags[i]);
                }
            }
            tiddler.tags = newtags;
            config.macros.niceTagger.saveTags(tiddler.title,tiddler.tags);
            
            config.macros.niceTagger.refreshTagDisplay(place,tiddler);
        });
    }
    ,handler: function(place,macroName,paramlist,wikifier,paramString,tiddler){
        var displayer = document.createElement(&quot;div&quot;);
        displayer.className = &quot;niceTagger&quot;;
        place.appendChild(displayer);
        config.macros.niceTagger.refreshTagDisplay(displayer,tiddler);
        var tagplace = document.createElement(&quot;div&quot;);

        place.appendChild(tagplace);
        var saveNewTag= function(value){
          if(value.replace(&quot; &quot;,&quot;&quot;).length == 0) return;
		  if(tiddler.tags.indexOf(value) != -1) return;
            tiddler.tags.push(value);
            config.macros.niceTagger.refreshTagDisplay(displayer,tiddler);
            adder.value = &quot;&quot;;
            config.macros.niceTagger.saveTags(tiddler.title,tiddler.tags);
        };
        var adder;
        if(config.macros.AdvancedEditTemplate){
            //config.macros.AdvancedEditTemplate.handler(tagplace,null,null,null,&quot;aet type:search metaDataName:assignby valuesSource:Suggestions&quot;);
             var params = paramString.parseParams(&quot;anon&quot;,null,true,false,false);
			 var textcase = getParam(params,&quot;case&quot;);
            var srcTiddler = getParam(params,&quot;valuesSource&quot;);
            var suggestions = [];
            if(srcTiddler){
                var text = store.getTiddler(srcTiddler).text;
                var tempdiv = document.createElement(&quot;div&quot;);
                wikify(text,tempdiv);
                suggestions = jQuery(tempdiv).html().split(&quot;&lt;br&gt;&quot;);
            }
            if(textcase &amp;&amp; textcase == &quot;lower&quot;){
              for(var i=0; i &lt; suggestions.length;i++){
                suggestions[i] =suggestions[i].toLowerCase();
              }
            }
		var tagsoff = getParam(params,&quot;nostoretags&quot;);
		if(!tagsoff) suggestions = suggestions.concat(config.macros.niceTagger.twtags);
		
		
		var uniqueSuggestions = [];
		for(var i=0; i &lt; suggestions.length; i++){
			var s =suggestions[i];
			//rtrim then ltrim
			s = s.replace(new RegExp(&quot;[\\s]+$&quot;, &quot;g&quot;), &quot;&quot;).replace(new RegExp(&quot;^[\\s]+&quot;, &quot;g&quot;), &quot;&quot;);
			//console.log(uniqueSuggestions.toString(),s,uniqueSuggestions.indexOf(s));
				if(uniqueSuggestions.indexOf(s) ==-1){
					uniqueSuggestions.push(s);
				}
		}
		//console.log(uniqueSuggestions);
           config.macros.AdvancedEditTemplate.createSearchBox(tagplace,&quot;tags&quot;,uniqueSuggestions,&quot;&quot;,function(v){saveNewTag(v);jQuery(&quot;input&quot;,tagplace).val(&quot;&quot;);})
           adder = jQuery(&quot;input&quot;,tagplace)[0];
			
		
        }
        else{
            adder = document.createElement(&quot;input&quot;);

            tagplace.appendChild(adder);
            
        }
		jQuery(adder).keypress(function (e) {
			if(e.which == 13){
				var results = jQuery(&quot;.ac_over&quot;,&quot;.ac_results&quot;); //is anything highlighted in autocomplete plugin
				if(results.length ==0)
		
					saveNewTag(adder.value);
			}
		});
        var addbutton = document.createElement(&quot;button&quot;);
        addbutton.innerHTML = config.macros.niceTagger.lingo.add;
		addbutton.className = &quot;adder&quot;;
        tagplace.appendChild(addbutton);
        

        jQuery(addbutton).click(function(e){
            var val = adder.value;
            saveNewTag(val);
        });
        
        
        
    },
	twtags:[]
    
};

var x= store.getTiddlers();
for(var i=0; i &lt; x.length; i ++){
	var y = x[i].tags;
	config.macros.niceTagger.twtags = config.macros.niceTagger.twtags.concat(y);
};
</pre>
</div>
<div title="Nicholas Blackman" modifier="YourName" modified="200909282108" changecount="4" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="David Edward BLACKMAN" mother="Christine Lyall Thomas">
<pre></pre>
</div>
<div title="Nicholas Hunter" modifier="YourName" created="200905032205" modified="200910021602" dom="" placeofbirth="" latitude="" longitude="" dob="" dod="" mother="Carmen Aquilina Hunter" father="Richard Hunter" spouse="" changecount="3" sex="M" placeofmarriage="" occupation="" causeofdeath="" placeofdeath="">
<pre></pre>
</div>
<div title="Noreen UNKNOWN" modifier="YourName" modified="200909282118" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="Tony Parsons" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="Gladys Newton" dom="" placeofmarriage="" changecount="2">
<pre></pre>
</div>
<div title="Norman Robson Bellwood" modifier="YourName" modified="200909261418" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1912-00-00" spouse="" sex="" dod="1973-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Charles Robson Bellwood" mother="Emma Binns" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Olive Llewellyn" modifier="YourName" modified="200909261506" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1919-00-00" spouse="Edmund Bentley (1)" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre></pre>
</div>
<div title="Oliver Child" modifier="YourName" modified="200909282115" mother="Janet Margaret Gartside" placeofdeath="" causeofdeath="" occupation="" placeofbirth="" dod="0000-00-00" sex="M" spouse="" dob="0000-00-00" server.type="file" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.page.revision="200903090000" latitude="" longitude="" father="Robert Child" dom="" placeofmarriage="" changecount="3">
<pre></pre>
</div>
<div title="OptionsPanel" tags="excludeTree" server.type="file" server.host="file:///Users/Jon/Documents/TiddlyWiki/Trunk/contributors/JonRobson/verticals/FamilyTree/index.html" server.page.revision="200903090000">
<pre>These options for customising your family tree are saved in your browser.

&lt;&lt;option chkSaveBackups&gt;&gt; [[SaveBackups]]
&lt;&lt;option chkAutoSave&gt;&gt; [[AutoSave]]

</pre>
</div>
<div title="PageTemplate" modifier="YourName" tags="excludeTree excludeLists" server.type="file" server.host="file:///Users/Jon/Documents/TiddlyWiki/Trunk/contributors/JonRobson/verticals/FamilyTree/index.html" server.page.revision="200903090000">
<pre>&lt;!--{{{--&gt;
&lt;div class='ftTitle' refresh='content' force='true' tiddler='SiteTitle'&gt;&lt;/div&gt;
&lt;div class='ftSubTitle' refresh='content' force='true' tiddler='SiteSubtitle'&gt;&lt;/div&gt;
&lt;div macro=&quot;FamilyTree&quot;&gt;

&lt;/div&gt;

&lt;div class='ftContainer'&gt;
	&lt;div id='topToolbar' tiddler='topToolbar' refresh='content'&gt;&lt;/div&gt;
	&lt;div id='sidebar'&gt;
		&lt;div id='sidebarOptions' refresh='content' tiddler='SideBarOptions'&gt;&lt;/div&gt;
		&lt;div id='sidebarTabs' refresh='content' force='true' tiddler='SideBarTabs'&gt;&lt;/div&gt;
	&lt;/div&gt;
	
	&lt;div id='displayArea'&gt;
		&lt;div class='ftHideCorner'&gt;&lt;/div&gt;
		&lt;div id='messageArea'&gt;&lt;/div&gt;
		&lt;div id='tiddlerDisplay'&gt;&lt;/div&gt;
		
	&lt;/div&gt;

&lt;/div&gt;
&lt;!--}}}--&gt;
</pre>
</div>
<div title="Paul Newton Wilford" modifier="YourName" modified="200909282050" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1966-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Michael J WILFORD" mother="Angela Spearman Oxx" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Peter Bellwood" modifier="YourName" modified="200909271032" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John Bellwood 1942" mother="Helen URQUART">
<pre></pre>
</div>
<div title="Peter William WILLS" modifier="YourName" created="200905032148" modified="200909221718" changecount="1" placeofdeath="" causeofdeath="" dod="" occupation="" placeofmarriage="" dom="" spouse="" father="" mother="" longitude="" latitude="" placeofbirth="" dob="1957-05-28" sex="M" vismoxy="300,315.7894736842106">
<pre></pre>
</div>
<div title="Phillip Bentley" modifier="YourName" modified="200909221733" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Edmund Bentley (1)" mother="Olive Llewellyn" latitude="" longitude="" dom="" placeofmarriage="" changecount="3">
<pre></pre>
</div>
<div title="Rachel Prickett" modifier="YourName" modified="200909252138" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1788-00-00" spouse="" sex="F" dod="1861-10-11" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Raghnailt Macnamara" modifier="YourName" modified="200909240803" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title="Rebecca Sarah Robson" modifier="YourName" modified="200909282107" mother="Kathryn Anne Hunter" father="Andrew Lyall Robson" placeofbirth="" latitude="" longitude="" dob="" dod="" spouse="" changecount="2" sex="F" dom="" placeofmarriage="" occupation="" causeofdeath="" placeofdeath="">
<pre></pre>
</div>
<div title="Reginald COKAYNE" modifier="YourName" created="200909131539" modified="200909131539" father="Sir John COKAYNE (-1447)" mother="Isabel SHIRLEY" placeofbirth="" latitude="" longitude="" dob="" dod="" spouse="" dom="" changecount="1">
<pre></pre>
</div>
<div title="Richard Bellwood 1784" modifier="YourName" modified="200909252243" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1784-00-00" spouse="" sex="M" dod="1862-00-00" placeofbirth="Heighington, Durham" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Richard Bellwood 1809" modifier="YourName" modified="200909252242" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1809-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="Heighington" occupation="" causeofdeath="" placeofdeath="" father="Richard Bellwood 1784" mother="Mary Dowthwaite" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre>Richard died young leaving his wife with a large family to bring up. Birth date is only a guess</pre>
</div>
<div title="Richard Brew 1859" modifier="YourName" modified="200909252233" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1859-08-02" spouse="" sex="M" dod="1930-07-30" placeofbirth="Moreyborough, Pembrokeshire, Wales" occupation="Railway related (See attachment)" causeofdeath="" placeofdeath="Llanwnda, Carnarvonshire, Wales" father="George Brew 1826" mother="Jane Margaret Morgan" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre>Died 30th July 1930 in Llanwnda, Carnarvonshire, Wales.

	Richard worked on the railway at various stations.
	Swansea in 1877; Neath &quot;79 &quot;87, &quot;89 &amp; &quot;94; Penzance &quot;85; Glyn Neath &quot;92 and Duffryn Yard &quot;98.

	He seemed to be a bit of a trouble maker, receiving many fines and cautions! He also received several injuries from his work from sprained ankle to his middle finger being amputated in January 1914.</pre>
</div>
<div title="Richard Cokayne" modifier="YourName" modified="200909271156" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1240-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Roger Cokayne" mother="Elizabeth COKAYNE">
<pre></pre>
</div>
<div title="Richard Hunter" modifier="YourName" created="200905032200" modified="200909251543" placeofdeath="" causeofdeath="" occupation="" placeofmarriage="" sex="M" changecount="3" dom="" placeofbirth="Leicester" latitude="" longitude="" dob="1969-04-27" dod="" mother="Freda Gartside" father="Herbert Hunter" spouse="" vismoxy="400,-932">
<pre></pre>
</div>
<div title="Robert Amos Robson" modifier="YourName" created="200905050816" modified="200909221711" placeofdeath="Sheffield?" causeofdeath="" occupation="" placeofmarriage="" dom="" placeofbirth="" latitude="" longitude="" dob="1851-09-07" dod="" mother="Mary Holder Oxx" father="Robert Robson" spouse="" changecount="3">
<pre>Did he marry? A census record shows Robert (Coke Drawer) born 1851 married to Elizabeth with childrne Mary Ellen, Martha Ann? It would seem strange he didn&quot;t use his middle name if he had one. This also gos on the premise that Robert Robson had a sibling Sarah Jane (born 1858) which he didn&quot;t</pre>
</div>
<div title="Robert Child" modifier="YourName" modified="200909261506" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="Janet Margaret Gartside" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre></pre>
</div>
<div title="Robert Cokayne" modifier="YourName" created="200909131537" modified="200909131537" father="Sir Edmund COKAYNE" mother="Elizabeth de HERTHULL" placeofbirth="" latitude="" longitude="" dob="" dod="" spouse="" dom="" changecount="1">
<pre></pre>
</div>
<div title="Robert Foster Robson" modifier="YourName" modified="200909271034" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1848-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="Stockport Lancashire" occupation="" causeofdeath="" placeofdeath="" father="Joseph Robson" mother="Ann Foster">
<pre>1851 census shows him living in Middlesbrough with his father, mother, and 2 brothers Joseph and George.
	Later in the 1881 census he is living in Swindon at No 13 William St - 2 doors down from his father with his 3 children Jane Elizabeth and Florence and wife.</pre>
</div>
<div title="Robert Foster? Robson" modifier="YourName" modified="200909271035" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1884-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Robert Foster Robson" mother="Elizabeth Rowe">
<pre></pre>
</div>
<div title="Robert H Broome" modifier="YourName" modified="200909271123" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="Sonia Spearman OXX" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre></pre>
</div>
<div title="Robert Jackson" modifier="YourName" modified="200909221948" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="William Jackson" mother="French woman UNKNOWN" latitude="" longitude="" dom="" placeofmarriage="" changecount="3">
<pre></pre>
</div>
<div title="Robert John ANDERSON" modifier="YourName" modified="200909271128" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1938-00-00" spouse="Christine Lyall Thomas" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Robert Keel" modifier="YourName" modified="200909271126" changecount="2" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1858-00-00" spouse="Martha Robson" sex="M" dod="0000-00-00" placeofbirth="New Swindon, Wiltshire" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title="Robert Morgan Brew" modifier="YourName" modified="200909261502" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1852-06-27" spouse="" sex="M" dod="1888-03-06" placeofbirth="Chepstow,Monmouthshire,Wales" occupation="" causeofdeath="" placeofdeath="" father="George Brew 1826" mother="Jane Margaret Morgan" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre>The 1881 Census shows Robert, 28, born Chepstow, a Railway Engineer, resident in Bristol, Gloucestershire, England, with his wife Esther, 29, born Carmarthen, and their three children, Frederick Charles, 6, a scholar, born in Bristol, Sarah Jane, 4, born in Wells, Somerset, and George William, 11 months old, born Bristol. 

	1888 Death in the Registration District of Barton Regis in the City and County of Bristol

	6 March 1888, 13 Edward Street, Robert Morgan Brew, male, 36 years, Railway Engine Driver, cause of death: pneumonia, informant: E. Brew, widow of deceased, present at death, 13 Edward Street, Bristol, Arthur Hunt, Registrar.
	</pre>
</div>
<div title="Robert PEARSON" modifier="YourName" created="200909131604" modified="200909261034" placeofdeath="" causeofdeath="" occupation="" placeofmarriage="" sex="M" changecount="6" dom="" spouse="Mary COKAYNE (- 1682)" father="" mother="" dod="1703-10-29(before)" dob="1620-00-00" longitude="" latitude="" placeofbirth="">
<pre>Died before 29 October 1703, as a lawsuit was filed over property of his land on this date.

Married Mary Cokayne
One known child: Margaret

Owned an estate which was obviously of some importance, since it was the topic of a lawsuit filed by his son-in-law Gilbert Spearman.</pre>
</div>
<div title="Robert Rees" modifier="YourName" modified="200909271126" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1850-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title="Robert Robson" modifier="YourName" modified="200909282124" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1820-01-07" spouse="" sex="M" dod="1884-06-00" placeofbirth="Plessey, Northumberland, England" occupation="Roll Turner (1841,1851) Mechanic at Engine Works (1881)" causeofdeath="" placeofdeath="Darlington" father="John Robson" mother="Jane UNKNOWN" latitude="" longitude="" dom="" placeofmarriage="" changecount="3">
<pre>Born 1820 in Plessey[1], Newcastle, Northumberland, England. Plessey being an area of Stannington.
	There is a conflicting birth date of 15th May 1820 on familysearch. But I think this is possibly incorrect as this was the date he married. The birth date given (of January 7th) was found on family tree passed down.

	Married Mary Holder Oxx 15th May 1842. The marriage is registered as being in Newcastle on Tyne district, Northumberland. The church married at is All Saints Church (built: 1786-96). Both Mary and Robert were in residence at Saint Anthony at time of marriage. It was witnessed by Ralph John Wilkinson and Jos. Peason/Pearson.

	Within the period of 1847-1850 he went to Nassau, Germany where he had his child Hannah Mary. The reason for this is unknown.
	In 1851 census he is shown to be living with wife Mary and children John George, William Isaac, Harriet Jane and Hannah Mary. Cooincidentally (??) he is living next door to another Robson - Joseph. He is living in Middlesbrough.

	In 1854 his registered address was Rostock Terrace, Middlesbrough.

	In 1877 he was living at 43 Guerney Street Darlington

	His daughter Frances birth and marriage certificates have Robert Robson working as a Roll Turner.

	The 1881 census has him as a 61 year old widow living with his daughter Hannah (now Bulmer) and her husband James at 40 Henry St, Darlington and 2 grandchildren working as a mechanic at engine works.

	His exact death is unknown, however, it is possible he died in Darlington in June 1884, aged 64.

	Sources:
	[1] 1851 census</pre>
</div>
<div title="Robert William Robson" modifier="GUEST" created="200905050817" placeofbirth="" latitude="" longitude="" dob="" dod="" mother="" father="John George Robson (2)" spouse="" vismoxy="600,126.6666666666667">
<pre>Type the text for 'New Tiddler'</pre>
</div>
<div title="Robin Bellwood" modifier="YourName" modified="200909271031" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1937-00-00" spouse="" sex="" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Norman Robson Bellwood" mother="Freda Thompson">
<pre></pre>
</div>
<div title="Roger COKAYNE" modifier="YourName" modified="200909271138" changecount="2" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="William Cokayne Snr" mother="">
<pre></pre>
</div>
<div title="Roger Cokayne" modifier="YourName" modified="200909271047" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1220-00-00" spouse="" sex="M" dod="1284-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="William COKAYNE (II)" mother="Alice Botham">
<pre></pre>
</div>
<div title="Roger Cokayne (314)" modifier="YourName" modified="200909271044" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1264-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="William COKAYNE 1244" mother=" Sarah MERCATON (241)">
<pre>Married an Elizabeth</pre>
</div>
<div title="Roger Cokayne (III)" modifier="YourName" created="200909131540" modified="200909131540" father="Sir John COKAYNE (-1447)" mother="Isabel SHIRLEY" placeofbirth="" latitude="" longitude="" dob="" dod="" spouse="" dom="" changecount="1">
<pre></pre>
</div>
<div title="Roger Hurt" modifier="YourName" modified="200909271136" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="Edith Cokayne" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title="Ronald Spearman OXX (1915-1926)" modifier="YourName" created="200909131629" modified="200909131629" sex="M" changecount="2" dom="" spouse="" dod="1926" dob="1915" longitude="" latitude="" placeofbirth="" mother="Annie E MOORE" father="James Spearman OXX (1854-1921)">
<pre></pre>
</div>
<div title="Rosalind Bellwood" modifier="YourName" modified="200909271032" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Robin Bellwood" mother="Mary Sillitoe">
<pre></pre>
</div>
<div title="Ruby Eleanor King" modifier="YourName" modified="200909230752" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1993-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="David King" mother="Julia Hunter">
<pre></pre>
</div>
<div title="Ruth Angharad Douglass" modifier="YourName" modified="200909261031" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Andrew William Rowe Douglass" mother="Ceri Elizabeth Sharman" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Ruth Roberts" modifier="YourName" modified="200909252229" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1794-03-04" spouse="" sex="F" dod="0000-00-00" placeofbirth="Holmfirth" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre>Baptised 28 March 1794 at Lane Ind., Holmfirth</pre>
</div>
<div title="Sarah BELLWOOD" modifier="YourName" modified="200909240836" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John Bellwood 1942" mother="Helen URQUART">
<pre></pre>
</div>
<div title="Sarah Brew" modifier="YourName" modified="200909252140" changecount="3" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1823-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John Brew 1790" mother="Rachel Prickett">
<pre>Married 18 November 1844</pre>
</div>
<div title="Sarah Brew 1829" modifier="YourName" modified="200909252223" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1829-08-09" spouse="" sex="F" dod="1833-03-04" placeofbirth="Chepstow,Monmouthshire,Wales" occupation="" causeofdeath="" placeofdeath="" father="Thomas Brew 1791" mother="Honor Perry" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre></pre>
</div>
<div title="Sarah Brew 1834" modifier="YourName" modified="200909252232" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1834-05-10" spouse="" sex="F" dod="1903-03-26" placeofbirth="Chepstow,Monmouthshire,Wales" occupation="" causeofdeath="" placeofdeath="" father="Thomas Brew 1791" mother="Honor Perry" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre>christened 1 June 1834, and died 26 March 1903 

	Sarah married Thomas Godfrey, a soldier, in Aldershot, Hampshire, on 26 February 1861. Thomas was born in Southam, Warwickshire, on 14 August 1834 to William Godfrey and Sarah Wells.

	Thomas left the army in 1873. They became missionaries of the Church of Latter Day Saints and emigrated to the United States. Sarah died in Fairview, Lincoln, Wyoming, U.S.A. on 26 March 1903, and Thomas predeceased her in Acapules, Mexico, on 29 July 1902.

	Sarah and Thomas had eight children. Sarah gave birth to their first two children in England, after which they moved to Ireland, where the next two children were born, and then on to Scotland, where a further two were born, before their emigration to the United States, where the last two children were born.</pre>
</div>
<div title="Sarah Cokayne" modifier="YourName" modified="200909271155" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1240-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Roger Cokayne" mother="Elizabeth COKAYNE">
<pre></pre>
</div>
<div title="Sarah FITZALDECINDERH" modifier="YourName" modified="200909271159" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title="Sarah MERCATON" modifier="YourName" created="200909131513" modified="200909261505" changecount="2" dom="" father="" mother="" dod="" dob="" longitude="" latitude="" placeofbirth="" spouse="William COKAYNE" sex="F" placeofmarriage="" occupation="" causeofdeath="" placeofdeath="">
<pre></pre>
</div>
<div title="Sarah UNKNOWN" modifier="YourName" modified="200909221705" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title="Sharman Louise Robson" modifier="YourName" modified="200909282107" mother="Joan Bagg" father="Ian Lyall Robson" placeofbirth="" latitude="" longitude="" dob="" dod="" spouse="" changecount="2" sex="F" dom="" placeofmarriage="" occupation="" causeofdeath="" placeofdeath="">
<pre></pre>
</div>
<div title="Shelby Hunter" modifier="GUEST" created="200905032204" placeofbirth="" latitude="" longitude="" dob="" dod="" mother="Carmen Aquilina Hunter" father="Richard Hunter" spouse="" changecount="1">
<pre>Type the text for 'New Tiddler'</pre>
</div>
<div title="SideBarOptions" tags="excludeTree" server.type="file" server.host="file:///Users/Jon/Documents/TiddlyWiki/Trunk/contributors/JonRobson/verticals/FamilyTree/index.html" server.page.revision="200903090000">
<pre>&lt;&lt;search&gt;&gt;&lt;&lt;slider chkSliderOptionsPanel OptionsPanel &quot;options »&quot; &quot;Change TiddlyWiki advanced options&quot;&gt;&gt;

</pre>
</div>
<div title="Simon Blackman" modifier="YourName" modified="200909282108" changecount="3" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="David Edward BLACKMAN" mother="Christine Lyall Thomas">
<pre></pre>
</div>
<div title="Sir Edmund COKAYNE" modifier="YourName" created="200909131523" modified="200909131528" changecount="2" dom="" spouse="Elizabeth de HERTHULL" dod="1403" dob="" longitude="" latitude="" placeofbirth="" sex="M" mother="Cecilia VERNON" father="Sir John COKAYNE">
<pre>Was slain at the Battle of Shrewsbury, Shropshire, on July 21st, 1403, and he was buried at Ashbourne, Derbyshire. He married Elizabeth de Herthull, who was the daughter and heiress of Sir Richard de Herthull. Elizabeth de Herthull married second John Franceys. Edmund Cokayne and Elizabeth de Herthull had five known children.

Sir Edmund Cokayne was of Ashbourne, Derbyshire, and Pooley, Warwickshire.</pre>
</div>
<div title="Sir John COKAYNE" modifier="YourName" created="200909131522" modified="200909131522" changecount="1" dom="" spouse="Cecilia VERNON" dod="1369" dob="1325" longitude="" latitude="" placeofbirth="" sex="M" mother="Letitia WITHERS" father="John COKAYNE II (1307)">
<pre></pre>
</div>
<div title="Sir John COKAYNE (-1447)" modifier="YourName" created="200909131538" modified="200909271143" father="Sir Edmund COKAYNE" mother="Elizabeth de HERTHULL" placeofbirth="" latitude="" longitude="" dob="1370-00-00" dod="1447" spouse="Isabel SHIRLEY" dom="" changecount="5" sex="M" placeofmarriage="" occupation="" causeofdeath="" placeofdeath="">
<pre>Sir John Cokayne was of Ashbourne, Derbyshire, and Pooley, Warwickshire. He was a Commissioner of Assay, and an M.P. for Derbyshire.</pre>
</div>
<div title="Sir Ralph SHIRLEY" modifier="YourName" modified="200909271130" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="Alice Cokayne" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Sir William (Lord Mayor of London 1619) COKAYNE (130)" modifier="YourName" modified="200909261403" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1560-00-00" spouse="" sex="M" dod="1626-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father=" William COKAYNE (132)" mother="Elizabeth MEDCALFE" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre>He was buried in St. Paul&quot;s Cathedral, The City, London, England.

	Sir William Cokayne held the office of Lord Mayor of London from 1619 to 1620.1 He lived in Cokayne House, Old Broad Street, London, England.</pre>
</div>
<div title="Sir William Cokayne (Mayor)" modifier="YourName" created="200909131559" modified="200909131600" father="William COKAYNE (-1599)" mother="" sex="M" placeofbirth="" latitude="" longitude="" dob="1560" dod="1626" spouse="Mary MORRIS, Countess of Dover" dom="" changecount="1">
<pre>Possibly born in Rushton, Northants, or originated from this location.

Sir Willliam Cokayne was knighted on June 8th, 1616.

He was apprenticed to his father at Christmas, 1582, and he was made free of the Skinners' Company by patrimony on March 28th, 1590. 

He amassed a great fortune and purchased numerous estates, including Rushton Hall, Northamptonshire. He gave each daughter £10,000 on marriage, and he left his son a rent roll of above £12,000 a year.

He was Sheriff of London in 1609, an Alderman from 1609 to his death, and Lord Mayor of London from 1619 to 1620.

In 1612, King James I granted a considerable tract of land in Ulster to the City of London, and William was appointed Governor, the City of Londonderry being founded under his direction. He worked as a London merchant and financer before that.

William Cokayne and Mary Morris were married at St. Leonard Eastcheap, City of London, where Mary had been baptized.

Sir William Cokayne died at his manor house at Comb Nevill in Kingston, Surrey. He was buried at St. Paul's, and a monument in St. Paul's Cathedral recorded his death at age 66 on Oct. 20th, 1626. However, under a copy of the funeral address by Dr. Donne, the date of death was given as December, 1626. His burial at St. Paul's Cathedral was recorded in the Parish registers of St. Peter Le Poer, City of London.</pre>
</div>
<div title="SiteSubtitle" tags="excludeTree" server.type="file" server.host="file:///Users/Jon/Documents/TiddlyWiki/Trunk/contributors/JonRobson/verticals/FamilyTree/index.html" server.page.revision="200903090000">
<pre>get yours [[here|http://www.jonrobson.me.uk/development/familytree/index.html]]
</pre>
</div>
<div title="SiteTitle" modifier="YourName" modified="200910050813" tags="excludeTree" server.type="file" server.host="file:///Users/Jon/Documents/TiddlyWiki/Trunk/contributors/JonRobson/verticals/FamilyTree/index.html" server.page.revision="200903090000" dob="" placeofbirth="" spouse="" placeofmarriage="" occupation="" dod="" causeofdeath="" placeofdeath="" changecount="1">
<pre>robson tree</pre>
</div>
<div title="Sonia Spearman OXX" modifier="YourName" modified="200909271121" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1938-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="George Spearman Cullen OXX" mother="Ivy B CROOKS">
<pre>(4 children: Sonia, Richard, Nicola, Sara)</pre>
</div>
<div title="Stephen Bentley" modifier="YourName" modified="200909221733" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1951-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Edmund Bentley (1)" mother="Olive Llewellyn" latitude="" longitude="" dom="" placeofmarriage="" changecount="3">
<pre></pre>
</div>
<div title="StyleSheet" modifier="YourName" modified="200910021556" tags="excludeTree" server.type="file" server.host="file:///Users/Jon/Documents/TiddlyWiki/Trunk/contributors/JonRobson/verticals/FamilyTree/index.html" server.page.revision="200903090000" dob="" placeofbirth="" spouse="" placeofmarriage="" occupation="" dod="" causeofdeath="" placeofdeath="" changecount="1">
<pre>.ac_results {	padding: 0px;	border: 1px solid black;	background-color: white;	overflow: hidden;	z-index: 99999;}
.ac_results ul {	width: 100%;	list-style-position: outside;	list-style: none;	padding: 0;	margin: 0;}
.ac_results li {	margin: 0px;	padding: 2px 5px;	cursor: default;	display: block;	/* 
	if width will be 100% horizontal scrollbar will apear 
	when scroll mode will be used
	*/
	/*width: 100%;*/
	font: menu;	font-size: 12px;	/* 
	it is very important, if line-height not setted or setted 
	in relative units scroll will be broken in firefox
	*/
	line-height: 16px;	overflow: hidden;}
.ac_loading {	background: white url('indicator.gif') right center no-repeat;}
.ac_odd {	background-color: #eee;}
.ac_over {background-color:#4DA6C9;color: white;}



a,.tabSelected,#sidebarOptions .sliderPanel a{color:#008500;}
.button {background-color:white;border:1px solid #FFFFFF;color:green;margin-right:2px;padding:20px;}
#topToolbar {margin-top:10px;margin-left:-12px;}
#messageArea {background:#39ac1b;border:1px solid white;}
.nodeLabel {width:200px; overflow:hidden;}
.factbox {border:1px dashed #024E02;
color:black;
font-weight:bold;
padding:10px;}
.subtitle {padding-top:5px;}
.ftSubTitle {color:white;
font-size:1.2em;
left:20px;
position:absolute;
top:160px;
z-index:2;}
.ftSubTitle a {color:white;}
#sidebarOptions input,.tagging, .tagged {
background-color:none;
border:1px dashed #024E02;
}


.tagsection input {width:150px;}
.button:hover {background-color:rgb(110,220,90);color:white;border:solid 1px black;}
.tiddler .button {padding:1.2em 2em;}
.sexMale .title {border-bottom:solid 5px #71B4FF;}
.sexFemale .title{border-bottom:solid 5px #ed00f5;}
.yourSearchResult {z-index:99999;}
.tiddler {background-color:white;margin-top:10px;padding:0 10px 20px;}
#displayArea {margin:1em 17em 0 1em;padding:0px;}
body {font-family: Helvetica, Arial, Sans-serif;color:#024E02;}
h1,h2,h3,h4,h5,.title{color:#39ac1b;}
.title {font-size:3em;}
.ftTitle {color:#39ac1b;font-size:108px;left:10px;position:relative;font-weight:700;}
.ftContainer {background-color:#39ac1b;padding:20px;position:relative;top:-26px;margin-right:17px;left:10px;}
#sidebarOptions .sliderPanel {background-color:#EEEEEE;}
.ftTitleBG {color:white;z-index:2;}
.ftContainer #displayArea {background-color:auto;}
.ftContainer #sidebar {background-color:white;margin-top:110px;margin-right:40px;}
.ft_tooltip {background-color:white;padding:10px;color:#39ac1b;z-index:40; font-weight:bold;}
#tiddlerDisplay {margin-top:100px;}
.FamilyTree {left:600px;right:7px;height:200px;position:absolute;background-color:#39AC1B;top:0;}
.tiddlerContainer {margin-left:10px;margin-right:10px;}
.toolbar {margin-top:10px;}

.tabContents {
color:black;
}
.tagging .listTitle, .tagged .listTitle {
color:black;
}

.ftHideCorner {border-color:#39AC1B #39AC1B white white;
border-style:solid;
border-width:20px 20px 10px 10px;
position:absolute;
left:0;
bottom:0;
z-index:1;
}
.VismoCanvas {z-index:11;}
.changeroot {margin-left:50%;width:200px;right:100px;z-index:4000;position:relative;}

.yourSearchNaviBar .currentPage {color:#39AC1B;}

#yourSearchResult {background-color:#EEEEEE;background:#EEEEEE none repeat scroll 0 0;}
.yourSearchResult .button {padding:0px;}

</pre>
</div>
<div title="Susan Preece" modifier="YourName" modified="200909271132" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre></pre>
</div>
<div title="Susannah Buckley" modifier="YourName" modified="200909240843" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre>Daughter of Robert Buckley of Grasscroft.
	Will proved 1711.</pre>
</div>
<div title="TaggedTemplateTweak" modifier="ELSDesignStudios" created="200706181748" modified="200901061019" tags="systemConfig BookmarkPackage MediaPackage TaskPackage IFramePackage DiscussionPackage" server.type="file" server.host="file:///Users/Jon/Documents/TiddlyWiki/Trunk/contributors/JonRobson/verticals/FamilyTree/index.html" server.page.revision="200901061019">
<pre>/***
|Name|TaggedTemplateTweak|
|Source|http://www.TiddlyTools.com/#TaggedTemplateTweak|
|Documentation|http://www.TiddlyTools.com/#TaggedTemplateTweakInfo|
|Version|1.5.1|
|Author|Eric Shulman - ELS Design Studios|
|License|http://www.TiddlyTools.com/#LegalStatements &lt;br&gt;and [[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|~CoreVersion|2.1|
|Type|plugin|
|Requires||
|Overrides|Story.prototype.chooseTemplateForTiddler()|
|Description|use alternative ViewTemplate/EditTemplate for tiddler's tagged with specific tag values|
This tweak extends story.chooseTemplateForTiddler() so that ''whenever a tiddler is marked with a specific tag value, it can be viewed and/or edited using alternatives to the standard tiddler templates.'' 
!!!!!Documentation
&gt;see [[TaggedTemplateTweakInfo]]
!!!!!Revisions
&lt;&lt;&lt;
2009.01.06 [1.5.1] reversed logic so that title-as-prefix takes precedence over tag-matched prefix
2008.12.18 [1.5.0] added handling for using tiddler //title// as prefix (e.g., {{{SomeTiddlerViewTemplate}}}) 
| please see [[TaggedTemplateTweakInfo]] for previous revision details |
2007.06.11 [1.0.0] initial release
&lt;&lt;&lt;
!!!!!Code
***/
//{{{
version.extensions.TaggedTemplateTweak= {major: 1, minor: 5, revision: 1, date: new Date(2009,1,6)};

Story.prototype.taggedTemplate_chooseTemplateForTiddler = Story.prototype.chooseTemplateForTiddler
Story.prototype.chooseTemplateForTiddler = function(title,template)
{
	// get default template from core
	var coreTemplate=this.taggedTemplate_chooseTemplateForTiddler.apply(this,arguments);

	// if the tiddler doesn't exist yet, return core result
	var tiddler=store.getTiddler(title); if (!tiddler) return coreTemplate;

	// split core template into theme prefix and template name
	var theme=&quot;&quot;;
	var template=coreTemplate;
	var parts=template.split(config.textPrimitives.sectionSeparator);
	if (parts[1]) { theme=parts[0]; template=parts[1]; }
	else theme=config.options.txtTheme||&quot;&quot;; // fallback if theme is not specified
	theme+=config.textPrimitives.sectionSeparator;

	// look for template whose prefix matches the *title* of this tiddler
	if (!store.getTaggedTiddlers(title).length) { // if tiddler is not a tag
		if (store.getTiddlerText(theme+title+template)) { return theme+title+template; } // theme##TitleTemplate
		if (store.getTiddlerText(title+template)) 	{ return title+template; }	 // TitleTemplate
	}

	// look for template whose prefix matches a *tag* on this tiddler (if any)
	for (i=0; i&lt;tiddler.tags.length; i++) {
		var t=tiddler.tags[i]+template; // add tag prefix to template
		var c=t.substr(0,1).toUpperCase()+t.substr(1); // capitalized for WikiWord title
		if (store.getTiddlerText(theme+t))	{ return theme+t; } // theme##tagTemplate
		if (store.getTiddlerText(theme+c))	{ return theme+c; } // theme##TagTemplate
		if (store.getTiddlerText(t)) 		{ return t; }	    // tagTemplate
		if (store.getTiddlerText(c))		{ return c; }	    // TagTemplate
	}

	// no matching tag OR title prefix... return core result
	return coreTemplate;
}
//}}}</pre>
</div>
<div title="Tara Samantha Andrews" modifier="YourName" modified="200909282109" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1974-09-21" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Teige (Terence)" modifier="YourName" modified="200909240817" changecount="2" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0988-00-00" spouse="" sex="M" dod="1023-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Brian Boru King of Ireland" mother="">
<pre>Died by assassination.</pre>
</div>
<div title="Teige Caeluisce King of Thomond" modifier="YourName" modified="200909240808" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="1259-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Conor Na Suidane King of Thomond" mother="">
<pre></pre>
</div>
<div title="Thomas Bellwood 1854" modifier="YourName" modified="200910021537" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1854-00-00" spouse="" sex="M" dod="1901-04-26" placeofbirth="Heighington" occupation="Iron Merchant Clerk" causeofdeath="drowned in the River Tees." placeofdeath="Stockton" father="Richard Bellwood 1809" mother="Elizabeth Wilson" latitude="" longitude="" dom="187703010000" placeofmarriage="" changecount="2">
<pre>An Iron Merchant Clerk, (born in Heigington Durham on 1st March 1877) at Bondgate Wesleyan Chapel, Darlington.

Thomas Bellwood died 26th April 1901 at Stockton having drowned in the River Tees.
</pre>
</div>
<div title="Thomas Brew" modifier="YourName" modified="200909252140" changecount="3" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1819-01-17" spouse="" sex="M" dod="1895-02-12" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John Brew 1790" mother="Rachel Prickett">
<pre>Thomas was deaf and apparently never married.</pre>
</div>
<div title="Thomas Brew 1791" modifier="YourName" modified="200909252202" changecount="3" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1791-12-04" spouse="" sex="M" dod="1840-04-22" placeofbirth="Chepstow, Monmouthshire, Wales" occupation="" causeofdeath="" placeofdeath="" father="John Brew 1763" mother="Mary Taylor">
<pre>Christened 4th December 1791 in Chepstow. Died 22nd April 1840. Buried 5 days later in Chepst, 27th April by curate Mr. Sand. Death certificate says died of consumption, a boatman at the time. Mary Ann his daughter was present at death. 

	Thomas was a seaman/merchant. He is also recorded has having a ropemaker apprenticeship.</pre>
</div>
<div title="Thomas Brew 1821" modifier="YourName" modified="200909252222" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1821-01-07" spouse="" sex="M" dod="1894-06-03" placeofbirth="Chepstow,Monmouthshire,Wales" occupation="" causeofdeath="" placeofdeath="" father="Thomas Brew 1791" mother="Honor Perry" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre>Christened in Chepstow on 7 January 1821.</pre>
</div>
<div title="Thomas C Hunter" modifier="YourName" modified="200909271056" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1850-00-00" spouse="Harriett Jane Robson" sex="M" dod="1891-00-00" placeofbirth="Scotland" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title="Thomas Cokayne 1540" modifier="YourName" modified="200909271141" changecount="3" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1540-00-00" spouse="Magdalen Towers" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Roger COKAYNE" mother="Alice ALLSOP">
<pre>Had the following known children:
Thomas COKAYNE m. Frideswyde PUREFOY

William COKAYNE
m. Eleanor LLYOD
m2. Elizabeth 08/06/1626

Alice COKAYNE
m. Henry SHERAT 13/12/1591

Alice COKAYNE
m. Thomas ROBINSON</pre>
</div>
<div title="Thomas Lyall" modifier="YourName" modified="200909231728" changecount="2" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre>Possibly a brother of [[Adam Lyall]]? Mentioned in letters.</pre>
</div>
<div title="Thomas Robinson" modifier="YourName" modified="200909282128" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="Alice Cokayne 1562" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Thomas Robson Bellwood" modifier="YourName" modified="200909271034" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1977-00-00" spouse="" sex="M" dod="1995-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="David Bellwood" mother="Alison Hook">
<pre></pre>
</div>
<div title="Thomas Spearman" modifier="YourName" created="200909131616" modified="200909131616" father="Gilbert Illegy SPEARMAN" mother="Anna CLARK" placeofbirth="" latitude="" longitude="" dob="" dod="1815" spouse="" dom="" changecount="1">
<pre>married Elizabeth</pre>
</div>
<div title="Tiege An Chomard King of Thomond" modifier="YourName" modified="200909240805" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="1466-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Turlough" mother="">
<pre></pre>
</div>
<div title="Tony Parsons" modifier="YourName" modified="200909282118" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="Noreen UNKNOWN" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" dom="" placeofmarriage="" changecount="3">
<pre></pre>
</div>
<div title="ToolbarCommands" tags="excludeTree" server.type="file" server.host="file://localhost/Users/Jon/Documents/TiddlyWiki/Trunk/contributors/JonRobson/verticals/FamilyTree/index.html" server.page.revision="200903090000">
<pre>|~ViewToolbar|closeTiddler addFather addMother addSpouse addChild +editTiddler &gt; fields permalink|
|~EditToolbar|+saveTiddler -cancelTiddler deleteTiddler|

</pre>
</div>
<div title="Turlogh (Prince of Thomond, Ireland) O BRIEN" modifier="YourName" modified="200909240805" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1487-00-00" spouse="" sex="M" dod="1528-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Tiege An Chomard King of Thomond" mother="">
<pre>Turlogh married Joan Fitzmaurice.</pre>
</div>
<div title="Turlogh Theodoras King of Munster" modifier="YourName" modified="200909282051" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Cathal King of Thomond" mother="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Turlough" modifier="YourName" modified="200909240806" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" the="" soft="" bog="" king="" of="" thomond="" dob="0000-00-00" spouse="" sex="M" dod="1459-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Brian Catha An Eanough King of Thomond" mother="">
<pre></pre>
</div>
<div title="Turlough King of Thomond" modifier="YourName" modified="200909240807" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1292-00-00" spouse="" sex="M" dod="1306-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Teige Caeluisce King of Thomond" mother="">
<pre></pre>
</div>
<div title="Turlough King of Thomond (2)" modifier="YourName" modified="200909240811" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1163-00-00" spouse="" sex="M" dod="1167-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Dermot King of Munster" mother="">
<pre></pre>
</div>
<div title="Turough King of Munster" modifier="YourName" modified="200909240818" changecount="2" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="1086-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Teige (Terence)" mother="">
<pre>  Tairrdelbach I, High King of Ireland gained the title of  King Turough of Munster. He succeeded to the title of  High King Tairrdelbach I of Ireland in 1072. [1]

[1] [S38] John Morby, Dynasties of the World: a chronological and genealogical handbook (Oxford, Oxfordshire, U.K.: Oxford University Press, 1989), page 76. Hereinafter cited as Dynasties of the World.</pre>
</div>
<div title="Una O BRIEN" modifier="YourName" modified="200909240800" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title="Unknown Gayler" modifier="YourName" modified="200909252314" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Unknown Newton" modifier="YourName" modified="200909251533" changecount="1" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title="Unknown Robson" modifier="YourName" modified="200909261458" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre>This line is not necessarily connected to the Robson family tree however in 1851, his son is living next door to Robert Robson (who is an ancestor). I was curious to whether the two people were related in anyway but as of yet have found no evidence to support this theory.

	If the marriage of Joseph Robson and Mary Foster is correct then this person is called Solomon Robson.</pre>
</div>
<div title="Unknown Spearman" modifier="YourName" modified="200909271217" changecount="3" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1734-00-00" spouse="Joseph Cuthbert" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="George Spearman" mother="Sarah UNKNOWN">
<pre></pre>
</div>
<div title="ViewTemplate" modifier="YourName" modified="200910021603" tags="excludeTree" server.type="file" server.host="file:///Users/Jon/Documents/TiddlyWiki/Trunk/contributors/JonRobson/verticals/FamilyTree/index.html" server.page.revision="200903090000" dob="" placeofbirth="" spouse="" placeofmarriage="" occupation="" dod="" causeofdeath="" placeofdeath="" changecount="1">
<pre>&lt;!--{{{--&gt;
&lt;div macro='tiddlerGender'&gt;
&lt;div class='tiddlerContainer'&gt;
&lt;div class='toolbar' macro='toolbar [[ToolbarCommands::ViewToolbar]]'&gt;&lt;/div&gt;
&lt;div&gt;&lt;span class='title' macro='view title'&gt;&lt;/span&gt;&amp;nbsp;&lt;span macro='makeRootLink'&gt;&lt;/span&gt;&lt;/div&gt;
&lt;span macro='aet if:dob|dod'&gt;(&lt;span macro='view dob'&gt;&lt;/span&gt;&lt;span macro='aet if:dod'&gt;-&lt;/span&gt;&lt;span macro='view dod'&gt;&lt;/span&gt;)&lt;/span&gt;

&lt;div class='subtitle'&gt;last modified &lt;span macro='view modified date'&gt;&lt;/span&gt; (&lt;span macro='message views.wikified.createdPrompt'&gt;&lt;/span&gt; &lt;span macro='view created date'&gt;&lt;/span&gt;)&lt;/div&gt;
&lt;div class='subtitle'&gt;
&lt;span macro='aet if:mother|father'&gt;Child of&lt;/span&gt;
&lt;span macro='view father link'&gt;&lt;/span&gt;
&lt;span macro='aet if:father&amp;mother'&gt;and&lt;/span&gt;
&lt;span macro='view mother link'&gt;&lt;/span&gt; 
&lt;br/&gt;
&lt;span macro='aet if:spouse'&gt;Spouse(s): &lt;/span&gt;&lt;span macro='ftview spouse'&gt;&lt;/span&gt;

&lt;/div&gt;
&lt;h3&gt;Children of &lt;span macro='view title'&gt;&lt;/span&gt;&lt;/h3&gt;
&lt;div macro='listchildren'&gt;&lt;/div&gt;
&lt;div class='tagging' macro='tagging'&gt;&lt;/div&gt;
&lt;div class='tagged' macro='tags'&gt;&lt;/div&gt;

&lt;h3&gt;Facts&lt;/h3&gt;
&lt;div class='factbox'&gt;
&lt;div&gt;
&lt;span macro='aet if:!dob&amp;!placeofbirth&amp;!occupation&amp;!dod&amp;!placeofdeath'&gt;No facts.&lt;/span&gt;
  &lt;span macro='aet if:dob'&gt;
  born &lt;span macro='view dob'&gt;&lt;/span&gt; &lt;/span&gt;
  &lt;span macro='aet if:placeofbirth'&gt;in &lt;/span&gt;&lt;span macro='view placeofbirth'&gt;&lt;/span&gt;&lt;/div&gt;

&lt;div&gt;&lt;span macro='aet if:occupation'&gt;occupation &lt;/span&gt;&lt;span macro='view occupation'&gt;&lt;/span&gt;&lt;/div&gt;
&lt;div&gt;
&lt;span macro='aet if:dod'&gt;died &lt;/span&gt;&lt;span macro='view dod'&gt;&lt;/span&gt;
&lt;span macro='aet if:placeofdeath'&gt; in&lt;/span&gt;&lt;span macro='view placeofdeath'&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;

&lt;h3&gt;Further Information&lt;/h3&gt;
&lt;div class='viewer' macro='view text wikified'&gt;&lt;/div&gt;

&lt;div class='tagClear'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;!--}}}--&gt;
</pre>
</div>
<div title="Violet Evelyn Brew" modifier="GUEST" created="200905082214" modified="200905082214" changecount="2" sex="F" placeofbirth="" latitude="" longitude="" dob="" dod="" mother="" father="" spouse="John George Robson">
<pre></pre>
</div>
<div title="Violet Franklin" modifier="YourName" modified="200909261025" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1908-06-00" spouse="Ivor Bagg" sex="F" dod="1994-05-00" placeofbirth="High Wycombe" occupation="" causeofdeath="" placeofdeath="Wales" father="William (Billy) Franklin" mother="Louisa Gayler" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre></pre>
</div>
<div title="VismoLibraryPlugin" modifier="YourName" created="200910011917" tags="systemConfig" imagexyr="-383.1000061035156,-239.3000030517578,12.5,1022,600" server.type="file" server.host="file:///Users/Jon/Documents/TiddlyWiki/Trunk/contributors/JonRobson/verticals/FamilyTree/index.html" server.page.revision="200910011917">
<pre>/***
|''Name:''|Jon Robson's VismoLibrary|
|''Description:''|An opensource library of javascript code designed to create clickable graphics in canvas with VML alternative for Internet Explorer browsers. The purpose of this is to provide hackable, extendable graphics based plugins without being locked in to consumer products such as Flash.|
|''Author:''|JonRobson (http://www.jonrobson.me.uk/Vismo)|
|''CodeRepository:''|http://svn.tiddlywiki.org/Trunk/contributors/JonRobson/Library/Vismo/|
|''Version:''|0.9 |
|''Dependencies:''| Requires jQuery|
|''Comments:''|Please raise questions and make comments at http://groups.google.co.uk/group/TiddlyWikiDev |
|''License:''|[[BSD License|http://www.opensource.org/licenses/bsd-license.php]] |
|''Usage:''|
Not much good on it's own - it provides some nice functions to create graphicsy plugins.
Currently provides horsepower to the following plugins amongst others:
GeoTiddlyWiki (http://www.jonrobson.me.uk/workspaces/tiddlers/GeoTiddlyWiki/), ImageTaggingPlugin, TiddlyTagMindMap (http://tiddlytagmindmap.tiddlyspot.com)
!Wouldn't have been possible without..
http://spatialreference.org/ref/sr-org/google-projection/ for help with google projection hack
***/
var VismoOptimisations = {
    minradius:5,
	packCoordinates: function(coordlist){
		var res = [];
		for(var i=0; i &lt; coordlist.length-1; i+=2){
			res.push([coordlist[i],coordlist[i+1]]);
		}
		
		return res;
	}
	,unpackCoordinates: function(coordlist){
		var res = [];
		for(var i=0; i &lt; coordlist.length; i+=1){
			res.push(coordlist[i][0]);
			res.push(coordlist[i][1]);
		}
		return res;	
	}
	//coords in form [[x1,y1],[x2,y2]]
	,douglasPeucker: function(coords,tolerance, start,end){
		var results = [];

		if(!start) start = 0;
		if(!end) end = coords.length - 1;
		if(start &gt;= coords.length || end &gt;= coords.length || start == end -1){
			return [];
		}	
		var midpoint = {};
	
	
		midpoint.x = (coords[end][0] + coords[start][0]) /2;
		midpoint.y = (coords[end][1] + coords[start][1]) /2;
		
		var bestPoint = {distance:-1, index:-1};
		for(var i=start+1; i &lt; end; i++){
			var x = coords[i][0];
			var y = coords[i][1];
			var deltax = midpoint.x - x;
			var deltay= midpoint.y - y;
			
			var perpendicular_d = Math.sqrt((deltax * deltax ) + (deltay *deltay)); //this is not perpendicular distancd.. i think!
			if(perpendicular_d &gt; bestPoint.distance){
				bestPoint.index = i;
				bestPoint.distance = perpendicular_d;
			}
		}
	
		if(bestPoint.index ==-1 || bestPoint.distance&lt;tolerance){
			var res = [];
			res.push(coords[start]);
			//res.push(coords[end])
			return res; //none of these points are interesting except last
		}
		else{
			results.push(coords[start]);
			var ref = bestPoint.index;
			var splice1 = VismoOptimisations.douglasPeucker(coords,tolerance,start+1,ref);
			var splice2 = VismoOptimisations.douglasPeucker(coords,tolerance,ref,end);
			results = results.concat(splice1);
			results = results.concat(splice2);
			results.push(coords[end]);
			return results;
		}
		
	}
  
	,vismoShapeIsInVisibleArea: function(vismoShape,canvas,transformation){
	    var t1= new Date();
		var left = 0,top = 0;
		var right =  parseInt(canvas.width) + left; 
		var bottom = parseInt(canvas.height) + top;
		var topleft =  VismoClickingUtils.undotransformation(left,top,transformation);
		var bottomright =  VismoClickingUtils.undotransformation(right,bottom,transformation);				
		var frame = {};
		frame.top = topleft.y;
		frame.bottom = bottomright.y;
		frame.right = bottomright.x;
		frame.left = topleft.x;
		var g = vismoShape.getBoundingBox();
		var t2 = new Date();
        VismoTimer[&quot;shape_visiblearea&quot;] += (t2-t1);
           
		if(g.x2 &lt; frame.left) {
			return false;}
		if(g.y2 &lt; frame.top) {
			return false;}
		if(g.x1 &gt; frame.right){
			return false;
		}
		if(g.y1 &gt; frame.bottom){
			return false;	
		}
		
		return true;
	}
	
	,vismoShapeIsTooSmall: function(vismoShape,transformation){
	    VismoTimer.start(&quot;VismoOptimisations.vismoShapeIsTooSmall&quot;);

		if(!transformation ||!transformation.scale) {
		    VismoTimer.end(&quot;VismoOptimisations.vismoShapeIsTooSmall&quot;);
		    return false;
		}
		var g = vismoShape.getBoundingBox();
		var s = transformation.scale;
		var t1 = (g.width) * s.x;
		var t2 =(g.height) * s.y;

       
		if(t2 &lt; this.minradius&amp;&amp; t1 &lt; this.minradius) 
			{
			  VismoTimer.end(&quot;VismoOptimisations.vismoShapeIsTooSmall&quot;);
                    return true;}//too small
		else{
		   VismoTimer.end(&quot;VismoOptimisations.vismoShapeIsTooSmall&quot;);
			return false;
		}
		VismoTimer.end(&quot;VismoOptimisations.vismoShapeIsTooSmall&quot;);
	}

};window.onbeforeunload =function(){
    try{
        VismoUtils.scrubNodes(window.documentElement);
        
        if (window.CollectGarbage) {
    	    window.CollectGarbage();
        }
    }
    catch(e){
        //get over it
    }
};

Array.prototype.contains = function(item)
{
	return this.indexOf(item) != -1;
};
Array.prototype.clone = function () {var a = new Array(); for (var property in this) {a[property] = typeof (this[property]) == 'object' ? this[property].clone() : this[property]} return a};

if(!Array.indexOf) {
	Array.prototype.indexOf = function(item,from)
	{
		if(!from)
			from = 0;
		for(var i=from; i&lt;this.length; i++) {
			if(this[i] === item)
				return i; 
		}
		return -1;
	};
}

var VismoShapeUtils ={
    randomColor: function(alpha){
       var r = parseInt(Math.random() * 255);
       var g = parseInt(Math.random() * 255);
       var b = parseInt(Math.random() * 255);
       var a;
       if(alpha) var a = parseInt(Math.random() * 255);
       else a = 1;
       return &quot;rgba(&quot;+r+&quot;,&quot;+g+&quot;,&quot;+b+&quot;,&quot;+a+&quot;)&quot;;
    }
    ,_isCoordinate: function(c){
        if(c == &quot;M&quot; || c == &quot;q&quot; || c== 'c') return false;
        else {
            if(typeof(c)== 'number') return true;
        }
    }
    
    ,toHex: function(rgba){
        if(rgba.indexOf(&quot;rgba&quot;) == 0){
            rgba = rgba.replace(&quot;rgba(&quot;,&quot;&quot;);
            rgba = rgba.replace(&quot;)&quot;,&quot;&quot;);
        }
        else if(rgba.indexOf(&quot;rgb&quot;)==0){
             rgba = rgba.replace(&quot;rgb(&quot;,&quot;&quot;);
        }
        
        rgba = rgba.replace(&quot;)&quot;,&quot;&quot;);
        rgba = rgba.split(&quot;,&quot;);
        return &quot;#&quot;+this._tohexadecimal(rgba[0])+this._tohexadecimal(rgba[1]) +this._tohexadecimal(rgba[2]);
    }
    ,_tohexadecimal: function(N){
        if (N==null) return &quot;00&quot;;
        N=parseInt(N); if (N==0 || isNaN(N)) return &quot;00&quot;;
        N=Math.max(0,N); N=Math.min(N,255); N=Math.round(N);
        return &quot;0123456789ABCDEF&quot;.charAt((N-N%16)/16)
             + &quot;0123456789ABCDEF&quot;.charAt(N%16);
        
    }
    ,opacityFrom: function(rgba){
 
        var rgbcode = rgba.replace(&quot;rgba(&quot;,&quot;&quot;);
	    rgbcode = rgbcode.replace(&quot;)&quot;,&quot;&quot;);
	    rgbcode = rgbcode.split(&quot;,&quot;);
	    var opvalue = 0;
	    if(rgbcode.length &lt; 4) opvalue = 1;
	    else opvalue =rgbcode[3];
	    
	    return opvalue;
    }
    ,toRgb: function(hex_rgba,opacity){
        var rgb = {};
        if(hex_rgba.indexOf(&quot;#&quot;) == 0 &amp;&amp; hex_rgba.indexOf(&quot;,&quot;) == -1){ //hex code argument
            var hex = hex_rgba;
			var hexcode = hex.substring(1);
			rgb.red = this._hexToR(hexcode);
			rgb.blue = this._hexToB(hexcode);
			rgb.green = this._hexToG(hexcode);
		}
		else if(hex_rgba.indexOf(&quot;rgba&quot;) != -1){
		    var rgbcode = hex_rgba.replace(&quot;rgba(&quot;,&quot;&quot;);
		    rgbcode = rgbcode.replace(&quot;)&quot;,&quot;&quot;);
		    rgbcode = rgbcode.split(&quot;,&quot;);
		    rgb.red =rgbcode[0];
		    rgb.green =rgbcode[1];
		    rgb.blue =rgbcode[2];
		    opacity = rgbcode[3];
		}
		return {rgb:&quot;rgb(&quot;+rgb.red+&quot;,&quot;+ rgb.green +&quot;,&quot;+ rgb.blue+&quot;)&quot;,opacity:opacity};
	}    
    ,toRgba: function(hex,opacity){
        var rgb = {};
        if(hex.indexOf(&quot;#&quot;) == 0 &amp;&amp; hex.indexOf(&quot;,&quot;) == -1){ //hex code argument
			var hexcode = hex.substring(1);
			rgb.red = this._hexToR(hexcode);
			rgb.blue = this._hexToB(hexcode);
			rgb.green = this._hexToG(hexcode);
		}
		if(!opacity) opacity = &quot;1.0&quot;;
		return &quot;rgba(&quot;+rgb.red+&quot;,&quot;+ rgb.green +&quot;,&quot;+ rgb.blue+&quot;,&quot; + opacity+&quot;)&quot;;
    }
	/* thank you http://www.javascripter.net/faq/hextorgb.htm*/
	,_cutHex: function(h) {return (h.charAt(0)==&quot;#&quot;) ? h.substring(1,7):h}
	,_hexToR:function(h){return parseInt((this._cutHex(h)).substring(0,2),16)}
	,_hexToG: function (h) {return parseInt((this._cutHex(h)).substring(2,4),16)}
	,_hexToB:function(h) {return parseInt((this._cutHex(h)).substring(4,6),16)}

};
var VismoUtils = {
	userAgent: navigator.userAgent.toLowerCase(),
	clone: function(obj){

        if(!obj) return obj;
        if(obj.appendChild) return obj;
	    if(obj == null || typeof(obj) != 'object')return obj;

	    var temp = new obj.constructor(); // changed (twice)

	    for(var key in obj){
	        //console.log(key);
	        temp[key] = VismoUtils.clone(obj[key]);
	        //console.log(temp[key])
	    }

	    return temp;

	}
	,invertYCoordinates: function(coords){
		var res = [];
		for(var i=0; i &lt; coords.length; i++){
			var x = coords[i][0];
			var y = coords[i][1];
			res.push([x,-y]);
		}
		return res;
	},
	scrubNode: function(e)
    {
    	if(!VismoUtils.browser.isIE)
    		return;
    	var att = e.attributes;
    	if(att) {
    		for(var t=0; t&lt;att.length; t++) {
    			var n = att[t].name;
    			if(n !== &quot;style&quot; &amp;&amp; (typeof e[n] === &quot;function&quot; || (typeof e[n] === &quot;object&quot; &amp;&amp; e[n] != null))) {
    				try {
    					e[n] = null;
    				} catch(ex) {
    				}
    			}
    		}
    	}
    	var c = e.firstChild;
    	while(c) {
    		 VismoUtils.scrubNode(c);
    		c = c.nextSibling;
    	}
    }
    
    ,mergejsons: function(prop1,prop2){
	    
	    var res = {};
	    var i;
	    for(i in prop1){
	        res[i] = prop1[i];
	    }
	    for(i in prop2){
	        res[i] = prop1[i];
	    }
	    return res;
	    
	}
};

VismoUtils.browser= {
		isIE: VismoUtils.userAgent.indexOf(&quot;msie&quot;) != -1 &amp;&amp; VismoUtils.userAgent.indexOf(&quot;opera&quot;) == -1,
		isGecko: VismoUtils.userAgent.indexOf(&quot;gecko&quot;) != -1,
		ieVersion: /MSIE (\d.\d)/i.exec(VismoUtils.userAgent), // config.browser.ieVersion[1], if it exists, will be the IE version string, eg &quot;6.0&quot;
		isSafari: VismoUtils.userAgent.indexOf(&quot;applewebkit&quot;) != -1,
		isBadSafari: !((new RegExp(&quot;[\u0150\u0170]&quot;,&quot;g&quot;)).test(&quot;\u0150&quot;)),
		firefoxDate: /gecko\/(\d{8})/i.exec(VismoUtils.userAgent), // config.browser.firefoxDate[1], if it exists, will be Firefox release date as &quot;YYYYMMDD&quot;
		isOpera: VismoUtils.userAgent.indexOf(&quot;opera&quot;) != -1,
		isLinux: VismoUtils.userAgent.indexOf(&quot;linux&quot;) != -1,
		isUnix: VismoUtils.userAgent.indexOf(&quot;x11&quot;) != -1,
		isMac: VismoUtils.userAgent.indexOf(&quot;mac&quot;) != -1,
		isWindows: VismoUtils.userAgent.indexOf(&quot;win&quot;) != -1
	};

if(VismoUtils.browser.isIE &amp;&amp; VismoUtils.browser.ieVersion[1] == &quot;6.0&quot;){
VismoUtils.browser.isIE6 = true;

}

if(VismoUtils.browser.isIE){
	if (!document.namespaces['vismoShapeVml_']) {
	        document.namespaces.add('vismoShapeVml_', 'urn:schemas-microsoft-com:vml'/*,&quot;#default#VML&quot;*/);
	        
	}
	document.namespaces.add('xmlns', 'http://www.w3.org/1999/xhtml');
	document.namespaces.add('svg', 'http://www.w3.org/2000/svg');
	document.namespaces.add('xlink', 'http://www.w3.org/1999/xlink');

	  // Setup default CSS.  Only add one style sheet per document
	 if (!document.styleSheets['vismoShape']) {
	        var ss = document.createStyleSheet();
	        ss.owningElement.id = 'vismoShape';
	        ss.cssText = 'canvas{display:inline;overflow:hidden;' +
	            'text-align:left;}' +
	            'vismoShapeVml_\\: * {behavior:url(#default#VML);}';
	}
}
VismoUtils.svgSupport = function(){
        if(VismoUtils.browser.isIE){
                try {
                 var asv = new ActiveXObject(&quot;Adobe.SVGCtl&quot;);
                 return true;
                }
                catch(e){ }
        }
        else if(document.implementation) {
                if(VismoUtils.browser.isSafari) return true;
                return document.implementation.hasFeature(&quot;http://www.w3.org/TR/SVG11/feature#Shape&quot;, &quot;1.0&quot;);
        }



        return true;
};
/* 
Creates primitive shapes that can be rendered across most browsers
I am not very happy with the code that follows. It is not of the best standard and needs much improvement
coordinates are a string consisting of floats and move commands (M)
*/

var VismoShape = function(properties,coordinates){
    this._isVismoShape = true;
    this.options = {pointsize:5};
    if(!coordinates) {
        coordinates = properties.coordinates;
        delete properties[&quot;coordinates&quot;];
    }
    this._optimise_cache = {};
    
	this.coordinates = {
		projected: false,
		normal: [],
		optimised: {},
		optimisedandprojected:{}
	};
	this.grid = {};
	this.width = 0;
	this.height =0;
	this.properties = {};
	this.setProperties(properties);
	if(coordinates[0] &amp;&amp; coordinates[0].length == 2){
		coordinates = VismoOptimisations.unpackCoordinates(coordinates);	
	}
	
	this._construct(properties,coordinates);
	this.browser =false;
	this.currentResolution = false;
	this.vml = false;
	this.unique_id = Math.random() + &quot;_&quot; + this.properties.id;
    this.scale = {x:1,y:1};
};



VismoShape.prototype={
    isCommand: function(i){
        if(i == 'M' || i =='b' || i =='q'){
            return true;
        }
        else{
            return false;
        }
    }
    ,clone: function(){
                var coords = this.getCoordinates(&quot;normal&quot;);
                var props = this.getProperties();
                var p = VismoUtils.clone(props);
                p.coordinates = coords;
                try{
                    //console.log(p);
                    return new VismoShape(p);
                }
                catch(e){
                    throw e;
                }
    }
    ,translate: function(x,y){
  	    var c = this.getCoordinates(&quot;normal&quot;);

  	    var newc = [];
  	    for(var i=0; i &lt; c.length; i+=2){
  	         if(this.isCommand(c[i])) i+=1;
  	         var newx,newy;

  	        newx = c[i] + x;
  	        newy = c[i+1] + y;
  	        newc.push(newx);
  	        newc.push(newy);
  	    }

  	    this.setCoordinates(newc);
      }

  	,scale: function(x,y){
  	    this._scale.x = x;
  	    this._scale.y = y;
  	    var c = this.getCoordinates(&quot;normal&quot;);

  	    var newc = [];
  	    for(var i=0; i &lt; c.length; i+=2){
  	        if(this.isCommand(c[i])) i+=1;
  	        var newx,newy;

  	        newx = c[i] * x;
  	        newy = c[i+1] * y;
  	        newc.push(newx);
  	        newc.push(newy);
  	    }

  	    this.setCoordinates(newc);
  	    return true;
  	}
	,resize: function(x,y){
	    var bb = this.getBoundingBox();
	    var newWidth = x *bb.width;
	    var newHeight = y * bb.height;
	    var offsetx = (bb.center.x * x) - bb.center.x;
	    var offsety = (bb.center.y * y)- bb.center.y;
	    this.scale.x = x;
	    this.scale.y = y;
	    var c = this.getCoordinates(&quot;normal&quot;);

	    var newc = [];
	    for(var i=0; i &lt; c.length; i+=2){
	        var newx,newy;
	        
	        newx = c[i] * x;
	        newy = c[i+1] * y;
	        newx -= offsetx;
	        newy -= offsety;
	        newc.push(newx);
	        newc.push(newy);
	    }
	  
	    this.setCoordinates(newc);
	    return true;
	}
	,moveTo: function(x,y){
	    var st = this.properties.shape;
	    var dim = this.getDimensions();
	 
	    if(st == &quot;point&quot; || st == 'circle'){
	        this.setCoordinates([x,y,dim.width/2, dim.height/2]);
	    }
	    else if(st == 'polygon' ||st == 'path'){
	        var bb = this.getBoundingBox();
	        var movex = x - bb.center.x;
	        var movey = y - bb.center.y;
	        
	        var c = this.getCoordinates(&quot;normal&quot;);
	        var newc = [];
	        for(var i=0; i &lt; c.length; i+=2){
	            if(this.isCommand(c[i])) i +=1;
	            newc.push(c[i]+movex);
	            newc.push(c[i+1]+movey);
	        }
	        this.setCoordinates(newc);
	    }
	}
	,getShape: function(){
		return this.getProperty(&quot;shape&quot;);
    }
	,setProperties: function(properties){
	    var newprops = VismoUtils.clone(properties);
		var i;
		for(i in newprops){
		        this.setProperty(i,newprops[i]);
		}
		if(!newprops[&quot;z-index&quot;]){
		    this.setProperty(&quot;z-index&quot;,&quot;0&quot;);
		}
		if(!newprops.stroke){
			this.setProperty(&quot;stroke&quot;,'#000000');		
		}
		
	}
	,getBoundingBox: function(){ /* returns untransformed bounding box */
	    return this.grid;
	}
	,setPointSize: function(pointsize){
	    VismoTimer.start(&quot;VismoShape.setPointSize&quot;);
	    var st = this.properties.shape;
	    if(st != &quot;point&quot;) return;
	    if(pointsize) {
		    this.options.pointsize = pointsize;
		    var bb= this.getBoundingBox();
		    this.setCoordinates([bb.center.x,bb.center.y,pointsize/2,pointsize/2]);
		}
		VismoTimer.end(&quot;VismoShape.setPointSize&quot;);
	}
	,render: function(canvas,transformation,projection,optimisations, browser,pointsize){
	    VismoTimer.start(&quot;VismoShape.render&quot;);
        this.setPointSize(pointsize); 
		var mode = this.getRenderMode(canvas);
		if(mode == 'ie'){
		     this.render_ie(canvas,transformation,projection,optimisations, browser);    
		}
		else{	
	        this.render_canvas(canvas,transformation,projection,optimisations, browser);
	        //this.render = this.render_canvas;
		}
		 VismoTimer.end(&quot;VismoShape.render&quot;);	
	}
	,render_ie: function(canvas,transformation,projection,optimisations, browser){
	    
	    VismoTimer.start(&quot;VismoShape.render_ie&quot;);
	    if(this.properties.hidden){
		        if(this.vml)this.vml.clear();
		        return;
		}
	    if(this.vml===false){ //not created
            this.vml = new VismoVector(this,canvas);
            this.donevml = true;
            
        }
        
           

		this.vml.render(canvas,transformation,projection);
        VismoTimer.end(&quot;VismoShape.render_ie&quot;);
        return;
	}
	,render_canvas: function(canvas,transformation,projection,optimisations, browser){
		VismoTimer.start(&quot;VismoShape.render_canvas&quot;);
		var c;
		if(this.properties.hidden) {
		    return;
    	}
    	var vismoShape = this;
    	var ctx = canvas.getContext('2d');
		if(!ctx) return;
		ctx.save();
		if(transformation){
			var o = transformation.origin;
			var tr = transformation.translate;
			var s = transformation.scale;
			var r = transformation.rotate;
			if(o &amp;&amp; s &amp;&amp; tr){
				ctx.translate(o.x,o.y);
				ctx.scale(s.x,s.y);
				ctx.translate(tr.x,tr.y);
			}
			if(r &amp;&amp; r.x)ctx.rotate(r.x);
		}

		VismoCanvasRenderer.renderShape(canvas,vismoShape);
		ctx.restore();
		VismoTimer.end(&quot;VismoShape.render_canvas&quot;);
	}
	,getTransformation: function(){
	    var transform= this.getProperty(&quot;transformation&quot;);
	   
	    if(!transform) transform = {translate:false,scale:false};
   		if(!transform.translate)transform.translate = {x:0,y:0};
   		if(!transform.translate.x)transform.translate.x = 0;
   		if(!transform.translate.y)transform.translate.y = 0;
   		if(!transform.scale)transform.scale= {x:1,y:1};
   		if(!transform.scale.x)transform.scale.x = 1;
   		if(!transform.scale.y)transform.scale.y = 1;
	       
	       return transform;
	}
	
    ,setTransformation: function(transformation){
	    this.setProperty(&quot;transformation&quot;,transformation);
	    this._calculateBounds();
	}
	,setCoordinates: function(coordinates,type){
	    if(this.properties.shape == 'circle' || this.properties.shape == 'point'){
	        if(coordinates.length == 2 &amp;&amp; this.coordinates.normal){
	            coordinates.push(this.coordinates.normal[2]);
	            coordinates.push(this.coordinates.normal[3]);
	        }
	    }	        
        var good = [];
        for(var i=0; i &lt; coordinates.length; i++){
            if(coordinates[i] +&quot;&quot; !='NaN')
            {good.push(coordinates[i]);}
        }
     
        if(good.length &lt; 2) {
                throw &quot;cannot set coordinates for VismoShape not enough good coordinates given (coordinates may contain non-number elements)&quot; + coordinates.toString();
        }
        coordinates = good;
                
                
		if(type == 'projected'){ 
		    this.coordinates.projected = coordinates;return;}
		
		this.coordinates.normal = coordinates;
	
		if(this.vml)this.vml.coordinatesHaveChanged();
		this.coordinates.projected= false;
		var i;
		for(i in this.coordinates_optimised){
			delete this.coordinates_optimised[i];
		}
		var j;
		for(j in this.coordinates.optimisedandprojected){
			delete this.coordinates.optimisedandprojected[j];
		}		
		this.grid = {}; //an enclosing grid
		
		if(this.vml) this.vml.path = false; //reset path so recalculation will occur
		var st = this.getShape();
		if(st== 'circle' || st == 'point'){
		    
		    if(coordinates[2] &amp;&amp; coordinates[3]) this.setRadius(coordinates[2],coordinates[3]);
		    else this.setDimensions(this.options.pointsize,this.options.pointsize);
		}
		this._calculateBounds();

	}
	,getCoordinates: function(type){
		if(type == 'normal') return this.coordinates.normal;
	    if(type == 'projected') return this.coordinates.projected;
		
		var resolution = this.currentResolution;
		if(this.coordinates.projected) {
			if(this.browser != 'ie' &amp;&amp; resolution){
				return this._simplifyCoordinates(resolution,this.coordinates.projected);
				var opt=this.coordinates.optimisedandprojected;
				if(!opt[resolution]) opt[resolution] =  this._simplifyCoordinates(resolution,this.coordinates.projected);
				
				return opt[resolution];
			}		
			return this.coordinates.projected;
		}
		else{
			if(this.browser != 'ie' &amp;&amp; resolution){
				var opt=this.coordinates.optimised;
				if(!opt[resolution]) opt[resolution] =  this._simplifyCoordinates(resolution,this.coordinates.normal);
				
				return opt[resolution];
			}	
			return this.coordinates.normal;
		}
	}
	,getProperties: function(){
	    return this.properties;
	}
	,getRenderMode: function(canvas){
	    VismoTimer.start(&quot;VismoShape.getRenderMode&quot;);
	    if(!this.browser){
		    if(!canvas.getContext) {				
		                this.browser = &quot;ie&quot;;
			}
				
			else 	this.browser = &quot;good&quot;;
		}
		VismoTimer.end(&quot;VismoShape.getRenderMode&quot;);
		return this.browser;
	}
	
	,setProperty: function(name,value){
		this.properties[name] = value;
		 //console.log(&quot;Reset&quot;,name,this);
		 if(this.vml) {
		    this.vml.nochange = false;
	       
	    }
	    if(name == 'z-index'){ //organise a re-sort for the z-index property to kick in
	      if(Vismo.store.Canvas[this._canvasref]){
	        Vismo.store.Canvas[this._canvasref].needsSort = true;
	      }
	    }
	}
	,getProperty: function(name){
		return this.properties[name];
	}

	,_calculateBounds: function(coords){
	    VismoTimer.start(&quot;VismoShapes._calculateBounds&quot;);
	    var that = this;
		var st = this.getShape();
		var transform = this.getTransformation();

        
		if(st == 'path'){
			this.grid = {x1:0,x2:1,y1:0,y2:1,center:{x:0,y:0}};
			return;
		}
		else if(st == 'point' || st == 'circle' | st == 'image' | st == 'domElement'){
				var coords = this.getCoordinates(&quot;normal&quot;).clone();
				var x = coords[0]; var y = coords[1]; 
				var dim = this.getDimensions();
				this.grid.center = {};
				this.grid.center.x = x;
				this.grid.center.y = y;
				
				if(transform){
				        if(transform.translate){
				                var tran_x = transform.translate.x;
				                var tran_y =  transform.translate.y;
				                
				                this.grid.center.x += tran_x;
				                this.grid.center.y += tran_y;
				        }
				        if(transform.scale){
				                dim.width *= transform.scale.x;
				                dim.height *= transform.scale.y;
				        }
				}
				var newx = this.grid.center.x;
				var newy = this.grid.center.y;
				var radiusw = dim.width / 2;
				var radiush = dim.height / 2;
				this.grid ={x1: newx -radiusw ,x2: newx + radiusw, y1: newy - radiush, y2: newy + radiush,center:{x:newx,y:newy},width: dim.width,height:dim.height};	

				
				//console.log(this.grid.center.x,this.coordinates.normal,this.properties.transformation);
				return;
		}
		
		if(!coords) coords = this.getCoordinates();
		if(coords.length &lt; 2) return;
		this.grid.x1 = coords[0];
		this.grid.y1 = coords[1];
		this.grid.x2 = coords[0];
		this.grid.y2 = coords[1];
		
		this._deltas = []
		var d = this._deltas;

		var lastX, lastY;
		var index = 0;
	
		lastX = coords[0];
		lastY = coords[1];
		for(var i=0; i &lt; coords.length-1; i+=2){
			var xPos = parseFloat(coords[i]); //long
			var yPos = parseFloat(coords[i+1]); //lat
			var deltax =xPos - lastX;
			var deltay= yPos - lastY;
			if(deltax &lt; 0) deltax = - deltax;
			if(deltay &lt; 0) deltay = -deltay;
			d.push(deltax);
			d.push(deltay);
			if(xPos &lt; this.grid.x1) this.grid.x1 = xPos;
			if(yPos &lt; this.grid.y1) this.grid.y1 = yPos;	
			if(xPos &gt; this.grid.x2) this.grid.x2 = xPos;
			if(yPos &gt; this.grid.y2) this.grid.y2 = yPos;
			
			lastX = xPos;
			lastY = yPos;
		}
		
		//this.grid.x2 *= transform.scale.x;
		//this.grid.y2 *= transform.scale.y;
		this.grid.width = (this.grid.x2 - this.grid.x1);
		this.grid.height = (this.grid.y2 - this.grid.y1);
		/*var transform = this.getTransformation();
		if(transform &amp;&amp; transform.scale){
		        var scale = transform.scale;
		        this.grid.width *= scale.x;
		        this.grid.height *= scale.y;
		        
		}*/
		this.grid.center = {};
		this.grid.center.x = (this.grid.x2 - this.grid.x1) / 2 + this.grid.x1;
		this.grid.center.y = (this.grid.y2 - this.grid.y1) / 2 + this.grid.y1;
		
		//recalculate based on scaling
		this.grid.width *= transform.scale.x;
		this.grid.height *= transform.scale.y;
		this.grid.center.x += transform.translate.x;
		this.grid.center.y += transform.translate.y;
		
		var halfw = this.grid.width / 2;
		var halfh = this.grid.height /2;
		this.grid.x1 = this.grid.center.x - halfw;
		this.grid.x2 = this.grid.center.x + halfw;
		this.grid.y1 = this.grid.center.y - halfh;
		this.grid.y2 = this.grid.center.y + halfh;
		
/*		if(transform &amp;&amp; transform.translate){
		        var trans = transform.translate;
		        this.grid.center.x += trans.x;
		        this.grid.center.y += trans.y;
		}
*/
		this.grid.x1 = this.grid.center.x - (this.grid.width / 2);
		this.grid.x2 = this.grid.center.x + (this.grid.width /2);
		this.grid.y1 = this.grid.center.y - (this.grid.height/2);
		this.grid.y2 = this.grid.center.y +(this.grid.height/2);
		
		VismoTimer.end(&quot;VismoShapes._calculateBounds&quot;);
		//if(st == 'path') console.log(this,this.grid);
	}

    ,getCanvas: function(){
        return this.vismoCanvas;
    }
	,setRadius: function(rx,ry){
	    if(!ry) ry = rx;
		this.setDimensions(rx*2,ry*2);
	}
	,getRadius: function(){
		if(this.width) return this.width /2;
	    else{
	        var bb = this.getBoundingBox();
		    return bb.width / 2;
		}
		
	}
	,setDimensions: function(width,height){
		this.width = width;
		this.height = height;
		if(this.properties.shape == 'point'){
		    this.options.pointsize = width;
		}
		this._calculateBounds();
	    
	}
	,getDimensions: function(){
		return {width: this.width, height: this.height};
	}
	
	,_construct: function(properties, coordinates){
	    VismoTimer.start(&quot;VismoShapes._construct&quot;);
		var shapetype =properties.shape; 
		if(!shapetype) shapetype = 'polygon';
		if(shapetype == 'point' || shapetype == 'circle'){
			var radiusw,radiush;
			if(coordinates[2]) radiusw = coordinates[2];
			else radiusw = this.options.pointsize/2;
			
			if(coordinates[3]) radiush= coordinates[3];
			else radiush = radiusw;
			
			this.setDimensions(radiusw*2,radiush*2);
			this.setCoordinates([coordinates[0],coordinates[1],radiusw,radiush]);
			
		}
		else if(shapetype == 'polygon' || shapetype == 'path')
		{
			this.setCoordinates(coordinates);
		}
		else if(shapetype == 'domElement'){
					       
		        var w = jQuery(this.getProperty(&quot;element&quot;)).width(); 
		        var h = jQuery(this.getProperty(&quot;element&quot;)).height(); 
		        this.setDimensions(w,h);
		        this.setCoordinates(coordinates);

		}
		else if(shapetype == 'image'){
			var src = this.getProperty(&quot;src&quot;);
			if(!src) throw &quot;all images must carry a property src at minimum&quot;;
			var image = new Image();
			image.src= src;
			this.image = image;
			var vismoShape = this;
			var w = vismoShape.getProperty(&quot;width&quot;); h=  vismoShape.getProperty(&quot;height&quot;);
			if(coordinates.length &gt; 2){
				w = coordinates[2]; h = coordinates[3];
			}
			image.onload = function(){
				if(!w &amp;&amp; !h){
					vismoShape.setDimensions(w,h);
					vismoShape.setCoordinates([coordinates[0],coordinates[1]]);
				}
				vismoShape.ready = true;
			};
			if(image.complete)vismoShape.ready = true;
		
			vismoShape.setDimensions(w,h);
			vismoShape.setCoordinates([coordinates[0],coordinates[1]]);	
			
		}
		else{
			console.log(&quot;don't know how to construct basic shape &quot; + properties.shape);
		}		
		VismoTimer.end(&quot;VismoShapes._construct&quot;);	
		
	}	

	,_applyProjection: function(projection,transformation){
	    VismoTimer.start(&quot;VismoShapes._applyProjection&quot;);
		var c = this.getCoordinates('normal');
	
		if(!projection || !projection.xy) return c;
	
		if(projection.init) projection.init();
		var newc = [];
		for(var i=0; i &lt; c.length-1; i+=2){
			var moved = false;
			if(!VismoShapeUtils._isCoordinate(c[i])){
				i+= 1;
			}
			var x = parseFloat(c[i]);
			var y = parseFloat(c[i+1]);
			var newx,newy;
			var projectedCoordinate = projection.xy(c[i],c[i+1],transformation);
			if(projectedCoordinate.x &amp;&amp; projectedCoordinate.y){
				newx= projectedCoordinate.x;
				newy= projectedCoordinate.y;
			
				if(projectedCoordinate.move){
					moved  =true;
				}
			
				cok = true;
				//check we haven't wrapped around world (For flat projections sss)
				if(!projection.nowrap){
					var diff;
					if(newx &gt; x) diff = newx - x;
					if(x &gt; newx) diff = x - newx;
					if(diff &gt; 100) cok = false; //too extreme change
				}
			
				if(cok){
					if(VismoShapeUtils._isCoordinate(x) &amp;&amp; VismoShapeUtils._isCoordinate(y)){
						if(moved){
							newc.push(&quot;M&quot;);
						}
						newc.push(newx);
						newc.push(newy);
					}

				}
			}	
		}	
		if(newc.length &lt; 2) return;
		this.setCoordinates(newc,&quot;projected&quot;);
		this._calculateBounds(newc);
		VismoTimer.end(&quot;VismoShapes._applyProjection&quot;);
		return newc;
	}


	
	,optimise: function(canvas,transformation,projection,justcompute){
	    VismoTimer.start(&quot;VismoShapes.optimise&quot;);
	    var ocache = this._optimise_cache;

	    
	    var cid = transformation[&quot;cache&quot;][&quot;id1&quot;];
	    var cid2 =transformation[&quot;cache&quot;][&quot;id2&quot;];
	    
	    if(this.scale.x &gt; 1){
	        var newx,newy;
	        newx = this.scale.x  * transformation.scale.x;
	        newy = this.scale.y  * transformation.scale.y;
	        cid = newx + &quot;,&quot;+newy;
	    }
	    if(!ocache[cid]) ocache[cid] = {};
	    
        if(typeof(ocache[cid][cid2]) != &quot;undefined&quot;){
	        return ocache[cid][cid2];
        }
	    
	    var shapetype = this.properties.shape;
	    if(shapetype == &quot;path&quot;) {
	        ocache[cid][cid2] = true;
	        VismoTimer.end(&quot;VismoShapes.optimise&quot;);
	        return true;
		}
		if(transformation &amp;&amp; transformation.scale) {
		    this.currentResolution = Math.min(transformation.scale.x, transformation.scale.y);
		}
		if(projection) {this._applyProjection(projection,transformation);}
		
		if(shapetype != 'point' &amp;&amp; shapetype != 'path' &amp;&amp; shapetype !=&quot;domElement&quot;){ //check if worth drawing				
			if(VismoOptimisations.vismoShapeIsTooSmall(this,transformation)) {
				if(!justcompute &amp;&amp; this.vml)this.vml.clear();
				ocache[cid][cid2] = false;
				VismoTimer.end(&quot;VismoShapes.optimise&quot;);
				return false;	
			}	
		}
		
		if(!VismoOptimisations.vismoShapeIsInVisibleArea(this,canvas,transformation)){
			if(!justcompute &amp;&amp; this.vml)this.vml.clear();
			ocache[cid][cid2] = false;
			VismoTimer.end(&quot;VismoShapes.optimise&quot;);
			return false;	
		}
		ocache[cid][cid2] = true;
		VismoTimer.end(&quot;VismoShapes.optimise&quot;);
		return true;
	}
	,optimise_ie: function(canvas,transformation,projection){	
	    VismoTimer.start(&quot;VismoShape.optimise_ie&quot;);
	    var ocache = this._optimise_cache;
	    var cid = transformation[&quot;cache&quot;][&quot;id1&quot;];
        if(typeof(ocache[cid]) != &quot;undefined&quot;){
	        return ocache[cid];
        }
        VismoOptimisations.minradius = 6;
	    var sh = this.properties.shape;
		if(sh == 'path' || sh == 'point') {
		        ocache[cid] =true;
               return true;
        }
        
		if(VismoOptimisations.vismoShapeIsTooSmall(this,transformation)) {
				if(this.vml)this.vml.clear();
                VismoTimer.end(&quot;VismoShape.optimise_ie&quot;);
				ocache[cid] =false;
				return false;		
		}
        ocache[cid] =true;
        VismoTimer.end(&quot;VismoShape.optimise_ie&quot;);
		return true;
	}
	
	,_simplifyCoordinates: function(scaleFactor,coordinates){// **
		VismoTimer.start(&quot;VismoShapes._simplifyCoordinates&quot;);
		if(this.getProperty(&quot;shape&quot;) == 'path') return coordinates;
		/*will use http://www.jarno.demon.nl/polygon.htm#ref2 */
		if(!coordinates) throw &quot;give me some coordinates!&quot;;
		var originals =coordinates;
		var tolerance;
		var bb = this.getBoundingBox();
		
		var d;
		if(bb.width &lt; bb.height) d = bb.width;
		else d = bb.height;
		tolerance = (d/4) / scaleFactor;
		
		coordinates = VismoOptimisations.packCoordinates(coordinates);
		coordinates = VismoOptimisations.douglasPeucker(coordinates,tolerance);
		
		coordinates = VismoOptimisations.unpackCoordinates(coordinates);	
		
		var diff = originals.length - coordinates.length;
		
		VismoTimer.end(&quot;VismoShapes._simplifyCoordinates&quot;);
		if(diff &lt; 10) return originals;
		else 
		return coordinates;	
	}


};/*
A package for rendering geojson polygon and point features easily to create maps
*/
var GeoTag = function(longitude,latitude,properties){
	var geo = {};
	geo.type = &quot;feature&quot;;
	geo.geometry = {};
	geo.geometry.type = &quot;point&quot;;
	geo.geometry.coordinates = [longitude,latitude];
	geo.properties = properties;
	return geo;	
};

var VismoMap = function(wrapper,options){  
    
    if(wrapper.length){ //for jquery
        var result = [];
        for(var i=0; i &lt; wrapper.length; i++){
            var x = new VismoMap(wrapper[i],options);
            result.push(x);
        }
        return x;
    }
    
	if(typeof wrapper == 'string') wrapper = document.getElementById(wrapper);
	else wrapper = wrapper;
		
	this.wrapper = wrapper;
	wrapper.vismoMap = this;
	//wrapper.style.position = &quot;relative&quot;;
	var that = this;
	this.settings = {};
	var w= jQuery(wrapper).width();
	var h= jQuery(wrapper).height();
	jQuery(wrapper).css({width:w,height:h});
	
	this.feature_reference = {};
	if(!options) options = {};


	var that = this;
	var handler = function(t){
	    that.transform(t);
	}
	//if(!options.vismoController) options.vismoController = {};
	if(options.vismoController)options.vismoController.handler = handler;

	this.vismoCanvas = new VismoCanvas(wrapper,options);
	this.controller = this.vismoCanvas.vismoController;
	
	//run stuff
	if(this.controller)this.transform(this.controller.transformation); //set initial transformation
	this._fittocanvas = true;
	this.geofeatures = {};
	this.features = [];
	this.clear();
	
	var proj = options.projection;
	var eMap = this;
	this._hijackMouseFunctions();
	if(options.tooltip){
	    this.vismoCanvas.addTooltip(function(el,s){
	        if(s){
	        el.innerHTML = s.getProperty(&quot;name&quot;);
            }
	    });
	    
	}
		this.mouse({down:options.mousedown,up:options.mouseup,move:options.move,dblclick:options.dblclick,keypress:options.keypress});
	
	var eMap = this;
	if(proj){
		if(proj == 'globe' || proj == 'spinnyglobe'){
			eMap = new VismoGlobe(this);
			if(proj == 'spinnyglobe'){
				eMap.toggleSpin();
			}
		}
		if(proj == 'google'){
			eMap.settings.projection = VismoSlippyMap.prototype.getGoogleMercatorProjection();
		}
		else if(proj == 'slippystaticmap'){
			eMap = new VismoSlippyMap(this);					
		}
		
	}
	
	if(options.geojson){
	    this.drawFromGeojson(options.geojson,options.fullscreen);
	}
	else if(options.georss){
	    this.drawFromGeojson(VismoConversion.geoRssToGeoJson(options.georss),options.fullscreen);
	}
	else if(options.kml){
	    this.drawFromGeojson(VismoConversion.kmlToGeoJson(options.kml),options.fullscreen);
	}
	return eMap;
};  
VismoMap.prototype = {
	setTransparency: function(args){
	    var alpha = arguments[0];
		this.vismoCanvas.setTransparency(alpha);
	}
	,getVismoShapes: function(args){
		return this.vismoCanvas.getMemory();
	}
	,resize: function(args){
	    var width = arguments[0];
	    var height = arguments[1];
		this.wrapper.style.width = width+&quot;px&quot;;
		this.wrapper.style.height = height +&quot;px&quot;;
		var  t=this.getTransformation();
		t.origin.x = width / 2;
		t.origin.y = height / 2;
		this.setTransformation(t);
		this.vismoCanvas.resize(width,height);

		this.clear();

	}
	,getProjection: function(args){
		return this.settings.projection;
	}
	,setProjection: function(args){
	    var projection = arguments[0];
		this.settings.projection = projection;

	}
	,clear: function(args){ /* does this work in IE? */
		var deleteMemory = arguments[0];
		this.vismoCanvas.clear(deleteMemory);
	},
	
	drawFromGeojson: function(args){
        var geojson = arguments[0];
        var autosize = arguments[1];
			if(typeof geojson == 'string'){
				geojson = eval('(' +geojson+ ')');
			}
							
			this._lastgeojson = geojson;
			if(autosize){
			 	var t = VismoMapUtils.fitgeojsontocanvas(geojson,this.wrapper);

				var p =this.getProjection();
				if(p &amp;&amp; p.name == &quot;GLOBE&quot;) {
					t.translate = {x:0,y:0};
				}
					
				this.controller.setTransformation(t);
			}
		
			var type =geojson.type.toLowerCase();		
	 
			if(type == &quot;featurecollection&quot;){
				var features = geojson.features;
				this.drawGeoJsonFeatures(features);
			}  else if(type =='feature') {
				this.drawGeoJsonFeature(geojson);
			} else {
				console.log(&quot;only feature collections currently supported&quot;);
			}

			this.render();
			
	},
	drawFromGeojsonFile: function(args){
	    var file = arguments[0];
		var that = this;
		var callback = function(status,params,responseText,url,xhr){
		
			that.drawFromGeojson(responseText);
		};
		VismoFileUtils.loadRemoteFile(file,callback);
	}

	,getTransformation: function(args){
		if(!this.transformation){
			return false;
		}
		else
			return this.transformation;
	}
	,setTransformation: function(args){
	    var transformation = arguments[0];
		if(typeof transformation.translate.x != 'number'||typeof transformation.translate.y != 'number') throw &quot;bad transformation translate given &quot;;
		if(typeof transformation.scale.x != 'number'||typeof transformation.scale.y != 'number') throw &quot;bad transformation scale given &quot;;
		
		this.controller.setTransformation(transformation);
	}
	,moveTo: function(args){
	    var longitude= arguments[0];
	    var latitude = arguments[1];
	    var zoom = arguments[2];
		var newt = {translate:{},scale:{}};
		var transformation =this.getTransformation();
		
		var newxy={};
		newxy.x = parseFloat(longitude);
		newxy.y = parseFloat(latitude);
		
		if(this.settings.projection){
		 	newxy = this.settings.projection.xy(newxy.x,newxy.y,transformation);
		}
		newt.translate.x = - newxy.x;
		newt.translate.y = newxy.y;
		
		if(!zoom){
			zoom =transformation.scale.x;
		}
		else{
			zoom = parseFloat(zoom);
		}
		newt.scale.x = zoom;
		newt.scale.y = zoom;
		this.controller.setTransformation(newt)
		
	}

	,redraw: function(args){
		this.render();	

	    //alert(&quot;average VML render&quot;+ VismoVector.rstats);
	    //alert(&quot;total average VML render time&quot;+ VismoVector.rstats * VismoVector.rnum);
	},
		
	transform: function(args){
	    var transformation = arguments[0];
		//console.log(arguments);
		var w =parseInt(this.wrapper.style.width);
		var h = parseInt(this.wrapper.style.height);
		var t =transformation.translate;
		var s = transformation.scale;
	
		this.transformation = transformation;
		/*if(!transformation.origin){
			this.transformation.origin = {};
			var origin = this.transformation.origin;
			origin.x =w / 2;
			origin.y =h / 2;
		}*/
		
		if(s.x &lt; 0.5) s.x = 0.5;
		if(s.y &lt; 0.5) s.y = 0.5;
		
		if(t.x &gt; 180) t.x = 180; //t.x=Math.min(t.x, 180)
		if(t.x &lt; -180) t.x = -180;
		
		if(t.y &gt; 85.0511) t.y = 85.0511;
		if(t.y &lt; -85.0511) t.y = -85.0511;
		
		if(!this.transformation.rotate){
				this.transformation.rotate = {x:0,y:0,z:0};
		}
			
		
		var that = this;
		var f = function(args){
		    that.vismoCanvas.setTransformation(that.transformation);
		    that.redraw();
		}
		window.setTimeout(f,0);

	},


	/*onmouseup and ove are functions with following parameters:
		e,shape,mouse,longitude_latitude,feature
		
	*/
	mouse: function(args){
 	    if(!args){
	        return {up: this.onmouseup, down: this.onmousedown, move: this.onmousemove, dblclick: this.ondblclick,keypress:this.onkeypress};
	    }
			if(args.move)this.onmousemove =args.move;
			if(args.up)this.onmouseup = args.up;
			if(args.down)this.onmouseup = args.down;
			if(args.keypress) this.onkeypress = args.keypress;
			if(args.dblclick) this.ondblClick = args.dblclick;
	}

	,_hijackMouseFunctions: function(args){
	        var eMap = this;
	        var getParameters = function(e){
			var result = {};
			var code;
			if (e.which) code =e.which;
			else if (e.keyCode) code = e.keyCode;
			var character;
			if(code) character = String.fromCharCode(code);	
			var t = VismoClickingUtils.resolveTargetWithVismo(e);
			if(t &amp;&amp; t.getAttribute(&quot;class&quot;) == 'vismoControl') return false;
			var shape = eMap.vismoCanvas.getShapeAtClick(e);
			if(shape) {
				result.shape = shape;
				result.feature = eMap.geofeatures[eMap.vismoCanvas.getMemoryID(shape)];
			}
		
			
			var pos = VismoClickingUtils.getMouseFromEvent(e);
			var x =pos.x;
			var y = pos.y;
			result.mouse = pos;
			result.longitude_latitude = VismoMapUtils.getLongLatFromMouse(x,y,eMap);
			result.event = e;
			result.keypressed = character;
			return result;
			
		};
		
		 var md = function(e,s){
	                var r = getParameters(e);
	                if(eMap.onmousedown) eMap.onmousedown(e,s,r.mouse,r.longitude_latitude,r.feature,r.key,eMap);
	        };
	        
	        var mu = function(e,s){
	                var r = getParameters(e);
	                if(eMap.onmouseup) eMap.onmouseup(e,s,r.mouse,r.longitude_latitude,r.feature,r.key,eMap);
	        };
	        var mm = function(e,s){
	            
	                var r = getParameters(e);
	                if(eMap.onmousemove) eMap.onmousemove(e,s,r.mouse,r.longitude_latitude,r.feature,r.key,eMap);	                
	        };
	        var dbl = function(e,s){
	                var r = getParameters(e);
        	        if(eMap.ondblClick) eMap.ondblClick(e,s,r.mouse,r.longitude_latitude,r.feature,r.key,eMap);
	        };
	        var key = function(e,s){
	                var r = getParameters(e);
                        if(eMap.onkeypress) eMap.onkeypress(e,s,r.mouse,r.longtitude_latitude,r.feature,r.key,eMap);
	        }
	        this.vismoCanvas.mouse({mousedown:md,mouseup:mu,mousemove:mm,dblclick:dbl,keypress:key});
	}

	,render: function(args){
	    var d1 = new Date();
	    var flag = arguments[0];
		var tran =this.transformation;

		var that = this;

		this.vismoCanvas.render(this.settings.projection);
		if(this.settings.afterRender) {
			this.settings.afterRender(tran);
			
		}
		var t = document.getElementById(that.wrapper.id + &quot;_statustext&quot;);
		if(t) {
			t.parentNode.removeChild(t);	
		}
		var d2 = new Date();
		var id=&quot;mapRender&quot;;
		if(!VismoTimer[id]) VismoTimer[id] = 0;
		VismoTimer[id] += (d2 - d1);
		
		
		
	
	},
	
	getFeatures: function(args){
	       if(arguments[0] &amp;&amp; this.features[arguments[0]]) return this.features[arguments[0]];
	       return this.features;
	}
	,drawGeoJsonFeature: function(args){
	    var featuredata = arguments[0];
	    var props = arguments[1];
		var feature = new VismoMap.Feature(featuredata,props);		
		var s = feature.getVismoShapes();		
		for(var i=0; i &lt; s.length; i++){
			this.vismoCanvas.add(s[i]);
			//this.geofeatures[this.vismoCanvas.getMemoryID(s[i])] = feature;
		}	
         this.features.push(feature);
	},
	drawGeoJsonFeatures: function(args){
	    var features = arguments[0];
			var avg1 = 0;
				
			for(var i=0; i &lt; features.length; i++){
			
				this.drawGeoJsonFeature(features[i],{featureid:i});
			}

	}
	,getVismoCanvas: function(args){
	        return this.vismoCanvas;
	}
};


VismoMap.Feature = function(feature,props){
	this.init(feature,props);
};

VismoMap.Feature.prototype = {
	init: function(args){
	    var feature = arguments[0];
	    if(arguments[1])extra_properties = arguments[1];
	    else extra_properties = {};
		this.properties = feature.properties;
		this.geometry = feature.geometry;
		this.outers = [];
		this.vismoShapes = [];
		var geometry = this.geometry;
		var type =geometry.type.toLowerCase();

		if(type == 'multipolygon'){
			this._drawGeoJsonMultiPolygonFeature(feature.geometry.coordinates,feature);
		}
		else if(type == 'linestring' || type=='multilinestring' || type == 'multipoint' || type=='geometrycollection'){
			console.log(type + &quot; not supported yet&quot;);
		}

		else if(type == 'polygon'){
			this._drawGeoJsonPolygonFeature(feature.geometry.coordinates,feature);
		}
		else if(type == 'point'){
			this._drawGeoJsonPointFeature(feature.geometry.coordinates,feature);				
		}
		else {	
			console.log(&quot;unsupported geojson geometry type &quot; + geometry.type);
		}		
        var x = this.getVismoShapes();
        var f;
  
        for(f in extra_properties){
    
             for(var i=0; i &lt; x.length; i++){
                x[i].setProperty(f,extra_properties[f]);
            }
        }
	}
	,addOuterVismoShape: function(args){
		var shape = arguments[0];
		this.outers.push(shape);
	}
	,getOuterVismoShapes: function(args){
		return this.outers;
	}
	,addVismoShape: function(args){
	    var vismoShape = arguments[0];
		this.vismoShapes.push(vismoShape);
	}
	,getVismoShapes: function(args){
		return this.vismoShapes;
	}
	,_drawGeoJsonMultiPolygonFeature: function(args){
	    var coordinates=  arguments[0];
	    var feature = arguments[1];
		var outer;
		
		for(var i=0; i &lt; coordinates.length; i++){ //it's a list of polygons!
			var s = this._drawGeoJsonPolygonFeature(coordinates[i],feature,i);
			
		}
		
	},	
	_drawGeoJsonPolygonFeature: function(args){
        var coordinates=  arguments[0];
	    var feature = arguments[1];
	    var featureid = arguments[2];
		var p = feature.properties;
		p.shape = 'polygon';
		//console.log(coordinates[0]);
		
		var outer = false;
		for(var j=0; j&lt; coordinates.length; j++){//identify and create each polygon
			var coords =coordinates[j];	
			coords = VismoUtils.invertYCoordinates(coords);
			var s = new VismoShape(p,coords);
			s.properties.geometryid = featureid;
			s.properties.geometryid2 = j;
			this.addVismoShape(s);
		}
		return outer;		
		
	},
	_drawGeoJsonPointFeature: function(args){
	    var coordinates=  arguments[0];
	    var feature = arguments[1];

		var p = feature.properties;
		p.shape = 'point';
		coordinates[1] = -coordinates[1];
		var s = new VismoShape(p,coordinates);
		this.addVismoShape(s);
	}
	,setProperty: function(args){
	    var id = arguments[0];
	    var val = arguments[1];
	    var shapes = this.getVismoShapes();
	    for(var i=0; i &lt; shapes.length;i++){
	        shapes[i].setProperty(id,val);
	    }
	}
};
/*Extends VismoMaps to provide tiled background */
var VismoGlobe=  function(eMap){
	var i;
	for(i in VismoGlobe.prototype){
		eMap[i] = VismoGlobe.prototype[i];
	}	
	
	eMap.setGlobeProjection(&quot;GLOBE&quot;);
	return eMap;
	
};

VismoGlobe.prototype = {
	setGlobeProjection: function(){
		var vismomap = this;
		vismomap._fittocanvas = false;
		this.settings.beforeRender = function(t){
				vismomap._createGlobe(vismomap.getProjection().getRadius(t.scale));
		};
		
		this.settings.projection= {
				name: &quot;GLOBE&quot;,
				nowrap:true,
				radius: 10,
				direction: 0
				,init: function(){
					this.direction = 0;
				}
				,getRadius: function(){
					return this.radius;
				}
				,inversexy: function(x,y,t){
						var radius =this.getRadius(t.scale);
						var res = VismoMapUtils._undospherify(x,y,t,radius);
						return res;
				}
				,xy: function(x,y,t){
					
					var radius =this.getRadius(t.scale);
					if(!radius || !x || !y || !t) return {x:x,y:y};
					var res = VismoMapUtils._spherifycoordinate(x,y,t,radius);
					/*
					if(res.movedNorth &amp;&amp; this.direction &gt;= 0){
						this.direction = -1;
						res.move= true;
					}
					else if(res.movedSouth &amp;&amp; this.direction &lt;= 0){
						this.direction = 1;
						res.move = true;
					}
					
					if(res.y &gt; radius - 10 || res.y &lt; 10-radius){
						
						res.y = false;
					}*/
					return res;
				}
		};
		
		var heightR = parseInt(vismomap.wrapper.style.height)  /2;
		var widthR= parseInt(vismomap.wrapper.style.width) /2;
		if(widthR &gt; heightR){
			this.settings.projection.radius = heightR;
		}
		else{
			this.settings.projection.radius = widthR;
		}
		
	
		
	}
	,toggleSpin: function(){
		var eMap = this;
		var f = function(){
			var t = eMap.controller.transformation;
			if(!t.rotate) t.rotate = {};
			if(!t.rotate.z) t.rotate.z  = 0;
		
			t.rotate.z += 0.3;
			eMap.controller.setTransformation(t);
			window.setTimeout(f,600);
		};
		f();
	}
	,_createGlobe: function(radius){
		if(VismoUtils.browser.isIE) {return;}
		var ctx = this.vismoClicking.canvas.getContext('2d');
		if(!ctx) return;
		var t =this.controller.transformation;
		var tr =t.translate;
		var s = t.scale;
		var o = t.origin;
		ctx.save();	
		ctx.translate(o.x,o.y);
		ctx.scale(s.x,s.y);
		ctx.translate(tr.x,tr.y);
	
	
		var radgrad = ctx.createRadialGradient(0,0,10,0,0,radius);

		radgrad.addColorStop(0,&quot;#AFDCEC&quot;);
		radgrad.addColorStop(0.5, '#00C9FF');
		radgrad.addColorStop(1, '#00B5E2');
		radgrad.addColorStop(1, 'rgba(0,201,255,0)');

		ctx.beginPath();
		ctx.arc(0, 0, radius, 0, Math.PI*2, true);
		ctx.closePath();
		ctx.fillStyle = radgrad;
		ctx.fill();
		ctx.restore();

	}
};



var VismoSlippyMap = function(vismoMap){	
	//vismoMap.resize(512,512);
	this.loadedurls = {};
	this.setupSlippyStaticMapLayer(vismoMap);

        vismoMap.oldDrawFromGeojson = vismoMap.drawFromGeojson
         vismoMap.drawFromGeojson = function(geojson,autosize){
                vismoMap.oldDrawFromGeojson(geojson,false);
        };
        
	return vismoMap;
};

VismoSlippyMap.prototype = {
	getGoogleMercatorProjection: function(vismomap){
		
		var p = {};
		p.source = new Proj4js.Proj('WGS84');//
		p.dest = new Proj4js.Proj('GOOGLE');
		p.resultCache = {};
		var that = this;
		p.getTileServerUrl = function(){
		        return that.tileserverurl;
		}
		p.tilesize = 256;
		p.googleHack = 1/((2 * Math.PI * 6378137) /p.tilesize);
		p.inversexy = function(x,y){
			x /= this.googleHack;
			y /= this.googleHack;
			var pointSource = new Proj4js.Point(x ,y);
			var pointDest = Proj4js.transform(p.dest,p.source, pointSource);

			return pointDest;
		}

		p.calculatescalefactor= function(vismomapscale,res){
			
			if(!res){ 
				if(vismomapscale &lt;= 1){
					return 0;
				}
				else{
					res = 0;
				}
			}
			
			if(vismomapscale &lt;= 1){
				return res;
			}
			else{
				var news = vismomapscale / 2;
				res +=1 ;
				return this.calculatescalefactor(news,res);
			}
		};
		p.xy = function(x,y,t){
			
				if(this.resultCache[x+&quot;|&quot;+y]) {
					return this.resultCache[x+&quot;|&quot;+y];
				}
				var pointSource = new Proj4js.Point(x,y);
				var pointDest = Proj4js.transform(p.source,p.dest, pointSource);


				var newx =pointDest.x;
				var newy = pointDest.y;
				newx *= this.googleHack;
				newy *= this.googleHack;
				
				this.resultCache[x+&quot;|&quot;+y] = {x:newx , y:newy};
				return this.resultCache[x+&quot;|&quot;+y];
				
		}
		return p;
	}
	,setupSlippyStaticMapLayer: function(eMap){
		/*Filename(url) format is /zoom/x/y.png */
		
		var projection = this.getGoogleMercatorProjection(eMap);
		//var projection = {};
		eMap.setTransparency(0.7);
		eMap.settings.projection = projection;
		var that = this;
		
		var mapheight =parseInt(eMap.wrapper.style.height);
		var mapwidth =parseInt(eMap.wrapper.style.width);
		var tileGridDimension = {x:mapwidth/projection.tilesize + 1,y:(mapheight/projection.tilesize) + 1};
		var tiles = this._createTiles(eMap,tileGridDimension.x,tileGridDimension.y);
		var eMap = eMap;
		
		eMap.settings.afterRender = function(transformation){
		        var origin = transformation.origin;
			jQuery(that.tilesWrapper).css({top: origin.y, left: origin.x});
			var zoomOut = false;
			if(eMap.settings.lastScale &gt; transformation.scale.x)
				zoomOut = true;
			eMap.settings.lastScale = transformation.scale.x;
			var x =0,y =0,lo,la, translate= transformation.translate,scale= transformation.scale;
		
			eMap.wrapper.style.backgroundImage = &quot;none&quot;;
			var zoomL = projection.calculatescalefactor(scale.x);	
	
				
			var mapheight =parseInt(eMap.wrapper.style.height);
			var mapwidth =parseInt(eMap.wrapper.style.width);
			
			var tile = tiles[&quot;main&quot;];
			var left = (scale.x * translate.x);
			var top = (scale.y * translate.y);
			top += (origin.y - 128);
			left += (origin.x - 128);
			tile.style.top = top + &quot;px&quot;;
			tile.style.left = left + &quot;px&quot;;
			if(zoomL == 0){
				var i;
				for(i in tiles){
					tiles[i].style.backgroundImage =&quot;none&quot;;
				}
				zoomL = 0;
				tilex = 0;tiley=0;
				var slippyurl =projection.getTileServerUrl()+zoomL +&quot;/&quot;+tilex+&quot;/&quot;+tiley+&quot;.png&quot;;
				that.renderTile(slippyurl,zoomL,tilex,tiley,tile);					
			}
			else{
				
				tiles.main.style.backgroundImage = &quot;none&quot;;
				var temp ={x: (translate.x),y:(translate.y)};
				temp.x *= scale.x;
				temp.y *= scale.y;				
				temp.x += (origin.x);
				temp.y += (origin.y);
				var tlleft = temp.x;
				var tltop =temp.y;
				//brtop = brtop%(256);
				tlleft= temp.x % 256;
				tltop =  temp.y % 256;
                                if(tltop &gt; 0) tltop -= 256;
                                if(tltop &lt; -256) tltop += 256;
                                if(tlleft &lt; -256) tlleft += 256;
		                if(tlleft &gt; 0) tlleft -= 256;
				var lola;
				
				lola = VismoMapUtils.getLongLatAtXY(tlleft+128,tltop+128,eMap);
			
				var tltilexy =VismoMapUtils.getSlippyTileNumber(lola.longitude,lola.latitude,zoomL,eMap);
				
				for(var idX=0; idX &lt; tileGridDimension.x; idX++){
					for(var idY=0; idY &lt; tileGridDimension.y; idY++){
						var leftShift = idX;
						var upShift = idY;
						var index = idX + &quot;|&quot;+idY;
						var tile = tiles[index];
						var top = tltop + (256 * idY);
						var left = tlleft + (256 *idX);
						var tilex = tltilexy.x + idX;
						var tiley = tltilexy.y + idY;

						
						var numtiles = Math.pow(2,zoomL);
						if(tilex &lt;  0) tilex = numtiles + tilex;
						if(tiley &lt; 0) tiley = numtiles + tiley;
						if(tilex &gt;= numtiles) tilex -= numtiles;
						if(tiley &gt;= numtiles) tiley -= numtiles;
					
						tile.style.left = left +&quot;px&quot;;
						tile.style.top = top + &quot;px&quot;;
						tile.title = zoomL+&quot;/&quot;+tilex + &quot;/&quot; + tiley;
						var slippyurl =&quot;http://tile.openstreetmap.org/&quot;+zoomL +&quot;/&quot;+tilex+&quot;/&quot;+tiley+&quot;.png&quot;;
						that.renderTile(slippyurl,zoomL,tilex,tiley,tile);
						
					}

				}
			
		
			}

		};
		
		
	}
	,renderTile: function(weburl,zoomlevel,x,y,tile){
		var that = this;
		var renderTile = function(dest){
			tile.style.backgroundImage = &quot;none&quot;;
			var style =&quot;url('&quot;+dest+&quot;')&quot;;
			if(style == tile.style.backgroundImage) return;
			tile.style.backgroundImage = style;
			//var numtiles = Math.pw(2,zoomL);

		};
		var renderTileWeb = function(url){
			var style =&quot;url('&quot;+url+&quot;')&quot;;
			tile.style.backgroundImage = &quot;none&quot;;
			if(style == tile.style.backgroundImage) return;
			tile.style.backgroundImage = style;

		};
		try{	
			var localurl = zoomlevel+ &quot;_&quot;+ x + &quot;_&quot; + y + &quot;.png&quot;;
			if(localurl != tile.style.backgroundImage){
				if(that.loadedurls[localurl]){
					renderTile(localurl);
				}
				else{
					tile.style.backgroundImage = &quot;none&quot;;
					VismoFileUtils.saveImageLocally(weburl,localurl,renderTile,renderTileWeb);
					that.loadedurls[localurl] = true;
				}
			}
		}
		catch(e){
			tile.style.backgroundImage = &quot;none&quot;;
			//console.log(&quot;unable to cache static image for this map view. (&quot;+e+&quot;)&quot;)
		}
	}
	,_createTiles: function(eMap,numtilesx,numtilesy){
		var res = {};
		var tiles = document.createElement(&quot;div&quot;);
		tiles.style.overflow = &quot;hidden&quot;;
		tiles.className = &quot;VismoTileWrapper&quot;
		tiles.style.position= &quot;absolute&quot;;
		tiles.style.width = eMap.wrapper.style.width;
		tiles.style.height = eMap.wrapper.style.height;
		var maintile = document.createElement(&quot;div&quot;);
		maintile.style.position = &quot;absolute&quot;;
		maintile.style.width = &quot;256px&quot;;
		maintile.style.height = &quot;256px&quot;;
		tiles.appendChild(maintile);
		
		for(var y = 0; y &lt; numtilesy; y++){
			for(var x = 0; x &lt; numtilesx; x++){
				var tile = document.createElement(&quot;div&quot;);
				tile.className = &quot;tile_&quot;+x+ &quot;_&quot;+y;
				tile.style.position = &quot;absolute&quot;;
				tile.style.width = &quot;256px&quot;;
				tile.style.height = &quot;256px&quot;;
				//if(x == 0 &amp;&amp; y == 0) tile.style.border = &quot;solid 1px black&quot;;
				var index =x+&quot;|&quot;+y;
				tiles.appendChild(tile);
				res[index] = tile;
			}
		}
		
		eMap.wrapper.appendChild(tiles);
		
		res['main'] = maintile;
		return res;
		

		
	}
	
};/*requires VismoShapes
Adds controls such as panning and zooming to a given dom element.

Mousewheel zooming currently not working as should - should center on location where mousewheel occurs
Will be changed to take a handler parameter rather then a targetjs
 */


var VismoController = function(elem,options){ //elem must have style.width and style.height etM  
   
    if(elem.length){ //for jquery
        var result = [];
        for(var i=0; i &lt; elem.length; i++){
            var x = new VismoController(elem[i],options);
            result.push(x);
        }
        return x;
    }
     
    if(!options)options = {};
        if(elem.vismoController) throw &quot;this already has a vismo controller!&quot;
        elem.vismoController = true;// this;              
	this.enabledControls = [];

	if(typeof elem == 'string') elem= document.getElementById(elem);
	this.setLimits({});
	
	//jQuery(elem).css()
	//if(!elem.style || !elem.style.position) elem.style.position = &quot;relative&quot;;
	this.wrapper = elem; //a dom element to detect mouse actions
	this.handler = options.handler; //a js object to run actions on (with pan and zoom functions)	
	this.defaultCursor = &quot;&quot;;
	var md = elem.onmousedown;
	var mu = elem.onmouseup;
	var mm = elem.onmousemove;
	for(var i=0; i &lt; elem.childNodes.length; i++){
		var child = elem.childNodes[i];
	    try{
		child.onmousedown = function(e){if(md)md(e);}
		child.onmouseup = function(e){if(mu)mu(e);}
		child.onmousemove = function(e){if(mm)mm(e);}
		}
		catch(e){
		    
		}
	}
        
	controlDiv = document.createElement('div');
	controlDiv.style.position = &quot;absolute&quot;;
	controlDiv.style.top = &quot;0&quot;;
	controlDiv.style.left = &quot;0&quot;;
	controlDiv.className = 'vismoControls';
	jQuery(controlDiv).css({'z-index':10000, height:&quot;120px&quot;,width:&quot;60px&quot;});
	this.wrapper.appendChild(controlDiv);
	this.controlDiv = controlDiv;
        this.controlCanvas = new VismoCanvas(this.controlDiv);
	//this.controlDiv.vismoController = this;
	var vismoController = this;
	var preventDef = function(e){
                if (e &amp;&amp; e.stopPropagation) //if stopPropagation method supported
                 e.stopPropagation()
                else
                 e.cancelBubble=true
          return false;      
	};
	var that = this;
	var f = function(e,s){
	        var vismoController = that;
	        vismoController._panzoomClickHandler(e,s,vismoController);
	        return preventDef(e);
	};
	this.controlCanvas.mouse({up:preventDef,down:f,dblclick:preventDef});

	//this.wrapper.vismoController = this;
	
	

	this.transformation = {'translate':{x:0,y:0}, 'scale': {x:1, y:1},'rotate': {x:0,y:0,z:0},origin:{}};	
	             
	             
	
	this.transformation.origin.x = jQuery(elem).width() / 2;
	this.transformation.origin.y = jQuery(elem).height() / 2;
        var t = this.transformation;

	//looks for specifically named function in targetjs
	if(!this.handler) {
	    alert(&quot;no transform handler function defined&quot;);
	}
	//this.wrapper.vismoController = this;
	this.enabled = true;


	if(!options) options = {};
	if(!options.controls)options.controls =['pan','zoom','mousepanning','mousewheelzooming'];
	this.options = options;
	if(!this.options.controlStroke){
        this.options.controlStroke = &quot;#000000&quot;;
    }
    if(!this.options.controlFill){
        this.options.controlFill = &quot;rgba(150,150,150,0.7)&quot;;
    }
    
    
	this.addControls(this.options.controls);
	this.limits = {scale:{}};
	if(this.options.maxZoom) {
	    this.limits.scale.x =this.options.maxZoom;
	    this.limits.scale.y = this.options.maxZoom;
    }
    if(this.options.minZoom){
        
        this.limits.scale.minx =this.options.minZoom;
         this.limits.scale.miny =this.options.minZoom;
    }

    this.pansensitivity =100;
    if(this.options.pansensitivity){
        this.pansensitivity =this.options.pansensitivity;
    }


};
VismoController.prototype = {
	setLimits: function(transformation){
	        this.limits = transformation;
	}
	,getHandler: function(){
	    return this.handler;
	}
	,setHandler: function(handler){
	    this.handler = handler;
	    handler(this.transformation);
	}
	,getEnabledControls: function(){
	        return this.enabledControls;
	}
	,_addEnabledControl: function(controlName){
	        this.enabledControls.push(controlName);      
	}
	,applyLayer: function(){
	        var that = this;
	        var hidebuttons = function(){
	               var shapes = that.controlCanvas.getMemory();
	                for(var i=0; i &lt; shapes.length; i++){
	                        shapes[i].setProperty(&quot;hidden&quot;,true);
	                }

	                that.controlCanvas.render();
	        };	        
	        this.controlCanvas.render();
	        if(this.options.hidebuttons){
	                hidebuttons();
	                return;
	        }
	        
	       	       
	        if(VismoUtils.browser.isIE6) return;
	        var enabled = this.getEnabledControls();
	        var pan,zoom;
	        if(enabled.contains(&quot;pan&quot;)) pan = true;
	        if(enabled.contains(&quot;zoom&quot;)) zoom = true;
                var callback = function(response){
                        if(!response)return;
                        if(!VismoUtils.svgSupport())return;
                        
                        var shape;
                        if(false == true){
                                //return;
                                shape = document.createElement(&quot;div&quot;);
                                shape.innerHTML = response;
                        }
                        else{
                                shape = document.createElement('object');
                                
                                shape.setAttribute('codebase', 'http://www.adobe.com/svg/viewer/install/');
                                if(VismoUtils.browser.isIE)shape.setAttribute('classid', '15');
                                shape.setAttribute('style',&quot;overflow:hidden;position:absolute;z-index:0;width:60px;height:120px;&quot;);
                                shape.setAttribute('type',&quot;image/svg+xml&quot;);
                                var dataString = 'data:image/svg+xml,'+ response;
                                shape.setAttribute('data', dataString); // the &quot;&lt;svg&gt;...&lt;/svg&gt;&quot; returned from Ajax call                                      
                                jQuery(shape).css({width:60,height:120})
                        }
                        that.controlDiv.appendChild(shape);
                        jQuery(that.controlDiv).css({&quot;background-image&quot;:&quot;none&quot;});
                        hidebuttons();
                };
	        if(pan &amp;&amp; zoom) callback(this.panzoomcontrolsSVG);

        	
	}
	,getTransformation: function(){ 
		return this.transformation;
	}
	,translate: function(x,y){
	        var t= this.getTransformation();
	        t.translate.x = x;
	        t.translate.y = y;
	        this.transform();
	},
	addMouseWheelZooming: function(){ /*not supported for internet explorer*/
                var that = this;
	        this._addEnabledControl(&quot;mousewheelzooming&quot;);
	
		this.crosshair = {lastdelta:false};
		this.crosshair.pos = {x:0,y:0};

		var t = this.getTransformation();

		var mw = this.wrapper.onmousewheel;
		

		var that = this;
		var mm = this.wrapper.onmousemove;
		

        var doingmw = false;
        var mwactive = false;
        
        var cancelMouseZoomCursor = function(){
            if(VismoUtils.browser.isIE6)that.wrapper.style.cursor = &quot;&quot;;
            else jQuery(that.wrapper).removeClass(&quot;zooming&quot;);
        }
        jQuery(this.wrapper).mousedown(function(e){
            mwactive = true;
            if(VismoUtils.browser.isIE6)this.style.cursor = &quot;crosshair&quot;;
            else {
                if(!jQuery(that.wrapper).hasClass(&quot;panning&quot;)){
                jQuery(that.wrapper).addClass(&quot;zooming&quot;);
                }
            }
            window.setTimeout(cancelMouseZoomCursor,2000);
        });
        jQuery(this.wrapper).mouseout(function(e){
            var newTarget;
            
            if(e.toElement) newTarget = e.toElement;
            else newTarget = e.relatedTarget;
            
            if(jQuery(newTarget,that.wrapper).length == 0){ //if not a child turn off
                mwactive = false;

            }
            cancelMouseZoomCursor();
        });
        var domw = function(e){
            if(!that.enabled) return;
			/* thanks to http://adomas.org/javascript-mouse-wheel */
			var delta = 0;

                        
			if(!that.goodToTransform(e)) {
			    doingmw = false;
			    return false;
			}
			var t = VismoClickingUtils.resolveTargetWithVismo(e);
		        t= el;

                       if(t != that.wrapper &amp;&amp; t.parentNode !=that.wrapper) return false;
	       	 	if (e.wheelDelta) { /* IE/Opera. */
		                delta = e.wheelDelta/120;
		                /** In Opera 9, delta differs in sign as compared to IE.
		                 */
		                if (window.opera)
		                        delta = -delta;
		        } else if (e.detail) { /** Mozilla case. */
		                /** In Mozilla, sign of delta is different than in IE.
		                 * Also, delta is multiple of 3.
		                 */
		                delta = -e.detail/3;
		        }
	
			var sensitivity = 0.4;
			var transform = that.getTransformation();
			var scale =transform.scale;
			var origin = transform.origin;


			var mousepos = VismoClickingUtils.getMouseFromEvent(e);
	
			var w = parseInt(that.wrapper.style.width) / 2;
			var h = parseInt(that.wrapper.style.height) / 2;
			var translation =  VismoTransformations.undoTransformation(mousepos.x,mousepos.y,that.transformation);
			transform.translate= {x: -translation.x, y: -translation.y};
			//{x: -mousepos.x + w,y: -mousepos.y + h};
			transform.origin = {
											x: mousepos.x,
											y: mousepos.y
										};
			



			if(delta &gt; that.crosshair.lastdelta + sensitivity || delta &lt; that.crosshair.lastdelta - sensitivity){	
				var newx,newy;
				if(delta &gt; 0){
					newx = parseFloat(scale.x) * 2;
					newy = parseFloat(scale.y) * 2;					
				}
				else{
					newx = parseFloat(scale.x) / 2;
					newy = parseFloat(scale.y) / 2;
				}

				if(newx &gt; 0 &amp;&amp; newy &gt; 0){
					scale.x = newx;
					scale.y = newy;
					that.setTransformation(transform);					
				}

			}
			that.crosshair.lastdelta = delta;	
			

            doingmw = false;
            return false;
        };
		var onmousewheel = function(e){	
		    if(!VismoUtils.browser.isIE){
		        jQuery(that.wrapper).addClass(&quot;zooming&quot;);	
		    }
		    if(e.preventDefault){e.preventDefault();}
		    if (e &amp;&amp; e.stopPropagation) {
                e.stopPropagation();
            }
             e.cancelBubble=true;
            
		    if(!mwactive) return false;
			if(!doingmw) {
			    var f = function(){
			        domw(e);
                    return false;
			    };
			    window.setTimeout(f,50);
			    doingmw = true;
            }


			return false;

		};

		
		var element = this.wrapper;
            if(VismoUtils.browser.isIE) {
		        document.onmousewheel = function(e){
		                if(!e)e = window.event;
		            
		                var el = e.target;
		                
		                //var el =  e.srcElement;
		                if(!el) return;
		                while(el != element){
		                        
		                        if(el == element) {
		                                onmousewheel(e); 
		                                
		                                return false;    
		                        }
		                        el = el.parentNode;
		                }
		                return;
		        };
		        window.onmousewheel = document.onmousewheel;
		        return;
		}
		else if (element.addEventListener){

			element.onmousewheel = onmousewheel; //safari
		    element.addEventListener('DOMMouseScroll', onmousewheel, false);/** DOMMouseScroll is for mozilla. */
		
		}
		else if(element.attachEvent){ 	
			element.attachEvent(&quot;onmousewheel&quot;, onmousewheel); //safari
		}
		else{ //it's ie.. or something non-standardised. do nowt
		//window.onmousewheel = document.onmousewheel = onmousewheel;	
		}

		
	}
	,disable: function(){
        jQuery(&quot;.vismoControls&quot;,this.wrapper).css({display:&quot;none&quot;});	    
		this.enabled = false;
	}
	,enable: function(){
		this.enabled = true;
		jQuery(&quot;.vismoControls&quot;,this.wrapper).css({display:&quot;&quot;});
	}
	
	,goodToTransform: function(e){
		var t =  VismoClickingUtils.resolveTarget(e);

		switch(t.tagName){
			case &quot;INPUT&quot;:
				return false;
			case &quot;SELECT&quot;:
				return false;
			case &quot;OPTION&quot;:
				return false;
		}
		
		if(t &amp;&amp; t.getAttribute(&quot;class&quot;) == &quot;vismoControl&quot;) return false;
		
		return true;
		
	}
	,addMousePanning: function(){
	       
	    this._addEnabledControl(&quot;mousepanning&quot;);
		var that = this;
		
		var el = that.wrapper;
		var md = el.onmousedown;
		var mu = el.onmouseup;	
		var mm = el.onmousemove;
		var panning_status = false;	
		//alert('here');
		//jQuery(document).mouseup(function(e){alert(&quot;cool&quot;);}); //doesn't work?!
		var cancelPanning = function(e){
			panning_status = false;
			that.transform();
			if(!VismoUtils.browser.isIE6){jQuery(that.wrapper).removeClass(&quot;panning&quot;);}
			//style.cursor= that.defaultCursor;
			that.wrapper.onmousemove = mm;
			return false;
		};
		jQuery(that.controlDiv).mousedown(function(e){

		    cancelPanning();
		});
		var onmousemove = function(e){
		    if(e &amp;&amp; e.shiftKey) {return false;}
			if(mm){mm(e);}
			if(!that.enabled) {return;}
			if(!panning_status) {
				return;
			}
			if(!VismoUtils.browser.isIE &amp;&amp; !jQuery(that.wrapper).hasClass(&quot;panning&quot;)){
			    jQuery(that.wrapper).addClass(&quot;panning&quot;)
			}
			if(!that.goodToTransform(e)) {return;}
			var pos =  VismoClickingUtils.getMouseFromEventRelativeToElement(e,panning_status.clickpos.x,panning_status.clickpos.y,panning_status.elem);		
			if(!pos){return;}
			
			var t = that.getTransformation();
			//if(this.transformation) t = this.transformation;
			var sc = t.scale;

			/* work out deltas */
			var xd =parseFloat(pos.x /sc.x);
			var yd = parseFloat(pos.y / sc.y);
			t.translate.x = panning_status.translate.x + xd;
			t.translate.y =panning_status.translate.y +yd;
            if(!VismoUtils.browser.isIE6){
                jQuery(that.wrapper).removeClass(&quot;zooming&quot;);
                that.transform();
            }
			that.transform();
			
			if(pos.x &gt; 5  || pos.y &gt; 5) panning_status.isClick = false;
			if(pos.x &lt; 5|| pos.y &lt; 5) panning_status.isClick = false;
			return false;	
		};
     
		jQuery(this.wrapper).mousedown(function(e){
		    var jqw = jQuery(that.wrapper);
			if(panning_status){
				return;
			}
			
			if(md) {md(e);}
			if(!that.enabled) return;
			if(!VismoUtils.browser.isIE6){
			    jqw.addClass(&quot;panning&quot;);
			}
			var target =  VismoClickingUtils.resolveTarget(e);
			target = el;
			if(!target) return;

			
			var t = that.transformation.translate;
			var sc =that.transformation.scale; 
			
			var realpos = VismoClickingUtils.getMouseFromEvent(e);
			if(!realpos) return;
			//this.vismoController = that;

			var element = VismoClickingUtils.resolveTargetWithVismo(e);
			element = el;
			panning_status =  {clickpos: realpos, translate:{x: t.x,y:t.y},elem: element,isClick:true};
			that.wrapper.onmousemove = onmousemove;
				
		});
			
		jQuery(document).mouseup(function(e){
			if(panning_status.isClick &amp;&amp; mu){
			    mu(e);
			};
			
			if(panning_status){
			    cancelPanning(e);
            }
		});
		
		jQuery(document).mousemove(function(e){
			if(panning_status){
			        onmousemove(e);
			        var parent= e.target;
			        while(parent.parentNode){
			                parent = parent.parentNode;
			                if(parent == that.wrapper) return;
			        }
				
				//if(parent != that.wrapper)cancelPanning(e); (not a good idea for tooltips)
			}
		});
	
	},

	setTransformation: function(t){
        
        if(this.limits){
            if(this.limits.scale){
            if(t.scale.x &gt; this.limits.scale.x){ t.scale.x = this.limits.scale.x;}
            if(t.scale.y &gt; this.limits.scale.y){ t.scale.y = this.limits.scale.y; }
            
            if(t.scale.x &lt; this.limits.scale.minx){ t.scale.x = this.limits.scale.minx;}
            if(t.scale.y &lt; this.limits.scale.miny){ t.scale.y = this.limits.scale.miny;}     
            }    
        }
        if(!t.origin){
            
                var w = jQuery(this.wrapper).width();
                var h = jQuery(this.wrapper).height();
                t.origin = {x: w/2, y: h/2};

        }
		if(this.enabled){
			if(!t.scale &amp;&amp; !t.translate &amp;&amp; !t.rotate) alert(&quot;bad transformation applied - any call to setTransformation must contain translate,scale and rotate&quot;);
			this.transformation = t;
			
			try{this.handler(t);}catch(e){};
		}
		//console.log(&quot;transformation set to &quot;,t);
	},
	createButtonLabel: function(r,type,offset){
		var properties=  {'shape':'path', stroke: this.options.controlStroke,lineWidth: '1','z-index':'2'};
		properties.actiontype = type;
		var coords=[];
		if(type == 'E'){
			coords =[r,0,-r,0,'M',r,0,0,-r,&quot;M&quot;,r,0,0,r];
		}
		else if(type =='W'){
			coords =[-r,0,r,0,'M',-r,0,0,r,&quot;M&quot;,-r,0,0,-r]; 
		}
		else if(type == 'S'){
			coords =[0,-r,0,r,'M',0,r,-r,0,&quot;M&quot;,0,r,r,0];	
		}
		else if(type == 'N'){
			coords =[0,-r,0,r,'M',0,-r,r,0,&quot;M&quot;,0,-r,-r,0];	
		}
		else if(type == 'in'){
			coords =[-r,0,r,0,&quot;M&quot;,0,-r,0,r];
		}
		else if(type == 'out'){
			coords = [-r,0,r,0];
		}
		for(var i=0; i &lt; coords.length; i+=2 ){
		        if(coords[i] == &quot;M&quot;) i+=1;
		        coords[i] += offset.x;
		        coords[i+1] += offset.y;
		}
		return new VismoShape(properties,coords);
	},	
	createButton: function(width,direction,offset,properties) {
	        var canvas = this.controlCanvas;
	        if(!canvas) throw &quot;no canvas to create on..&quot;;
		if(!width) width = 120;
		var r = width/2;

		offset = {
			x: offset.x || 0,
			y: offset.y || 0
		};
		
		var coords;
		if(this.options.controlShape &amp;&amp; this.options.controlShape == 'circle'){
		    	coords = [
        			offset.x , offset.y,
        			width/2
        		];
        		properties.shape = 'circle';  
		}
		else{
		    
    		coords = [
    			offset.x, offset.y,
    			offset.x + width, offset.y,
    			offset.x + width, offset.y + width,
    			offset.x, offset.y + width
    		];
    		properties.shape = 'polygon';
	    }
		properties.fill =this.options.controlFill;
		properties.stroke =this.options.controlStroke;
		var button = new VismoShape(properties,coords);
		var bb = button.getBoundingBox();
		buttoncenter = {x:bb.center.x,y:bb.center.y}; 
		var label = this.createButtonLabel(r-2,properties.actiontype,buttoncenter);
	    canvas.add(label);
		canvas.add(button);
		return button;
	},
	addControls: function(list){
		for(var i= 0; i &lt; list.length; i++){
			this.addControl(list[i]);
		}
	}
	,addControl: function(controlType) {
		switch(controlType) {
			//case &quot;zoom&quot;:
			case &quot;pan&quot;:
				this.addPanningActions();
				break;
			case &quot;zoom&quot;:
				this.addZoomingActions();
				break;
			case &quot;mousepanning&quot;:
				this.addMousePanning();
				break;
			case &quot;mousewheelzooming&quot;:
				this.addMouseWheelZooming();
				break;
			case &quot;rotation&quot;:
		
				this.addRotatingActions();
				break;
			default:
				break;
		}
	
	},
	
	addPanningActions: function(controlDiv){
	        this._addEnabledControl(&quot;pan&quot;);
		this.createButton(12,180,{x:-6,y:-54},{'actiontype':'N','name':'pan north','buttonType': 'narrow'});
		this.createButton(12,270,{x:10,y:-38},{'actiontype':'E','name':'pan east','buttonType': 'earrow'});
		//this.createButton(10,90,{x:16,y:16},{'actiontype':'O','name':'re-center','buttonType': ''});
		this.createButton(12,90,{x:-22,y:-38},{'actiontype':'W','name':'pan west','buttonType': 'warrow'});
		this.createButton(12,0,{x:-6,y:-20},{'actiontype':'S','name':'pan south','buttonType': 'sarrow'});			
		this.applyLayer();		

	},
	addRotatingActions: function(){
		/*
		var rotateCanvas = this.controlCanvas.getDomElement();
		this.createButton(rotateCanvas,10,180,{x:16,y:2},{'actiontype':'rotatezup','name':'pan north','buttonType': 'narrow'});
		this.createButton(rotateCanvas,10,0,{x:16,y:30},{'actiontype':'rotatezdown','name':'pan south','buttonType': 'sarrow'});			
			
		this.createButton(rotateCanvas,10,270,{x:30,y:16},{'actiontype':'rotatezright','name':'rotate to right','buttonType': 'earrow'});
		this.createButton(rotateCanvas,10,90,{x:2,y:16},{'actiontype':'rotatezleft','name':'rotate to left','buttonType': 'warrow'});
		rotateCanvas.onmouseup = this._panzoomClickHandler;*/

	},	
	addZoomingActions: function(){
	        this._addEnabledControl(&quot;zoom&quot;);
		this.createButton(12,180,{x:-6,y:12},{'actiontype':'in','name':'zoom in','buttonType': 'plus'});		
		this.createButton(12,180,{x:-6,y:42},{'actiontype':'out','name':'zoom out','buttonType': 'minus'});	
	        this.applyLayer();
	}	
	    ,zoom: function(x,y){
	         var t = this.getTransformation();
	         t.scale.x = x;
	         if(!y) y=  x;
	         t.scale.y = y;
	         this.setTransformation(t);
	    }
        ,panTo: function(x,y){
                //if(!this.enabled) return;
                var t = this.getTransformation();
                
                var finalX = -x;
                var finalY = -y;
                var thisx,thisy;
                var direction = {};
                var difference = {};
                
                thisx = t.translate.x;
                thisy = t.translate.y;
                
                difference.x=  thisx - finalX;
                difference.y = thisy - finalY;
                
                direction.x = -difference.x / 5;
                direction.y = -difference.y / 5;

                var change = true;
                
                var that = this;
                var f = function(){
                   
                        change= {x: false,y:false};
                        if(thisx &gt; finalX &amp;&amp; thisx + direction.x &gt; finalX) {thisx += direction.x;change.x=true;}
                        else if(thisx &lt; finalX &amp;&amp; thisx + direction.x &lt; finalX) {thisx += direction.x;change.x=true;}
                        else{
                                t.translate.x = finalX;
                        }
                
                        if(thisy &gt; finalY &amp;&amp; thisy + direction.y &gt; finalY) {thisy += direction.y;change.y=true;}
                        else if(thisy &lt; finalY &amp;&amp; thisy + direction.y &lt; finalY) {thisy += direction.y;change.y=true;}
                        else{
                                change.x = true;
                                t.translate.y =finalY;
                        }
                
                        if(change.x){
                                t.translate.x = thisx;
                        }
                        else{
                                t.translate.x = finalX;
                        }
                        if(change.y){
                                t.translate.y = thisy;
                        }
                        else{
                                t.translate.y = finalY;
                        }
    
                        if(t.translate.x != finalX &amp;&amp; t.translate.y != finalY){
                                that.setTransformation(t); 
                                window.setTimeout(f,5);
                        }
                        else{
                                that.setTransformation(t);
                        }
  
                };
                
                f();
                                       
               

                //window.setTimeout(pan,200);
        }
	,transform: function(){
		if(this.enabled){
			var t = this.getTransformation();
			var s = t.scale;
			var tr = t.translate;
			if(s.x &lt;= 0) s.x = 0.1125;
			if(s.y &lt;= 0) s.y = 0.1125;

                        var ok = true;
                        var lim = this.limits;
                        if(lim.scale){
                                if(s.y &lt; lim.scale.miny) t.scale.y = lim.scale.miny;
                                if(s.x &lt; lim.scale.minx) t.scale.x = lim.scale.minx;
                                
                                if(s.y &gt; lim.scale.y) t.scale.y = lim.scale.y;
                                if(s.x &gt; lim.scale.x) t.scale.x = lim.scale.x;
		        }
		        //remove origin?
		        //var translatex = t.origin.x+ (t.translate.x * t.scale.x);
                //var translatey = t.origin.y+ (t.translate.y *t.scale.y);
		        this.handler(this.transformation);

		}
	},
	_panzoomClickHandler: function(e,hit,controller) {
	
	    	if(!hit) return;
	   
		var pan = {};
		var t =controller.getTransformation();
		if(!t.scale) t.scale = {x:1,y:1};
		if(!t.translate) t.translate = {x:0,y:0};
		if(!t.rotate) t.rotate = {x:0,y:0,z:0};
		
		var scale =t.scale;
		
		pan.x = parseFloat(this.pansensitivity / scale.x);
		pan.y = parseFloat(this.pansensitivity / scale.y);
	
		switch(hit.getProperty(&quot;actiontype&quot;)) {
			case &quot;W&quot;:
				t.translate.x += pan.x;
				break;
			case &quot;O&quot;:
				t.translate.x = 0;
				t.translate.y = 0;
				break;

			case &quot;E&quot;:
				t.translate.x -= pan.x;
				break;
			case &quot;N&quot;:
				t.translate.y += pan.y;
				break;
			case &quot;S&quot;:
				t.translate.y -= pan.y;
				break;
			case &quot;in&quot;:
				scale.x *= 2;
				scale.y *= 2;
				break;
			case &quot;out&quot;:
				scale.x /= 2;
				scale.y /= 2;			
				break;
			case &quot;rotatezright&quot;:
				if(!t.rotate.z) t.rotate.z = 0;
				//console.log(&quot;right&quot;,t.rotate.z);
				t.rotate.z -= 0.1;
				var left =6.28318531;
				
				if(t.rotate.z &lt;0 )t.rotate.z =left;
				break;
			case &quot;rotatezup&quot;:
				if(!t.rotate.y) t.rotate.y = 0;
				t.rotate.y += 0.1;
				break;
			case &quot;rotatezdown&quot;:
				if(!t.rotate.y) t.rotate.y = 0;
				t.rotate.y -= 0.1;
				break;
			case &quot;rotatezleft&quot;:
				if(!t.rotate.z) t.rotate.z = 0;
				t.rotate.z += 0.1;
				break;
			default:
				break;
		}
		controller.transform();
                //console.log(&quot;done&quot;,controller);
		return false;
	}
};
/*VismoController.prototype.panzoomcontrolsSVG =&quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot; standalone=\&quot;no\&quot;?&gt;&lt;!-- Created with Inkscape (http://www.inkscape.org/) --&gt;&lt;svg   xmlns:dc=\&quot;http://purl.org/dc/elements/1.1/\&quot;   xmlns:cc=\&quot;http://creativecommons.org/ns#\&quot;   xmlns:rdf=\&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#\&quot;   xmlns:svg=\&quot;http://www.w3.org/2000/svg\&quot;   xmlns=\&quot;http://www.w3.org/2000/svg\&quot;   xmlns:sodipodi=\&quot;http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd\&quot;   xmlns:inkscape=\&quot;http://www.inkscape.org/namespaces/inkscape\&quot;   width=\&quot;60px\&quot;   height=\&quot;120px\&quot;   id=\&quot;svg3820\&quot;   sodipodi:version=\&quot;0.32\&quot;   inkscape:version=\&quot;0.46\&quot;   sodipodi:docname=\&quot;panzoomcontrols.svg\&quot;   inkscape:output_extension=\&quot;org.inkscape.output.svg.inkscape\&quot;&gt;  &lt;defs     id=\&quot;defs3\&quot;&gt;    &lt;linearGradient       id=\&quot;linearGradient3735\&quot;&gt;      &lt;stop         style=\&quot;stop-color:#ffffff;stop-opacity:1;\&quot;         offset=\&quot;0\&quot;         id=\&quot;stop3737\&quot; /&gt;      &lt;stop         style=\&quot;stop-color:#0000f0;stop-opacity:1;\&quot;         offset=\&quot;1\&quot;         id=\&quot;stop3739\&quot; /&gt;    &lt;/linearGradient&gt;    &lt;linearGradient       id=\&quot;linearGradient3745\&quot;&gt;      &lt;stop         style=\&quot;stop-color:#000000;stop-opacity:1;\&quot;         offset=\&quot;0\&quot;         id=\&quot;stop3747\&quot; /&gt;      &lt;stop         style=\&quot;stop-color:#ffffef;stop-opacity:0;\&quot;         offset=\&quot;1\&quot;         id=\&quot;stop3749\&quot; /&gt;    &lt;/linearGradient&gt;    &lt;inkscape:perspective       sodipodi:type=\&quot;inkscape:persp3d\&quot;       inkscape:vp_x=\&quot;0 : 526.18109 : 1\&quot;       inkscape:vp_y=\&quot;6.123234e-14 : 1000 : 0\&quot;       inkscape:vp_z=\&quot;744.09448 : 526.18109 : 1\&quot;       inkscape:persp3d-origin=\&quot;372.04724 : 350.78739 : 1\&quot;       id=\&quot;perspective3826\&quot; /&gt;  &lt;/defs&gt;  &lt;sodipodi:namedview     inkscape:document-units=\&quot;mm\&quot;     id=\&quot;base\&quot;     pagecolor=\&quot;#ffffff\&quot;     bordercolor=\&quot;#666666\&quot;     borderopacity=\&quot;1.0\&quot;     inkscape:pageopacity=\&quot;0.0\&quot;     inkscape:pageshadow=\&quot;2\&quot;     inkscape:zoom=\&quot;4\&quot;     inkscape:cx=\&quot;14.379355\&quot;     inkscape:cy=\&quot;60.049799\&quot;     inkscape:current-layer=\&quot;layer1\&quot;     showgrid=\&quot;true\&quot;     inkscape:window-width=\&quot;1440\&quot;     inkscape:window-height=\&quot;776\&quot;     inkscape:window-x=\&quot;-84\&quot;     inkscape:window-y=\&quot;22\&quot; /&gt;  &lt;metadata     id=\&quot;metadata4\&quot;&gt;    &lt;rdf:RDF&gt;      &lt;cc:Work         rdf:about=\&quot;\&quot;&gt;        &lt;dc:format&gt;image/svg+xml&lt;/dc:format&gt;        &lt;dc:type           rdf:resource=\&quot;http://purl.org/dc/dcmitype/StillImage\&quot; /&gt;      &lt;/cc:Work&gt;    &lt;/rdf:RDF&gt;  &lt;/metadata&gt;  &lt;g     inkscape:label=\&quot;Layer 1\&quot;     inkscape:groupmode=\&quot;layer\&quot;     id=\&quot;layer1\&quot;&gt;    &lt;rect       style=\&quot;opacity:1;fill:#fafafa;fill-opacity:1;stroke:#000000;stroke-width:1.25095212000000000;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1\&quot;       id=\&quot;rect4374\&quot;       width=\&quot;3.036346\&quot;       height=\&quot;29.855259\&quot;       x=\&quot;26.456741\&quot;       y=\&quot;77.110023\&quot; /&gt;    &lt;path       sodipodi:type=\&quot;arc\&quot;       style=\&quot;opacity:0;fill:#ffc100;fill-opacity:0.18999999;fill-rule:evenodd;stroke:#00d300;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:0.98500001\&quot;       id=\&quot;path2811\&quot;       sodipodi:cx=\&quot;36.681629\&quot;       sodipodi:cy=\&quot;40.457794\&quot;       sodipodi:rx=\&quot;22.848825\&quot;       sodipodi:ry=\&quot;23.466362\&quot;       d=\&quot;M 59.530455,40.457794 A 22.848825,23.466362 0 1 1 13.832804,40.457794 A 22.848825,23.466362 0 1 1 59.530455,40.457794 z\&quot;       transform=\&quot;translate(-10.077156,-13.286926)\&quot; /&gt;    &lt;path       sodipodi:type=\&quot;star\&quot;       style=\&quot;fill:#ffffff\&quot;       id=\&quot;path2817\&quot;       sodipodi:sides=\&quot;5\&quot;       sodipodi:cx=\&quot;21.984276\&quot;       sodipodi:cy=\&quot;13.286215\&quot;       sodipodi:r1=\&quot;0.34933102\&quot;       sodipodi:r2=\&quot;0.17466551\&quot;       sodipodi:arg1=\&quot;-0.78539816\&quot;       sodipodi:arg2=\&quot;-0.15707963\&quot;       inkscape:flatsided=\&quot;false\&quot;       inkscape:rounded=\&quot;0\&quot;       inkscape:randomized=\&quot;0\&quot;       d=\&quot;M 22.23129,13.0392 L 22.156791,13.258891 L 22.295532,13.444808 L 22.063572,13.441843 L 21.929628,13.631245 L 21.860769,13.409722 L 21.639246,13.340862 L 21.828648,13.206918 L 21.825683,12.974959 L 22.0116,13.1137 L 22.23129,13.0392 z\&quot;       transform=\&quot;translate(-2.9137398,-0.9362086)\&quot; /&gt;    &lt;path       sodipodi:type=\&quot;arc\&quot;       style=\&quot;fill:#fafafa;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:0.99893030000000005;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;opacity:1\&quot;       id=\&quot;path3847\&quot;       sodipodi:cx=\&quot;113.64216\&quot;       sodipodi:cy=\&quot;108.12209\&quot;       sodipodi:rx=\&quot;23.233507\&quot;       sodipodi:ry=\&quot;20.960665\&quot;       d=\&quot;M 136.87567,108.12209 A 23.233507,20.960665 0 1 1 90.408651,108.12209 A 23.233507,20.960665 0 1 1 136.87567,108.12209 z\&quot;       transform=\&quot;matrix(0.9778731,0,0,-1.0598112,-84.661617,141.94941)\&quot; /&gt;    &lt;path       style=\&quot;fill:#dcdcdc;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\&quot;       d=\&quot;M 39.621219,21.031683 L 47.389849,26.975113 L 39.969679,33.117243 L 41.484209,27.164163 L 39.621219,21.031683 z\&quot;       id=\&quot;north\&quot;       inkscape:label=\&quot;north\&quot;       sodipodi:nodetypes=\&quot;ccccc\&quot; /&gt;    &lt;path       style=\&quot;fill:#dcdcdc;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\&quot;       d=\&quot;M 20.231889,13.770245 L 26.175319,6.0016174 L 32.317449,13.421792 L 26.364359,11.907259 L 20.231889,13.770245 z\&quot;       id=\&quot;path3757\&quot;       inkscape:label=\&quot;north\&quot;       sodipodi:nodetypes=\&quot;ccccc\&quot; /&gt;    &lt;path       style=\&quot;fill:#dcdcdc;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\&quot;       d=\&quot;M 20.048989,40.437803 L 25.992419,48.206433 L 32.134549,40.786253 L 26.181459,42.300793 L 20.048989,40.437803 z\&quot;       id=\&quot;path3761\&quot;       inkscape:label=\&quot;north\&quot;       sodipodi:nodetypes=\&quot;ccccc\&quot; /&gt;    &lt;path       style=\&quot;fill:#dcdcdc;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\&quot;       d=\&quot;M 12.629649,33.160653 L 4.8610222,27.217223 L 12.281197,21.075093 L 10.766664,27.028173 L 12.629649,33.160653 z\&quot;       id=\&quot;path3765\&quot;       inkscape:label=\&quot;north\&quot;       sodipodi:nodetypes=\&quot;ccccc\&quot; /&gt;    &lt;path       sodipodi:type=\&quot;arc\&quot;       style=\&quot;fill:#ff0000;fill-rule:evenodd;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1\&quot;       id=\&quot;path3849\&quot;       sodipodi:cx=\&quot;114.65231\&quot;       sodipodi:cy=\&quot;133.62845\&quot;       sodipodi:rx=\&quot;0\&quot;       sodipodi:ry=\&quot;2.5253813\&quot;       d=\&quot;M 114.65231,133.62845 A 0,2.5253813 0 1 1 114.65231,133.62845 A 0,2.5253813 0 1 1 114.65231,133.62845 z\&quot; /&gt;    &lt;path       sodipodi:type=\&quot;arc\&quot;       style=\&quot;fill:#fafafa;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:3.29227274000000003;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;opacity:1\&quot;       id=\&quot;path4600\&quot;       sodipodi:cx=\&quot;113.64216\&quot;       sodipodi:cy=\&quot;108.12209\&quot;       sodipodi:rx=\&quot;23.233507\&quot;       sodipodi:ry=\&quot;20.960665\&quot;       d=\&quot;M 136.87567,108.12209 A 23.233507,20.960665 0 1 1 90.408651,108.12209 A 23.233507,20.960665 0 1 1 136.87567,108.12209 z\&quot;       transform=\&quot;matrix(0.3044572,0,0,-0.3133744,-6.349179,108.99488)\&quot; /&gt;    &lt;path       sodipodi:type=\&quot;arc\&quot;       style=\&quot;fill:#fafafa;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:3.29227274000000003;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;opacity:1\&quot;       id=\&quot;path4602\&quot;       sodipodi:cx=\&quot;113.64216\&quot;       sodipodi:cy=\&quot;108.12209\&quot;       sodipodi:rx=\&quot;23.233507\&quot;       sodipodi:ry=\&quot;20.960665\&quot;       d=\&quot;M 136.87567,108.12209 A 23.233507,20.960665 0 1 1 90.408651,108.12209 A 23.233507,20.960665 0 1 1 136.87567,108.12209 z\&quot;       transform=\&quot;matrix(0.3044572,0,0,-0.3133744,-6.5991733,140.49488)\&quot; /&gt;    &lt;path       style=\&quot;fill:#dcdcdc;fill-rule:evenodd;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;fill-opacity:1\&quot;       d=\&quot;M 29.344931,79.34136 L 26.693281,79.164583 L 26.870057,76.336156 L 22.804193,76.159379 L 23.157747,73.330952 L 26.870057,73.507729 L 26.870057,70.856078 L 29.875261,71.032855 L 29.875261,73.684505 L 33.587572,74.038059 L 33.587572,76.512933 L 29.521708,76.336156 L 29.344931,79.34136 z\&quot;       id=\&quot;path3299\&quot; /&gt;    &lt;path       style=\&quot;fill:#dcdcdc;fill-rule:evenodd;stroke:#000000;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;fill-opacity:1\&quot;       d=\&quot;M 26.781669,107.80241 L 22.715805,107.62563 L 23.069359,104.79721 L 26.781669,104.97398 L 29.786873,105.15076 L 33.499184,105.50431 L 33.499184,107.97919 L 29.43332,107.80241 L 26.781669,107.80241 z\&quot;       id=\&quot;path3301\&quot;       sodipodi:nodetypes=\&quot;ccccccccc\&quot; /&gt;  &lt;/g&gt;&lt;/svg&gt;&quot;;*/

/*
Some common utils used throughout package 
*/
var VismoMapUtils = {
	googlelocalsearchurl: &quot;http://ajax.googleapis.com/ajax/services/search/local?v=1.0&amp;q=&quot;
	
	,optimiseForIE6: function(geojson){
      	var newf = [];
        for(var i=0; i &lt; geojson.features.length;i++){
            var f = geojson.features[i];
            var coordinates = f.geometry.coordinates;


            var newc = [];
            
            var good = false;
            
            if(coordinates.length &lt;2){
                good = true;
            }
            for(var j=0; j &lt; coordinates.length; j++){
                var c1 = coordinates[j];
                
            }
            
            var bb = f.geometry.bbox;
            if(bb){
                var dx = bb[2] - bb[0]; var dy= bb[3]- bb[1]; if(dy&lt;0)dy =-dy;if(dx&lt;0)dx =-dx;
                if(dx &lt; 1 || dy &lt; 1){
                    good =false;
                }
            }
            
            if(good){
                newf.push(f);
            }
        }
        geojson.features= newf;
        return geojson;
	
	}
	,addBoundingBoxes: function(geojson){ //currently MultiPolygon only..
		var geojsonbb = geojson;
		for(var i=0; i &lt; geojson.features.length; i++){
			var f = geojson.features[i];

			var g = f.geometry;
			var c = g.coordinates;

			
			if(g.type.toLowerCase() == 'multipolygon'){
				var x1,y1,x2,y2;
				
				var horizontal = {belowzero:0,abovezero:0};
				var vertical = {belowzero:0,abovezero:0};
			
				for(var j=0; j &lt; c.length; j++){
					for(var k=0; k &lt; c[j].length; k++){
						
						for(var l=0; l &lt; c[j][k].length; l++){
							var x = c[j][k][l][0];
							var y = c[j][k][l][1];
							/*if(x &lt; 0 &amp;&amp; horizontal.abovezero &gt; horizontal.belowzero){
								x = 180;
							}
							else if(x &gt; 0 &amp;&amp; horizontal.abovezero &lt; horizontal.belowzero){
								x = -180;
							}*/
							if(!x1) x1= x;
							if(!x2) x2 =x;
							if(!y1) y1 = y;
							if(!y2) y2 = y;
							if(y &gt; y2) y2 = y;
							if(y &lt; y1) y1 = y;
							if(x &lt; x1) x1 = x;
							if(x &gt; x2) x2= x;
							
							if(x &gt; 0){
								horizontal.abovezero +=1;
							}
							else{
								horizontal.belowzero +=1;
							}
							
							if(y &gt; 0){
								vertical.abovezero +=1;
							}
							else{
								vertical.belowzero +=1;
							}
							
									
										
						}
					}
				}
				
				//if(f.properties.name == &quot;RUSSIAN FEDERATION&quot;)
				//console.log(x1,x2);
	
				g.bbox = [];
				g.bbox.push(x1);
				g.bbox.push(y1);
				g.bbox.push(x2);
				g.bbox.push(y2);
				x1 = false; x2=false;y1=false;y2=false;
			}
			
		}
		return geojsonbb;
	}
	 ,tile2long: function(x,z) {
	  	return (x/Math.pow(2,z)*360-180);
	 }
	 ,tile2lat: function(y,z) {
	  	var n=Math.PI-2*Math.PI*y/Math.pow(2,z);
	  	return (180/Math.PI*Math.atan(0.5*(Math.exp(n)-Math.exp(-n))));
	 }
	,getLongLatAtXY: function(x,y,eMap){
		
		var res = VismoMapUtils.getLongLatFromMouse(x,y,eMap);
	
		
		return res;
	}
	,getSlippyTileNumber: function(lo,la,zoomL,eMap){
		var n = Math.pow(2,zoomL);
		var x = lo;

		var tilex = ((lo + 180)/360) *n;

		tilex = Math.floor(tilex);
		tiley =(Math.floor((1-Math.log(Math.tan(la*Math.PI/180) + 1/Math.cos(la*Math.PI/180))/Math.PI)/2 *Math.pow(2,zoomL)));		
		return {x: tilex, y:tiley};
	}
	,getLocationsFromQuery: function(query,callback){
		var that = this;
		var fileloadedcallback = function(status,params,responseText,url,xhr){
				var response = eval(&quot;(&quot;+responseText+&quot;)&quot;);

				if(response.responseStatus == 200){
					var results = response.responseData.results;
					callback(results);
					
					return;
				}

		};
			
	
		VismoFileUtils.loadRemoteFile(that.googlelocalsearchurl+query,fileloadedcallback);
	}
	,getLongLatFromMouse: function(x,y,vismoMap){
		var t =vismoMap.getTransformation();
		var pos = VismoClickingUtils.undotransformation(x,y,t);	
		
		if(vismoMap.settings.projection) {
			pos = vismoMap.settings.projection.inversexy(pos.x,pos.y,t);
		}

		var lo = pos.x;
		var la = -pos.y;
		
		
		/*if(la &gt; 85.0511) la = -la%85.0511;
		if(la &lt; -85.0511) la = -la%85.0511;
		if(lo &lt; -180) lo = -lo%180;
		if(lo &gt; 180) lo = - lo%180;
		*/
		return {latitude: la, longitude: lo};
	}
	,_radToDeg: function(rad){
		return rad / (Math.PI /180);
	},
	_degToRad: function(deg) {
		//return ((deg + 180)/360) ;
		
		return (deg * Math.PI) / 180.0;
	},
	fitgeojsontocanvas: function(json,canvas){ /*canvas must have style width and height properties, returns an VismoTransformation*/
		var view ={};
		var f =json.features;
		for(var i=0; i &lt; f.length; i++){
			var c = f[i].geometry.coordinates;
											
			for(var j=0; j &lt; c.length; j++ ){
				for(var k=0; k &lt; c[j].length; k++){
					

					for(var l=0; l &lt; c[j][k].length;l++){
						
		
						var x =c[j][k][l][0];
						var y = c[j][k][l][1];
						if(!view.x1 || x &lt;view.x1) {
							view.x1 = x;
						}
						else if(!view.x2 || x &gt;view.x2) {
							view.x2 = x;
						}
						
						if(!view.y1 || y &lt;view.y1) {
							view.y1 = y;
						}
						else if(!view.y2 || y &gt;view.y2) {
							view.y2 = y;
						}
						

					}
						
				}
				
			}
		}
		if(!json.transform) json.transform ={};
		if(!json.transform.scale) json.transform.scale = {x:1, y:1};
		if(!json.transform.translate) json.transform.translate = {x:0,y:0};
		
		var canvasx =		parseFloat(canvas.style.width);
		var canvasy =parseFloat(canvas.style.height);
		view.center = {};
		view.width = (view.x2 - view.x1);
		view.height = (view.y2 - view.y1)
		view.center.x = view.x2 - (view.width/2);
		view.center.y = view.y2 - (view.height/2);
		//console.log(view.center.y, view.height);
		var scale = 1,temp;
		var tempx = parseFloat(canvasx/view.width);
		var tempy = parseFloat(canvasy/view.height);

		if(tempx &lt; tempy) temp = tempx; else temp = tempy;
		
		var transform = {scale:{},translate:{}};
		transform.scale.x = temp;
		transform.scale.y = temp;

		transform.boundingBox = view;

		transform.translate.x = -view.center.x;
		transform.translate.y = view.center.y;//view.center.y;	
		return transform;
	},
	/*does not yet support undoing rotating */
	_testCanvas: function(ctx){
		ctx.beginPath();
		ctx.arc(75,75,50,0,Math.PI*2,true); // Outer circle
		ctx.moveTo(110,75);
		ctx.arc(75,75,35,0,Math.PI,false);   // Mouth (clockwise)
		ctx.moveTo(65,65);
		ctx.arc(60,65,5,0,Math.PI*2,true);  // Left eye
		ctx.moveTo(95,65);
		ctx.arc(90,65,5,0,Math.PI*2,true);  // Right eye
		ctx.stroke();

	},	
	_undospherify: function (x,y,transformation,radius){
		var pos= this._spherifycoordinate(x,y,transformation);
		var latitude = Math.asin(y / radius);
		var longitude = Math.asin(parseFloat(x / radius) / Math.cos(latitude));

				
	
		//if(transformation.rotate.z &amp;&amp; longitude != 'NaN')longitude -= transformation.rotate.z;
		//longitude = longitude % (6.28318531);
		//if(longitude &lt; 0) longitude = longitude 

		if(transformation.rotate) {
			var r =transformation.rotate.z;
			//console.log(&quot;from&quot;,longitude);
			longitude +=r;
		
			//longitude =longitude% (6.28318531);
			
		}
		var lon = VismoMapUtils._radToDeg(longitude);
		var lat = VismoMapUtils._radToDeg(latitude);
		//console.log(&quot;to&quot;,longitude,r,lon);
		return {x:lon,y:lat};
	},
	_spherifycoordinate: function(lon,lat,transformation,radius){
		//http://board.flashkit.com/board/archive/index.php/t-666832.html
		var utils = VismoMapUtils;
		var res = {};
		
		var longitude = VismoMapUtils._degToRad(lon);
		var latitude = VismoMapUtils._degToRad(lat);
 		var wraplat = false;
 		// assume rotate values given in radians
		if(transformation &amp;&amp; transformation.rotate){
			//latitude += transformation.rotate.x;
			
			var rotation =transformation.rotate.z;
			//rotation = transformation.translate.x;
			if(rotation){
				var r =parseFloat(rotation);
			
				var newl =parseFloat(longitude+r);
			
				//console.log(longitude,&quot;-&gt;&quot;,newl,longitude,r,transformation.rotate.z);
			
				longitude +=r;
			}
			if(transformation.rotate.y){
				latitude += parseFloat(transformation.rotate.y);
				/*var limit =VismoMapUtils._degToRad(85);
				if(latitude &lt;-limit){
					latitude += (2 * limit);
					res.movedNorth = true;
					
				}
				
				if(latitude &gt; limit){
					latitude -= (2 * limit);
					res.movedSouth = true;
					
					
				}
				*/	
				
				//latitude = latitude % 6.28318531;
				
			} 
		}
		// latitude is 90-theta, where theta is the polar angle in spherical coordinates
		// cos(90-theta) = sin(theta)
		// sin(90-theta) = cos(theta)
		// to transform from spherical to cartesian, we would normally use radius*Math.cos(theta)
		//   hence in this case we use radius*Math.sin(latitude)
		// similarly longitude is phi-180, where phi is the azimuthal angle
		// cos(phi-180) = -cos(phi)
		// sin(phi-180) = -sin(phi)
		// to transform from spherical to cartesian, we would normally use radius*Math.sin(theta)*Math.cos(phi)
		//   we must exchange for theta as above, but because of the circular symmetry
		//   it does not matter whether we multiply by sin or cos of longitude	
	
		longitude = longitude % 6.28318531; //360 degrees		
	
		
		
		
		res.y = (radius) * Math.sin(latitude);	
		//console.log(latitude);
		//if(wraplat) res.y = [&quot;M&quot;,res.y];
		/*
		
		if(latitude &gt; 85.0511){
			res.y = (-radius) * Math.sin(latitude);	
		}
		else{
		res.y = (radius) * Math.sin(latitude);		
		}
		*/
		
		//if(latitude &gt; 85.0511)
		
		
		if(longitude &lt; 1.57079633 || longitude &gt; 4.71238898){//0-90 (right) or 270-360 (left) then on other side 
			res.x = (radius) * Math.cos(latitude) * Math.sin(longitude);		
		}
		else{
			//console.log(longitude,&quot;bad&quot;,transformation.rotate.z);
			res.x = false;
		}
	
		return res;
	}

};Array.prototype.contains = function(item)
{
	return this.indexOf(item) != -1;
};


function mozillaSaveFile(filePath,content)
{
	if(window.Components) {
		try {
			netscape.security.PrivilegeManager.enablePrivilege(&quot;UniversalXPConnect&quot;);
			var file = Components.classes[&quot;@mozilla.org/file/local;1&quot;].createInstance(Components.interfaces.nsILocalFile);
			file.initWithPath(filePath);
			if(!file.exists())
				file.create(0,0664);
			var out = Components.classes[&quot;@mozilla.org/network/file-output-stream;1&quot;].createInstance(Components.interfaces.nsIFileOutputStream);
			out.init(file,0x20|0x02,00004,null);
			out.write(content,content.length);
			out.flush();
			out.close();
			return true;
		} catch(ex) {
			return false;
		}
	}
	return null;
}


var VismoFileUtils= {
	saveFile: function(fileUrl,content)
	{
		mozillaSaveFile(fileUrl,content); return;
		jQuery.file.save({fileUrl:fileUrl,content:content});
	}	
	,convertUriToUTF8:function(uri,charSet)
	{
		if(window.netscape == undefined || charSet == undefined || charSet == &quot;&quot;)
			return uri;
		try {
			netscape.security.PrivilegeManager.enablePrivilege(&quot;UniversalXPConnect&quot;);
			var converter = Components.classes[&quot;@mozilla.org/intl/utf8converterservice;1&quot;].getService(Components.interfaces.nsIUTF8ConverterService);
		} catch(ex) {
			return uri;
		}
		return converter.convertURISpecToUTF8(uri,charSet);
	}
	
	,getLocalPath:function(origPath)
	{
		var originalPath = VismoFileUtils.convertUriToUTF8(origPath,&quot;UTF-8&quot;);
		
		// Remove any location or query part of the URL
		var argPos = originalPath.indexOf(&quot;?&quot;);
		if(argPos != -1)
			originalPath = originalPath.substr(0,argPos);
		var hashPos = originalPath.indexOf(&quot;#&quot;);
		if(hashPos != -1)
			originalPath = originalPath.substr(0,hashPos);
		// Convert file://localhost/ to file:///
		if(originalPath.indexOf(&quot;file://localhost/&quot;) == 0)
			originalPath = &quot;file://&quot; + originalPath.substr(16);
		// Convert to a native file format
		var localPath;

		if(originalPath.charAt(9) == &quot;:&quot;) // pc local file
			localPath = unescape(originalPath.substr(8)).replace(new RegExp(&quot;/&quot;,&quot;g&quot;),&quot;\\&quot;);
		else if(originalPath.indexOf(&quot;file://///&quot;) == 0) // FireFox pc network file
			localPath = &quot;\\\\&quot; + unescape(originalPath.substr(10)).replace(new RegExp(&quot;/&quot;,&quot;g&quot;),&quot;\\&quot;);
		else if(originalPath.indexOf(&quot;file:///&quot;) == 0) // mac/unix local file
			localPath = unescape(originalPath.substr(7));
		else if(originalPath.indexOf(&quot;file:/&quot;) == 0) // mac/unix local file
			localPath = unescape(originalPath.substr(5));
		else if(originalPath.indexOf(&quot;http&quot;) == 0){ //jon hack for online

			var end =originalPath.lastIndexOf(&quot;/&quot;);
			localPath = unescape(originalPath.substr(0,end+1));
		}
		else // pc network file
			localPath = &quot;\\\\&quot; + unescape(originalPath.substr(7)).replace(new RegExp(&quot;/&quot;,&quot;g&quot;),&quot;\\&quot;);
		return localPath;
	}

	,loadRemoteFile: function(url,callback,params,headers,data,contentType,username,password,allowCache)
	{
		//callback parameters: status,params,responseText,url,xhr
		return this._httpReq(&quot;GET&quot;,url,callback,params,headers,data,contentType,username,password,allowCache);
	}
	/*currently doesnt work with jpg files - ok formats:gifs pngs*/
	,saveImageLocally: function(sourceurl,dest,dothiswhensavedlocally,dothiswhenloadedfromweb) {
		
		var localPath = VismoFileUtils.getLocalPath(document.location.toString());
	
		var savePath;
		if((p = localPath.lastIndexOf(&quot;/&quot;)) != -1) {
			savePath = localPath.substr(0,p) + &quot;/&quot; + dest;
		} else {
			if((p = localPath.lastIndexOf(&quot;\\&quot;)) != -1) {
				savePath = localPath.substr(0,p) + &quot;\\&quot; + dest;
			} else {
				savePath = localPath + &quot;/&quot; + dest;
			}
		}
		
		var onloadfromweb = function(status,params,responseText,url,xhr){
			try{
				if(dothiswhenloadedfromweb){
					dothiswhenloadedfromweb(url);
				}
				//console.log(&quot;VismoFileUtil.saveFile doesnt work for iamges it might seem&quot;,savePath);
				VismoFileUtils.saveFile(savePath,responseText);
		
			}
			catch(e){
				console.log(&quot;error saving locally..&quot;+ e);
			}

		};
		
		var onloadlocally = function(responseText,url,xhr){		
		
				if(dothiswhensavedlocally){
					dothiswhensavedlocally(dest);
				}
			
		};
		

		try{
			var r = jQuery.get(dest,null,onloadlocally);
			if(r.status == 404) throw &quot;404 error&quot;;
		
		}
		catch(e){//couldnt load probably doesn't exist!
			VismoFileUtils.loadRemoteFile(sourceurl,onloadfromweb,null,null,null,null,null,null,true);		
		}

		
		
	}
	,_httpReq: function (type,url,callback,params,headers,data,contentType,username,password,allowCache)
	{
		var x = null;
		try {
			x = new XMLHttpRequest(); //# Modern
		} catch(ex) {
			try {
				x = new ActiveXObject(&quot;Msxml2.XMLHTTP&quot;); //# IE 6
			} catch(ex2) {
			}
		}
		if(!x)
			return &quot;Can't create XMLHttpRequest object&quot;;
		x.onreadystatechange = function() {
			try {
				var status = x.status;
			} catch(ex) {
				status = false;
			}
			if(x.readyState == 4 &amp;&amp; callback &amp;&amp; (status !== undefined)) {
				if([0, 200, 201, 204, 207].contains(status))
					callback(true,params,x.responseText,url,x);
				else{
					callback(false,params,null,url,x);
			
				}
				x.onreadystatechange = function(){};
				x = null;
			}
		};
		try {
			if(window.Components &amp;&amp; window.netscape &amp;&amp; window.netscape.security &amp;&amp; document.location.protocol.indexOf(&quot;http&quot;) == -1)
			window.netscape.security.PrivilegeManager.enablePrivilege(&quot;UniversalBrowserRead&quot;);
			
			if(!allowCache)
				url = url + (url.indexOf(&quot;?&quot;) &lt; 0 ? &quot;?&quot; : &quot;&amp;&quot;) + &quot;nocache=&quot; + Math.random();
			else{
				url = url + (url.indexOf(&quot;?&quot;) &lt; 0 ? &quot;?&quot; : &quot;&amp;&quot;);
			}
			x.open(type,url,true,username,password);
			if(data)
				x.setRequestHeader(&quot;Content-Type&quot;, contentType || &quot;application/x-www-form-urlencoded&quot;);
			if(x.overrideMimeType)
				x.setRequestHeader(&quot;Connection&quot;, &quot;close&quot;);
			if(headers) {
				for(var n in headers)
					x.setRequestHeader(n,headers[n]);
			}
		//	x.setRequestHeader(&quot;X-Requested-With&quot;, &quot;TiddlyWiki &quot; + formatVersion());
		x.overrideMimeType('text/plain; charset=x-user-defined');
			x.send(data);
		} catch(ex) {
			//console.log(ex);
			//throw ex;
		}
		return x;
	},
	

	_getXML:function(str) {
		if(!str)
			return null;
		var errorMsg;
		try {
			var doc = new ActiveXObject(&quot;Microsoft.XMLDOM&quot;);
			doc.async=&quot;false&quot;;
			doc.loadXML(str);
		}
		catch(e) {
			try {
				var parser=  new DOMParser();
				var doc = parser.parseFromString(str,&quot;text/xml&quot;);
			}
			catch(e) {
				return e.message;
			}
		}

		return doc;	
	}

	,getChildNodeValue: function(ofThisNode){
		var value= &quot;&quot;;
		if(ofThisNode.childNodes){
			
			for(var k=0; k &lt; ofThisNode.childNodes.length; k++){
			
				if(ofThisNode.childNodes[k].nodeValue){
					value += ofThisNode.childNodes[k].nodeValue;
				}
			}
		}
		return value;
	}
};/*some conversion functions that convert to geojson */
var VismoConversion ={
	niaveGeoJsonFlatten: function(geojson,niaveness){
		
		var newdata = geojson;
		var coordsDropped = 0;
		for(var i=0; i &lt; newdata.features.length; i++){
			var g = newdata.features[i].geometry;
		
			if(g.type == 'MultiPolygon'){
				for(var ij =0; ij &lt; g.coordinates.length; ij++){
					for(var j=0; j &lt; g.coordinates[ij].length; j++){
		
						var bettercoords = [];
						var every = 0;
						if(g.coordinates[ij][j].length &gt; 50){
							for(var k=0; k &lt; g.coordinates[ij][j].length; k++){

								var c = g.coordinates[ij][j][k];
							
								if(every == 0){
									var x = parseFloat(c[0]);
									var y = parseFloat(c[1]);
									bettercoords.push([x,y]);
									every= niaveness;
								}
								else{
									every -= 1;
								}	
			
							}
							coordsDropped += (g.coordinates[ij][j].length - bettercoords.length);
							g.coordinates[ij][j] = bettercoords;
						}
					}
				}
			}
		}
		console.log(coordsDropped,&quot;dropped&quot;);
		return newdata;
	}
	,svgToGeoJson: function(svg,canvas){
		var svgxml = VismoFileUtils._getXML(svg);
		var res = VismoMapSVGUtils.convertSVGToMultiPolygonFeatureCollection(svgxml);
		
		
		//res = VismoMapUtils.fitgeojsontocanvas(res,canvas);
		//console.log(res.boundingBox);
		//res
		//work out here where origin should be (half of the maximum width of the svg coordinate space should be 0)
		return res;
	},
	_kmlPolygonToFeature: function(xmlNode,feature){
		var geocoordinates = [];
		var polyChildren =xmlNode.childNodes;
		
		for(var k=0; k &lt; polyChildren.length; k++){
			var fail = true;
			if(polyChildren[k].tagName =='outerBoundaryIs'){
				
				var outerChildren =polyChildren[k].childNodes;
				for(var l=0; l &lt; outerChildren.length; l++){
					if(outerChildren[l].tagName == 'LinearRing'){
						
						var ringChildren =outerChildren[l].childNodes;
						for(var m=0; m &lt; ringChildren.length; m++){
							if(ringChildren[m].tagName == 'coordinates'){
							
								
								var geometry = VismoFileUtils.getChildNodeValue(ringChildren[m]);
								geometry = geometry.trim();
						
								
								var coords = geometry.split(&quot; &quot;); //\n?
								for(var n=0; n &lt; coords.length; n+= 1){
									var values = coords[n].split(&quot;,&quot;);
									var longitude= parseFloat(values[0]);
									var latitude = parseFloat(values[1]);
									var altitude = parseFloat(values[2]);
									geocoordinates.push([longitude,latitude]);
								
								}
								if(coords.length ==0){
									return false;
								}
								else{
									fail = false;
								}
								feature.geometry.coordinates.push([geocoordinates]);			
								
							}	
						}
					}
				}

                                                
			}
		}
		if(!feature){
			fail  = true;
		}
		else if(feature.geometry.coordinates[0].length == 0){
			fail = true;
		}
		else if(feature.geometry.coordinates[0][0].length == 1){
			fail = true;
		}
	
		if(fail) {
			return false;
		}
		else{
				
			return feature;
		}
	}
	,kmlToGeoJson: function(kml){
		var geojson = {type:&quot;FeatureCollection&quot;, features:[]};
		
		var xml =VismoFileUtils._getXML(kml);
		var items = xml.getElementsByTagName(&quot;Placemark&quot;);
		
		for(var i=0; i &lt; items.length; i++){
	
			var feature = {type:'Feature', geometry:{type:'MultiPolygon', coordinates:[]},properties:{'name':'georss'}};
						
			
			var att = items[i].childNodes;
			
			for(var j=0; j &lt; att.length; j++){
				var fail = false;
				
				if(att[j].tagName == 'name' &amp;&amp; att[j].firstChild){
					feature.properties.name =att[j].firstChild.nodeValue;
				}
				
				if(att[j].tagName == 'Polygon'){
					
					var succeeded = this._kmlPolygonToFeature(att[j],feature);

					if(succeeded){
						feature = succeeded;
					}
					else{
						fail = true;
					}
				}
				if(att[j].tagName == 'MultiGeometry'){
					
					var children = att[j].childNodes;
					for(var k=0; k &lt; children.length; k++){
						if(children[k].tagName == 'Polygon'){

							var succeeded = this._kmlPolygonToFeature(children[k],feature);
						
							if(succeeded){
								feature = succeeded;
							}
							else{
								fail = true;
							}
						}	
					}
				}
				
			}
			//console.log(&quot;ere&quot;,fail);
			//if(!fail)
	//console.log(feature.geometry.coordinates.length);
			if(!fail &amp;&amp; feature &amp;&amp; feature.geometry.coordinates.length &gt; 0) {
					geojson.features.push(feature);
			}
		}
	
		return geojson;
	}
	
	,geoRssToGeoJson : function (georss){
	
		var geojson = {type:&quot;FeatureCollection&quot;, features:[]};
		var xml =VismoFileUtils._getXML(georss);
		var items = xml.getElementsByTagName(&quot;item&quot;);
		
		for(var i=0; i &lt; items.length; i++){
			
			var feature = {type:'Feature', geometry:{type:'MultiPolygon', coordinates:[]},properties:{'name':'georss'}};
						
			var fail = false;
			var att = items[i].childNodes;
			for(var j=0; j &lt; att.length; j++){

				
				if(att[j].tagName == 'title' &amp;&amp; att[j].firstChild){
					feature.properties.name =att[j].firstChild.nodeValue;
				}
				if(att[j].tagName == 'description' &amp;&amp; att[j].firstChild){
					feature.properties.description =att[j].firstChild.nodeValue;
				}
				
				if(att[j].tagName == 'georss:polygon'){
					var geocoordinates = [];
					//console.log(att[j].innerHTML,att[j].firstChild,&quot;inner&quot;);

					var geometry = VismoFileUtils.getChildNodeValue(att[j]);
					geometry = geometry.trim();
					geometry = geometry.replace(/  +/g, &quot; &quot;);
					geometry = geometry.replace(/\n/g, &quot;&quot;);
					var values = geometry.split(&quot; &quot;);
				
					if(values[0] != values[values.length-2] |values[1] != values[values.length-1]){
						values.push(values[0]);
						values.push(values[1]);
					}
					for(var k=0; k &lt; values.length - 1; k+= 2){
						var latitude = parseFloat(values[k]);
						var longitude= parseFloat(values[k+1]);
						geocoordinates.push([longitude,latitude]);
					}
					feature.geometry.coordinates.push([geocoordinates]);
				}
				
			}
			if(!fail){
				geojson.features.push(feature);
			}
			else{
				
				//console.log(&quot;Unable to construct feature &quot; +feature.properties.name+&quot;. Invalid georss coordinates: first and last coordinates should be same. &quot;);
			}
		}
		
		return geojson;
	}

};var VismoClickingUtils = {
        //to be implemented..
        inVisibleArea: function(vismoCanvas,vismoShape){
                var bb = vismoShape.getBoundingBox();
                return true;
        }
        ,scrollXY: function(){
          var scrOfX = 0, scrOfY = 0;
          if( typeof( window.pageYOffset ) == 'number' ) {
            //Netscape compliant
            scrOfY = window.pageYOffset;
            scrOfX = window.pageXOffset;
          } else if( document.body &amp;&amp; ( document.body.scrollLeft || document.body.scrollTop ) ) {
            //DOM compliant
            scrOfY = document.body.scrollTop;
            scrOfX = document.body.scrollLeft;
          } else if( document.documentElement &amp;&amp; ( document.documentElement.scrollLeft || document.documentElement.scrollTop ) ) {
            //IE6 standards compliant mode
            scrOfY = document.documentElement.scrollTop;
            scrOfX = document.documentElement.scrollLeft;
          }
          return {x: scrOfX,y: scrOfY};
        }
	,getRealXYFromMouse: function(e,t){
		var newpos =VismoClickingUtils.getMouseFromEvent(e);
		newpos = VismoClickingUtils.undotransformation(newpos.x,newpos.y,t);
		return newpos;
	}
	
	,undotransformation: function(x,y,transformation){ //porting to VismoTransformations?
		return VismoTransformations.undoTransformation(x,y,transformation);
	}	
	,resolveTarget:function(e)
	{
		if(!e) e = window.event;
		var obj;
		
		if(e &amp;&amp; e.srcElement){
			obj = e.srcElement;
		}
	        else if(e.target)
        	        obj = e.target;
        	else{
	                obj = false;
	        }
	        try{
                        var x = obj.parentNode;
                }catch(e){return false;}
                /*
		if(obj &amp;&amp; obj.nodeType &amp;&amp; obj.nodeType == 3) // defeat Safari bug
			obj = obj.parentNode;
			*/
			
			/*try{
                                var x = obj.parentNode;
                        }
                        catch(e){return false;};*/
	        return obj;

		//return obj;
	}
	
	
	,getMouseFromEvent : function(e,target){
			if(!e) e = window.event;
			
			if(!target){
			       
			        var target = this.resolveTargetWithVismo(e);
			        if(!target)return false;
                        }
                        
			var offset = jQuery(target).offset();
               
                        var i;
          
			if(typeof(offset.left) != 'number') return false;
		
		        var scroll = this.scrollXY(e);
			x = e.clientX + scroll.x;
			y = e.clientY + scroll.y;
			//alert(x +&quot;/&quot;+y);
			x -= offset.left;
			y-=  offset.top;
			
			return {'x':x, 'y':y};		
			
	}
	,getMouseFromEventRelativeToTarget : function(e,target){
			if(!e) e = window.event;
			if(!target)return false;

			var offset = jQuery(target).offset();

			
			if(!offset.left) return false;
			var scroll = this.scrollXY();
			x = e.clientX + scroll.x - offset.left;
			y = e.clientY + scroll.y - offset.top;
			return {'x':x, 'y':y};		
			
	}

	,resolveTargetWithVismo: function(e)
	{
		var node = VismoClickingUtils.resolveTarget(e);
                

                
		if(!node)return false;
		var hasVismo = false;
     
                
		while(!hasVismo &amp;&amp; node != document &amp;&amp; node.parentNode &amp;&amp; node.parentNode != document){
		        
		        if(node.vismoCanvas || node.vismoController || node.vismoClicking){
		                hasVismo = true;
			}
			else{
			        node= node.parentNode;
			}
		}
		
		if(!node) return false;
		return node;
	}
	,getMouseFromEventRelativeToElement: function (e,x,y,target){
		if(!e) e = window.event;

		var offset = jQuery(target).offset();
		if(!offset.left) return false;
		
		var scroll = this.scrollXY();
		oldx = e.clientX + scroll.x - offset.left;
		oldy = e.clientY + scroll.y - offset.top;
		var pos = {'x':oldx, 'y':oldy};

		if(!pos) return false;
		pos.x -= x;
		pos.y -= y;
		

		return pos;
		
	}

	,getMouseFromEventRelativeTo: function (e,x,y){
	
		var pos = this.getMouseFromEvent(e);
		if(!pos) return false;
		pos.x -= x;
		pos.y -= y;

		return pos;
	
	}
	,getMouseFromEventRelativeToElementCenter: function(e){ /*redundant?? */
		var w,h;
		var target = this.resolveTargetWithVismo(e);
		if(!target)return;
		if(target.style.width)
			w = parseInt(target.style.width);
		else if(target.width)
			w =parseInt(target.width);

		if(target.style.height)
			h = parseInt(target.style.height);
		else if(target.height)
			h = parseInt(target.height);
	
		if(!w || !h) throw &quot;target has no width or height (vismomaputils)&quot;;
	
		return this.getMouseFromEventRelativeTo(e,w/2,h/2);
	}	
	

};

var VismoTransformations= {
	clone: function(transformation){
	
		var t = {};
		t.translate = {x:0,y:0};
		t.scale = {x:1,y:1};

		if(transformation.translate &amp;&amp; transformation.translate.x){
			t.translate.x = transformation.translate.x;
			t.translate.y = transformation.translate.y;
		}
		
		if(transformation.scale &amp;&amp; transformation.scale.x){
			t.scale.x = transformation.scale.x;
			t.scale.y = transformation.scale.y;		
		}
		
		return t;
	}
	,applyTransformation: function(x,y,t){

		var res= {};
		res.x = x;
		res.y = y;



		if(t.translate){
			res.x +=  t.translate.x;
			res.y += t.translate.y;
		}
		if(t.scale){
			res.x *= t.scale.x;
			res.y *= t.scale.y;
		}

		if(t.origin){
			res.x += t.origin.x;
			res.y += t.origin.y;
		}
		return res;
		
	}
	,mergeTransformations: function(a,b){
		if(!b) return a;
		if(!a) return b;
		
		var result = {};
		var i;
		for(i in a){
			result[i] = a[i];
		}
		
		for(i in b){
			if(result[i]){
				var oldt = result[i];
				var newt = b[i];
				
				result[i].x = oldt.x + newt.x;
				result[i].y = oldt.y + newt.y;
			}
			else{
				result[i] = b[i];
			}
		}
		return result;
	}
	,undoTransformation: function(x,y,transformation){
		var pos = {};
		var t =transformation;
		var tr =t.translate;
		var s = t.scale;
		var o = t.origin;
		if(s ===false || o ===false || tr ===false) return false;
		
		if(x ===false || y ===false)return false;
		pos.x = x - o.x;
		pos.y = y -o.y;
		//pos.x -= x;
		//pos.y += y;
		
		if(pos.x !== 0)
			pos.x /= s.x;
		
		if(pos.y !== 0)
			pos.y /= s.y;
			
		pos.x -= tr.x;
		pos.y -= tr.y;			
		return pos;	
	}
	,getXY: function(e,t){
		var pos =VismoClickingUtils.getMouseFromEvent(e);
		return this.undoTransformation(pos.x,pos.y,t);
	}
	,create: function(options){
	    var transformation= {};
	    var i;
	    for(i in options){
	        transformation[i] = options[i];
	    }
	    var s = transformation.scale;
	    var t = transformation.translate;
	    transformation[&quot;cache&quot;] = {id1:[s.x,&quot;,&quot;,s.y].join(&quot;&quot;),id2:[t.x,&quot;,&quot;,t.y].join(&quot;&quot;)};
	    
	    return transformation;
	    
	}
};var Vismo = {store:{Canvas:{}}};
var VismoCanvas = function(element,options){
    this._referenceid = Math.random();
    Vismo.store.Canvas[this._referenceid] = this;
    this._lastTransformation = {scale:{}};

    if(element.length){ //for jquery
        var result = [];
        for(var i=0; i &lt; element.length; i++){
            var x = new VismoCanvas(element[i],options);
            result.push(x);
        }
        return x;
    }
    this.className = &quot;VismoCanvas&quot;;
    this._idtoshapemap = {};
    if(!options) options = {};
	if(typeof element == 'string') element= document.getElementById(element);
	if(!element) throw &quot;Element doesn't exist!&quot;;
	
	var canvaswidth = jQuery(element).width();
	var canvasheight = jQuery(element).height();
	element.style.width = canvaswidth;
	element.style.height = canvasheight;
	if(element.vismoClicking) {
		var update = element.vismoClicking;
		return update;
	}
	if(!options.pointsize){
        options.pointsize = 5;
    }	

	this.options = options;

	var wrapper = element;
	
	this.settings = {};
	this.settings.browser = !VismoUtils.browser.isIE ? 'good' : 'ie'
	this.settings.globalAlpha = 1;
	var canvas;
	var hideoverflow;
	if(this.settings.browser =='good'){
	    canvas = document.createElement('canvas');
	    canvas.className = &quot;VismoCanvasRenderer&quot;;
	    hideoverflow = canvas;
	}    
	else
	{
	    hideoverflow = document.createElement(&quot;div&quot;);
	    canvas = document.createElement('div');
	    canvas.className = &quot;VismoIECanvas VismoCanvasRenderer&quot;;
	    
	    canvas.style.setAttribute('cssText', 'position:absolute;left:0px;top:0px;', 0);
	    
	    hideoverflow.appendChild(canvas);
	    
	}
	
	
	//.VismoIECanvas
	var width =parseInt(wrapper.style.width);
	var height =parseInt(wrapper.style.height);
	canvas.width = width;
	canvas.height = height;
	
	this.setTransformation({translate:{x:0,y:0},scale:{x:1,y:1},origin:{x:canvaswidth/2, y:canvasheight/2}});
	if(!element.className)element.className = &quot;VismoCanvas&quot;;
	jQuery(canvas).css({width:width, height:height,'z-index':1,position:'absolute'});        
	element.appendChild(hideoverflow);
	jQuery(hideoverflow).css({width:width, height:height,position:&quot;absolute&quot;,overflow:&quot;hidden&quot;,left:&quot;0px&quot;,top:&quot;0px&quot;});
	var labels =  document.createElement(&quot;div&quot;);
    jQuery(labels).css({position:&quot;absolute&quot;,&quot;z-index&quot;:9});      
    labels.className = &quot;VismoLabels&quot;;
    wrapper.appendChild(labels);
    this.labelHolder = labels;
    this.labels = [];
	this.canvas = canvas;

	this.memory = [];
	
	element.vismoClicking = true;//this;//true;//this
    jQuery(this.canvas).mousedown(function(e){e.preventDefault();});

	this.wrapper = wrapper;

	this._setupMouse();

    var vc = this;
	if(options.vismoController){
	    if(!options.vismoController.handler){
	        options.vismoController.handler = function(t){
	            vc.transform(t);
	        }
	    }
	    this.vismoController = new VismoController(this.getDomElement(),options.vismoController);
	}
	
	this.mouse({down:options.mousedown,up:options.mouseup,move:options.move,dblclick:options.dblclick,keypress:options.keypress});
	var tooltipfunction;
	if(options.tooltipfunction){
	    if(typeof options.tooltipfunction == 'boolean'){
	        tooltipfunction = function(el,s){
	            if(s){
	                el.innerHTML = &quot;cool&quot;+s.getProperty(&quot;id&quot;);}
	            }
	    }
	    else{
	        tooltipfunction = options.tooltipfunction;
	    }
	    this.addTooltip(tooltipfunction)
	}

	if(options.shapes) {
		for(var i=0; i &lt; options.shapes.length; i++){
	        
			this.add(options.shapes[i]);
		
		}
		this.render();
	}
	
	var x = window.onbeforeunload;
	var that = this;

	window.onbeforeunload =function(){
	    that.teardown();
	    x();
    };

};

VismoCanvas.prototype = {
    teardown: function(){
        VismoUtils.scrubNode(this.canvas);
        VismoUtils.scrubNode(this.wrapper);
        VismoUtils.scrubNode(this.labelHolder); 
       jQuery(this.canvas).unbind(&quot;mousedown&quot;);
       this.wrapper.onmouseout = null;
       this.wrapper.onmouseover = null;
      
        
    }
	,getDomElement: function(args){
		return this.wrapper;
	}
	,addTooltip: function(args){
	    var addContent = arguments[0];
	    var wrapper = this.wrapper;
	        if(addContent) this.tooltipAddContent = addContent;
	        if(!this.tooltip){
	                var tooltip =  document.createElement(&quot;div&quot;);
                        jQuery(tooltip).css({position:&quot;absolute&quot;,&quot;z-index&quot;:1000,display:&quot;none&quot;});      
                        tooltip.className = &quot;VismoTooltip&quot;;
                        
                        jQuery(tooltip).mousedown(function(e){e.preventDefault();if(wrapper &amp;&amp; wrapper.onmousedown)wrapper.onmousedown(e);});
                        jQuery(tooltip).mousemove(function(e){e.preventDefault();});
                        jQuery(this.wrapper).parent().append(tooltip);
                        this.tooltip = tooltip;
                        
        		                       
                }
                if(!this.tooltipAdded){
                        var move= this.onmousemove;
                        var that = this;
                        var lastshape;
        		var newmove = function(e,shape){
        		        if(!e) e = window.event;
        		        if(!that.tooltip) return;     
                                jQuery(that.tooltip).html(&quot;&quot;);
                        
                        if(shape &amp;&amp; lastshape != shape){
                                var bb = shape.getBoundingBox();
                           	    //var pos = VismoClickingUtils.getMouseFromEvent(e);
                		        if(that.tooltipAddContent)that.tooltipAddContent(that.tooltip,shape);
                		        var pos = VismoTransformations.applyTransformation(bb.x2,bb.y1,that.getTransformation())
                		        //var pos= {x: bb.center.x, y:bb.center.y};
                		        var w = jQuery(that.wrapper).width();
                		        var h = jQuery(that.wrapper).height();
                		        var off = jQuery(that.wrapper).offset();
                		        if(pos.x &gt; off.left + w) pos.x = off.left + w;
                		        
                		        //jQuery(that.tooltip).css({top:0, right:0});             
                                }
        		        if(that.tooltipAddContent &amp;&amp; shape){
        		                that.tooltipAddContent(that.tooltip,shape);
        		                lastshape = shape;
        		                jQuery(that.tooltip).css({display:&quot;&quot;});
        		        }
        		        else{
     		                  jQuery(that.tooltip).css({display:&quot;none&quot;});
        		        }     
        		        if(move)move(e,shape);
        		        
        		};
        		this.onmousemove = newmove;
                        this.tooltipAdded = true;
                }
	}
	,getXYWindow: function(args){
	    var e = arguments[0];
	       var t = this.getTransformation();
	       var pos = this.getXY(e);
	       return  VismoTransformations.applyTransformation(pos.x,pos.y,t);
	}
	,getXY: function(args){
	    var e = arguments[0];
		return VismoTransformations.getXY(e,this.getTransformation());
	}
	,mouse: function(args){
	  
	    if(!args){
	        return {up: this.onmouseup, down: this.onmousedown, move: this.onmousemove, dblclick: this.ondblclick,keypress:this.onkeypress};
	    }
	    else{
	        var args = arguments[0];
	        
	        if(args.down)this.onmousedown = args.down;
    		if(args.up)this.onmouseup = args.up;
    		if(args.move)this.onmousemove=  args.move;
    		if(args.dblclick) this.ondblclick = args.dblclick;
    		if(args.keypress) this.onkeypress = args.keypress;

    		//if(this.madeMoveable) this.makeMoveable();
    		//if(this.tooltipAdded) this.addTooltip();	        
	    }
	}

	,_setupMouse: function(args){
		var that = this;
		this.onmousedown = function(e,s,pos){};
		this.onmouseup = function(e,s,pos){};
		this.onmousemove = function(e,s,pos){};
		this.ondblclick = function(e,s,pos){};
		this.onkeypress = function(e){};
	

		this._applyMouseBehaviours(this.wrapper);
		for(var i =0; i &lt; this.wrapper.childNodes.length; i++){
			var child = this.wrapper.childNodes[i];
			//this._applyMouseBehaviours(child);
		}
	
	}
	,_applyMouseBehaviours: function(args){
	    var el = arguments[0];
	    var that = this;
	        
		var newbehaviour = function(e){
				//var t = VismoClickingUtils.resolveTargetWithVismo(e);              
				//if(t &amp;&amp; t.getAttribute(&quot;class&quot;) == 'vismoControl') return false;
				var shape = that.getShapeAtClick(e,el);
				return shape;
			
		};
	    var applymice = function(el){
	        var down = el.onmousedown;
    		var up = el.onmouseup;
    		var mv = el.onmousemove;
    		var dblclick =el.ondblclick;
    		this.initialKeyPress = window.onkeypress;
    		//el.oncontextmenu=function(args) {  return false}; 		
    		el.onmouseover = function(e){

    				if(!that.keypressactive) {

    					that.keypressactive =  true;
    					window.onkeypress =function(e){
    					    that.onkeypress(e);
    					    if(that.initialKeyPress)that.initialKeyPress(e);
    					}
    					document.onkeypress = function(e){if(!e) e= window.event;if(that.initialKeyPress)that.initialKeyPress(e);if(!e) e= window.event;var s = newbehaviour(e); 
    					        if(that.onkeypress)that.onkeypress(e,s)
    					       
    					};
    				}
    		};
    		el.onmouseout = function(e){if(!e) e= window.event;that.keypressactive = false;};
	    
	    
    		jQuery(el).mousedown(function(e){
    		    //console.log(&quot;md&quot;,el);
    			var s = newbehaviour(e); 
    			if(s){
    				if(s.getProperty(&quot;onmousedown&quot;)){
    				        s.getProperty(&quot;onmousedown&quot;)(e,s);	
    				        if(that.onmousedown)that.onmousedown(e,s);

    				}
    				else{
    				    if(that.onmousedown)that.onmousedown(e,s);
    				}
    			}
    			else {
    			    //console.log(&quot;ic&quot;);
    			        if(that.onmousedown)that.onmousedown(e,s);
    			        if(down)down(e,s);
    			}

    		});

            jQuery(el).dblclick(function(e){
    			if(!e) e= window.event;
    			var s = newbehaviour(e); 				
    			if(s) {

    				if(s.getProperty(&quot;ondblclick&quot;)){
    				        s.getProperty(&quot;ondblclick&quot;)(e,s);
    				}
    				else if(that.ondblclick){
            			        that.ondblclick(e,s);
            			}
            			else{


            			}
    			}
    			else {
    				if(that.ondblclick){
            			        that.ondblclick(e,s);
            			}
    				if(dblclick){
    				        dblclick(e,s);
                                    }
    			}
    		});
            jQuery(el).mouseup(function(e){ 
                //console.log(&quot;mu&quot;,el);
                    var s = newbehaviour(e);
                    if(s){
    		                if(s.getProperty(&quot;onmouseup&quot;)){
    		                        s.getProperty(&quot;onmouseup&quot;)(e,s);
    		                        if(that.onmouseup)that.onmouseup(e,s);

    		                }
    		                else{
    		                    if(that.onmouseup)that.onmouseup(e,s);
    		                }


    		        }
    		        else{
    		                if(that.onmouseup)that.onmouseup(e,s);
    		                if(up)up(e,s);
    		        }
    		});
    		var defaultCursor;
    		jQuery(el).mousemove(function(e){ if(!e) e= window.event;var s = newbehaviour(e);

    		        if(!VismoUtils.browser.isIE){
    		                if(jQuery(el).hasClass(&quot;overVismoShape&quot;)) jQuery(el).removeClass(&quot;overVismoShape&quot;);
    		        }
    		        if(!VismoUtils.browser.isIE){

    		                if(jQuery(el).hasClass(&quot;overVismoPoint&quot;))jQuery(el).removeClass(&quot;overVismoPoint&quot;);
    		        }

    		        if(s &amp;&amp; !s.getProperty(&quot;unclickable&quot;)){


            		        if(that.ondblclick || that.onmousedown || that.onmouseup) {
            		                var sh;
                    		        if(s){
                    		               sh  = s.getShape();
                    		               if(!VismoUtils.browser.isIE  &amp;&amp;sh == &quot;point&quot;) jQuery(el).addClass(&quot;overVismoPoint&quot;);
                    		        }
            		                if(!VismoUtils.browser.isIE &amp;&amp; !jQuery(el).hasClass(&quot;panning&quot;) &amp;&amp; !jQuery(el).hasClass(&quot;zooming&quot;))jQuery(el).addClass(&quot;overVismoShape&quot;);
            	                }

    		                if(s.getProperty(&quot;onmousemove&quot;))s.getProperty(&quot;onmousemove&quot;)(e,s);
    		        }
    		        else{
    		                //el.style.cursor = defaultCursor;
    		        }
    		        if(that.onmousemove)that.onmousemove(e,s); 
    		        if(mv)mv(e,s);
    		});       	

        };
        applymice(el);
		


	}
	,getDimensions: function(args){
		return {width: this.width() , height: this.height()};
	}
	,height: function(){
	    return parseInt(this.canvas.style.height);
	},
	width: function(){
	    return parseInt(this.canvas.style.width);
	}
	,resize: function(args){
		var width = arguments[0]; var height=arguments[1];
		if(this.canvas.getAttribute(&quot;width&quot;)){
			this.canvas.width = width;
			this.canvas.height = height;
		}
		jQuery(this.hideoverflow).css({height:height,width:width});
		jQuery(this.wrapper).css({height:height,width:width});
		jQuery(this.canvas).css({height:height,width:width});
	}
	,setTransparency: function(args){	
	    var alpha = arguments[0];
		this.settings.globalAlpha = alpha
	}
	,_setupCanvasEnvironment: function(args){
		if(VismoUtils.browser.isIE) return;
		var ctx = this.canvas.getContext('2d');
		var s =this.getTransformation().scale;
		if(s &amp;&amp; s.x)ctx.lineWidth = (0.5 / s.x);
		ctx.globalAlpha = this.settings.globalAlpha;
		ctx.clearRect(0,0,this.canvas.width,this.canvas.height);
		ctx.lineJoin = 'round'; //miter or bevel or round	
	}
	,clear: function(args){
	    var deleteMemory = arguments[0];
		if(deleteMemory){
			this.clearMemory();
		}
		this._maxX = 0;
		this._maxY = 0;
        
		
		if(!this.canvas.getContext) {
			return;
		}
		var ctx = this.canvas.getContext('2d');
		ctx.clearRect(0,0,this.canvas.width,this.canvas.height);		
		
	}	
	
	
	,ie_render: function(args){
	    var projection= arguments[0];
	    VismoTimer.start(&quot;VismoCanvas.ie_render&quot;);
	    //this.render = this.ie_render;
	    var that = this;
		var transformation = this.getTransformation();
		if(this.options.beforeRender) this.options.beforeRender(this);	
		if(transformation.scale.x) sc = transformation.scale.x; else sc = 1;
		
		//determine point size
		var ps = this.options.pointsize / parseFloat(sc);
			
		tran = transformation;
        var o = tran.origin,t = tran.translate, s = tran.scale;
        jQuery(this.canvas).css({left:o.x+(t.x*s.x),top:o.y +(s.y*t.y),zoom:s.x});
        
		var mem =that.memory;
        var firstTime = false;
	    var appendTo;
	    if(that.canvas.childNodes.length == 0){
	        firstTime = true;
	        appendTo  = document.createElement(&quot;div&quot;);
	    }
	    else{
	        appendTo = that.canvas;
	    }
	    var lastT = this._lastTransformation.scale;
	    var shapes = this._lastTransformation.shapes;
	    if(lastT.x  ===s.x &amp;&amp; lastT.y === s.y &amp;&amp; this.memory.length == shapes){
	        tran = false; //stop a transformation from being applied we've covered it here
	    }

	    var globalAlpha =that.settings.globalAlpha; 
		for(var i=0; i &lt; mem.length; i++){
            var vs =mem[i];
		    var st = vs.properties.shape
	        //if(vs.optimise(appendTo,transformation,projection)){
		        
			    if(st == 'domElement')tran = transformation;
				vs.render(that.canvas,tran,projection,true,that.settings.browser,ps);        
				if(vs.vmlfill &amp;&amp; !vs.vmlfill.opacity &amp;&amp; globalAlpha) {
					vs.vmlfill.opacity =globalAlpha;
				}
			
				
			//}
			/*
			var lookahead = function(){
			    var newtransformation = VismoUtils.clone(transformation);
			    newtransformation.scale.x *=2;
			    newtransformation.scale.y *= 2;
			    vs.optimise(appendTo,newtransformation,projection,true);
			};
			window.setTimeout(lookahead,1000);
		    */
		}
	    
		this._lastTransformation = {scale:{x:s.x,y:s.y},shapes:this.memory.length};
		if(firstTime){
		    that.canvas.appendChild(appendTo.cloneNode(true));
		}
		VismoTimer.end(&quot;VismoCanvas.ie_render&quot;);
	    
        
	}
	,canvas_render: function(args){
	    	    //console.log(this.getDomElement(),this.transformation);
	    var projection = arguments[0];
	    this.render = this.canvas_render;
	    var that = this;
		var transformation = this.getTransformation();
		if(this.options.beforeRender) this.options.beforeRender(this);	
		if(transformation.scale.x) sc = transformation.scale.x; else sc = 1;
		//determine point size
		var ps = this.options.pointsize / parseFloat(sc);
	
			
		
		var appendTo;
	    var mem =that.getMemory();
	    this._setupCanvasEnvironment();
	    var ctx = that.canvas.getContext('2d');
		ctx.save();
		tran = false;

		if(transformation){
			
			var o = transformation.origin;
			var tr = transformation.translate;
			var s = transformation.scale;
			var r = transformation.rotate;
			if(o &amp;&amp; s &amp;&amp; tr){
				ctx.translate(o.x,o.y);
				ctx.scale(s.x,s.y);
				ctx.translate(tr.x,tr.y);
			}
			if(r &amp;&amp; r.x)ctx.rotate(r.x);
		}
	
		appendTo = that.canvas;
		
		for(var i=0; i &lt; mem.length; i++){
		    var st = mem[i].getShape();
	        if(mem[i].optimise(that.canvas,transformation,projection)){
			    if(st == 'domElement')tran = transformation;
				mem[i].render(that.canvas,tran,projection,true,that.settings.browser,ps);        
				if(mem[i].vmlfill &amp;&amp; that.settings.globalAlpha) {
					mem[i].vmlfill.opacity =that.settings.globalAlpha;
				}
			}
		}
	    if(ctx)ctx.restore();
	}
	,render: function(args){
	    var projection = arguments[0];

		if(this.settings.browser == 'good'){
            this.canvas_render(projection);
		}
		else{
	        this.ie_render(projection);
		}
			
	}
	,getTransformation: function(args){
		if(!this.transformation) {
		var ox = parseInt(this.canvas.style.width);
		var oy = parseInt(this.canvas.style.height);
		this.transformation = {scale:{x:1,y:1},translate:{x:0,y:0},origin:{x: ox/2, y: oy/2}};
		//this.transformation = VismoTransformation.getBlankTransformation(this.canvas);
		}
		return this.transformation;
	}
	
	,setTransformation: function(args){
	    var transformation = arguments[0];
	        //console.log(transformation.origin.x,transformation.translate.x,transformation.translate.y);
	        if(!transformation.origin){
	                transformation.origin = {};
	                transformation.origin.x = jQuery(this.wrapper).width() / 2;
	                transformation.origin.y = jQuery(this.wrapper).height() / 2;
	        }
	      
		if(transformation) this.transformation = transformation;
		var t = transformation.translate, s = transformation.scale;	
	    transformation.cache = {id1:[s.x,&quot;,&quot;,s.y].join(&quot;&quot;),id2:[t.x,&quot;,&quot;,t.y].join(&quot;&quot;)};
	    
	}

    ,centerOn: function(x,y){
        
        var t=  this.getTransformation();
        t.translate.x = -x;
        t.translate.y = -y;
        if(this.vismoController){
            this.vismoController.setTransformation(t);
        }
        else{
            this.setTransformation(t);
        }
        this.render();
    }
	,remove: function(args){
        var vismoShape = arguments[0];
       var shapes = this.getMemory();
       
     
       for(var i=0; i &lt; shapes.length; i++){
            if(shapes[i] == vismoShape){
                this.memory.splice(i,1);
            }
       }
       if(vismoShape.vml)vismoShape.vml.scrub();
       
	    var id = vismoShape.properties.id;
   	    delete this._idtoshapemap[id]
	       
	}
	,add: function(args){
	    var vismoShape = arguments[0];
	    this.needsSort = true;
	    if(!vismoShape._isVismoShape){
	        vismoShape = new VismoShape(vismoShape);
	    
	    }
	    if(vismoShape.properties.shape =='point'){
	        
            vismoShape.setDimensions(this.options.pointsize,this.options.pointsize);
        }
		if(!this.memory) this.memory = [];
		
		vismoShape.vismoCanvas = this;
		if(!vismoShape.getProperty(&quot;id&quot;)){
		    var newid  = this.memory.length +&quot;_&quot; + Math.random();
		    vismoShape.setProperty(&quot;id&quot;,newid);
		}
		vismoShape._canvasref = this._referenceid;
		var id = vismoShape.properties.id;
		this.memory.push(vismoShape);
		
		
		this._idtoshapemap[id] = vismoShape;
		vismoShape._vismoClickingID = id;


		return vismoShape;
	}
	,addLabel:function(args){
	    var domElement = arguments[0];
	    var x=  arguments[1];
	    var y = arguments[2];
	        this.labelHolder.appendChild(domElement);
	        var properties = {element: domElement,shape:&quot;domElement&quot;};
	  
	        var coords = [];
	        coords.push(x);
	        coords.push(y);
	        var shape = new VismoShape(properties,coords);
	        this.add(shape);
	              //console.log(shape);
	        return {element: domElement ,vismoshape: shape};
	}
	,transform: function(args){
	    var t = arguments[0];
		this.setTransformation(t);
		this.render();

	}
	,clearMemory: function(args){
		for(var i=0; i &lt; this.memory.length; i++){
			if(this.memory[i].vml){
				this.memory[i].vml.scrub();
			}
		}
		this._idtoshapemap = {};
		this.memory = [];

	},
	getMemory: function(args){
        if(this.needsSort){
          
    	    this.memory =this.memory.sort(function(a,b){
    	        var z1 = a.getProperty(&quot;z-index&quot;);
    	        var z2 =b.getProperty(&quot;z-index&quot;);
    	        if(z1 &lt; z2) return -1;
    	        else if(z1 == z2){
    	            return 0;
    	        }
    	        else{
    	            return 1;
    	        }
    	        });
	        this.needsSort = false;
	    }
	        
	    return this.memory;
	}
	,getMemoryID: function(args){
	    var vismoShape = arguments[0];
		if(vismoShape &amp;&amp; vismoShape._vismoClickingID)
			return vismoShape._vismoClickingID;
		else{
			return false;
		}
	}
	,getShapeWithID: function(args){
	    var id = arguments[0];
	    var mem = this.getMemory();
	    if(this._idtoshapemap[id]) return this._idtoshapemap[id];
	    else return false;
	}
	,getShapeAtClick: function(args){
	    var e = arguments[0];
	    var el = arguments[1]; //the dom element the behaviour occurred o
		if(!e) {
			e = window.event;
		}
	
		var node = VismoClickingUtils.resolveTarget(e);
		//alert(node.tagName);
		if(node &amp;&amp; node.tagName) { //vml vismoShape
		    if(node.tagName.toUpperCase() == 'SHAPE'){
		        if(node._vismoClickingID){
		            
		            var shape = this.getShapeWithID(node._vismoClickingID);
		            if(shape) return shape;
		        }
		        
			}
			
		}

		var target = VismoClickingUtils.resolveTargetWithVismo(e);
	    target =el;
		if(!target) return;
		
		var offset = jQuery(target).offset();

                var xy= VismoClickingUtils.scrollXY();
		x = e.clientX + xy.x - offset.left;
		y = e.clientY + xy.y - offset.top;

		if(this.memory.length &gt; 0){
			var shape = false;
			
			if(target.vismoClicking){
			    var pos =  VismoTransformations.undoTransformation(x,y,this.transformation);
    			x = pos.x;
    			y = pos.y;
			    shape = this.getShapeAtPosition(x,y);
			}
			else{
			    //shape = false;
			}
			return shape;
		} else{
			return false;
		}
	},
	getShapeAtPosition: function(args) {
	    /* x and y should be in VismoShape coordinate world*/
	    var x= arguments[0];
	    var y=  arguments[1];
		var shapes = this.memory;

		var hitShapes = [];
		for(var i=0; i &lt; shapes.length; i++){
			var shape = shapes[i];
			if(!shape.getProperty(&quot;unclickable&quot;))
	                {		
	                        var st = shape.getShape();
				var g = shape.getBoundingBox();
			
				if(x &gt;= g.x1 &amp;&amp; x &lt;= g.x2 &amp;&amp; y &gt;=  g.y1 &amp;&amp; y &lt;=g.y2){
					hitShapes.push(shapes[i]);
				}
			}

		}
		
		if(hitShapes.length &gt; 0){
		    
		        var res = this._findNeedleInHaystack(x,y,hitShapes);
			return res;
		
		}
	        else return false;
	
		// var shapesInsideBox = _findShapesInsideBoundingBox(shapes, ..) TODO RENAME
		// var points = _findPointsInsideShapes(..)
		

	},
	_findNeedleInHaystack: function(args){
		var x= arguments[0];
	    var y=  arguments[1];
	    var shapes = arguments[2];
	    var hits = [];
		
		for(var i=0; i &lt; shapes.length; i++){
			var st = shapes[i].getShape();
			var itsahit = false;
			if(st == 'polygon'){
				itsahit = this._inPoly(x,y,shapes[i]);
			}
			else if(st == 'path'){
			    //itsahit = this._onPath(x,y,shapes[i]);
			    itsahit = false; 
			}
			else if(st == 'image'){
				itsahit = true;
			}
			else if(st == 'point' || st == 'circle'){
				itsahit = this._inCircle(x,y,shapes[i]);
			}
			if(itsahit) {
				hits.push(shapes[i]);
			}
			
		}

		if(hits.length == 0){
			return false;
		}
		else if(hits.length == 1) 
			return hits[0];
		else {//the click is in a polygon which is inside another polygon
		    var bestZindex = {s:[],z:0};
		    for(var i=0; i &lt; hits.length; i++){
		        var zin = hits[i].getProperty(&quot;z-index&quot;); 
		        if(zin &gt; bestZindex.z){
		            bestZindex.s = [hits[i]];
		            bestZindex.z = zin;
		        }  
		        else if(zin == bestZindex.z){
		            bestZindex.s.push(hits[i]);
		        }
	        }
	        if(bestZindex.s.length == 1) return bestZindex.s[0];
		    
			var g = bestZindex.s[0].getBoundingBox();
			var mindist = Math.min(g.x2 - x,x - g.x1,g.y2 - y,y - g.y1);
			var closerEdge = {id:0, closeness:mindist};
			for(var i=1; i &lt; bestZindex.s.length; i++){
				var g = bestZindex.s[i].getBoundingBox();
				var mindist = Math.min(g.x2 - x,x - g.x1,g.y2 - y,y - g.y1);
			
				if(closerEdge.closeness &gt; mindist) {
					closerEdge.id = i; closerEdge.closeness = mindist;
				}
				
			}
			return bestZindex.s[closerEdge.id];
		
		}

	}
	,_inCircle: function(args){
	    var x= arguments[0];
	    var y=  arguments[1];
	    var vismoShape = arguments[2];
		  var bb = vismoShape.getBoundingBox();
        var transform = vismoShape.getTransformation();

		if(transform){
		        var newpos = VismoTransformations.applyTransformation(x,y,transform);
		        x= newpos.x;
		        y = newpos.y;
	    }
	    
		var a =((x - bb.center.x)*(x - bb.center.x)) + ((y - bb.center.y)*(y - bb.center.y));
		var dim = vismoShape.getDimensions();
		
		var w = dim.width;
		var h = dim.height;
		
		var inCircleOne;
		var inCircleTwo;
		
		if(transform &amp;&amp; transform.scale) {
		    w *= transform.scale.x;
		    h *= transform.scale.y;
		}
		w *= w;
		h *=h;
		
		if (a &lt;= w) inCircleOne= true;
		else inCircleOne = false;
		
		if (a &lt;= h) inCircleTwo= true;		
		else inCircleTwo = false;
		

    		//console.log(bb.center.x,bb.center.y,x,y,vismoShape.properties.id,a,w,h,inCircleOne,inCircleTwo);
    		
		if(inCircleOne &amp;&amp; inCircleTwo) return true;
		else return false;
	
	}
	,_onPath: function(args){
	    var x= arguments[0];
	    var y=  arguments[1];
	    var vismoShape = arguments[2];
	    return false;
	}
	,_inPoly: function(args) {
	    var x= arguments[0];
	    var y=  arguments[1];
	    var vismoShape = arguments[2];
		/* _inPoly adapted from inpoly.c
		Copyright (c) 1995-1996 Galacticomm, Inc.  Freeware source code.
		http://www.visibone.com/inpoly/inpoly.c.txt */
		var coords;
		coords = vismoShape.getCoordinates();
		var transform = vismoShape.getTransformation();
		
		if(transform){
		        var newpos = VismoTransformations.applyTransformation(x,y,transform);
		        x = newpos.x;
		        y = newpos.y;
		}
		
		var npoints = coords.length;
		if (npoints/2 &lt; 3) {
			//points don't describe a polygon
			return false;
		}
		var inside = false;
		var xold = coords[npoints-2];
		var yold = coords[npoints-1];
		var x1,x2,y1,y2,xnew,ynew;
		for (var i=0; i&lt;npoints; i+=2) {
			xnew=coords[i];
			ynew=coords[i+1];
			if (xnew &gt; xold) {
				x1=xold;
				x2=xnew;
				y1=yold;
				y2=ynew;
			} else {
				x1=xnew;
				x2=xold;
				y1=ynew;
				y2=yold;
			}
			if ((xnew &lt; x) == (x &lt;= xold)
				&amp;&amp; (y-y1)*(x2-x1) &lt; (y2-y1)*(x-x1)) {
				   inside=!inside;
				}
			xold=xnew;
			yold=ynew;
		 }
		 return inside;
	}

    ,isOverlap: function(shape1,shape2){
        return false;
    }


};
var VismoCanvasRenderer = {
	renderShape: function(canvas,vismoShape){
	    var ctx = canvas.getContext('2d');
		var shapetype =vismoShape.properties.shape;
		if(vismoShape.properties[&quot;lineWidth&quot;]){
			ctx.lineWidth = vismoShape.getProperty(&quot;lineWidth&quot;);
		}
		
		ctx.save();
                
		ctx.beginPath();
		if(shapetype == 'point' || shapetype =='circle'){
			this.renderPoint(ctx,vismoShape);
		}
		else if(shapetype =='image'){
			this.renderImage(ctx,vismoShape);
		}
		else if(shapetype == &quot;path&quot;){
            this.renderPath(ctx,vismoShape);
		}
		else{	
			this.renderPath(ctx,vismoShape,true);	
			ctx.closePath();
		        
		}
		
		ctx.strokeStyle = vismoShape.getProperty(&quot;stroke&quot;)
		if(typeof vismoShape.getProperty(&quot;fill&quot;) == 'string') 
			fill = vismoShape.getProperty(&quot;fill&quot;);
		else
			fill = &quot;#ffffff&quot;;


		ctx.stroke();
		if(shapetype != 'path') {
			ctx.fillStyle = fill;
			ctx.fill();
		}
	        ctx.restore();
                
                
	        
	}
	,renderPath: function(ctx,vismoShape,join){
		var move = true,quadraticCurve = false,bezierCurve = false;
		var c = vismoShape.getCoordinates();
		var t =vismoShape.getProperty(&quot;transformation&quot;);
		if(!t) t= {};
		//ctx.save(); //issue with this in safari..
		if(!t.translate)t.translate = {x:0,y:0};
		if(!t.scale) t.scale = {x:1,y:1};
		    

		//ctx.scale(t.scale.x,t.scale.y);
		if(!t.translate.y) t.translate.y = 0;
		if(!t.translate.x) t.translate.x = 0;
		if(!t.scale.x) t.scale.x = 1;
		if(!t.scale.y) t.scale.y = 1;

		var bb = vismoShape.grid;
		if(bb.center){
		    ctx.translate(bb.center.x-(bb.center.x*t.scale.x),bb.center.y-(bb.center.y*t.scale.y));
            ctx.scale(t.scale.x,t.scale.y);	
            ctx.translate(t.translate.x,t.translate.y);
        }
		var bb = vismoShape.grid;
		for(var i=0; i &lt; c.length-1; i+=2){
            var isCoord =VismoShapeUtils._isCoordinate(c[i]);
			if(!isCoord){

				if(c[i] == &quot;M&quot;){
				    move=true;
			    }
			    else if(c[i] == &quot;q&quot;){
			        quadraticCurve = true;
			    }
			    else if(c[i] == &quot;c&quot;){
			        bezierCurve = true;
			    }
			    i+=1;
			}
			var x = parseFloat(c[i]);
			var y = parseFloat(c[i+1]);	
			
			if(move){ 
				ctx.moveTo(x,y);
			
				move = false;
			}
			else if(quadraticCurve){
			    var x2 = parseFloat(c[i+2]);
			    var y2 = parseFloat(c[i+3]);

			    i+= 2;
			    ctx.quadraticCurveTo(x,y,x2,y2);
			}
			else if(bezierCurve){
			    var x2 = parseFloat(c[i+2]);
			    var y2 = parseFloat(c[i+3]);
                var x3 = parseFloat(c[i+4]);
                var y3 = parseFloat(c[i+5]);
			    i+= 4;
			    ctx.bezierCurveTo(x,y,x2,y2,x3,y3);			    
			}
			else{
			       
				ctx.lineTo(x,y);
			}			
				
				
		}
	
		//ctx.restore(); //issue with this in safari..
	}
	,renderPoint: function(ctx,vismoShape){
	        //ctx.restore();
		//ctx.save();
		var bb =vismoShape.getBoundingBox();
		var dim =vismoShape.getDimensions();
		var radiusx = dim.width / 2;
		var radiusy = dim.height/2;
		
		var transform = vismoShape.getTransformation();
		if(transform &amp;&amp; transform.scale) radiusx*= transform.scale.x;
		//ctx.save();
		if(radiusx &gt; radiusy) {
		    //ctx.scale(radiusx/radiusy,1)
		}
		else if(radiusy &gt; radiusx){
		    //
		    //ctx.scale(1,radiusy/radiusx)
		    //ctx.restore();
		}
		ctx.arc(bb.center.x, bb.center.y, radiusx, 0, Math.PI*2,true);
	    
	}
	,renderImage: function(ctx,vismoShape){
		var c = vismoShape.getCoordinates();
		var bb = vismoShape.getBoundingBox();
		var draw = function(){
		        if(vismoShape.ready)ctx.drawImage(vismoShape.image,bb.x1,bb.y1,bb.width,bb.height);
		        else window.setTimeout(draw,100);
		};
                draw();

	}
};


var VismoGraph = function(properties){
    this._nodes = {};
    this._children = {};
    this._parents = {};
    this._orphans = {};
    this._spouses = {};
	if(properties.nodes){
    	for(var i=0; i &lt; properties.nodes.length; i++){
    	    this.addNode(properties.nodes[i]);
    	}
	}
	if(properties.edges){
	    var edges = properties.edges;
	    for(var i=0; i &lt; edges.length; i++){
	        var a = edges[i][0];
	        var b = edges[i][1]; 
    	    this.addEdge(a,b);
    	}
	}
};

VismoGraph.prototype = {
    getNode: function(id){
        return this._nodes[id];
    }
    ,depth: function(id,depthsofar){
       if(!depthsofar &amp;&amp; depthsofar !== 0)depthsofar =0;
       var kids = this.getChildren(id);
       if(kids.length == 0) return depthsofar;
       
       var maxdepth = 0;
       for(var i=0; i &lt; kids.length;i++){
           var depth = this.depth(kids[i],depthsofar+1)
           if(depth &gt; maxdepth) maxdepth = depth;
       }
       return maxdepth;
    }
    /* a spouse shares the same children as another node*/
    ,isSpouse: function(id1,id2){
        if(id1 == id2) return false;
        var childrenX = this.getChildren(id1);
        var childrenY = this.getChildren(id2);
        var allchildren = childrenX.concat(childrenY);
        for(var i=0; i &lt; allchildren.length; i++){
            // if the child also has y as a parent..
            var child = allchildren[0];
            if(this._parents[child].indexOf(id2) != -1 &amp;&amp; this._parents[child].indexOf(id1) != -1) return true;
        }
        return false;
    }
    ,getSpouses: function(id){
        var n = this.getNodes();
        var spouses = [];
        for(var i=0; i &lt; n.length;i++){
            
            if(this.isSpouse(id,n[i].id)){
                spouses.push(n[i].id);
            }
        }
        return spouses;
    }
    ,getNodes: function(){
        var nodes = [];
        for(var i in this._nodes){
            nodes.push(this._nodes[i]);
        }
        return nodes;
    }
    ,getChildren: function(id){
        if(typeof(id) != 'string'){
	        var done = {};
	        var allchildren = [];
	        for(var i=0; i &lt; id.length;i++){
	            var parentid = id[i];
	            var children = this.getChildren(parentid);
	            for(var j=0; j &lt; children.length;j++){
	                var childid = children[j];
	                if(!done[childid]){
	                    allchildren.push(childid);
	                    done[childid] = true;
	                }
	            }
	        }
	        return allchildren;
	        
	        
	    }
	    
        var children = this._children[id];

        if(!children){
            return [];
        }
        else {
            return children;
        }
    }
    ,isOrphan: function(id){
        if(!this._parents[id] || this._parents[id].length == 0){
            return true;
        }
        else{
            return false;
        }
    }
    ,getParents: function(id){
        var p = this._parents[id];

        if(!p){
            return [];
        }
        else {
            return p;
        }
    }
    ,getOrphans: function(){ 
        var orphans = [];
       var nodes = this.getNodes();
       for(var i=0; i &lt; nodes.length; i++){
           var id = nodes[i].id;
           if(this.isOrphan(id)){
               orphans.push(id);
            }
        }
    
        return orphans;
    } 
    ,addNode: function(nodejson){
        var id = nodejson.id;
        if(!nodejson.properties){
            nodejson.properties = {};
        }
        this._nodes[id] = nodejson;
        this._orphans[id] = true;
    }
    ,addEdge: function(a,b){
        //not working properly with new lines
        a = a.replace(/\n/,&quot;&quot;);
        b= b.replace(/\n/,&quot;&quot;);
        
        if(!a || !b ||(a &amp;&amp; a.length == 0) || (b &amp;&amp; b.length==0)) {
        
            return;
        
        }
        if(!this._children[a]) this._children[a] = [];
        if(!this._parents[b]) this._parents[b] = [];
        
        this._children[a].push(b);
        this._parents[b].push(a);
        
        if(!this._orphans[a])this._orphans[a] = true;
        this._orphans[b] = false;
        
    }
};

var VismoGraphRenderer = function(place,options){
    if(!options.algorithm){
        throw &quot;GraphRenderer requires an option called algorithm which is a function. This will take two parameters graph and root and should set XPosition and YPosition on every node.&quot;;
    }
    if(!options.lineColor){
        options.lineColor = &quot;rgb(0,0,0)&quot;;
    }
    if(!options.defaultNodeColor){
        options.defaultNodeColor = &quot;#ffffff&quot;;
    }
    if(!options.lineWidth){
        options.lineWidth = &quot;2&quot;;
    }
    
    this.algorithm = options.algorithm; 
    if(!options.nodeWidth) options.nodeWidth= 5;
    if(!options.nodeHeight) options.nodeHeight = 5; 
    
    this.options = options;
    this._edgeShapeCoordinates = [];
    this._graph = options.graph;
    
    var canvasopts;
    if(!options.vismoCanvas) canvasopts = {};
    else canvasopts = options.vismoCanvas;
    
    if(!options.vismoController){
        canvasopts.vismoController = {};
    } 
    else{
        canvasopts.vismoController = options.vismoController;
    }
    if(options.move)canvasopts.move = options.move;
    if(options.dblclick)canvasopts.dblclick = options.dblclick;
    this._canvas = new VismoCanvas(place,canvasopts);

    if(options.root){
        this.compute(options.root);  
    }
     
};

VismoGraphRenderer.prototype = {
    clear: function(){
        this._canvas.clear(true);
        this._edgeShapeCoordinates = [];
    }

    ,compute: function(root){
        var graph = this._graph;
        if(this.options.root != root) this.clear();
        if(root)this.options.root = root;
        this.algorithm.compute(graph,this.options);
        
        this.plot(root);
        
        if(this._edgeShapeCoordinates.length &gt; 0){
            var edge = new VismoShape({&quot;z-index&quot;:&quot;-1&quot;,shape:&quot;path&quot;,stroke:this.options.lineColor,lineWidth:this.options.lineWidth,coordinates:this._edgeShapeCoordinates});
            this._canvas.add(edge);
        }
        this._canvas.render();

        var node = graph.getNode(root);
        var half_height = this._canvas.height() /2;
        this._canvas.centerOn(node.XPosition,node.YPosition + half_height);

    }
    ,plot: function(id){
        var node = this._graph.getNode(id);
        var y = -node.YPosition;
        var x = node.XPosition;
        this.plotNode(id,{x:x,y:y});
        var children = this._graph.getChildren(id);
        for(var i=0; i &lt; children.length; i++){
            var parentpos = {x:x,y:y};
            var ch =children[i];
            var childxy = this.plot(ch);
            if(parentpos &amp;&amp; childxy){
                
                this._edgeShapeCoordinates=this._edgeShapeCoordinates.concat([&quot;M&quot;,parentpos.x,parentpos.y,&quot;q&quot;,childxy.x,parentpos.y,childxy.x,childxy.y]);
            }
        }
        return {x: x,y:y};
    }
    
    ,plotNode: function(id,pos){
        var exists = this._canvas.getShapeWithID(id);
        if(!exists){
            var st,coords;
            st= &quot;polygon&quot;;
            var hr = this.options.nodeWidth /2;
            var vr=this.options.nodeHeight /2;
            coords = [pos.x-hr,pos.y-vr,pos.x+hr,pos.y-vr,pos.x+hr,pos.y+vr,pos.x-hr,pos.y+vr];
            
            var node= this._graph.getNode(id);
            node.properties.shape = st;
            node.properties.coordinates = coords;
            if(!node.properties.fill)node.properties.fill = this.options.defaultNodeColor;
            var shape= new VismoShape(node.properties);
            this._canvas.add(shape);          
        }
        else{
            var b = exists.getBoundingBox();
            pos = b.center;
        } 
        return pos;
        
    }

 };var VismoVector = function(vismoShape,canvas){
	
  VismoTimer.start(&quot;VismoVector.init&quot;);
	this._iemultiplier = 10; //since vml doesn't accept floats you have to define the precision of your points 100 means you can get float coordinates 0.01 and 0.04 but not 0.015 and 0.042 etc..
	this.vismoShape=  vismoShape;

	this.cache = {};
	this.maxResolution_id_x = 1;
	this._oldproperties = {};
	this.initShape(vismoShape,canvas);
    
    
	vismoShape.vml = this;
	VismoTimer.end(&quot;VismoVector.init&quot;);		
};

VismoVector.prototype = {
	scrub: function(){
	     VismoTimer.start(&quot;VismoVector.scrub&quot;);
	     if(this.el){
	    this.el.parentNode.removeChild(this.el);
	    this.el = false;
	    }
	    VismoTimer.end(&quot;VismoVector.scrub&quot;);
	}
	,initShape: function(vismoShape,canvas){
	    VismoTimer.start(&quot;VismoVector.initShape&quot;);
	    this.coordinatesHaveChanged();
	    this.el = false;
	    var isVML;
    	var shapetype =vismoShape.properties.shape;       
        this.initialshapetype= shapetype;
        
		if(shapetype == 'point' || shapetype == 'circle'){
    		this._initArc(vismoShape,canvas);
    		isVML = false;
    	}
    	else if(shapetype == 'image'){
    		this._initImage(vismoShape,canvas);
    	}
    	else if(shapetype == 'domElement'){
    	        //this.haveAppended = true;
    	        this.el = vismoShape.getProperty(&quot;element&quot;);
    	        this.el.style.position = &quot;absolute&quot;;
    	        var el = this.el;
    	   
    	        
    	        return;
    	}
    	else{
    		this._initPoly(vismoShape,canvas);
    		isVML = true;
    	}
    	if(isVML &amp;&amp; canvas){
    	    var w,h;
    	    if(!canvas){
    	        throw &quot; i need a canvas to do my magic!&quot;;
    	    }
    	    if(canvas.width){
    	        w= canvas.width;
    	    } 
    	    else{
    	        w = jQuery(canvas).width();
    	        canvas.width = w;
    	    }
    	    if(canvas.height){
    	        h= canvas.height;
    	    } 
    	    else{
    	        h = jQuery(canvas).height();
    	        canvas.height= h;
    	    }
            
    	    
            	var xspace = parseInt(w);
            	xspace *=this._iemultiplier;
            	var yspace =parseInt(h);
            	yspace *= this._iemultiplier;
            	coordsize = xspace +&quot;,&quot; + yspace;
            	this.el.coordsize = coordsize;
    	}
            if(this.vismoShape &amp;&amp; this.el){
                //this.el.vismoShape = this.vismoShape;
    	        var nclass= &quot;vismoShape&quot;;			
    	        if(shapetype == 'path'){ nclass= &quot;vismoShapePath&quot;;}
    	        this.el.setAttribute(&quot;class&quot;, nclass);
    	        this.style();
    	}
    	var that= this;
	    //jQuery(window).bind(&quot;unload&quot;, function(){that.el= null;});
		 VismoTimer.end(&quot;VismoVector.initShape&quot;);
	}
	,_initImage: function(vismoShape,canvas){

		var that = this;
		var dim = vismoShape.getDimensions();
		var setup = function(){
			var shape = document.createElement(&quot;img&quot;);
			
			that.el = shape;
			shape.src = vismoShape.getProperty(&quot;src&quot;);	
			
			jQuery(shape).css({&quot;height&quot;: dim.height, &quot;width&quot;: dim.width,&quot;position&quot;:&quot;absolute&quot;,&quot;z-index&quot;:4});		

		};

		var image = new Image();
		image.src = vismoShape.getProperty(&quot;src&quot;);
		image.onload = function(e){
			setup();
		};
		if(image.complete){
			setup();
		}
		
	}
	,_initArc: function(vismoShape,canvas){
		var shape = document.createElement(&quot;vismoShapeVml_:arc&quot;);
		shape.startAngle = 0;
		shape.endAngle = 360;
		var bb = vismoShape.getBoundingBox();
		this.el = shape;	
		var diameterx = bb.width;
		var radiusx = bb.width/ 2;
		var diametery =  bb.height;
		var radiusy= bb.height/  2;
		
		jQuery(this.el).css({&quot;height&quot;: diametery, left:bb.center.x-radiusx, top: bb.center.y-radiusy,&quot;width&quot;:diametery,&quot;position&quot;:&quot;absolute&quot;,&quot;z-index&quot;:4});			
	}
	,_initPoly: function(vismoShape,canvas){
		VismoTimer.start(&quot;VismoVector._initPoly&quot;);
		var shape = document.createElement(&quot;vismoShapeVml_:shape&quot;);
		
		this.el = shape;
		this.el.name=vismoShape.properties.name;
		//var css = jQuery(canvas).css();
		var w =canvas.width;// css.width;
		var h = canvas.height;//css.height;

		
		jQuery(this.el).css({&quot;height&quot;: h,&quot;width&quot;: w,&quot;position&quot;:&quot;absolute&quot;,&quot;z-index&quot;:4});
		
		VismoTimer.end(&quot;VismoVector._initPoly&quot;);
	}
	,getVMLElement: function(){
		return this.el;
	}
	,_createvmlpathstring: function(transformation,projection){ //mr bottleneck
	    VismoTimer.start(&quot;VismoVector.createvmlpathstring&quot;);
		var vml = this.el;
		var o,t,s;
		if(transformation){
		    o = transformation.origin;
		    t = transformation.translate;
		    s = transformation.scale;
		}
		else{
		    o = {x:0,y:0};
		    t = {x:0,y:0};
		    s = {x:1,y:1};
		}
		var cindex;
		if(!s || (!s.x &amp;&amp; !s.y)){
		    cindex = &quot;1,1&quot;;
		}else{
		     cindex= s.x+&quot;,&quot;+s.y;
		}
		
		if(!this.cache) {this.cache = {};}
	    if(!this.cache[cindex]){ this.cache[cindex] = {};}
	
		if(!this.cache[cindex][&quot;pathstring&quot;]){
		    var path;
		    var buffer = [];
		    var c;
		    if(this.vismoShape.coordinates.normal){
		        c = this.vismoShape.coordinates.normal;
    		}
    		else{
    		    c =this.vismoShape.getCoordinates(&quot;normal&quot;);
	        }
	 
    		if(projection){
    			c = this.vismoShape._applyProjection(projection,transformation);
    		}
		
    		if(c.length &lt; 2) return;

    		var x,y;
    		var startAtIndex = 0;
    		if(this.vismoShape.isCommand(c[0])){
    		    startAtIndex = 1;
    		}
    		x = c[startAtIndex];
    		y =c[startAtIndex+1];

    				
    		x *=this._iemultiplier;
    		y *= this._iemultiplier;
    		x = parseInt(x);
    		y = parseInt(y);
 
    		//path = &quot;M&quot;;
    		buffer.push(&quot;M&quot;);
    		//path+= x + &quot;,&quot; +y + &quot; L&quot;;
    		buffer.push([x,&quot;,&quot;,y].join(&quot;&quot;))
    		var lineTo = false,quadraticCurveTo = false,bezierCurveTo = false;
    		for(var i =startAtIndex+2; i &lt; c.length; i+=2){
    		    
    			if(c[i] == 'M') {
    				//path += &quot; M&quot;;
    				buffer.push(&quot; M&quot;);
    				lineTo = false;
    				i+=1;
    			}
    			else if(c[i] == 'z'){
    			    buffer.push(&quot; XE&quot;);
    			}
    			else if(c[i] == &quot;q&quot;){
    			    quadraticCurveTo = true;
    			    i += 1;
    			}
    			else if(c[i] == &quot;c&quot;){
    			    bezierCurveTo = true;
    			    i+=1;
    			}
    			else if(!lineTo) {
    				//path += &quot; L&quot;;
    				buffer.push(&quot; L&quot;);
    				lineTo = true;
    			}
    			else if(lineTo){
    				//path += &quot; &quot;;
    				buffer.push(&quot; &quot;);
    			}
    			var x =parseInt(c[i] * this._iemultiplier);
    			var y =parseInt(c[i+1] * this._iemultiplier);

			
    			if(quadraticCurveTo){
    			    var x2 =parseInt(c[i+2] * this._iemultiplier);
        			var y2 =parseInt(c[i+3] * this._iemultiplier);
    			    buffer.push([&quot; c &quot;,x,&quot;,&quot;,y,&quot;,&quot;,x2,&quot;,&quot;,y2,&quot;,&quot;,x2,&quot;,&quot;,y2,&quot;&quot;].join(&quot;&quot;));
    			    i += 2;
    			    quadraticCurveTo = false;
    			}
    			else if(bezierCurveTo){
    			    var x2 =parseInt(c[i+2] * this._iemultiplier);
        			var y2 =parseInt(c[i+3] * this._iemultiplier);
        			var x3 = parseInt(c[i+4] * this._iemultiplier);
        			var y3 = parseInt(c[i+5] * this._iemultiplier);
    			    buffer.push([&quot; c &quot;,x,&quot;,&quot;,y,&quot;,&quot;,x2,&quot;,&quot;,y2,&quot;,&quot;,x3,&quot;,&quot;,y3,&quot;&quot;].join(&quot;&quot;));
    			    i += 4;
    			    bezierCurveTo = false;
    			}
    			else{
    			    buffer.push([x,&quot;,&quot;,y].join(&quot;&quot;));
    			}
    			//path += x +&quot;,&quot; + y;
			
    			//if(i &lt; c.length - 2) path += &quot;&quot;;
		    }
        
		    if(this.vismoShapeProperties.shape != &quot;path&quot;){buffer.push(&quot; XE&quot;);}
		    this.cache[cindex][&quot;pathstring&quot;] = buffer.join(&quot;&quot;);
		//console.log(buffer.join(&quot;&quot;));
	    }
        
	
	
        VismoTimer.end(&quot;VismoVector.createvmlpathstring&quot;);
		return this.cache[cindex][&quot;pathstring&quot;];
	
	}

	,transformDomElement: function(transformation,projection){
	    VismoTimer.start(&quot;VismoVector.transformDomElement&quot;);
		/*var o = transformation.origin, t = transformation.translate,s = transformation.scale;
		*/
		var shape = this.vismoShape;
		var el = this.el;
		var top,left,width,height;
		var bb = shape.getBoundingBox();
		dx = bb.x1;
		dy = bb.y1;
        jQuery(this.el).css({left:dx,top:dy});
        VismoTimer.end(&quot;VismoVector.transformDomElement&quot;);
	}
	
	,coordinatesHaveChanged: function(){
	    this.coordinatesChanged = true;
	
	}
	
	,_cacheStyle: function(t,s,o){
	    VismoTimer.start(&quot;VismoVector._cacheStyle&quot;);
	    var vml = this.el;
		if(!this.initialStyle) { //remember original placement
			var initTop = parseInt(vml.style.top);
			if(!initTop) initTop = 0;
			var initLeft = parseInt(vml.style.left);
			if(!initLeft) initLeft = 0;
			var w =parseInt(vml.style.width);
			var h = parseInt(vml.style.height)
			this.initialStyle = {width: w, height: h};
		}
		var initialStyle= this.initialStyle;

		var newwidth = initialStyle.width * s.x;
		var newheight = initialStyle.height * s.y; 	
			
 
		 VismoTimer.end(&quot;VismoVector._cacheStyle&quot;);
		return { width:newwidth+&quot;px&quot;,height:newheight+&quot;px&quot;};
	}
	,_cssTransform: function(transformation,projection){
	   
		VismoTimer.start(&quot;VismoVector._cssTransform&quot;);
	
		var vml = this.el;
		var st = this.vismoShapeProperties.shape;
	
		if(st == 'circle' || st == 'img' || st == 'domElement'){
		   
			this.transformDomElement(transformation,projection);
			VismoTimer.end(&quot;VismoVector._cssTransform&quot;);
			return;
		}
		if(!transformation) return;
		var ckey_1, ckey_2;
		if(transformation.cache){
		    ckey_1 = transformation.cache.id1;
		    ckey_2 = transformation.cache.id2;
		}
		else{
		    ckey_1 = &quot;1,1&quot;;
		    ckey_2 = &quot;0,0&quot;;
		}
		if(!this.cache[ckey_1]) this.cache[ckey_1] = {};

	
        var s =  transformation.scale;
		if(!this.cache[ckey_1][ckey_2]){
		    var o = transformation.origin, t = transformation.translate;
			this.cache[ckey_1][ckey_2] = this._cacheStyle(t,s,o);
		}
	    var style = this.cache[ckey_1][ckey_2];
	    //jQuery(this.el).css(style); //jon
		VismoTimer.end(&quot;VismoVector._cssTransform&quot;);
	}
	,clear: function(){
			VismoTimer.start(&quot;VismoVector.clear&quot;);
			var el = this.el;
			
			try{
			        if(el)jQuery(el).css({display:&quot;none&quot;});
			}catch(e){
			};
			VismoTimer.end(&quot;VismoVector.clear&quot;);
	}
	,render: function(canvas,transformation,projection){
	    VismoTimer.start(&quot;VismoVector.render&quot;);
        var that = this;
        var shape = this.el;
        this.vismoShapeProperties = this.vismoShape.properties;
        if(!shape){ //try again later
                var f= function(){
                        that.render(canvas,transformation);
                }
                window.setTimeout(f,50);
                return;
        }
        if(!this.haveAppended){ //append element to dom
		    shape._vismoClickingID = this.vismoShapeProperties.id;
		}
	
		if(this.coordinatesChanged) {
		    this._cssTransform(transformation,projection);
		    
			shape.path = this._createvmlpathstring(transformation,projection);//causes slow down..	
			
            
			this.coordinatesChanged = false;
			
		}
		
		
			
		var shtype= this.vismoShapeProperties.shape;
		if(this.initialshapetype != shtype){ //shape type has changed force restart
		   this.scrub();
		   this.initShape(this.vismoShape,canvas);
		   this.haveAppended = false;
		}
		if(shtype!=&quot;domElement&quot;)shape.style.display = &quot;&quot;;
		
		if(!this.haveAppended){ //append element to dom
		    if(transformation)this._cssTransform(transformation,projection);
			canvas.appendChild(shape);
			if(shtype == 'domElement'){
    			var vismoShape = this.vismoShape;
                var c = vismoShape.getCoordinates();
                var rw = jQuery(el).width()/2;
                var rh = jQuery(el).height()/2;
          
                jQuery(el).css({position:&quot;absolute&quot;,left:c[0],top:c[1]-rh});            	     
			}
			this.haveAppended = true;
		}
		this.style();
        VismoTimer.end(&quot;VismoVector.render&quot;);
	}
	,style: function(){
        
        VismoTimer.start(&quot;VismoVector.style&quot;);
        if(!this.vismoShapeProperties){
             this.vismoShapeProperties = this.vismoShape.properties;
         }
        if(this.vismoShapeProperties.hidden){
            jQuery(this.el).css({display:&quot;none&quot;});
        }
         if(this.nochange){
	       
	     	VismoTimer.end(&quot;VismoVector.style&quot;);
	        return;
	    }
	     jQuery(&quot;#log&quot;).append(&quot;Exiting&quot;);
	     this.nochange = true;
	    //if(this.el.className =='label')alert(&quot;!&quot;);
        
        
 

	    if(this.el.style.display == 'none') this.el.style.display =&quot;&quot;
	    
	    
		var shapetype = this.vismoShapeProperties.shape;

		var shape = this.el;
		shape.stroked = &quot;t&quot;;

		
		if(this.vismoShapeProperties[&quot;z-index&quot;]){
		    shape.style.zIndex = this.vismoShapeProperties[&quot;z-index&quot;];
		}
		if(this.vismoShapeProperties.lineWidth) {
			shape.strokeweight =this.vismoShapeProperties.lineWidth + &quot;em&quot;;
		}
		else {
			shape.strokeweight = &quot;1em&quot;;
		}
	
	
	    var strokergba = this.vismoShapeProperties.stroke;
        if(strokergba.indexOf(&quot;#&quot;) == 0 || strokergba.indexOf(&quot;rgb(&quot;) == 0){
		            shape.strokecolor = strokergba;
				}
				else{
		    		if(!this.vmlstroke){
    					this.vmlstroke =document.createElement(&quot;vismoShapeVml_:stroke&quot;);
    					shape.appendChild(this.vmlstroke); 
    				}
				
            		if(strokergba){
            		    var stroke;
            		    if(strokergba.indexOf(&quot;rgba&quot;) != -1 &amp;&amp;strokergba.match(/rgba\([0-9]*,[0-9]*,[0-9]*,(.*)\)/)){
            		        var match =strokergba.match(/(rgb)a(\([0-9]*,[0-9]*,[0-9]*),(.*)\)/);

        					if(match[3]){
        						stroke = match[1] + match[2] +&quot;)&quot;;
        						this.vmlstroke.opacity = match[3];
        					}
            		    }
            		    else{
            		        stroke = strokergba;
            		    }
            		    this.vmlstroke.color = stroke;
            		}
            		else{
            		    this.vmlstroke.color = &quot;rgb(0,0,0)&quot;;
            		}
    		    }
    		    	
		if(!this.vismoShapeProperties[&quot;fill&quot;] || shapetype == 'path'){
		    shape.filled = &quot;f&quot;;
                    VismoTimer.end(&quot;VismoVector.style&quot;);
					return;
		}
	
		
		var fill = this.vismoShapeProperties[&quot;fill&quot;];
		shape.filled = &quot;t&quot;;
		if(fill.indexOf(&quot;#&quot;) == 0 || fill.indexOf(&quot;rgb(&quot;) == 0){
	        shape.fillcolor = this.vismoShapeProperties.fill;
	    
	    }
	    else{
	        if(!this.vmlfill &amp;&amp; shape){
				this.vmlfill =document.createElement(&quot;vismoShapeVml_:fill&quot;);
				shape.appendChild(this.vmlfill); 
		    }	
			//look for rgba fill for transparency
			if(fill.indexOf(&quot;rgba&quot;) != -1 &amp;&amp;fill.match(/rgba\([0-9]*,[0-9]*,[0-9]*,(.*)\)/)){

				var match =fill.match(/(rgb)a(\([0-9]*,[0-9]*,[0-9]*),(.*)\)/);

				if(match[3]){
					fill = match[1] + match[2] +&quot;)&quot;;
					this.vmlfill.opacity = match[3];
				}
			}
			this.vmlfill.color = fill;
			
	        
	    }
	    this._oldproperties = VismoUtils.clone(this.vismoShapeProperties);
		VismoTimer.end(&quot;VismoVector.style&quot;);
		this.nochange = true;
	}

};


var VismoTimer = {
    startsAt:{},
    timed: {},
    clear: function(){
     
     var i;
     for(i in this.timed){
         this.timed[i] = 0;
     }   
    }
    ,start: function(id){
        if(!this.timed[id]) this.timed[id] = 0;
        this.startsAt[id] = new Date();
    },
    end: function(id){
        var d = new Date();
        this.timed[id] += (d-this.startsAt[id]);
    },
    summarise: function(selector){
        var text =&quot;&quot;;
        for(i in this.timed){
             text += i +&quot;: &quot; + this.timed[i] .toString() +&quot;\n&quot;;
               
        }
        jQuery(selector).val(text);
    }
    ,blankf: function(){}
};
VismoTimer.start = VismoTimer.blankf;
VismoTimer.end = VismoTimer.blankf;
</pre>
</div>
<div title="William (Billy) Franklin" modifier="YourName" modified="200909252311" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="William Bellwood" modifier="YourName" modified="200909252245" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1841-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Richard Bellwood 1809" mother="Elizabeth Wilson" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="William Brinley Thomas" modifier="GUEST" created="200905082241" modified="200905082241" spouse="Marjorie Isabell Robson" sex="M" placeofbirth="" latitude="" longitude="" dob="1911" dod="1988" mother="" father="" dom="16/09/39" changecount="1">
<pre></pre>
</div>
<div title="William COKAYNE (-1599)" modifier="YourName" created="200909131554" modified="200909131558" father="Roger COKAYNE" mother="Alice ALLSOP" placeofbirth="" latitude="" longitude="" dob="" dod="1599" spouse="" dom="" changecount="3" sex="M">
<pre>m. Elizabeth MEDCALFE (-1589)
m2. Catherine WONTON (-1596)

William had 4 daughters (all died young under age of 10) and 6 other sons</pre>
</div>
<div title="William COKAYNE (1629-1630)" modifier="YourName" created="200909131604" modified="200909131604" changecount="2" dom="" spouse="" dod="1630" dob="1629" longitude="" latitude="" placeofbirth="" mother="Mary O'BRIEN Lady " father="Charles COKAYNE 1st Viscount Cullen (1602-1686)">
<pre></pre>
</div>
<div title="William COKAYNE (II)" modifier="YourName" modified="200909271213" changecount="3" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1184-00-00" spouse="Alice DE DALBURY,Alice Botham" sex="M" dod="1270-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="William Cokayne (I)" mother="Sarah FITZALDECINDERH">
<pre></pre>
</div>
<div title="William COKAYNE 1244" modifier="YourName" created="200909131513" modified="200909271149" placeofdeath="" causeofdeath="" occupation="" placeofmarriage="" changecount="3" dom="" spouse="Sarah MERCATON" dod="" dob="1244" longitude="" latitude="" placeofbirth="" mother="Elizabeth COKAYNE" father="Roger Cokayne" sex="M">
<pre></pre>
</div>
<div title="William Cokayne (I)" modifier="YourName" created="200909131507" modified="200909271158" placeofdeath="" causeofdeath="" occupation="" placeofmarriage="" changecount="3" dom="" spouse="Sarah FITZALDECINDERH" dod="1242" dob="1153" longitude="" latitude="" placeofbirth="" sex="M" mother="" father="Andreas (Andrew) COKAYNE">
<pre></pre>
</div>
<div title="William Cokayne 1264" modifier="YourName" modified="200909271152" changecount="2" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1264-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="William COKAYNE 1244" mother="Sarah MERCATON">
<pre></pre>
</div>
<div title="William Cokayne Snr" modifier="YourName" modified="200909271144" changecount="2" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Sir John COKAYNE (-1447)" mother="Isabel SHIRLEY">
<pre></pre>
</div>
<div title="William Gartside 1526" modifier="YourName" modified="200909252155" changecount="2" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1526-00-00" spouse="" sex="M" dod="1543-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Henry Gartside 1526" mother="">
<pre>LEased farm called Denshaw with father from Roche Abbey.
	Living 1526.
	Paid rent for one eight of bakestone mine at Delph.
	Possibly had heirs since his interest in the bakestone mine does not appear to have reverted to his father.</pre>
</div>
<div title="William Isaac Robson" modifier="YourName" modified="200909261445" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1845-01-11" spouse="" sex="M" dod="0000-00-00" placeofbirth="Middlesbrough" occupation="" causeofdeath="" placeofdeath="" father="Robert Robson" mother="Mary Holder Oxx" latitude="" longitude="" dom="" placeofmarriage="" changecount="2">
<pre>In 1861 census he is no longer living with his parents. In the 1851 cenus he was.

	May have been born Mar 1845 in Middlesbrough, Stockton T registree - 
	LINK: http://www.middlesbrough-indexes.co.uk/contact.php?type=births&amp;ref=M-V-006-0-0126&amp;last_name=ROBSON&amp;first_name=WILLIAM&amp;initial=I&amp;year=1845
	</pre>
</div>
<div title="William Jackson" modifier="YourName" modified="200909221949" changecount="4" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Matthew Jackson" mother="Martha UNKNOWN">
<pre>From a letter sent by Joseph Jackson (probably his son) it seems they set sail for America 8 of October 1849, arriving in November?

	May 3rd 1852 William writes from Jamesville, America (just outside New York) to his brother. He mentions the sale of the house and it seems like the recipient of the letter lives near his mother as he is capable of helping the situation. He says &quot;We are sorry to hear of your brother Matthew being sick and Elizabeth also but I hope they will soon recover.&quot; so he is not writing to Matthew. This suggests he has written to his brother Adam, as his brother Robert is in Cuba.

	He married a French woman sometime before 1824, as a letter written by Robert talks about it. This may have caused shame to the family as as much as 10 years later in a later letter Robert is still asking to send a letter to William.</pre>
</div>
<div title="William Kenneth (Jack) Sharman" modifier="YourName" modified="200909271031" changecount="3" placeofmarriage="" dom="" longitude="" latitude="" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1909-00-00" spouse="" sex="M" dod="1968-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="">
<pre></pre>
</div>
<div title="William Owen" modifier="YourName" modified="200910021559" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="" mother="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="William Robson" modifier="YourName" modified="200909252225" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1860-00-00" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John Robson 1828" mother="" latitude="" longitude="" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="Winnie Bagg" modifier="YourName" modified="200909231726" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="0000-00-00" spouse="" sex="F" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="John David Bagg" mother="Katherine Anne UNKNOWN" latitude="" longitude="" dom="" placeofmarriage="" changecount="3">
<pre></pre>
</div>
<div title="Woodhouse Spearman" modifier="YourName" created="200909010915" modified="200909252238" placeofbirth="Newcastle (12.05pm)" latitude="" longitude="" dob="1787-07-12" dod="1826-04-04" mother="Hannah WOODHOUSE" father="George SPEARMAN (1760-1828)" spouse="John Oxe" dom="" changecount="5" sex="F" placeofmarriage="" occupation="" causeofdeath="" placeofdeath="">
<pre>Married at All Saints, Newcastle Upon Tyne, Northumberland, England.
	Died 5.30pm on 4th April 1826 aged 38.
	She was buried at St. Edmunds Burying Ground, Gateshead, letter F No. 6.</pre>
</div>
<div title="Xavier Brinley Blackman" modifier="YourName" modified="200909282109" server.page.revision="200903090000" server.host="file:///Users/jonrobson/Desktop/FamilyTree/db_export.html" server.type="file" dob="1999-11-20" spouse="" sex="M" dod="0000-00-00" placeofbirth="" occupation="" causeofdeath="" placeofdeath="" father="Alastair Blackman" mother="Tara Samantha Andrews" dom="" placeofmarriage="" changecount="1">
<pre></pre>
</div>
<div title="YourSearchPlugin" modifier="UdoBorkowski" created="200601161427" modified="200610130632" tags="Plugin UdoBorkowski systemConfig" server.type="file" server.host="file:///Users/Jon/Documents/TiddlyWiki/Trunk/contributors/JonRobson/verticals/FamilyTree/index.html" server.page.revision="200610130632">
<pre>/***
|''Name:''|YourSearchPlugin|
|''Version:''|2.1.0 (2006-10-12)|
|''Source:''|http://tiddlywiki.abego-software.de/#YourSearchPlugin ([[del.icio.us|http://del.icio.us/post?url=http://tiddlywiki.abego-software.de/index.html%23YourSearchPlugin]])|
|''Author:''|UdoBorkowski (ub [at] abego-software [dot] de)|
|''Licence:''|[[BSD open source license (abego Software)|http://www.abego-software.de/legal/apl-v10.html]]|
|''Copyright:''|&amp;copy; 2005-2006 [[abego Software|http://www.abego-software.de]]|
|''~CoreVersion:''|2.1.0|
|''Browser:''|Firefox 1.0.4+; Firefox 1.5; ~InternetExplorer 6.0|
!About YourSearch
YourSearch gives you a bunch of new features to simplify and speed up your daily searches in TiddlyWiki. It seamlessly integrates into the standard TiddlyWiki search: just start typing into the 'search' field and explore!

For more information see [[Help|YourSearch Help]].
!Compatibility
This plugin requires TiddlyWiki 2.1. 
Check the [[archive|http://tiddlywiki.abego-software.de/archive]] for ~YourSearchPlugins supporting older versions of TiddlyWiki.
!Source Code
***/
/***
This plugin's source code is compressed (and hidden). Use this [[link|http://tiddlywiki.abego-software.de/archive/YourSearchPlugin/Plugin-YourSearch-src.2.1.0.js]] to get the readable source code.
***/
///%
if(!version.extensions.YourSearchPlugin){version.extensions.YourSearchPlugin={major:2,minor:1,revision:0,source:&quot;http://tiddlywiki.abego-software.de/#YourSearchPlugin&quot;,licence:&quot;[[BSD open source license (abego Software)|http://www.abego-software.de/legal/apl-v10.html]]&quot;,copyright:&quot;Copyright (c) abego Software GmbH, 2005-2006 (www.abego-software.de)&quot;};if(!window.abego){window.abego={};}if(!Array.forEach){Array.forEach=function(_1,_2,_3){for(var i=0,len=_1.length;i&lt;len;i++){_2.call(_3,_1[i],i,_1);}};Array.prototype.forEach=function(_5,_6){for(var i=0,len=this.length;i&lt;len;i++){_5.call(_6,this[i],i,this);}};}abego.toInt=function(s,_9){if(!s){return _9;}var n=parseInt(s);return (n==NaN)?_9:n;};abego.createEllipsis=function(_b){var e=createTiddlyElement(_b,&quot;span&quot;);e.innerHTML=&quot;&amp;hellip;&quot;;};abego.shallowCopy=function(_d){if(!_d){return _d;}var _e={};for(var n in _d){_e[n]=_d[n];}return _e;};abego.copyOptions=function(_10){return !_10?{}:abego.shallowCopy(_10);};abego.countStrings=function(_11,s){if(!s){return 0;}var len=s.length;var n=0;var _15=0;while(1){var i=_11.indexOf(s,_15);if(i&lt;0){return n;}n++;_15=i+len;}return n;};abego.getBracedText=function(_17,_18,_19){if(!_18){_18=0;}var re=/\{([^\}]*)\}/gm;re.lastIndex=_18;var m=re.exec(_17);if(m){var s=m[1];var _1d=abego.countStrings(s,&quot;{&quot;);if(!_1d){if(_19){_19.lastIndex=re.lastIndex;}return s;}var len=_17.length;for(var i=re.lastIndex;i&lt;len&amp;&amp;_1d;i++){var c=_17.charAt(i);if(c==&quot;{&quot;){_1d++;}else{if(c==&quot;}&quot;){_1d--;}}}if(!_1d){if(_19){_19.lastIndex=i-1;}return _17.substring(m.index+1,i-1);}}};abego.select=function(_21,_22,_23,_24){if(!_24){_24=[];}_21.forEach(function(t){if(_22.call(_23,t)){_24.push(t);}});return _24;};abego.TiddlerFilterTerm=function(_26,_27){if(!_27){_27={};}var _28=_26;if(!_27.textIsRegExp){_28=_26.escapeRegExp();if(_27.fullWordMatch){_28=&quot;\\b&quot;+_28+&quot;\\b&quot;;}}var _29=new RegExp(_28,&quot;m&quot;+(_27.caseSensitive?&quot;&quot;:&quot;i&quot;));this.tester=new abego.MultiFieldRegExpTester(_29,_27.fields,_27.withExtendedFields);};abego.TiddlerFilterTerm.prototype.test=function(_2a){return this.tester.test(_2a);};abego.parseNewTiddlerCommandLine=function(s){var m=/(.*?)\.(?:\s+|$)([^#]*)(#.*)?/.exec(s);if(!m){m=/([^#]*)()(#.*)?/.exec(s);}if(m){var r;if(m[3]){var s2=m[3].replace(/#/g,&quot;&quot;);r=s2.parseParams(&quot;tag&quot;);}else{r=[[]];}var _2f=m[2]?m[2].trim():&quot;&quot;;r.push({name:&quot;text&quot;,value:_2f});r[0].text=[_2f];return {title:m[1].trim(),params:r};}else{return {title:s.trim(),params:[[]]};}};abego.parseTiddlerFilterTerm=function(_30,_31,_32){var re=/\s*(?:(?:\{([^\}]*)\})|(?:(=)|([#%!])|(?:(\w+)\s*\:(?!\/\/))|(?:(?:(&quot;(?:(?:\\&quot;)|[^&quot;])+&quot;)|(?:\/((?:(?:\\\/)|[^\/])+)\/)|(\w+\:\/\/[^\s]+)|([^\s\)\-\&quot;]+)))))/mg;var _34={&quot;!&quot;:&quot;title&quot;,&quot;%&quot;:&quot;text&quot;,&quot;#&quot;:&quot;tags&quot;};var _35={};var _36;re.lastIndex=_31;while(1){var i=re.lastIndex;var m=re.exec(_30);if(!m||m.index!=i){throw &quot;Word or String literal expected&quot;;}if(m[1]){var _39={};var _3a=abego.getBracedText(_30,0,_39);if(!_3a){throw &quot;Invalid {...} syntax&quot;;}var f=Function(&quot;tiddler&quot;,&quot;return (&quot;+_3a+&quot;);&quot;);return {func:f,lastIndex:_39.lastIndex,markRE:null};}if(m[2]){_36=true;}else{if(m[3]){_35[_34[m[3]]]=1;}else{if(m[4]){_35[m[4]]=1;}else{var _3c=m[6];var _3d=m[5]?window.eval(m[5]):m[6]?m[6]:m[7]?m[7]:m[8];var _32=abego.copyOptions(_32);_32.fullWordMatch=_36;_32.textIsRegExp=_3c;var _3e=[];for(var n in _35){_3e.push(n);}if(_3e.length==0){_32.fields=_32.defaultFields;}else{_32.fields=_3e;_32.withExtendedFields=false;}var _40=new abego.TiddlerFilterTerm(_3d,_32);var _41=_3c?_3d:_3d.escapeRegExp();if(_41&amp;&amp;_36){_41=&quot;\\b&quot;+_41+&quot;\\b&quot;;}return {func:function(_42){return _40.test(_42);},lastIndex:re.lastIndex,markRE:_41?&quot;(?:&quot;+_41+&quot;)&quot;:null};}}}}};abego.BoolExp=function(s,_44,_45){this.s=s;var _46=_45&amp;&amp;_45.defaultOperationIs_OR;var _47=/\s*(?:(\-|not)|(\())/gi;var _48=/\s*\)/g;var _49=/\s*(?:(and|\&amp;\&amp;)|(or|\|\|))/gi;var _4a=/\s*[^\)\s]/g;var _4b=/\s*(\-|not)?(\s*\()?/gi;var _4c=function(_4d){_4b.lastIndex=_4d;var m=_4b.exec(s);var _4f;var _50;if(m&amp;&amp;m.index==_4d){_4d=_4b.lastIndex;_4f=m[1];if(m[2]){var e=parseBoolExpression(_4d);_48.lastIndex=e.lastIndex;if(!_48.exec(s)){throw &quot;Missing ')'&quot;;}_50={func:e.func,lastIndex:_48.lastIndex};}}if(!_50){_50=_44(s,_4d,_45);}if(_4f){_50.func=(function(f){return function(_53){return !f(_53);};})(_50.func);_50.markRE=null;}return _50;};var _54=function(_55){var _56=_4c(_55);while(1){var l=_56.lastIndex;_49.lastIndex=l;var m=_49.exec(s);var _59;var _5a;if(m&amp;&amp;m.index==l){_59=!m[1];_5a=_4c(_49.lastIndex);}else{try{_5a=_4c(l);}catch(e){return _56;}_59=_46;}_56.func=(function(_5b,_5c,_5d){return _5d?function(_5e){return _5b(_5e)||_5c(_5e);}:function(_5f){return _5b(_5f)&amp;&amp;_5c(_5f);};})(_56.func,_5a.func,_59);_56.lastIndex=_5a.lastIndex;if(!_56.markRE){_56.markRE=_5a.markRE;}else{if(_5a.markRE){_56.markRE=_56.markRE+&quot;|&quot;+_5a.markRE;}}}};var _60=_54(0);this.evalFunc=_60.func;if(_60.markRE){this.markRegExp=new RegExp(_60.markRE,_45.caseSensitive?&quot;mg&quot;:&quot;img&quot;);}};abego.BoolExp.prototype.exec=function(){return this.evalFunc.apply(this,arguments);};abego.BoolExp.prototype.getMarkRegExp=function(){return this.markRegExp;};abego.BoolExp.prototype.toString=function(){return this.s;};abego.MultiFieldRegExpTester=function(re,_62,_63){this.re=re;this.fields=_62?_62:[&quot;title&quot;,&quot;text&quot;,&quot;tags&quot;];this.withExtendedFields=_63;};abego.MultiFieldRegExpTester.prototype.test=function(_64){var re=this.re;for(var i=0;i&lt;this.fields.length;i++){var s=store.getValue(_64,this.fields[i]);if(typeof s==&quot;string&quot;&amp;&amp;re.test(s)){return this.fields[i];}}if(this.withExtendedFields){return store.forEachField(_64,function(_68,_69,_6a){return typeof _6a==&quot;string&quot;&amp;&amp;re.test(_6a)?_69:null;},true);}return null;};abego.TiddlerQuery=function(_6b,_6c,_6d,_6e,_6f){if(_6d){this.regExp=new RegExp(_6b,_6c?&quot;mg&quot;:&quot;img&quot;);this.tester=new abego.MultiFieldRegExpTester(this.regExp,_6e,_6f);}else{this.expr=new abego.BoolExp(_6b,abego.parseTiddlerFilterTerm,{defaultFields:_6e,caseSensitive:_6c,withExtendedFields:_6f});}this.getQueryText=function(){return _6b;};this.getUseRegExp=function(){return _6d;};this.getCaseSensitive=function(){return _6c;};this.getDefaultFields=function(){return _6e;};this.getWithExtendedFields=function(){return _6f;};};abego.TiddlerQuery.prototype.test=function(_70){if(!_70){return false;}if(this.regExp){return this.tester.test(_70);}return this.expr.exec(_70);};abego.TiddlerQuery.prototype.filter=function(_71){return abego.select(_71,this.test,this);};abego.TiddlerQuery.prototype.getMarkRegExp=function(){if(this.regExp){return &quot;&quot;.search(this.regExp)&gt;=0?null:this.regExp;}return this.expr.getMarkRegExp();};abego.TiddlerQuery.prototype.toString=function(){return (this.regExp?this.regExp:this.expr).toString();};abego.PageWiseRenderer=function(){this.firstIndexOnPage=0;};merge(abego.PageWiseRenderer.prototype,{setItems:function(_72){this.items=_72;this.setFirstIndexOnPage(0);},getMaxPagesInNavigation:function(){return 10;},getItemsCount:function(_73){return this.items?this.items.length:0;},getCurrentPageIndex:function(){return Math.floor(this.firstIndexOnPage/this.getItemsPerPage());},getLastPageIndex:function(){return Math.floor((this.getItemsCount()-1)/this.getItemsPerPage());},setFirstIndexOnPage:function(_74){this.firstIndexOnPage=Math.min(Math.max(0,_74),this.getItemsCount()-1);},getFirstIndexOnPage:function(){this.firstIndexOnPage=Math.floor(this.firstIndexOnPage/this.getItemsPerPage())*this.getItemsPerPage();return this.firstIndexOnPage;},getLastIndexOnPage:function(){return Math.min(this.getFirstIndexOnPage()+this.getItemsPerPage()-1,this.getItemsCount()-1);},onPageChanged:function(_75,_76){},renderPage:function(_77){if(_77.beginRendering){_77.beginRendering(this);}try{if(this.getItemsCount()){var _78=this.getLastIndexOnPage();var _79=-1;for(var i=this.getFirstIndexOnPage();i&lt;=_78;i++){_79++;_77.render(this,this.items[i],i,_79);}}}finally{if(_77.endRendering){_77.endRendering(this);}}},addPageNavigation:function(_7b){if(!this.getItemsCount()){return;}var _7c=this;var _7d=function(e){if(!e){var e=window.event;}var _7f=abego.toInt(this.getAttribute(&quot;page&quot;),0);var _80=_7c.getCurrentPageIndex();if(_7f==_80){return;}var _81=_7f*_7c.getItemsPerPage();_7c.setFirstIndexOnPage(_81);_7c.onPageChanged(_7f,_80);};var _82;var _83=this.getCurrentPageIndex();var _84=this.getLastPageIndex();if(_83&gt;0){_82=createTiddlyButton(_7b,&quot;Previous&quot;,&quot;Go to previous page (Shortcut: Alt-'&lt;')&quot;,_7d,&quot;prev&quot;);_82.setAttribute(&quot;page&quot;,(_83-1).toString());_82.setAttribute(&quot;accessKey&quot;,&quot;&lt;&quot;);}for(var i=-this.getMaxPagesInNavigation();i&lt;this.getMaxPagesInNavigation();i++){var _86=_83+i;if(_86&lt;0){continue;}if(_86&gt;_84){break;}var _87=(i+_83+1).toString();var _88=_86==_83?&quot;currentPage&quot;:&quot;otherPage&quot;;_82=createTiddlyButton(_7b,_87,&quot;Go to page %0&quot;.format([_87]),_7d,_88);_82.setAttribute(&quot;page&quot;,(_86).toString());}if(_83&lt;_84){_82=createTiddlyButton(_7b,&quot;Next&quot;,&quot;Go to next page (Shortcut: Alt-'&gt;')&quot;,_7d,&quot;next&quot;);_82.setAttribute(&quot;page&quot;,(_83+1).toString());_82.setAttribute(&quot;accessKey&quot;,&quot;&gt;&quot;);}}});abego.LimitedTextRenderer=function(){var _89=40;var _8a=4;var _8b=function(_8c,_8d,_8e){var n=_8c.length;if(n==0){_8c.push({start:_8d,end:_8e});return;}var i=0;for(;i&lt;n;i++){var _91=_8c[i];if(_91.start&lt;=_8e&amp;&amp;_8d&lt;=_91.end){var r;var _93=i+1;for(;_93&lt;n;_93++){r=_8c[_93];if(r.start&gt;_8e||_8d&gt;_91.end){break;}}var _94=_8d;var _95=_8e;for(var j=i;j&lt;_93;j++){r=_8c[j];_94=Math.min(_94,r.start);_95=Math.max(_95,r.end);}_8c.splice(i,_93-i,{start:_94,end:_95});return;}if(_91.start&gt;_8e){break;}}_8c.splice(i,0,{start:_8d,end:_8e});};var _97=function(_98){var _99=0;for(var i=0;i&lt;_98.length;i++){var _9b=_98[i];_99+=_9b.end-_9b.start;}return _99;};var _9c=function(c){return (c&gt;=&quot;a&quot;&amp;&amp;c&lt;=&quot;z&quot;)||(c&gt;=&quot;A&quot;&amp;&amp;c&lt;=&quot;Z&quot;)||c==&quot;_&quot;;};var _9e=function(s,_a0){if(!_9c(s[_a0])){return null;}for(var i=_a0-1;i&gt;=0&amp;&amp;_9c(s[i]);i--){}var _a2=i+1;var n=s.length;for(i=_a0+1;i&lt;n&amp;&amp;_9c(s[i]);i++){}return {start:_a2,end:i};};var _a4=function(s,_a6,_a7){var _a8;if(_a7){_a8=_9e(s,_a6);}else{if(_a6&lt;=0){return _a6;}_a8=_9e(s,_a6-1);}if(!_a8){return _a6;}if(_a7){if(_a8.start&gt;=_a6-_8a){return _a8.start;}if(_a8.end&lt;=_a6+_8a){return _a8.end;}}else{if(_a8.end&lt;=_a6+_8a){return _a8.end;}if(_a8.start&gt;=_a6-_8a){return _a8.start;}}return _a6;};var _a9=function(s,_ab){var _ac=[];if(_ab){var _ad=0;var n=s.length;var _af=0;do{_ab.lastIndex=_ad;var _b0=_ab.exec(s);if(_b0){if(_ad&lt;_b0.index){var t=s.substring(_ad,_b0.index);_ac.push({text:t});}_ac.push({text:_b0[0],isMatch:true});_ad=_b0.index+_b0[0].length;}else{_ac.push({text:s.substr(_ad)});break;}}while(true);}else{_ac.push({text:s});}return _ac;};var _b2=function(_b3){var _b4=0;for(var i=0;i&lt;_b3.length;i++){if(_b3[i].isMatch){_b4++;}}return _b4;};var _b6=function(s,_b8,_b9,_ba,_bb){var _bc=Math.max(Math.floor(_bb/(_ba+1)),_89);var _bd=Math.max(_bc-(_b9-_b8),0);var _be=Math.min(Math.floor(_b9+_bd/3),s.length);var _bf=Math.max(_be-_bc,0);_bf=_a4(s,_bf,true);_be=_a4(s,_be,false);return {start:_bf,end:_be};};var _c0=function(_c1,s,_c3){var _c4=[];var _c5=_b2(_c1);var pos=0;for(var i=0;i&lt;_c1.length;i++){var t=_c1[i];var _c9=t.text;if(t.isMatch){var _ca=_b6(s,pos,pos+_c9.length,_c5,_c3);_8b(_c4,_ca.start,_ca.end);}pos+=_c9.length;}return _c4;};var _cb=function(s,_cd,_ce){var _cf=_ce-_97(_cd);while(_cf&gt;0){if(_cd.length==0){_8b(_cd,0,_a4(s,_ce,false));return;}else{var _d0=_cd[0];var _d1;var _d2;if(_d0.start==0){_d1=_d0.end;if(_cd.length&gt;1){_d2=_cd[1].start;}else{_8b(_cd,_d1,_a4(s,_d1+_cf,false));return;}}else{_d1=0;_d2=_d0.start;}var _d3=Math.min(_d2,_d1+_cf);_8b(_cd,_d1,_d3);_cf-=(_d3-_d1);}}};var _d4=function(_d5,s,_d7,_d8,_d9){if(_d8.length==0){return;}var _da=function(_db,s,_dd,_de,_df){var t;var _e1;var pos=0;var i=0;var _e4=0;for(;i&lt;_dd.length;i++){t=_dd[i];_e1=t.text;if(_de&lt;pos+_e1.length){_e4=_de-pos;break;}pos+=_e1.length;}var _e5=_df-_de;for(;i&lt;_dd.length&amp;&amp;_e5&gt;0;i++){t=_dd[i];_e1=t.text.substr(_e4);_e4=0;if(_e1.length&gt;_e5){_e1=_e1.substr(0,_e5);}if(t.isMatch){createTiddlyElement(_db,&quot;span&quot;,null,&quot;marked&quot;,_e1);}else{createTiddlyText(_db,_e1);}_e5-=_e1.length;}if(_df&lt;s.length){abego.createEllipsis(_db);}};if(_d8[0].start&gt;0){abego.createEllipsis(_d5);}var _e6=_d9;for(var i=0;i&lt;_d8.length&amp;&amp;_e6&gt;0;i++){var _e8=_d8[i];var len=Math.min(_e8.end-_e8.start,_e6);_da(_d5,s,_d7,_e8.start,_e8.start+len);_e6-=len;}};this.render=function(_ea,s,_ec,_ed){if(s.length&lt;_ec){_ec=s.length;}var _ee=_a9(s,_ed);var _ef=_c0(_ee,s,_ec);_cb(s,_ef,_ec);_d4(_ea,s,_ee,_ef,_ec);};};(function(){function alertAndThrow(msg){alert(msg);throw msg;}if(version.major&lt;2||(version.major==2&amp;&amp;version.minor&lt;1)){alertAndThrow(&quot;YourSearchPlugin requires TiddlyWiki 2.1 or newer.\n\nCheck the archive for YourSearch plugins\nsupporting older versions of TiddlyWiki.\n\nArchive: http://tiddlywiki.abego-software.de/archive&quot;);}abego.YourSearch={};var _f1;var _f2;var _f3=function(_f4){_f1=_f4;};var _f5=function(){return _f1?_f1:[];};var _f6=function(){return _f1?_f1.length:0;};var _f7=4;var _f8=10;var _f9=2;var _fa=function(s,re){var m=s.match(re);return m?m.length:0;};var _fe=function(_ff,_100){var _101=_100.getMarkRegExp();if(!_101){return 1;}var _102=_ff.title.match(_101);var _103=_102?_102.length:0;var _104=_fa(_ff.getTags(),_101);var _105=_102?_102.join(&quot;&quot;).length:0;var _106=_ff.title.length&gt;0?_105/_ff.title.length:0;var rank=_103*_f7+_104*_f9+_106*_f8+1;return rank;};var _108=function(_109,_10a,_10b,_10c,_10d,_10e){_f2=null;var _10f=_109.reverseLookup(&quot;tags&quot;,_10e,false);try{var _110=[];if(config.options.chkSearchInTitle){_110.push(&quot;title&quot;);}if(config.options.chkSearchInText){_110.push(&quot;text&quot;);}if(config.options.chkSearchInTags){_110.push(&quot;tags&quot;);}_f2=new abego.TiddlerQuery(_10a,_10b,_10c,_110,config.options.chkSearchExtendedFields);}catch(e){return [];}var _111=_f2.filter(_10f);var _112=abego.YourSearch.getRankFunction();for(var i=0;i&lt;_111.length;i++){var _114=_111[i];var rank=_112(_114,_f2);_114.searchRank=rank;}if(!_10d){_10d=&quot;title&quot;;}var _116=function(a,b){var _119=a.searchRank-b.searchRank;if(_119==0){if(a[_10d]==b[_10d]){return (0);}else{return (a[_10d]&lt;b[_10d])?-1:+1;}}else{return (_119&gt;0)?-1:+1;}};_111.sort(_116);return _111;};var _11a=80;var _11b=50;var _11c=250;var _11d=50;var _11e=25;var _11f=10;var _120=&quot;yourSearchResult&quot;;var _121=&quot;yourSearchResultItems&quot;;var _122;var _123;var _124;var _125;var _126;var _127=function(){if(version.extensions.YourSearchPlugin.styleSheetInited){return;}version.extensions.YourSearchPlugin.styleSheetInited=true;setStylesheet(store.getTiddlerText(&quot;YourSearchStyleSheet&quot;),&quot;yourSearch&quot;);};var _128=function(){return _123!=null&amp;&amp;_123.parentNode==document.body;};var _129=function(){if(_128()){document.body.removeChild(_123);}};var _12a=function(e){_129();var _12c=this.getAttribute(&quot;tiddlyLink&quot;);if(_12c){var _12d=this.getAttribute(&quot;withHilite&quot;);var _12e=highlightHack;if(_12d&amp;&amp;_12d==&quot;true&quot;&amp;&amp;_f2){highlightHack=_f2.getMarkRegExp();}story.displayTiddler(this,_12c);highlightHack=_12e;}return (false);};var _12f=function(){if(!_124){return;}var root=_124;var _131=findPosX(root);var _132=findPosY(root);var _133=root.offsetHeight;var _134=_131;var _135=_132+_133;var _136=findWindowWidth();if(_136&lt;_123.offsetWidth){_123.style.width=(_136-100)+&quot;px&quot;;_136=findWindowWidth();}var _137=_123.offsetWidth;if(_134+_137&gt;_136){_134=_136-_137-30;}if(_134&lt;0){_134=0;}_123.style.left=_134+&quot;px&quot;;_123.style.top=_135+&quot;px&quot;;_123.style.display=&quot;block&quot;;};var _138=function(){if(_123){window.scrollTo(0,ensureVisible(_123));}if(_124){window.scrollTo(0,ensureVisible(_124));}};var _139=function(){_12f();_138();};var _13a;var _13b;var _13c=new abego.PageWiseRenderer();var _13d=function(_13e){this.itemHtml=store.getTiddlerText(&quot;YourSearchItemTemplate&quot;);if(!this.itemHtml){alertAndThrow(&quot;YourSearchItemTemplate not found&quot;);}this.place=document.getElementById(_121);if(!this.place){this.place=createTiddlyElement(_13e,&quot;div&quot;,_121);}};merge(_13d.prototype,{render:function(_13f,_140,_141,_142){_13a=_142;_13b=_140;var item=createTiddlyElement(this.place,&quot;div&quot;,null,&quot;yourSearchItem&quot;);item.innerHTML=this.itemHtml;applyHtmlMacros(item,null);refreshElements(item,null);},endRendering:function(_144){_13b=null;}});var _145=function(){if(!_123||!_124){return;}var html=store.getTiddlerText(&quot;YourSearchResultTemplate&quot;);if(!html){html=&quot;&lt;b&gt;Tiddler YourSearchResultTemplate not found&lt;/b&gt;&quot;;}_123.innerHTML=html;applyHtmlMacros(_123,null);refreshElements(_123,null);var _147=new _13d(_123);_13c.renderPage(_147);_139();};_13c.getItemsPerPage=function(){var n=(config.options.chkPreviewText)?abego.toInt(config.options.txtItemsPerPageWithPreview,_11f):abego.toInt(config.options.txtItemsPerPage,_11e);return (n&gt;0)?n:1;};_13c.onPageChanged=function(){_145();};var _149=function(){if(!_123){_123=createTiddlyElement(document.body,&quot;div&quot;,_120,&quot;yourSearchResult&quot;);}else{if(_123.parentNode!=document.body){document.body.appendChild(_123);}}_145();};var _14a=function(){if(_124==null||!config.options.chkUseYourSearch){return;}if((_124.value==_122)&amp;&amp;_122&amp;&amp;!_128()){if(_123&amp;&amp;(_123.parentNode!=document.body)){document.body.appendChild(_123);_139();}else{_149();}}};var _14b=function(){_129();_123=null;_122=null;};var _14c=function(self,e){while(e!=null){if(self==e){return true;}e=e.parentNode;}return false;};var _14f=function(e){if(e.target==_124){return;}if(e.target==_125){return;}if(_123&amp;&amp;_14c(_123,e.target)){return;}_129();};var _151=function(e){if(e.keyCode==27){_129();}};addEvent(document,&quot;click&quot;,_14f);addEvent(document,&quot;keyup&quot;,_151);var _153=function(text,_155,_156){_122=text;_f3(_108(store,text,_155,_156,&quot;title&quot;,&quot;excludeSearch&quot;));highlightHack=_f2?_f2.getMarkRegExp():null;_13c.setItems(_f5());_149();highlightHack=null;};var _157=function(_158,_159,_15a,_15b,_15c,_15d){_127();_122=&quot;&quot;;var _15e=null;var _15f=function(txt){if(config.options.chkUseYourSearch){_153(txt.value,config.options.chkCaseSensitiveSearch,config.options.chkRegExpSearch);}else{story.search(txt.value,config.options.chkCaseSensitiveSearch,config.options.chkRegExpSearch);}_122=txt.value;};var _161=function(e){_15f(_124);return false;};var _163=function(e){if(!e){var e=window.event;}_124=this;switch(e.keyCode){case 13:if(e.ctrlKey&amp;&amp;_126&amp;&amp;_128()){_126.onclick.apply(_126,[e]);}else{_15f(this);}break;case 27:if(_128()){_129();}else{this.value=&quot;&quot;;clearMessage();}break;}if(String.fromCharCode(e.keyCode)==this.accessKey||e.altKey){_14a();}if(this.value.length&lt;3&amp;&amp;_15e){clearTimeout(_15e);}if(this.value.length&gt;2){if(this.value!=_122){if(!config.options.chkUseYourSearch||config.options.chkSearchAsYouType){if(_15e){clearTimeout(_15e);}var txt=this;_15e=setTimeout(function(){_15f(txt);},500);}}else{if(_15e){clearTimeout(_15e);}}}if(this.value.length==0){_129();}};var _166=function(e){this.select();clearMessage();_14a();};var args=_15c.parseParams(&quot;list&quot;,null,true);var _169=getFlag(args,&quot;buttonAtRight&quot;);var _16a=getParam(args,&quot;sizeTextbox&quot;,this.sizeTextbox);var btn;if(!_169){btn=createTiddlyButton(_158,this.label,this.prompt,_161);}var txt=createTiddlyElement(_158,&quot;input&quot;,null,null,null);if(_15a[0]){txt.value=_15a[0];}txt.onkeyup=_163;txt.onfocus=_166;txt.setAttribute(&quot;size&quot;,_16a);txt.setAttribute(&quot;accessKey&quot;,this.accessKey);txt.setAttribute(&quot;autocomplete&quot;,&quot;off&quot;);if(config.browser.isSafari){txt.setAttribute(&quot;type&quot;,&quot;search&quot;);txt.setAttribute(&quot;results&quot;,&quot;5&quot;);}else{txt.setAttribute(&quot;type&quot;,&quot;text&quot;);}if(_169){btn=createTiddlyButton(_158,this.label,this.prompt,_161);}_124=txt;_125=btn;};var _16d=function(){_129();var _16e=_f5();var n=_16e.length;if(n){var _170=[];for(var i=0;i&lt;n;i++){_170.push(_16e[i].title);}story.displayTiddlers(null,_170);}};var _172=function(_173,_174,_175,_176){invokeMacro(_173,&quot;option&quot;,_174,_175,_176);var elem=_173.lastChild;var _178=elem.onclick;elem.onclick=function(e){var _17a=_178.apply(this,arguments);_145();return _17a;};return elem;};var _17b=function(s){var _17d=[&quot;''&quot;,&quot;{{{&quot;,&quot;}}}&quot;,&quot;//&quot;,&quot;&lt;&lt;&lt;&quot;,&quot;/***&quot;,&quot;***/&quot;];var _17e=&quot;&quot;;for(var i=0;i&lt;_17d.length;i++){if(i!=0){_17e+=&quot;|&quot;;}_17e+=&quot;(&quot;+_17d[i].escapeRegExp()+&quot;)&quot;;}return s.replace(new RegExp(_17e,&quot;mg&quot;),&quot;&quot;).trim();};var _180=function(){var i=_13a;return (i&gt;=0&amp;&amp;i&lt;=9)?(i&lt;9?(i+1):0):-1;};var _182=new abego.LimitedTextRenderer();var _183=function(_184,s,_186){_182.render(_184,s,_186,_f2.getMarkRegExp());};var _187=TiddlyWiki.prototype.saveTiddler;TiddlyWiki.prototype.saveTiddler=function(_188,_189,_18a,_18b,_18c,tags,_18e){_187.apply(this,arguments);_14b();};var _18f=TiddlyWiki.prototype.removeTiddler;TiddlyWiki.prototype.removeTiddler=function(_190){_18f.apply(this,arguments);_14b();};config.macros.yourSearch={label:&quot;yourSearch&quot;,prompt:&quot;Gives access to the current/last YourSearch result&quot;,handler:function(_191,_192,_193,_194,_195,_196){if(_193.length==0){return;}var name=_193[0];var func=config.macros.yourSearch.funcs[name];if(func){func(_191,_192,_193,_194,_195,_196);}},tests:{&quot;true&quot;:function(){return true;},&quot;false&quot;:function(){return false;},&quot;found&quot;:function(){return _f6()&gt;0;},&quot;previewText&quot;:function(){return config.options.chkPreviewText;}},funcs:{itemRange:function(_199){if(_f6()){var _19a=_13c.getLastIndexOnPage();var s=&quot;%0 - %1&quot;.format([_13c.getFirstIndexOnPage()+1,_19a+1]);createTiddlyText(_199,s);}},count:function(_19c){createTiddlyText(_19c,_f6().toString());},query:function(_19d){if(_f2){createTiddlyText(_19d,_f2.toString());}},version:function(_19e){var t=&quot;YourSearch %0.%1.%2&quot;.format([version.extensions.YourSearchPlugin.major,version.extensions.YourSearchPlugin.minor,version.extensions.YourSearchPlugin.revision]);var e=createTiddlyElement(_19e,&quot;a&quot;);e.setAttribute(&quot;href&quot;,&quot;http://tiddlywiki.abego-software.de/#YourSearchPlugin&quot;);e.innerHTML=&quot;&lt;font color=\&quot;black\&quot; face=\&quot;Arial, Helvetica, sans-serif\&quot;&gt;&quot;+t+&quot;&lt;font&gt;&quot;;},copyright:function(_1a1){var e=createTiddlyElement(_1a1,&quot;a&quot;);e.setAttribute(&quot;href&quot;,&quot;http://www.abego-software.de&quot;);e.innerHTML=&quot;&lt;font color=\&quot;black\&quot; face=\&quot;Arial, Helvetica, sans-serif\&quot;&gt;&amp;copy; 2005-2006 &lt;b&gt;&lt;font color=\&quot;red\&quot;&gt;abego&lt;/font&gt;&lt;/b&gt; Software&lt;font&gt;&quot;;},newTiddlerButton:function(_1a3){if(_f2){var r=abego.parseNewTiddlerCommandLine(_f2.getQueryText());var btn=config.macros.newTiddler.createNewTiddlerButton(_1a3,r.title,r.params,&quot;new tiddler&quot;,&quot;Create a new tiddler based on search text. (Shortcut: Ctrl-Enter; Separators: '.', '#')&quot;,null,&quot;text&quot;);var _1a6=btn.onclick;btn.onclick=function(){_129();_1a6.apply(this,arguments);};_126=btn;}},linkButton:function(_1a7,_1a8,_1a9,_1aa,_1ab,_1ac){if(_1a9&lt;2){return;}var _1ad=_1a9[1];var text=_1a9&lt;3?_1ad:_1a9[2];var _1af=_1a9&lt;4?text:_1a9[3];var _1b0=_1a9&lt;5?null:_1a9[4];var btn=createTiddlyButton(_1a7,text,_1af,_12a,null,null,_1b0);btn.setAttribute(&quot;tiddlyLink&quot;,_1ad);},closeButton:function(_1b2,_1b3,_1b4,_1b5,_1b6,_1b7){var _1b8=createTiddlyButton(_1b2,&quot;close&quot;,&quot;Close the Search Results (Shortcut: ESC)&quot;,_129);},openAllButton:function(_1b9,_1ba,_1bb,_1bc,_1bd,_1be){var n=_f6();if(n==0){return;}var _1c0=n==1?&quot;open tiddler&quot;:&quot;open all %0 tiddlers&quot;.format([n]);var _1c1=createTiddlyButton(_1b9,_1c0,&quot;Open all found tiddlers (Shortcut: Alt-O)&quot;,_16d);_1c1.setAttribute(&quot;accessKey&quot;,&quot;O&quot;);},naviBar:function(_1c2,_1c3,_1c4,_1c5,_1c6,_1c7){_13c.addPageNavigation(_1c2);},&quot;if&quot;:function(_1c8,_1c9,_1ca,_1cb,_1cc,_1cd){if(_1ca.length&lt;2){return;}var _1ce=_1ca[1];var _1cf=(_1ce==&quot;not&quot;);if(_1cf){if(_1ca.length&lt;3){return;}_1ce=_1ca[2];}var test=config.macros.yourSearch.tests[_1ce];var _1d1=false;try{if(test){_1d1=test(_1c8,_1c9,_1ca,_1cb,_1cc,_1cd)!=_1cf;}else{_1d1=(!eval(_1ce))==_1cf;}}catch(ex){}if(!_1d1){_1c8.style.display=&quot;none&quot;;}},chkPreviewText:function(_1d2,_1d3,_1d4,_1d5,_1d6,_1d7){var _1d8=_1d4.slice(1).join(&quot; &quot;);var elem=_172(_1d2,&quot;chkPreviewText&quot;,_1d5,_1d7);elem.setAttribute(&quot;accessKey&quot;,&quot;P&quot;);elem.title=&quot;Show text preview of found tiddlers (Shortcut: Alt-P)&quot;;return elem;}}};config.macros.foundTiddler={label:&quot;foundTiddler&quot;,prompt:&quot;Provides information on the tiddler currently processed on the YourSearch result page&quot;,handler:function(_1da,_1db,_1dc,_1dd,_1de,_1df){var name=_1dc[0];var func=config.macros.foundTiddler.funcs[name];if(func){func(_1da,_1db,_1dc,_1dd,_1de,_1df);}},funcs:{title:function(_1e2,_1e3,_1e4,_1e5,_1e6,_1e7){if(!_13b){return;}var _1e8=_180();var _1e9=_1e8&gt;=0?&quot;Open tiddler (Shortcut: Alt-%0)&quot;.format([_1e8.toString()]):&quot;Open tiddler&quot;;var btn=createTiddlyButton(_1e2,null,_1e9,_12a,null);btn.setAttribute(&quot;tiddlyLink&quot;,_13b.title);btn.setAttribute(&quot;withHilite&quot;,&quot;true&quot;);_183(btn,_13b.title,_11a);if(_1e8&gt;=0){btn.setAttribute(&quot;accessKey&quot;,_1e8.toString());}},tags:function(_1eb,_1ec,_1ed,_1ee,_1ef,_1f0){if(!_13b){return;}_183(_1eb,_13b.getTags(),_11b);},text:function(_1f1,_1f2,_1f3,_1f4,_1f5,_1f6){if(!_13b){return;}_183(_1f1,_17b(_13b.text),_11c);},field:function(_1f7,_1f8,_1f9,_1fa,_1fb,_1fc){if(!_13b){return;}var name=_1f9[1];var len=_1f9.length&gt;2?abego.toInt(_1f9[2],_11d):_11d;var v=store.getValue(_13b,name);if(v){_183(_1f7,_17b(v),len);}},number:function(_200,_201,_202,_203,_204,_205){var _206=_180();if(_206&gt;=0){var text=&quot;%0)&quot;.format([_206.toString()]);createTiddlyElement(_200,&quot;span&quot;,null,&quot;shortcutNumber&quot;,text);}}}};var opts={chkUseYourSearch:true,chkPreviewText:true,chkSearchAsYouType:true,chkSearchInTitle:true,chkSearchInText:true,chkSearchInTags:true,chkSearchExtendedFields:true,txtItemsPerPage:_11e,txtItemsPerPageWithPreview:_11f};for(var n in opts){if(config.options[n]==undefined){config.options[n]=opts[n];}}config.shadowTiddlers.AdvancedOptions+=&quot;\n&lt;&lt;option chkUseYourSearch&gt;&gt; Use 'Your Search' //([[more options|YourSearch Options]]) ([[help|YourSearch Help]])// &quot;;config.shadowTiddlers[&quot;YourSearch Help&quot;]=&quot;!Field Search\nWith the Field Search you can restrict your search to certain fields of a tiddler, e.g&quot;+&quot; only search the tags or only the titles. The general form is //fieldname//'':''//textToSearch// (e.&quot;+&quot;g. {{{title:intro}}}). In addition one-character shortcuts are also supported for the standard field&quot;+&quot;s {{{title}}}, {{{text}}} and {{{tags}}}:\n|!What you want|!What you type|!Example|\n|Search ''titles &quot;+&quot;only''|start word with ''!''|{{{!jonny}}} (shortcut for {{{title:jonny}}})|\n|Search ''contents/text &quot;+&quot;only''|start word with ''%''|{{{%football}}} (shortcut for {{{text:football}}})|\n|Search ''tags only&quot;+&quot;''|start word with ''#''|{{{#Plugin}}} (shortcut for {{{tags:Plugin}}})|\n\nUsing this feature you may&quot;+&quot; also search the extended fields (\&quot;Metadata\&quot;) introduced with TiddlyWiki 2.1, e.g. use {{{priority:1&quot;+&quot;}}} to find all tiddlers with the priority field set to \&quot;1\&quot;.\n\nYou may search a word in more than one&quot;+&quot; field. E.g. {{{!#Plugin}}} (or {{{title:tags:Plugin}}} in the \&quot;long form\&quot;) finds tiddlers containin&quot;+&quot;g \&quot;Plugin\&quot; either in the title or in the tags (but does not look for \&quot;Plugin\&quot; in the text). \n\n!Boole&quot;+&quot;an Search\nThe Boolean Search is useful when searching for multiple words.\n|!What you want|!What you &quot;+&quot;type|!Example|\n|''All words'' must exist|List of words|{{{jonny jeremy}}} (or {{{jonny and jeremy}}}&quot;+&quot;)|\n|''At least one word'' must exist|Separate words by ''or''|{{{jonny or jeremy}}}|\n|A word ''must &quot;+&quot;not exist''|Start word with ''-''|{{{-jonny}}} (or {{{not jonny}}})|\n\n''Note:'' When you specify two&quot;+&quot; words, separated with a space, YourSearch finds all tiddlers that contain both words, but not neces&quot;+&quot;sarily next to each other. If you want to find a sequence of word, e.g. '{{{John Brown}}}', you need&quot;+&quot; to put the words into quotes. I.e. you type: {{{\&quot;john brown\&quot;}}}.\n\nUsing parenthesis you may change &quot;+&quot;the default \&quot;left to right\&quot; evaluation of the boolean search. E.g. {{{not (jonny or jeremy)}}} finds&quot;+&quot; all tiddlers that contain neither \&quot;jonny\&quot; nor \&quot;jeremy. In contrast to this {{{not jonny or jeremy}}&quot;+&quot;} (i.e. without parenthesis) finds all tiddlers that either don't contain \&quot;jonny\&quot; or that contain \&quot;j&quot;+&quot;eremy\&quot;.\n\n!'Exact Word' Search\nBy default a search result all matches that 'contain' the searched tex&quot;+&quot;t. E.g. if you search for {{{Task}}} you will get all tiddlers containing 'Task', but also '~Complet&quot;+&quot;edTask', '~TaskForce' etc.\n\nIf you only want to get the tiddlers that contain 'exactly the word' you&quot;+&quot; need to prefix it with a '='. E.g. typing '=Task' will find the tiddlers that contain the word 'Tas&quot;+&quot;k', ignoring words that just contain 'Task' as a substring.\n\n!~CaseSensitiveSearch and ~RegExpSearch&quot;+&quot;\nThe standard search options ~CaseSensitiveSearch and ~RegExpSearch are fully supported by YourSearc&quot;+&quot;h. However when ''~RegExpSearch'' is on Filtered and Boolean Search are disabled.\n\nIn addition you m&quot;+&quot;ay do a \&quot;regular expression\&quot; search even with the ''~RegExpSearch'' set to false by directly enterin&quot;+&quot;g the regular expression into the search field, framed with {{{/.../}}}. \n\nExample: {{{/m[ae][iy]er/&quot;+&quot;}}} will find all tiddlers that contain either \&quot;maier\&quot;, \&quot;mayer\&quot;, \&quot;meier\&quot; or \&quot;meyer\&quot;.\n\n!~JavaScript E&quot;+&quot;xpression Filtering\nIf you are familiar with JavaScript programming and know some TiddlyWiki interna&quot;+&quot;ls you may also use JavaScript expression for the search. Just enter a JavaScript boolean expression&quot;+&quot; into the search field, framed with {{{ { ... } }}}. In the code refer to the variable tiddler and e&quot;+&quot;valuate to {{{true}}} when the given tiddler should be included in the result. \n\nExample: {{{ { tidd&quot;+&quot;ler.modified &gt; new Date(\&quot;Jul 4, 2005\&quot;)} }}} returns all tiddler modified after July 4th, 2005.\n\n!Com&quot;+&quot;bined Search\nYou are free to combine the various search options. \n\n''Examples''\n|!What you type|!Res&quot;+&quot;ult|\n|{{{!jonny !jeremy -%football}}}|all tiddlers with both {{{jonny}}} and {{{jeremy}}} in its tit&quot;+&quot;les, but no {{{football}}} in content.|\n|{{{#=Task}}}|All tiddlers tagged with 'Task' (the exact wor&quot;+&quot;d). Tags named '~CompletedTask', '~TaskForce' etc. are not considered.|\n\n!Access Keys\nYou are encour&quot;+&quot;aged to use the access keys (also called \&quot;shortcut\&quot; keys) for the most frequently used operations. F&quot;+&quot;or quick reference these shortcuts are also mentioned in the tooltip for the various buttons etc.\n\n|&quot;+&quot;!Key|!Operation|\n|{{{Alt-F}}}|''The most important keystroke'': It moves the cursor to the search in&quot;+&quot;put field so you can directly start typing your query. Pressing {{{Alt-F}}} will also display the pr&quot;+&quot;evious search result. This way you can quickly display multiple tiddlers using \&quot;Press {{{Alt-F}}}. S&quot;+&quot;elect tiddler.\&quot; sequences.|\n|{{{ESC}}}|Closes the [[YourSearch Result]]. When the [[YourSearch Resul&quot;+&quot;t]] is already closed and the cursor is in the search input field the field's content is cleared so &quot;+&quot;you start a new query.|\n|{{{Alt-1}}}, {{{Alt-2}}},... |Pressing these keys opens the first, second e&quot;+&quot;tc. tiddler from the result list.|\n|{{{Alt-O}}}|Opens all found tiddlers.|\n|{{{Alt-P}}}|Toggles the &quot;+&quot;'Preview Text' mode.|\n|{{{Alt-'&lt;'}}}, {{{Alt-'&gt;'}}}|Displays the previous or next page in the [[Your&quot;+&quot;Search Result]].|\n|{{{Return}}}|When you have turned off the 'as you type' search mode pressing the &quot;+&quot;{{{Return}}} key actually starts the search (as does pressing the 'search' button).|\n\n//If some of t&quot;+&quot;hese shortcuts don't work for you check your browser if you have other extensions installed that alr&quot;+&quot;eady \&quot;use\&quot; these shortcuts.//&quot;;config.shadowTiddlers[&quot;YourSearch Options&quot;]=&quot;|&gt;|!YourSearch Options|\n|&gt;|&lt;&lt;option chkUseYourSearch&gt;&gt; Use 'Your Search'|\n|!|&lt;&lt;option chkPreviewText&quot;+&quot;&gt;&gt; Show Text Preview|\n|!|&lt;&lt;option chkSearchAsYouType&gt;&gt; 'Search As You Type' Mode (No RETURN required&quot;+&quot; to start search)|\n|!|Default Search Filter:&lt;&lt;option chkSearchInTitle&gt;&gt;Title ('!')     &lt;&lt;option chk&quot;+&quot;SearchInText&gt;&gt;Text ('%')     &lt;&lt;option chkSearchInTags&gt;&gt;Tags ('#')    &lt;&lt;option chkSearchExtendedFiel&quot;+&quot;ds&gt;&gt;Extended Fields&lt;html&gt;&lt;br&gt;&lt;font size=\&quot;-2\&quot;&gt;The fields of a tiddlers that are searched when you don&quot;+&quot;'t explicitly specify a filter in the search text &lt;br&gt;(Explictly specify fields using one or more '!&quot;+&quot;', '%', '#' or 'fieldname:' prefix before the word/text to find).&lt;/font&gt;&lt;/html&gt;|\n|!|Number of items &quot;+&quot;on search result page: &lt;&lt;option txtItemsPerPage&gt;&gt;|\n|!|Number of items on search result page with pre&quot;+&quot;view text: &lt;&lt;option txtItemsPerPageWithPreview&gt;&gt;|\n&quot;;config.shadowTiddlers[&quot;YourSearchStyleSheet&quot;]=&quot;/***\n!~YourSearchResult Stylesheet\n***/\n/*{{{*/\n.yourSearchResult {\n\tposition: absolute;\n\twidth: 800&quot;+&quot;px;\n\n\tpadding: 0.2em;\n\tlist-style: none;\n\tmargin: 0;\n\n\tbackground: #ffd;\n\tborder: 1px solid DarkGra&quot;+&quot;y;\n}\n\n/*}}}*/\n/***\n!!Summary Section\n***/\n/*{{{*/\n.yourSearchResult .summary {\n\tborder-bottom-width:&quot;+&quot; thin;\n\tborder-bottom-style: solid;\n\tborder-bottom-color: #999999;\n\tpadding-bottom: 4px;\n}\n\n.yourSea&quot;+&quot;rchRange, .yourSearchCount, .yourSearchQuery   {\n\tfont-weight: bold;\n}\n\n.yourSearchResult .summary .&quot;+&quot;button {\n\tfont-size: 10px;\n\n\tpadding-left: 0.3em;\n\tpadding-right: 0.3em;\n}\n\n.yourSearchResult .summa&quot;+&quot;ry .chkBoxLabel {\n\tfont-size: 10px;\n\n\tpadding-right: 0.3em;\n}\n\n/*}}}*/\n/***\n!!Items Area\n***/\n/*{{{*&quot;+&quot;/\n.yourSearchResult .marked {\n\tbackground: none;\n\tfont-weight: bold;\n}\n\n.yourSearchItem {\n\tmargin-to&quot;+&quot;p: 2px;\n}\n\n.yourSearchNumber {\n\tcolor: #808080;\n}\n\n\n.yourSearchTags {\n\tcolor: #008000;\n}\n\n.yourSearc&quot;+&quot;hText {\n\tcolor: #808080;\n\tmargin-bottom: 6px;\n}\n\n/*}}}*/\n/***\n!!Footer\n***/\n/*{{{*/\n.yourSearchFoote&quot;+&quot;r {\n\tmargin-top: 8px;\n\tborder-top-width: thin;\n\tborder-top-style: solid;\n\tborder-top-color: #999999;&quot;+&quot;\n}\n\n.yourSearchFooter a:hover{\n\tbackground: none;\n\tcolor: none;\n}\n/*}}}*/\n/***\n!!Navigation Bar\n***/&quot;+&quot;\n/*{{{*/\n.yourSearchNaviBar a {\n\tfont-size: 16px;\n\tmargin-left: 4px;\n\tmargin-right: 4px;\n\tcolor: bla&quot;+&quot;ck;\n\ttext-decoration: underline;\n}\n\n.yourSearchNaviBar a:hover {\n\tbackground-color: none;\n}\n\n.yourSe&quot;+&quot;archNaviBar .prev {\n\tfont-weight: bold;\n\tcolor: blue;\n}\n\n.yourSearchNaviBar .currentPage {\n\tcolor: #&quot;+&quot;FF0000;\n\tfont-weight: bold;\n\ttext-decoration: none;\n}\n\n.yourSearchNaviBar .next {\n\tfont-weight: bold&quot;+&quot;;\n\tcolor: blue;\n}\n/*}}}*/\n&quot;;config.shadowTiddlers[&quot;YourSearchResultTemplate&quot;]=&quot;&lt;!--\n{{{\n--&gt;\n&lt;span macro=\&quot;yourSearch if found\&quot;&gt;\n&lt;!-- The Summary Header ============================&quot;+&quot;================ --&gt;\n&lt;table class=\&quot;summary\&quot; border=\&quot;0\&quot; width=\&quot;100%\&quot; cellspacing=\&quot;0\&quot; cellpadding=\&quot;0\&quot;&gt;&quot;+&quot;&lt;tbody&gt;\n  &lt;tr&gt;\n\t&lt;td align=\&quot;left\&quot;&gt;\n\t\tYourSearch Result &lt;span class=\&quot;yourSearchRange\&quot; macro=\&quot;yourSearc&quot;+&quot;h itemRange\&quot;&gt;&lt;/span&gt;\n\t\t&amp;nbsp;of&amp;nbsp;&lt;span class=\&quot;yourSearchCount\&quot; macro=\&quot;yourSearch count\&quot;&gt;&lt;/span&gt;\n&quot;+&quot;\t\tfor&amp;nbsp;&lt;span class=\&quot;yourSearchQuery\&quot; macro=\&quot;yourSearch query\&quot;&gt;&lt;/span&gt;\n\t&lt;/td&gt;\n\t&lt;td class=\&quot;yourSea&quot;+&quot;rchButtons\&quot; align=\&quot;right\&quot;&gt;\n\t\t&lt;span macro=\&quot;yourSearch chkPreviewText\&quot;&gt;&lt;/span&gt;&lt;span class=\&quot;chkBoxLabel&quot;+&quot;\&quot;&gt;preview text&lt;/span&gt;\n\t\t&lt;span macro=\&quot;yourSearch newTiddlerButton\&quot;&gt;&lt;/span&gt;\n\t\t&lt;span macro=\&quot;yourSearch openAllButton\&quot;&gt;&lt;/span&gt;\n\t\t&lt;span macro=\&quot;yourSearch lin&quot;+&quot;kButton 'YourSearch Options' options 'Configure YourSearch'\&quot;&gt;&lt;/span&gt;\n\t\t&lt;span macro=\&quot;yourSearch linkB&quot;+&quot;utton 'YourSearch Help' help 'Get help how to use YourSearch'\&quot;&gt;&lt;/span&gt;\n\t\t&lt;span macro=\&quot;yourSearch clo&quot;+&quot;seButton\&quot;&gt;&lt;/span&gt;\n\t&lt;/td&gt;\n  &lt;/tr&gt;\n&lt;/tbody&gt;&lt;/table&gt;\n\n&lt;!-- The List of Found Tiddlers =================&quot;+&quot;=========================== --&gt;\n&lt;div id=\&quot;yourSearchResultItems\&quot; itemsPerPage=\&quot;25\&quot; itemsPerPageWithPr&quot;+&quot;eview=\&quot;10\&quot;&gt;&lt;/div&gt;\n\n&lt;!-- The Footer (with the Navigation) ===========================================&quot;+&quot;= --&gt;\n&lt;table class=\&quot;yourSearchFooter\&quot; border=\&quot;0\&quot; width=\&quot;100%\&quot; cellspacing=\&quot;0\&quot; cellpadding=\&quot;0\&quot;&gt;&lt;tbody&quot;+&quot;&gt;\n  &lt;tr&gt;\n\t&lt;td align=\&quot;left\&quot;&gt;\n\t\tResult page: &lt;span class=\&quot;yourSearchNaviBar\&quot; macro=\&quot;yourSearch naviBar&quot;+&quot;\&quot;&gt;&lt;/span&gt;\n\t&lt;/td&gt;\n\t&lt;td align=\&quot;right\&quot;&gt;&lt;span macro=\&quot;yourSearch version\&quot;&gt;&lt;/span&gt;, &lt;span macro=\&quot;yourSearc&quot;+&quot;h copyright\&quot;&gt;&lt;/span&gt;\n\t&lt;/td&gt;\n  &lt;/tr&gt;\n&lt;/tbody&gt;&lt;/table&gt;\n&lt;!-- end of the 'tiddlers found' case =========&quot;+&quot;================================== --&gt;\n&lt;/span&gt;\n\n\n&lt;!-- The \&quot;No tiddlers found\&quot; case =================&quot;+&quot;========================== --&gt;\n&lt;span macro=\&quot;yourSearch if not found\&quot;&gt;\n&lt;table class=\&quot;summary\&quot; border=&quot;+&quot;\&quot;0\&quot; width=\&quot;100%\&quot; cellspacing=\&quot;0\&quot; cellpadding=\&quot;0\&quot;&gt;&lt;tbody&gt;\n  &lt;tr&gt;\n\t&lt;td align=\&quot;left\&quot;&gt;\n\t\tYourSearch Resu&quot;+&quot;lt: No tiddlers found for &lt;span class=\&quot;yourSearchQuery\&quot; macro=\&quot;yourSearch query\&quot;&gt;&lt;/span&gt;.\n\t&lt;/td&gt;\n\t&lt;t&quot;+&quot;d class=\&quot;yourSearchButtons\&quot; align=\&quot;right\&quot;&gt;\n\t\t&lt;span macro=\&quot;yourSearch newTiddlerButton\&quot;&gt;&lt;/span&gt;\n\t\t&lt;span macro=\&quot;yourSearch linkButton 'YourSearch Options'&quot;+&quot; options 'Configure YourSearch'\&quot;&gt;&lt;/span&gt;\n\t\t&lt;span macro=\&quot;yourSearch linkButton 'YourSearch Help' help&quot;+&quot; 'Get help how to use YourSearch'\&quot;&gt;&lt;/span&gt;\n\t\t&lt;span macro=\&quot;yourSearch closeButton\&quot;&gt;&lt;/span&gt;\n\t&lt;/td&gt;\n  &lt;&quot;+&quot;/tr&gt;\n&lt;/tbody&gt;&lt;/table&gt;\n&lt;/span&gt;\n\n\n&lt;!--\n}}}\n--&gt;\n&quot;;config.shadowTiddlers[&quot;YourSearchItemTemplate&quot;]=&quot;&lt;!--\n{{{\n--&gt;\n&lt;span class='yourSearchNumber' macro='foundTiddler number'&gt;&lt;/span&gt;\n&lt;span class='yourSea&quot;+&quot;rchTitle' macro='foundTiddler title'/&gt;&lt;/span&gt;&amp;nbsp;-&amp;nbsp;\n&lt;span class='yourSearchTags' macro='found&quot;+&quot;Tiddler field tags 50'/&gt;&lt;/span&gt;\n&lt;span macro=\&quot;yourSearch if previewText\&quot;&gt;&lt;div class='yourSearchText' macro='fo&quot;+&quot;undTiddler field text 250'/&gt;&lt;/div&gt;&lt;/span&gt;\n&lt;!--\n}}}\n--&gt;&quot;;config.shadowTiddlers[&quot;YourSearch&quot;]=&quot;&lt;&lt;tiddler [[YourSearch Help]]&gt;&gt;&quot;;config.shadowTiddlers[&quot;YourSearch Result&quot;]=&quot;The popup-like window displaying the result of a YourSearch query.&quot;;config.macros.search.handler=_157;var _20a=function(){if(config.macros.search.handler!=_157){alert(&quot;Message from YourSearchPlugin:\n\n\nAnother plugin has disabled the 'Your Search' features.\n\n\nYou may &quot;+&quot;disable the other plugin or change the load order of \nthe plugins (by changing the names of the tidd&quot;+&quot;lers)\nto enable the 'Your Search' features.&quot;);}};setTimeout(_20a,5000);abego.YourSearch.getStandardRankFunction=function(){return _fe;};abego.YourSearch.getRankFunction=function(){return abego.YourSearch.getStandardRankFunction();};abego.YourSearch.getCurrentTiddler=function(){return _13b;};abego.YourSearch.closeResult=function(){_129();};})();}
//%/</pre>
</div>
<div title="excludeTreeViewTemplate" modifier="YourName" tags="excludeTree" server.type="file" server.host="file:///Users/Jon/Documents/TiddlyWiki/Trunk/contributors/JonRobson/verticals/FamilyTree/index.html" server.page.revision="200903090000">
<pre>&lt;!--{{{--&gt;
&lt;div class='toolbar' macro='toolbar [[ToolbarCommands::ViewToolbar]]'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;

&lt;div class='tagging' macro='tagging'&gt;&lt;/div&gt;
&lt;div class='tagged' macro='tags'&gt;&lt;/div&gt;

&lt;div macro='view text wikified'&gt;&lt;/div&gt;
&lt;div class='tagClear'&gt;&lt;/div&gt;

&lt;!--}}}--&gt;
</pre>
</div>
<div title="sexDefinition" modifier="YourName" tags="excludeTree" server.type="file" server.host="file:///Users/Jon/Documents/TiddlyWiki/Trunk/contributors/JonRobson/verticals/FamilyTree/index.html" server.page.revision="200903090000">
<pre>Male:M
Female:F
</pre>
</div>
<div title="topToolbar" modifier="YourName" modified="200910021551" tags="excludeTree" server.type="file" server.host="file:///Users/Jon/Documents/TiddlyWiki/Trunk/contributors/JonRobson/verticals/FamilyTree/index.html" server.page.revision="200903090000" dob="" placeofbirth="" spouse="" placeofmarriage="" occupation="" dod="" causeofdeath="" placeofdeath="" changecount="1">
<pre>&lt;&lt;closeAll&gt;&gt;&lt;&lt;permaview&gt;&gt;&lt;&lt;newTiddler&gt;&gt;&lt;&lt;saveChanges&gt;&gt;{{button{[[About]]}}}</pre>
</div>
</div>
<!--POST-STOREAREA-->
<!--POST-BODY-START-->
<!--POST-BODY-END-->
<script id="jsArea" type="text/javascript">
//<![CDATA[
//
// Please note:
//
// * This code is designed to be readable but for compactness it only includes brief comments. You can see fuller comments
//   in the project Subversion repository at http://svn.tiddlywiki.org/Trunk/core/
//
// * You should never need to modify this source code directly. TiddlyWiki is carefully designed to allow deep customisation
//   without changing the core code. Please consult the development group at http://groups.google.com/group/TiddlyWikiDev
//

//--
//-- Configuration repository
//--

// Miscellaneous options
var config = {
	numRssItems: 20, // Number of items in the RSS feed
	animDuration: 400, // Duration of UI animations in milliseconds
	cascadeFast: 20, // Speed for cascade animations (higher == slower)
	cascadeSlow: 60, // Speed for EasterEgg cascade animations
	cascadeDepth: 5, // Depth of cascade animation
	locale: "en" // W3C language tag
};

// Hashmap of alternative parsers for the wikifier
config.parsers = {};

// Adaptors
config.adaptors = {};
config.defaultAdaptor = null;

// Backstage tasks
config.tasks = {};

// Annotations
config.annotations = {};

// Custom fields to be automatically added to new tiddlers
config.defaultCustomFields = {};

// Messages
config.messages = {
	messageClose: {},
	dates: {},
	tiddlerPopup: {}
};

// Options that can be set in the options panel and/or cookies
config.options = {
	chkRegExpSearch: false,
	chkCaseSensitiveSearch: false,
	chkIncrementalSearch: true,
	chkAnimate: true,
	chkSaveBackups: true,
	chkAutoSave: false,
	chkGenerateAnRssFeed: false,
	chkSaveEmptyTemplate: false,
	chkOpenInNewWindow: true,
	chkToggleLinks: false,
	chkHttpReadOnly: true,
	chkForceMinorUpdate: false,
	chkConfirmDelete: true,
	chkInsertTabs: false,
	chkUsePreForStorage: true, // Whether to use <pre> format for storage
	chkDisplayInstrumentation: false,
	txtBackupFolder: "",
	txtEditorFocus: "text",
	txtMainTab: "tabTimeline",
	txtMoreTab: "moreTabAll",
	txtMaxEditRows: "30",
	txtFileSystemCharSet: "UTF-8",
	txtTheme: ""
	};
config.optionsDesc = {};

// Default tiddler templates
var DEFAULT_VIEW_TEMPLATE = 1;
var DEFAULT_EDIT_TEMPLATE = 2;
config.tiddlerTemplates = {
	1: "ViewTemplate",
	2: "EditTemplate"
};

// More messages (rather a legacy layout that should not really be like this)
config.views = {
	wikified: {
		tag: {}
	},
	editor: {
		tagChooser: {}
	}
};

// Backstage tasks
config.backstageTasks = ["save","sync","importTask","tweak","upgrade","plugins"];

// Extensions
config.extensions = {};

// Macros; each has a 'handler' member that is inserted later
config.macros = {
	today: {},
	version: {},
	search: {sizeTextbox: 15},
	tiddler: {},
	tag: {},
	tags: {},
	tagging: {},
	timeline: {},
	allTags: {},
	list: {
		all: {},
		missing: {},
		orphans: {},
		shadowed: {},
		touched: {},
		filter: {}
	},
	closeAll: {},
	permaview: {},
	saveChanges: {},
	slider: {},
	option: {},
	options: {},
	newTiddler: {},
	newJournal: {},
	tabs: {},
	gradient: {},
	message: {},
	view: {defaultView: "text"},
	edit: {},
	tagChooser: {},
	toolbar: {},
	plugins: {},
	refreshDisplay: {},
	importTiddlers: {},
	upgrade: {
		source: "http://www.tiddlywiki.com/upgrade/",
		backupExtension: "pre.core.upgrade"
	},
	sync: {},
	annotations: {}
};

// Commands supported by the toolbar macro
config.commands = {
	closeTiddler: {},
	closeOthers: {},
	editTiddler: {},
	saveTiddler: {hideReadOnly: true},
	cancelTiddler: {},
	deleteTiddler: {hideReadOnly: true},
	permalink: {},
	references: {type: "popup"},
	jump: {type: "popup"},
	syncing: {type: "popup"},
	fields: {type: "popup"}
};

// Browser detection... In a very few places, there's nothing else for it but to know what browser we're using.
config.userAgent = navigator.userAgent.toLowerCase();
config.browser = {
	isIE: config.userAgent.indexOf("msie") != -1 && config.userAgent.indexOf("opera") == -1,
	isGecko: config.userAgent.indexOf("gecko") != -1,
	ieVersion: /MSIE (\d.\d)/i.exec(config.userAgent), // config.browser.ieVersion[1], if it exists, will be the IE version string, eg "6.0"
	isSafari: config.userAgent.indexOf("applewebkit") != -1,
	isBadSafari: !((new RegExp("[\u0150\u0170]","g")).test("\u0150")),
	firefoxDate: /gecko\/(\d{8})/i.exec(config.userAgent), // config.browser.firefoxDate[1], if it exists, will be Firefox release date as "YYYYMMDD"
	isOpera: config.userAgent.indexOf("opera") != -1,
	isLinux: config.userAgent.indexOf("linux") != -1,
	isUnix: config.userAgent.indexOf("x11") != -1,
	isMac: config.userAgent.indexOf("mac") != -1,
	isWindows: config.userAgent.indexOf("win") != -1
};

// Basic regular expressions
config.textPrimitives = {
	upperLetter: "[A-Z\u00c0-\u00de\u0150\u0170]",
	lowerLetter: "[a-z0-9_\\-\u00df-\u00ff\u0151\u0171]",
	anyLetter:   "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]",
	anyLetterStrict: "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]"
};
if(config.browser.isBadSafari) {
	config.textPrimitives = {
		upperLetter: "[A-Z\u00c0-\u00de]",
		lowerLetter: "[a-z0-9_\\-\u00df-\u00ff]",
		anyLetter:   "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff]",
		anyLetterStrict: "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff]"
	};
}
config.textPrimitives.sliceSeparator = "::";
config.textPrimitives.sectionSeparator = "##";
config.textPrimitives.urlPattern = "(?:file|http|https|mailto|ftp|irc|news|data):[^\\s'\"]+(?:/|\\b)";
config.textPrimitives.unWikiLink = "~";
config.textPrimitives.wikiLink = "(?:(?:" + config.textPrimitives.upperLetter + "+" +
	config.textPrimitives.lowerLetter + "+" +
	config.textPrimitives.upperLetter +
	config.textPrimitives.anyLetter + "*)|(?:" +
	config.textPrimitives.upperLetter + "{2,}" +
	config.textPrimitives.lowerLetter + "+))";

config.textPrimitives.cssLookahead = "(?:(" + config.textPrimitives.anyLetter + "+)\\(([^\\)\\|\\n]+)(?:\\):))|(?:(" + config.textPrimitives.anyLetter + "+):([^;\\|\\n]+);)";
config.textPrimitives.cssLookaheadRegExp = new RegExp(config.textPrimitives.cssLookahead,"mg");

config.textPrimitives.brackettedLink = "\\[\\[([^\\]]+)\\]\\]";
config.textPrimitives.titledBrackettedLink = "\\[\\[([^\\[\\]\\|]+)\\|([^\\[\\]\\|]+)\\]\\]";
config.textPrimitives.tiddlerForcedLinkRegExp = new RegExp("(?:" + config.textPrimitives.titledBrackettedLink + ")|(?:" +
	config.textPrimitives.brackettedLink + ")|(?:" +
	config.textPrimitives.urlPattern + ")","mg");
config.textPrimitives.tiddlerAnyLinkRegExp = new RegExp("("+ config.textPrimitives.wikiLink + ")|(?:" +
	config.textPrimitives.titledBrackettedLink + ")|(?:" +
	config.textPrimitives.brackettedLink + ")|(?:" +
	config.textPrimitives.urlPattern + ")","mg");

config.glyphs = {
	browsers: [
		function() {return config.browser.isIE;},
		function() {return true;}
	],
	currBrowser: null,
	codes: {
		downTriangle: ["\u25BC","\u25BE"],
		downArrow: ["\u2193","\u2193"],
		bentArrowLeft: ["\u2190","\u21A9"],
		bentArrowRight: ["\u2192","\u21AA"]
	}
};

//--
//-- Shadow tiddlers
//--

config.shadowTiddlers = {
	StyleSheet: "",
	MarkupPreHead: "",
	MarkupPostHead: "",
	MarkupPreBody: "",
	MarkupPostBody: "",
	TabTimeline: '<<timeline>>',
	TabAll: '<<list all>>',
	TabTags: '<<allTags excludeLists>>',
	TabMoreMissing: '<<list missing>>',
	TabMoreOrphans: '<<list orphans>>',
	TabMoreShadowed: '<<list shadowed>>',
	AdvancedOptions: '<<options>>',
	PluginManager: '<<plugins>>',
	ToolbarCommands: '|~ViewToolbar|closeTiddler closeOthers +editTiddler > fields syncing permalink references jump|\n|~EditToolbar|+saveTiddler -cancelTiddler deleteTiddler|'
};

//--
//-- Translateable strings
//--

// Strings in "double quotes" should be translated; strings in 'single quotes' should be left alone

merge(config.options,{
	txtUserName: "YourName"});

merge(config.tasks,{
	save: {text: "save", tooltip: "Save your changes to this TiddlyWiki", action: saveChanges},
	sync: {text: "sync", tooltip: "Synchronise changes with other TiddlyWiki files and servers", content: '<<sync>>'},
	importTask: {text: "import", tooltip: "Import tiddlers and plugins from other TiddlyWiki files and servers", content: '<<importTiddlers>>'},
	tweak: {text: "tweak", tooltip: "Tweak the appearance and behaviour of TiddlyWiki", content: '<<options>>'},
	upgrade: {text: "upgrade", tooltip: "Upgrade TiddlyWiki core code", content: '<<upgrade>>'},
	plugins: {text: "plugins", tooltip: "Manage installed plugins", content: '<<plugins>>'}
});

// Options that can be set in the options panel and/or cookies
merge(config.optionsDesc,{
	txtUserName: "Username for signing your edits",
	chkRegExpSearch: "Enable regular expressions for searches",
	chkCaseSensitiveSearch: "Case-sensitive searching",
	chkIncrementalSearch: "Incremental key-by-key searching",
	chkAnimate: "Enable animations",
	chkSaveBackups: "Keep backup file when saving changes",
	chkAutoSave: "Automatically save changes",
	chkGenerateAnRssFeed: "Generate an RSS feed when saving changes",
	chkSaveEmptyTemplate: "Generate an empty template when saving changes",
	chkOpenInNewWindow: "Open external links in a new window",
	chkToggleLinks: "Clicking on links to open tiddlers causes them to close",
	chkHttpReadOnly: "Hide editing features when viewed over HTTP",
	chkForceMinorUpdate: "Don't update modifier username and date when editing tiddlers",
	chkConfirmDelete: "Require confirmation before deleting tiddlers",
	chkInsertTabs: "Use the tab key to insert tab characters instead of moving between fields",
	txtBackupFolder: "Name of folder to use for backups",
	txtMaxEditRows: "Maximum number of rows in edit boxes",
	txtTheme: "Name of the theme to use",
	txtFileSystemCharSet: "Default character set for saving changes (Firefox/Mozilla only)"});

merge(config.messages,{
	customConfigError: "Problems were encountered loading plugins. See PluginManager for details",
	pluginError: "Error: %0",
	pluginDisabled: "Not executed because disabled via 'systemConfigDisable' tag",
	pluginForced: "Executed because forced via 'systemConfigForce' tag",
	pluginVersionError: "Not executed because this plugin needs a newer version of TiddlyWiki",
	nothingSelected: "Nothing is selected. You must select one or more items first",
	savedSnapshotError: "It appears that this TiddlyWiki has been incorrectly saved. Please see http://www.tiddlywiki.com/#Download for details",
	subtitleUnknown: "(unknown)",
	undefinedTiddlerToolTip: "The tiddler '%0' doesn't yet exist",
	shadowedTiddlerToolTip: "The tiddler '%0' doesn't yet exist, but has a pre-defined shadow value",
	tiddlerLinkTooltip: "%0 - %1, %2",
	externalLinkTooltip: "External link to %0",
	noTags: "There are no tagged tiddlers",
	notFileUrlError: "You need to save this TiddlyWiki to a file before you can save changes",
	cantSaveError: "It's not possible to save changes. Possible reasons include:\n- your browser doesn't support saving (Firefox, Internet Explorer, Safari and Opera all work if properly configured)\n- the pathname to your TiddlyWiki file contains illegal characters\n- the TiddlyWiki HTML file has been moved or renamed",
	invalidFileError: "The original file '%0' does not appear to be a valid TiddlyWiki",
	backupSaved: "Backup saved",
	backupFailed: "Failed to save backup file",
	rssSaved: "RSS feed saved",
	rssFailed: "Failed to save RSS feed file",
	emptySaved: "Empty template saved",
	emptyFailed: "Failed to save empty template file",
	mainSaved: "Main TiddlyWiki file saved",
	mainFailed: "Failed to save main TiddlyWiki file. Your changes have not been saved",
	macroError: "Error in macro <<\%0>>",
	macroErrorDetails: "Error while executing macro <<\%0>>:\n%1",
	missingMacro: "No such macro",
	overwriteWarning: "A tiddler named '%0' already exists. Choose OK to overwrite it",
	unsavedChangesWarning: "WARNING! There are unsaved changes in TiddlyWiki\n\nChoose OK to save\nChoose CANCEL to discard",
	confirmExit: "--------------------------------\n\nThere are unsaved changes in TiddlyWiki. If you continue you will lose those changes\n\n--------------------------------",
	saveInstructions: "SaveChanges",
	unsupportedTWFormat: "Unsupported TiddlyWiki format '%0'",
	tiddlerSaveError: "Error when saving tiddler '%0'",
	tiddlerLoadError: "Error when loading tiddler '%0'",
	wrongSaveFormat: "Cannot save with storage format '%0'. Using standard format for save.",
	invalidFieldName: "Invalid field name %0",
	fieldCannotBeChanged: "Field '%0' cannot be changed",
	loadingMissingTiddler: "Attempting to retrieve the tiddler '%0' from the '%1' server at:\n\n'%2' in the workspace '%3'",
	upgradeDone: "The upgrade to version %0 is now complete\n\nClick 'OK' to reload the newly upgraded TiddlyWiki"});

merge(config.messages.messageClose,{
	text: "close",
	tooltip: "close this message area"});

config.messages.backstage = {
	open: {text: "backstage", tooltip: "Open the backstage area to perform authoring and editing tasks"},
	close: {text: "close", tooltip: "Close the backstage area"},
	prompt: "backstage: ",
	decal: {
		edit: {text: "edit", tooltip: "Edit the tiddler '%0'"}
	}
};

config.messages.listView = {
	tiddlerTooltip: "Click for the full text of this tiddler",
	previewUnavailable: "(preview not available)"
};

config.messages.dates.months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November","December"];
config.messages.dates.days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
config.messages.dates.shortMonths = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
config.messages.dates.shortDays = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
// suffixes for dates, eg "1st","2nd","3rd"..."30th","31st"
config.messages.dates.daySuffixes = ["st","nd","rd","th","th","th","th","th","th","th",
		"th","th","th","th","th","th","th","th","th","th",
		"st","nd","rd","th","th","th","th","th","th","th",
		"st"];
config.messages.dates.am = "am";
config.messages.dates.pm = "pm";

merge(config.messages.tiddlerPopup,{
	});

merge(config.views.wikified.tag,{
	labelNoTags: "no tags",
	labelTags: "tags: ",
	openTag: "Open tag '%0'",
	tooltip: "Show tiddlers tagged with '%0'",
	openAllText: "Open all",
	openAllTooltip: "Open all of these tiddlers",
	popupNone: "No other tiddlers tagged with '%0'"});

merge(config.views.wikified,{
	defaultText: "The tiddler '%0' doesn't yet exist. Double-click to create it",
	defaultModifier: "(missing)",
	shadowModifier: "(built-in shadow tiddler)",
	dateFormat: "DD MMM YYYY",
	createdPrompt: "created"});

merge(config.views.editor,{
	tagPrompt: "Type tags separated with spaces, [[use double square brackets]] if necessary, or add existing",
	defaultText: "Type the text for '%0'"});

merge(config.views.editor.tagChooser,{
	text: "tags",
	tooltip: "Choose existing tags to add to this tiddler",
	popupNone: "There are no tags defined",
	tagTooltip: "Add the tag '%0'"});

merge(config.messages,{
	sizeTemplates:
		[
		{unit: 1024*1024*1024, template: "%0\u00a0GB"},
		{unit: 1024*1024, template: "%0\u00a0MB"},
		{unit: 1024, template: "%0\u00a0KB"},
		{unit: 1, template: "%0\u00a0B"}
		]});

merge(config.macros.search,{
	label: "search",
	prompt: "Search this TiddlyWiki",
	accessKey: "F",
	successMsg: "%0 tiddlers found matching %1",
	failureMsg: "No tiddlers found matching %0"});

merge(config.macros.tagging,{
	label: "tagging: ",
	labelNotTag: "not tagging",
	tooltip: "List of tiddlers tagged with '%0'"});

merge(config.macros.timeline,{
	dateFormat: "DD MMM YYYY"});

merge(config.macros.allTags,{
	tooltip: "Show tiddlers tagged with '%0'",
	noTags: "There are no tagged tiddlers"});

config.macros.list.all.prompt = "All tiddlers in alphabetical order";
config.macros.list.missing.prompt = "Tiddlers that have links to them but are not defined";
config.macros.list.orphans.prompt = "Tiddlers that are not linked to from any other tiddlers";
config.macros.list.shadowed.prompt = "Tiddlers shadowed with default contents";
config.macros.list.touched.prompt = "Tiddlers that have been modified locally";

merge(config.macros.closeAll,{
	label: "close all",
	prompt: "Close all displayed tiddlers (except any that are being edited)"});

merge(config.macros.permaview,{
	label: "permaview",
	prompt: "Link to an URL that retrieves all the currently displayed tiddlers"});

merge(config.macros.saveChanges,{
	label: "save changes",
	prompt: "Save all tiddlers to create a new TiddlyWiki",
	accessKey: "S"});

merge(config.macros.newTiddler,{
	label: "new tiddler",
	prompt: "Create a new tiddler",
	title: "New Tiddler",
	accessKey: "N"});

merge(config.macros.newJournal,{
	label: "new journal",
	prompt: "Create a new tiddler from the current date and time",
	accessKey: "J"});

merge(config.macros.options,{
	wizardTitle: "Tweak advanced options",
	step1Title: "These options are saved in cookies in your browser",
	step1Html: "<input type='hidden' name='markList'></input><br><input type='checkbox' checked='false' name='chkUnknown'>Show unknown options</input>",
	unknownDescription: "//(unknown)//",
	listViewTemplate: {
		columns: [
			{name: 'Option', field: 'option', title: "Option", type: 'String'},
			{name: 'Description', field: 'description', title: "Description", type: 'WikiText'},
			{name: 'Name', field: 'name', title: "Name", type: 'String'}
			],
		rowClasses: [
			{className: 'lowlight', field: 'lowlight'}
			]}
	});

merge(config.macros.plugins,{
	wizardTitle: "Manage plugins",
	step1Title: "Currently loaded plugins",
	step1Html: "<input type='hidden' name='markList'></input>", // DO NOT TRANSLATE
	skippedText: "(This plugin has not been executed because it was added since startup)",
	noPluginText: "There are no plugins installed",
	confirmDeleteText: "Are you sure you want to delete these plugins:\n\n%0",
	removeLabel: "remove systemConfig tag",
	removePrompt: "Remove systemConfig tag",
	deleteLabel: "delete",
	deletePrompt: "Delete these tiddlers forever",
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Description', field: 'Description', title: "Description", type: 'String'},
			{name: 'Version', field: 'Version', title: "Version", type: 'String'},
			{name: 'Size', field: 'size', tiddlerLink: 'size', title: "Size", type: 'Size'},
			{name: 'Forced', field: 'forced', title: "Forced", tag: 'systemConfigForce', type: 'TagCheckbox'},
			{name: 'Disabled', field: 'disabled', title: "Disabled", tag: 'systemConfigDisable', type: 'TagCheckbox'},
			{name: 'Executed', field: 'executed', title: "Loaded", type: 'Boolean', trueText: "Yes", falseText: "No"},
			{name: 'Startup Time', field: 'startupTime', title: "Startup Time", type: 'String'},
			{name: 'Error', field: 'error', title: "Status", type: 'Boolean', trueText: "Error", falseText: "OK"},
			{name: 'Log', field: 'log', title: "Log", type: 'StringList'}
			],
		rowClasses: [
			{className: 'error', field: 'error'},
			{className: 'warning', field: 'warning'}
			]}
	});

merge(config.macros.toolbar,{
	moreLabel: "more",
	morePrompt: "Show additional commands",
	lessLabel: "less",
	lessPrompt: "Hide additional commands",
	separator: "|"
	});

merge(config.macros.refreshDisplay,{
	label: "refresh",
	prompt: "Redraw the entire TiddlyWiki display"
	});

merge(config.macros.importTiddlers,{
	readOnlyWarning: "You cannot import into a read-only TiddlyWiki file. Try opening it from a file:// URL",
	wizardTitle: "Import tiddlers from another file or server",
	step1Title: "Step 1: Locate the server or TiddlyWiki file",
	step1Html: "Specify the type of the server: <select name='selTypes'><option value=''>Choose...</option></select><br>Enter the URL or pathname here: <input type='text' size=50 name='txtPath'><br>...or browse for a file: <input type='file' size=50 name='txtBrowse'><br><hr>...or select a pre-defined feed: <select name='selFeeds'><option value=''>Choose...</option></select>",
	openLabel: "open",
	openPrompt: "Open the connection to this file or server",
	openError: "There were problems fetching the tiddlywiki file",
	statusOpenHost: "Opening the host",
	statusGetWorkspaceList: "Getting the list of available workspaces",
	step2Title: "Step 2: Choose the workspace",
	step2Html: "Enter a workspace name: <input type='text' size=50 name='txtWorkspace'><br>...or select a workspace: <select name='selWorkspace'><option value=''>Choose...</option></select>",
	cancelLabel: "cancel",
	cancelPrompt: "Cancel this import",
	statusOpenWorkspace: "Opening the workspace",
	statusGetTiddlerList: "Getting the list of available tiddlers",
	errorGettingTiddlerList: "Error getting list of tiddlers, click Cancel to try again",
	step3Title: "Step 3: Choose the tiddlers to import",
	step3Html: "<input type='hidden' name='markList'></input><br><input type='checkbox' checked='true' name='chkSync'>Keep these tiddlers linked to this server so that you can synchronise subsequent changes</input><br><input type='checkbox' name='chkSave'>Save the details of this server in a 'systemServer' tiddler called:</input> <input type='text' size=25 name='txtSaveTiddler'>",
	importLabel: "import",
	importPrompt: "Import these tiddlers",
	confirmOverwriteText: "Are you sure you want to overwrite these tiddlers:\n\n%0",
	step4Title: "Step 4: Importing %0 tiddler(s)",
	step4Html: "<input type='hidden' name='markReport'></input>", // DO NOT TRANSLATE
	doneLabel: "done",
	donePrompt: "Close this wizard",
	statusDoingImport: "Importing tiddlers",
	statusDoneImport: "All tiddlers imported",
	systemServerNamePattern: "%2 on %1",
	systemServerNamePatternNoWorkspace: "%1",
	confirmOverwriteSaveTiddler: "The tiddler '%0' already exists. Click 'OK' to overwrite it with the details of this server, or 'Cancel' to leave it unchanged",
	serverSaveTemplate: "|''Type:''|%0|\n|''URL:''|%1|\n|''Workspace:''|%2|\n\nThis tiddler was automatically created to record the details of this server",
	serverSaveModifier: "(System)",
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Size', field: 'size', tiddlerLink: 'size', title: "Size", type: 'Size'},
			{name: 'Tags', field: 'tags', title: "Tags", type: 'Tags'}
			],
		rowClasses: [
			]}
	});

merge(config.macros.upgrade,{
	wizardTitle: "Upgrade TiddlyWiki core code",
	step1Title: "Update or repair this TiddlyWiki to the latest release",
	step1Html: "You are about to upgrade to the latest release of the TiddlyWiki core code (from <a href='%0' class='externalLink' target='_blank'>%1</a>). Your content will be preserved across the upgrade.<br><br>Note that core upgrades have been known to interfere with older plugins. If you run into problems with the upgraded file, see <a href='http://www.tiddlywiki.org/wiki/CoreUpgrades' class='externalLink' target='_blank'>http://www.tiddlywiki.org/wiki/CoreUpgrades</a>",
	errorCantUpgrade: "Unable to upgrade this TiddlyWiki. You can only perform upgrades on TiddlyWiki files stored locally",
	errorNotSaved: "You must save changes before you can perform an upgrade",
	step2Title: "Confirm the upgrade details",
	step2Html_downgrade: "You are about to downgrade to TiddlyWiki version %0 from %1.<br><br>Downgrading to an earlier version of the core code is not recommended",
	step2Html_restore: "This TiddlyWiki appears to be already using the latest version of the core code (%0).<br><br>You can continue to upgrade anyway to ensure that the core code hasn't been corrupted or damaged",
	step2Html_upgrade: "You are about to upgrade to TiddlyWiki version %0 from %1",
	upgradeLabel: "upgrade",
	upgradePrompt: "Prepare for the upgrade process",
	statusPreparingBackup: "Preparing backup",
	statusSavingBackup: "Saving backup file",
	errorSavingBackup: "There was a problem saving the backup file",
	statusLoadingCore: "Loading core code",
	errorLoadingCore: "Error loading the core code",
	errorCoreFormat: "Error with the new core code",
	statusSavingCore: "Saving the new core code",
	statusReloadingCore: "Reloading the new core code",
	startLabel: "start",
	startPrompt: "Start the upgrade process",
	cancelLabel: "cancel",
	cancelPrompt: "Cancel the upgrade process",
	step3Title: "Upgrade cancelled",
	step3Html: "You have cancelled the upgrade process"
	});

merge(config.macros.sync,{
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'selected', rowName: 'title', type: 'Selector'},
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Server Type', field: 'serverType', title: "Server type", type: 'String'},
			{name: 'Server Host', field: 'serverHost', title: "Server host", type: 'String'},
			{name: 'Server Workspace', field: 'serverWorkspace', title: "Server workspace", type: 'String'},
			{name: 'Status', field: 'status', title: "Synchronisation status", type: 'String'},
			{name: 'Server URL', field: 'serverUrl', title: "Server URL", text: "View", type: 'Link'}
			],
		rowClasses: [
			],
		buttons: [
			{caption: "Sync these tiddlers", name: 'sync'}
			]},
	wizardTitle: "Synchronize with external servers and files",
	step1Title: "Choose the tiddlers you want to synchronize",
	step1Html: "<input type='hidden' name='markList'></input>", // DO NOT TRANSLATE
	syncLabel: "sync",
	syncPrompt: "Sync these tiddlers",
	hasChanged: "Changed while unplugged",
	hasNotChanged: "Unchanged while unplugged",
	syncStatusList: {
		none: {text: "...", display:null, className:'notChanged'},
		changedServer: {text: "Changed on server", display:null, className:'changedServer'},
		changedLocally: {text: "Changed while unplugged", display:null, className:'changedLocally'},
		changedBoth: {text: "Changed while unplugged and on server", display:null, className:'changedBoth'},
		notFound: {text: "Not found on server", display:null, className:'notFound'},
		putToServer: {text: "Saved update on server", display:null, className:'putToServer'},
		gotFromServer: {text: "Retrieved update from server", display:null, className:'gotFromServer'}
		}
	});

merge(config.macros.annotations,{
	});

merge(config.commands.closeTiddler,{
	text: "close",
	tooltip: "Close this tiddler"});

merge(config.commands.closeOthers,{
	text: "close others",
	tooltip: "Close all other tiddlers"});

merge(config.commands.editTiddler,{
	text: "edit",
	tooltip: "Edit this tiddler",
	readOnlyText: "view",
	readOnlyTooltip: "View the source of this tiddler"});

merge(config.commands.saveTiddler,{
	text: "done",
	tooltip: "Save changes to this tiddler"});

merge(config.commands.cancelTiddler,{
	text: "cancel",
	tooltip: "Undo changes to this tiddler",
	warning: "Are you sure you want to abandon your changes to '%0'?",
	readOnlyText: "done",
	readOnlyTooltip: "View this tiddler normally"});

merge(config.commands.deleteTiddler,{
	text: "delete",
	tooltip: "Delete this tiddler",
	warning: "Are you sure you want to delete '%0'?"});

merge(config.commands.permalink,{
	text: "permalink",
	tooltip: "Permalink for this tiddler"});

merge(config.commands.references,{
	text: "references",
	tooltip: "Show tiddlers that link to this one",
	popupNone: "No references"});

merge(config.commands.jump,{
	text: "jump",
	tooltip: "Jump to another open tiddler"});

merge(config.commands.syncing,{
	text: "syncing",
	tooltip: "Control synchronisation of this tiddler with a server or external file",
	currentlySyncing: "<div>Currently syncing via <span class='popupHighlight'>'%0'</span> to:</"+"div><div>host: <span class='popupHighlight'>%1</span></"+"div><div>workspace: <span class='popupHighlight'>%2</span></"+"div>", // Note escaping of closing <div> tag
	notCurrentlySyncing: "Not currently syncing",
	captionUnSync: "Stop synchronising this tiddler",
	chooseServer: "Synchronise this tiddler with another server:",
	currServerMarker: "\u25cf ",
	notCurrServerMarker: "  "});

merge(config.commands.fields,{
	text: "fields",
	tooltip: "Show the extended fields of this tiddler",
	emptyText: "There are no extended fields for this tiddler",
	listViewTemplate: {
		columns: [
			{name: 'Field', field: 'field', title: "Field", type: 'String'},
			{name: 'Value', field: 'value', title: "Value", type: 'String'}
			],
		rowClasses: [
			],
		buttons: [
			]}});

merge(config.shadowTiddlers,{
	DefaultTiddlers: "[[GettingStarted]]",
	MainMenu: "[[GettingStarted]]",
	SiteTitle: "My TiddlyWiki",
	SiteSubtitle: "a reusable non-linear personal web notebook",
	SiteUrl: "http://www.tiddlywiki.com/",
	SideBarOptions: '<<search>><<closeAll>><<permaview>><<newTiddler>><<newJournal "DD MMM YYYY" "journal">><<saveChanges>><<slider chkSliderOptionsPanel OptionsPanel "options \u00bb" "Change TiddlyWiki advanced options">>',
	SideBarTabs: '<<tabs txtMainTab "Timeline" "Timeline" TabTimeline "All" "All tiddlers" TabAll "Tags" "All tags" TabTags "More" "More lists" TabMore>>',
	TabMore: '<<tabs txtMoreTab "Missing" "Missing tiddlers" TabMoreMissing "Orphans" "Orphaned tiddlers" TabMoreOrphans "Shadowed" "Shadowed tiddlers" TabMoreShadowed>>'
	});

merge(config.annotations,{
	AdvancedOptions: "This shadow tiddler provides access to several advanced options",
	ColorPalette: "These values in this shadow tiddler determine the colour scheme of the ~TiddlyWiki user interface",
	DefaultTiddlers: "The tiddlers listed in this shadow tiddler will be automatically displayed when ~TiddlyWiki starts up",
	EditTemplate: "The HTML template in this shadow tiddler determines how tiddlers look while they are being edited",
	GettingStarted: "This shadow tiddler provides basic usage instructions",
	ImportTiddlers: "This shadow tiddler provides access to importing tiddlers",
	MainMenu: "This shadow tiddler is used as the contents of the main menu in the left-hand column of the screen",
	MarkupPreHead: "This tiddler is inserted at the top of the <head> section of the TiddlyWiki HTML file",
	MarkupPostHead: "This tiddler is inserted at the bottom of the <head> section of the TiddlyWiki HTML file",
	MarkupPreBody: "This tiddler is inserted at the top of the <body> section of the TiddlyWiki HTML file",
	MarkupPostBody: "This tiddler is inserted at the end of the <body> section of the TiddlyWiki HTML file immediately after the script block",
	OptionsPanel: "This shadow tiddler is used as the contents of the options panel slider in the right-hand sidebar",
	PageTemplate: "The HTML template in this shadow tiddler determines the overall ~TiddlyWiki layout",
	PluginManager: "This shadow tiddler provides access to the plugin manager",
	SideBarOptions: "This shadow tiddler is used as the contents of the option panel in the right-hand sidebar",
	SideBarTabs: "This shadow tiddler is used as the contents of the tabs panel in the right-hand sidebar",
	SiteSubtitle: "This shadow tiddler is used as the second part of the page title",
	SiteTitle: "This shadow tiddler is used as the first part of the page title",
	SiteUrl: "This shadow tiddler should be set to the full target URL for publication",
	StyleSheetColors: "This shadow tiddler contains CSS definitions related to the color of page elements. ''DO NOT EDIT THIS TIDDLER'', instead make your changes in the StyleSheet shadow tiddler",
	StyleSheet: "This tiddler can contain custom CSS definitions",
	StyleSheetLayout: "This shadow tiddler contains CSS definitions related to the layout of page elements. ''DO NOT EDIT THIS TIDDLER'', instead make your changes in the StyleSheet shadow tiddler",
	StyleSheetLocale: "This shadow tiddler contains CSS definitions related to the translation locale",
	StyleSheetPrint: "This shadow tiddler contains CSS definitions for printing",
	TabAll: "This shadow tiddler contains the contents of the 'All' tab in the right-hand sidebar",
	TabMore: "This shadow tiddler contains the contents of the 'More' tab in the right-hand sidebar",
	TabMoreMissing: "This shadow tiddler contains the contents of the 'Missing' tab in the right-hand sidebar",
	TabMoreOrphans: "This shadow tiddler contains the contents of the 'Orphans' tab in the right-hand sidebar",
	TabMoreShadowed: "This shadow tiddler contains the contents of the 'Shadowed' tab in the right-hand sidebar",
	TabTags: "This shadow tiddler contains the contents of the 'Tags' tab in the right-hand sidebar",
	TabTimeline: "This shadow tiddler contains the contents of the 'Timeline' tab in the right-hand sidebar",
	ToolbarCommands: "This shadow tiddler determines which commands are shown in tiddler toolbars",
	ViewTemplate: "The HTML template in this shadow tiddler determines how tiddlers look"
	});

//--
//-- Main
//--

var params = null; // Command line parameters
var store = null; // TiddlyWiki storage
var story = null; // Main story
var formatter = null; // Default formatters for the wikifier
var anim = typeof Animator == "function" ? new Animator() : null; // Animation engine
var readOnly = false; // Whether we're in readonly mode
var highlightHack = null; // Embarrassing hack department...
var hadConfirmExit = false; // Don't warn more than once
var safeMode = false; // Disable all plugins and cookies
var showBackstage; // Whether to include the backstage area
var installedPlugins = []; // Information filled in when plugins are executed
var startingUp = false; // Whether we're in the process of starting up
var pluginInfo,tiddler; // Used to pass information to plugins in loadPlugins()

// Whether to use the JavaSaver applet
var useJavaSaver = (config.browser.isSafari || config.browser.isOpera) && (document.location.toString().substr(0,4) != "http");

// Starting up
function main()
{
	var t10,t9,t8,t7,t6,t5,t4,t3,t2,t1,t0 = new Date();
	startingUp = true;
	jQuery.noConflict();
	window.onbeforeunload = function(e) {if(window.confirmExit) return confirmExit();};
	params = getParameters();
	if(params)
		params = params.parseParams("open",null,false);
	store = new TiddlyWiki();
	invokeParamifier(params,"oninit");
	story = new Story("tiddlerDisplay","tiddler");
	addEvent(document,"click",Popup.onDocumentClick);
	saveTest();
	loadOptionsCookie();
	for(var s=0; s<config.notifyTiddlers.length; s++)
		store.addNotification(config.notifyTiddlers[s].name,config.notifyTiddlers[s].notify);
	t1 = new Date();
	loadShadowTiddlers();
	jQuery().trigger("loadShadows");
	t2 = new Date();
	store.loadFromDiv("storeArea","store",true);
	jQuery().trigger("loadTiddlers");
	t3 = new Date();
	invokeParamifier(params,"onload");
	t4 = new Date();
	readOnly = (window.location.protocol == "file:") ? false : config.options.chkHttpReadOnly;
	var pluginProblem = loadPlugins();
	jQuery().trigger("loadPlugins");
	t5 = new Date();
	formatter = new Formatter(config.formatters);
	invokeParamifier(params,"onconfig");
	story.switchTheme(config.options.txtTheme);
	showBackstage = !readOnly;
	t6 = new Date();
	for(var m in config.macros) {
		if(config.macros[m].init)
			config.macros[m].init();
	}
	t7 = new Date();
	store.notifyAll();
	t8 = new Date();
	restart();
	refreshDisplay();
	t9 = new Date();
	if(pluginProblem) {
		story.displayTiddler(null,"PluginManager");
		displayMessage(config.messages.customConfigError);
	}
	if(showBackstage)
		backstage.init();
	t10 = new Date();
	if(config.options.chkDisplayInstrumentation) {
		displayMessage("LoadShadows " + (t2-t1) + " ms");
		displayMessage("LoadFromDiv " + (t3-t2) + " ms");
		displayMessage("LoadPlugins " + (t5-t4) + " ms");
		displayMessage("Macro init " + (t7-t6) + " ms");
		displayMessage("Notify " + (t8-t7) + " ms");
		displayMessage("Restart " + (t9-t8) + " ms");
		displayMessage("Total: " + (t10-t0) + " ms");
	}
	startingUp = false;
	jQuery().trigger("startup");
}

// Called on unload. All functions called conditionally since they themselves may have been unloaded.
function unload()
{
	if(window.checkUnsavedChanges)
		checkUnsavedChanges();
	if(window.scrubNodes)
		scrubNodes(document.body);
}

// Restarting
function restart()
{
	invokeParamifier(params,"onstart");
	if(story.isEmpty()) {
		story.displayDefaultTiddlers();
	}
	window.scrollTo(0,0);
}

function saveTest()
{
	var s = document.getElementById("saveTest");
	if(s.hasChildNodes())
		alert(config.messages.savedSnapshotError);
	s.appendChild(document.createTextNode("savetest"));
}

function loadShadowTiddlers()
{
	var shadows = new TiddlyWiki();
	shadows.loadFromDiv("shadowArea","shadows",true);
	shadows.forEachTiddler(function(title,tiddler){config.shadowTiddlers[title] = tiddler.text;});
	delete shadows;
}

function loadPlugins()
{
	if(safeMode)
		return false;
	var tiddlers = store.getTaggedTiddlers("systemConfig");
	var toLoad = [];
	var nLoaded = 0;
	var map = {};
	var nPlugins = tiddlers.length;
	installedPlugins = [];
	for(var i=0; i<nPlugins; i++) {
		var p = getPluginInfo(tiddlers[i]);
		installedPlugins[i] = p;
		var n = p.Name;
		if(n)
			map[n] = p;
		n = p.Source;
		if(n)
			map[n] = p;
	}
	var visit = function(p) {
		if(!p || p.done)
			return;
		p.done = 1;
		var reqs = p.Requires;
		if(reqs) {
			reqs = reqs.readBracketedList();
			for(var i=0; i<reqs.length; i++)
				visit(map[reqs[i]]);
		}
		toLoad.push(p);
	};
	for(i=0; i<nPlugins; i++)
		visit(installedPlugins[i]);
	for(i=0; i<toLoad.length; i++) {
		p = toLoad[i];
		pluginInfo = p;
		tiddler = p.tiddler;
		if(isPluginExecutable(p)) {
			if(isPluginEnabled(p)) {
				p.executed = true;
				var startTime = new Date();
				try {
					if(tiddler.text)
						window.eval(tiddler.text);
					nLoaded++;
				} catch(ex) {
					p.log.push(config.messages.pluginError.format([exceptionText(ex)]));
					p.error = true;
				}
				pluginInfo.startupTime = String((new Date()) - startTime) + "ms";
			} else {
				nPlugins--;
			}
		} else {
			p.warning = true;
		}
	}
	return nLoaded != nPlugins;
}

function getPluginInfo(tiddler)
{
	var p = store.getTiddlerSlices(tiddler.title,["Name","Description","Version","Requires","CoreVersion","Date","Source","Author","License","Browsers"]);
	p.tiddler = tiddler;
	p.title = tiddler.title;
	p.log = [];
	return p;
}

// Check that a particular plugin is valid for execution
function isPluginExecutable(plugin)
{
	if(plugin.tiddler.isTagged("systemConfigForce")) {
		plugin.log.push(config.messages.pluginForced);
		return true;
	}
	if(plugin["CoreVersion"]) {
		var coreVersion = plugin["CoreVersion"].split(".");
		var w = parseInt(coreVersion[0],10) - version.major;
		if(w == 0 && coreVersion[1])
			w = parseInt(coreVersion[1],10) - version.minor;
		if(w == 0 && coreVersion[2])
			w = parseInt(coreVersion[2],10) - version.revision;
		if(w > 0) {
			plugin.log.push(config.messages.pluginVersionError);
			return false;
		}
	}
	return true;
}

function isPluginEnabled(plugin)
{
	if(plugin.tiddler.isTagged("systemConfigDisable")) {
		plugin.log.push(config.messages.pluginDisabled);
		return false;
	}
	return true;
}

function invokeMacro(place,macro,params,wikifier,tiddler)
{
	try {
		var m = config.macros[macro];
		if(m && m.handler) {
			var tiddlerElem = story.findContainingTiddler(place);
			window.tiddler = tiddlerElem ? store.getTiddler(tiddlerElem.getAttribute("tiddler")) : null;
			window.place = place;
			m.handler(place,macro,params.readMacroParams(),wikifier,params,tiddler);
		} else {
			createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,config.messages.missingMacro]));
		}
	} catch(ex) {
		createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,ex.toString()]));
	}
}

//--
//-- Paramifiers
//--

function getParameters()
{
	var p = null;
	if(window.location.hash) {
		p = decodeURIComponent(window.location.hash.substr(1));
		if(config.browser.firefoxDate != null && config.browser.firefoxDate[1] < "20051111")
			p = convertUTF8ToUnicode(p);
	}
	return p;
}

function invokeParamifier(params,handler)
{
	if(!params || params.length == undefined || params.length <= 1)
		return;
	for(var i=1; i<params.length; i++) {
		var p = config.paramifiers[params[i].name];
		if(p && p[handler] instanceof Function)
			p[handler](params[i].value);
		else {
			var h = config.optionHandlers[params[i].name.substr(0,3)];
			if(h && h.set instanceof Function)
				h.set(params[i].name,params[i].value);
		}
	}
}

config.paramifiers = {};

config.paramifiers.start = {
	oninit: function(v) {
		safeMode = v.toLowerCase() == "safe";
	}
};

config.paramifiers.open = {
	onstart: function(v) {
		if(!readOnly || store.tiddlerExists(v) || store.isShadowTiddler(v))
			story.displayTiddler("bottom",v,null,false,null);
	}
};

config.paramifiers.story = {
	onstart: function(v) {
		var list = store.getTiddlerText(v,"").parseParams("open",null,false);
		invokeParamifier(list,"onstart");
	}
};

config.paramifiers.search = {
	onstart: function(v) {
		story.search(v,false,false);
	}
};

config.paramifiers.searchRegExp = {
	onstart: function(v) {
		story.prototype.search(v,false,true);
	}
};

config.paramifiers.tag = {
	onstart: function(v) {
		story.displayTiddlers(null,store.filterTiddlers("[tag["+v+"]]"),null,false,null);
	}
};

config.paramifiers.newTiddler = {
	onstart: function(v) {
		if(!readOnly) {
			story.displayTiddler(null,v,DEFAULT_EDIT_TEMPLATE);
			story.focusTiddler(v,"text");
		}
	}
};

config.paramifiers.newJournal = {
	onstart: function(v) {
		if(!readOnly) {
			var now = new Date();
			var title = now.formatString(v.trim());
			story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE);
			story.focusTiddler(title,"text");
		}
	}
};

config.paramifiers.readOnly = {
	onconfig: function(v) {
		var p = v.toLowerCase();
		readOnly = p == "yes" ? true : (p == "no" ? false : readOnly);
	}
};

config.paramifiers.theme = {
	onconfig: function(v) {
		story.switchTheme(v);
	}
};

config.paramifiers.upgrade = {
	onstart: function(v) {
		upgradeFrom(v);
	}
};

config.paramifiers.recent= {
	onstart: function(v) {
		var titles=[];
		var tiddlers=store.getTiddlers("modified","excludeLists").reverse();
		for(var i=0; i<v && i<tiddlers.length; i++)
			titles.push(tiddlers[i].title);
		story.displayTiddlers(null,titles);
	}
};

config.paramifiers.filter = {
	onstart: function(v) {
		story.displayTiddlers(null,store.filterTiddlers(v),null,false);
	}
};

//--
//-- Formatter helpers
//--

function Formatter(formatters)
{
	this.formatters = [];
	var pattern = [];
	for(var n=0; n<formatters.length; n++) {
		pattern.push("(" + formatters[n].match + ")");
		this.formatters.push(formatters[n]);
	}
	this.formatterRegExp = new RegExp(pattern.join("|"),"mg");
}

config.formatterHelpers = {

	createElementAndWikify: function(w)
	{
		w.subWikifyTerm(createTiddlyElement(w.output,this.element),this.termRegExp);
	},

	inlineCssHelper: function(w)
	{
		var styles = [];
		config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			var s,v;
			if(lookaheadMatch[1]) {
				s = lookaheadMatch[1].unDash();
				v = lookaheadMatch[2];
			} else {
				s = lookaheadMatch[3].unDash();
				v = lookaheadMatch[4];
			}
			if(s=="bgcolor")
				s = "backgroundColor";
			styles.push({style: s, value: v});
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
			config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
		}
		return styles;
	},

	applyCssHelper: function(e,styles)
	{
		for(var t=0; t< styles.length; t++) {
			try {
				e.style[styles[t].style] = styles[t].value;
			} catch (ex) {
			}
		}
	},

	enclosedTextHelper: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var text = lookaheadMatch[1];
			if(config.browser.isIE)
				text = text.replace(/\n/g,"\r");
			createTiddlyElement(w.output,this.element,null,null,text);
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
		}
	},

	isExternalLink: function(link)
	{
		if(store.tiddlerExists(link) || store.isShadowTiddler(link)) {
			return false;
		}
		var urlRegExp = new RegExp(config.textPrimitives.urlPattern,"mg");
		if(urlRegExp.exec(link)) {
			return true;
		}
		if(link.indexOf(".")!=-1 || link.indexOf("\\")!=-1 || link.indexOf("/")!=-1 || link.indexOf("#")!=-1) {
			return true;
		}
		return false;
	}

};

//--
//-- Standard formatters
//--

config.formatters = [
{
	name: "table",
	match: "^\\|(?:[^\\n]*)\\|(?:[fhck]?)$",
	lookaheadRegExp: /^\|([^\n]*)\|([fhck]?)$/mg,
	rowTermRegExp: /(\|(?:[fhck]?)$\n?)/mg,
	cellRegExp: /(?:\|([^\n\|]*)\|)|(\|[fhck]?$\n?)/mg,
	cellTermRegExp: /((?:\x20*)\|)/mg,
	rowTypes: {"c":"caption", "h":"thead", "":"tbody", "f":"tfoot"},
	handler: function(w)
	{
		var table = createTiddlyElement(w.output,"table",null,"twtable");
		var prevColumns = [];
		var currRowType = null;
		var rowContainer;
		var rowCount = 0;
		w.nextMatch = w.matchStart;
		this.lookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			var nextRowType = lookaheadMatch[2];
			if(nextRowType == "k") {
				table.className = lookaheadMatch[1];
				w.nextMatch += lookaheadMatch[0].length+1;
			} else {
				if(nextRowType != currRowType) {
					rowContainer = createTiddlyElement(table,this.rowTypes[nextRowType]);
					currRowType = nextRowType;
				}
				if(currRowType == "c") {
					// Caption
					w.nextMatch++;
					if(rowContainer != table.firstChild)
						table.insertBefore(rowContainer,table.firstChild);
					rowContainer.setAttribute("align",rowCount == 0?"top":"bottom");
					w.subWikifyTerm(rowContainer,this.rowTermRegExp);
				} else {
					var theRow = createTiddlyElement(rowContainer,"tr",null,(rowCount&1)?"oddRow":"evenRow");
					theRow.onmouseover = function() {addClass(this,"hoverRow");};
					theRow.onmouseout = function() {removeClass(this,"hoverRow");};
					this.rowHandler(w,theRow,prevColumns);
					rowCount++;
				}
			}
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		}
	},
	rowHandler: function(w,e,prevColumns)
	{
		var col = 0;
		var colSpanCount = 1;
		var prevCell = null;
		this.cellRegExp.lastIndex = w.nextMatch;
		var cellMatch = this.cellRegExp.exec(w.source);
		while(cellMatch && cellMatch.index == w.nextMatch) {
			if(cellMatch[1] == "~") {
				// Rowspan
				var last = prevColumns[col];
				if(last) {
					last.rowSpanCount++;
					last.element.setAttribute("rowspan",last.rowSpanCount);
					last.element.setAttribute("rowSpan",last.rowSpanCount); // Needed for IE
					last.element.valign = "center";
				}
				w.nextMatch = this.cellRegExp.lastIndex-1;
			} else if(cellMatch[1] == ">") {
				// Colspan
				colSpanCount++;
				w.nextMatch = this.cellRegExp.lastIndex-1;
			} else if(cellMatch[2]) {
				// End of row
				if(prevCell && colSpanCount > 1) {
					prevCell.setAttribute("colspan",colSpanCount);
					prevCell.setAttribute("colSpan",colSpanCount); // Needed for IE
				}
				w.nextMatch = this.cellRegExp.lastIndex;
				break;
			} else {
				// Cell
				w.nextMatch++;
				var styles = config.formatterHelpers.inlineCssHelper(w);
				var spaceLeft = false;
				var chr = w.source.substr(w.nextMatch,1);
				while(chr == " ") {
					spaceLeft = true;
					w.nextMatch++;
					chr = w.source.substr(w.nextMatch,1);
				}
				var cell;
				if(chr == "!") {
					cell = createTiddlyElement(e,"th");
					w.nextMatch++;
				} else {
					cell = createTiddlyElement(e,"td");
				}
				prevCell = cell;
				prevColumns[col] = {rowSpanCount:1,element:cell};
				if(colSpanCount > 1) {
					cell.setAttribute("colspan",colSpanCount);
					cell.setAttribute("colSpan",colSpanCount); // Needed for IE
					colSpanCount = 1;
				}
				config.formatterHelpers.applyCssHelper(cell,styles);
				w.subWikifyTerm(cell,this.cellTermRegExp);
				if(w.matchText.substr(w.matchText.length-2,1) == " ") // spaceRight
					cell.align = spaceLeft ? "center" : "left";
				else if(spaceLeft)
					cell.align = "right";
				w.nextMatch--;
			}
			col++;
			this.cellRegExp.lastIndex = w.nextMatch;
			cellMatch = this.cellRegExp.exec(w.source);
		}
	}
},

{
	name: "heading",
	match: "^!{1,6}",
	termRegExp: /(\n)/mg,
	handler: function(w)
	{
		w.subWikifyTerm(createTiddlyElement(w.output,"h" + w.matchLength),this.termRegExp);
	}
},

{
	name: "list",
	match: "^(?:[\\*#;:]+)",
	lookaheadRegExp: /^(?:(?:(\*)|(#)|(;)|(:))+)/mg,
	termRegExp: /(\n)/mg,
	handler: function(w)
	{
		var stack = [w.output];
		var currLevel = 0, currType = null;
		var listLevel, listType, itemType, baseType;
		w.nextMatch = w.matchStart;
		this.lookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			if(lookaheadMatch[1]) {
				listType = "ul";
				itemType = "li";
			} else if(lookaheadMatch[2]) {
				listType = "ol";
				itemType = "li";
			} else if(lookaheadMatch[3]) {
				listType = "dl";
				itemType = "dt";
			} else if(lookaheadMatch[4]) {
				listType = "dl";
				itemType = "dd";
			}
			if(!baseType)
				baseType = listType;
			listLevel = lookaheadMatch[0].length;
			w.nextMatch += lookaheadMatch[0].length;
			var t;
			if(listLevel > currLevel) {
				for(t=currLevel; t<listLevel; t++) {
					var target = (currLevel == 0) ? stack[stack.length-1] : stack[stack.length-1].lastChild;
					stack.push(createTiddlyElement(target,listType));
				}
			} else if(listType!=baseType && listLevel==1) {
				w.nextMatch -= lookaheadMatch[0].length;
				return;
			} else if(listLevel < currLevel) {
				for(t=currLevel; t>listLevel; t--)
					stack.pop();
			} else if(listLevel == currLevel && listType != currType) {
				stack.pop();
				stack.push(createTiddlyElement(stack[stack.length-1].lastChild,listType));
			}
			currLevel = listLevel;
			currType = listType;
			var e = createTiddlyElement(stack[stack.length-1],itemType);
			w.subWikifyTerm(e,this.termRegExp);
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		}
	}
},

{
	name: "quoteByBlock",
	match: "^<<<\\n",
	termRegExp: /(^<<<(\n|$))/mg,
	element: "blockquote",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "quoteByLine",
	match: "^>+",
	lookaheadRegExp: /^>+/mg,
	termRegExp: /(\n)/mg,
	element: "blockquote",
	handler: function(w)
	{
		var stack = [w.output];
		var currLevel = 0;
		var newLevel = w.matchLength;
		var t;
		do {
			if(newLevel > currLevel) {
				for(t=currLevel; t<newLevel; t++)
					stack.push(createTiddlyElement(stack[stack.length-1],this.element));
			} else if(newLevel < currLevel) {
				for(t=currLevel; t>newLevel; t--)
					stack.pop();
			}
			currLevel = newLevel;
			w.subWikifyTerm(stack[stack.length-1],this.termRegExp);
			createTiddlyElement(stack[stack.length-1],"br");
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
			var matched = lookaheadMatch && lookaheadMatch.index == w.nextMatch;
			if(matched) {
				newLevel = lookaheadMatch[0].length;
				w.nextMatch += lookaheadMatch[0].length;
			}
		} while(matched);
	}
},

{
	name: "rule",
	match: "^----+$\\n?|<hr ?/?>\\n?",
	handler: function(w)
	{
		createTiddlyElement(w.output,"hr");
	}
},

{
	name: "monospacedByLine",
	match: "^(?:/\\*\\{\\{\\{\\*/|\\{\\{\\{|//\\{\\{\\{|<!--\\{\\{\\{-->)\\n",
	element: "pre",
	handler: function(w)
	{
		switch(w.matchText) {
		case "/*{{{*/\n": // CSS
			this.lookaheadRegExp = /\/\*\{\{\{\*\/\n*((?:^[^\n]*\n)+?)(\n*^\/\*\}\}\}\*\/$\n?)/mg;
			break;
		case "{{{\n": // monospaced block
			this.lookaheadRegExp = /^\{\{\{\n((?:^[^\n]*\n)+?)(^\}\}\}$\n?)/mg;
			break;
		case "//{{{\n": // plugin
			this.lookaheadRegExp = /^\/\/\{\{\{\n\n*((?:^[^\n]*\n)+?)(\n*^\/\/\}\}\}$\n?)/mg;
			break;
		case "<!--{{{-->\n": //template
			this.lookaheadRegExp = /<!--\{\{\{-->\n*((?:^[^\n]*\n)+?)(\n*^<!--\}\}\}-->$\n?)/mg;
			break;
		default:
			break;
		}
		config.formatterHelpers.enclosedTextHelper.call(this,w);
	}
},

{
	name: "wikifyComment",
	match: "^(?:/\\*\\*\\*|<!---)\\n",
	handler: function(w)
	{
		var termRegExp = (w.matchText == "/***\n") ? (/(^\*\*\*\/\n)/mg) : (/(^--->\n)/mg);
		w.subWikifyTerm(w.output,termRegExp);
	}
},

{
	name: "macro",
	match: "<<",
	lookaheadRegExp: /<<([^>\s]+)(?:\s*)((?:[^>]|(?:>(?!>)))*)>>/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart && lookaheadMatch[1]) {
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			invokeMacro(w.output,lookaheadMatch[1],lookaheadMatch[2],w,w.tiddler);
		}
	}
},

{
	name: "prettyLink",
	match: "\\[\\[",
	lookaheadRegExp: /\[\[(.*?)(?:\|(~)?(.*?))?\]\]/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var e;
			var text = lookaheadMatch[1];
			if(lookaheadMatch[3]) {
				// Pretty bracketted link
				var link = lookaheadMatch[3];
				e = (!lookaheadMatch[2] && config.formatterHelpers.isExternalLink(link)) ?
						createExternalLink(w.output,link) : createTiddlyLink(w.output,decodeURIComponent(link),false,null,w.isStatic,w.tiddler);
			} else {
				// Simple bracketted link
				e = createTiddlyLink(w.output,decodeURIComponent(text),false,null,w.isStatic,w.tiddler);
			}
			createTiddlyText(e,text);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "wikiLink",
	match: config.textPrimitives.unWikiLink+"?"+config.textPrimitives.wikiLink,
	handler: function(w)
	{
		if(w.matchText.substr(0,1) == config.textPrimitives.unWikiLink) {
			w.outputText(w.output,w.matchStart+1,w.nextMatch);
			return;
		}
		if(w.matchStart > 0) {
			var preRegExp = new RegExp(config.textPrimitives.anyLetterStrict,"mg");
			preRegExp.lastIndex = w.matchStart-1;
			var preMatch = preRegExp.exec(w.source);
			if(preMatch.index == w.matchStart-1) {
				w.outputText(w.output,w.matchStart,w.nextMatch);
				return;
			}
		}
		if(w.autoLinkWikiWords || store.isShadowTiddler(w.matchText)) {
			var link = createTiddlyLink(w.output,w.matchText,false,null,w.isStatic,w.tiddler);
			w.outputText(link,w.matchStart,w.nextMatch);
		} else {
			w.outputText(w.output,w.matchStart,w.nextMatch);
		}
	}
},

{
	name: "urlLink",
	match: config.textPrimitives.urlPattern,
	handler: function(w)
	{
		w.outputText(createExternalLink(w.output,w.matchText),w.matchStart,w.nextMatch);
	}
},

{
	name: "image",
	match: "\\[[<>]?[Ii][Mm][Gg]\\[",
	lookaheadRegExp: /\[([<]?)(>?)[Ii][Mm][Gg]\[(?:([^\|\]]+)\|)?([^\[\]\|]+)\](?:\[([^\]]*)\])?\]/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var e = w.output;
			if(lookaheadMatch[5]) {
				var link = lookaheadMatch[5];
				e = config.formatterHelpers.isExternalLink(link) ? createExternalLink(w.output,link) : createTiddlyLink(w.output,link,false,null,w.isStatic,w.tiddler);
				addClass(e,"imageLink");
			}
			var img = createTiddlyElement(e,"img");
			if(lookaheadMatch[1])
				img.align = "left";
			else if(lookaheadMatch[2])
				img.align = "right";
			if(lookaheadMatch[3]) {
				img.title = lookaheadMatch[3];
				img.setAttribute("alt",lookaheadMatch[3]);
			}
			img.src = lookaheadMatch[4];
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "html",
	match: "<[Hh][Tt][Mm][Ll]>",
	lookaheadRegExp: /<[Hh][Tt][Mm][Ll]>((?:.|\n)*?)<\/[Hh][Tt][Mm][Ll]>/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			createTiddlyElement(w.output,"span").innerHTML = lookaheadMatch[1];
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "commentByBlock",
	match: "/%",
	lookaheadRegExp: /\/%((?:.|\n)*?)%\//mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
			w.nextMatch = this.lookaheadRegExp.lastIndex;
	}
},

{
	name: "characterFormat",
	match: "''|//|__|\\^\\^|~~|--(?!\\s|$)|\\{\\{\\{",
	handler: function(w)
	{
		switch(w.matchText) {
		case "''":
			w.subWikifyTerm(w.output.appendChild(document.createElement("strong")),/('')/mg);
			break;
		case "//":
			w.subWikifyTerm(createTiddlyElement(w.output,"em"),/(\/\/)/mg);
			break;
		case "__":
			w.subWikifyTerm(createTiddlyElement(w.output,"u"),/(__)/mg);
			break;
		case "^^":
			w.subWikifyTerm(createTiddlyElement(w.output,"sup"),/(\^\^)/mg);
			break;
		case "~~":
			w.subWikifyTerm(createTiddlyElement(w.output,"sub"),/(~~)/mg);
			break;
		case "--":
			w.subWikifyTerm(createTiddlyElement(w.output,"strike"),/(--)/mg);
			break;
		case "{{{":
			var lookaheadRegExp = /\{\{\{((?:.|\n)*?)\}\}\}/mg;
			lookaheadRegExp.lastIndex = w.matchStart;
			var lookaheadMatch = lookaheadRegExp.exec(w.source);
			if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
				createTiddlyElement(w.output,"code",null,null,lookaheadMatch[1]);
				w.nextMatch = lookaheadRegExp.lastIndex;
			}
			break;
		}
	}
},

{
	name: "customFormat",
	match: "@@|\\{\\{",
	handler: function(w)
	{
		switch(w.matchText) {
		case "@@":
			var e = createTiddlyElement(w.output,"span");
			var styles = config.formatterHelpers.inlineCssHelper(w);
			if(styles.length == 0)
				e.className = "marked";
			else
				config.formatterHelpers.applyCssHelper(e,styles);
			w.subWikifyTerm(e,/(@@)/mg);
			break;
		case "{{":
			var lookaheadRegExp = /\{\{[\s]*([\w]+[\s\w]*)[\s]*\{(\n?)/mg;
			lookaheadRegExp.lastIndex = w.matchStart;
			var lookaheadMatch = lookaheadRegExp.exec(w.source);
			if(lookaheadMatch) {
				w.nextMatch = lookaheadRegExp.lastIndex;
				e = createTiddlyElement(w.output,lookaheadMatch[2] == "\n" ? "div" : "span",null,lookaheadMatch[1]);
				w.subWikifyTerm(e,/(\}\}\})/mg);
			}
			break;
		}
	}
},

{
	name: "mdash",
	match: "--",
	handler: function(w)
	{
		createTiddlyElement(w.output,"span").innerHTML = "&mdash;";
	}
},

{
	name: "lineBreak",
	match: "\\n|<br ?/?>",
	handler: function(w)
	{
		createTiddlyElement(w.output,"br");
	}
},

{
	name: "rawText",
	match: "\\\"{3}|<nowiki>",
	lookaheadRegExp: /(?:\"{3}|<nowiki>)((?:.|\n)*?)(?:\"{3}|<\/nowiki>)/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			createTiddlyElement(w.output,"span",null,null,lookaheadMatch[1]);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "htmlEntitiesEncoding",
	match: "(?:(?:&#?[a-zA-Z0-9]{2,8};|.)(?:&#?(?:x0*(?:3[0-6][0-9a-fA-F]|1D[c-fC-F][0-9a-fA-F]|20[d-fD-F][0-9a-fA-F]|FE2[0-9a-fA-F])|0*(?:76[89]|7[7-9][0-9]|8[0-7][0-9]|761[6-9]|76[2-7][0-9]|84[0-3][0-9]|844[0-7]|6505[6-9]|6506[0-9]|6507[0-1]));)+|&#?[a-zA-Z0-9]{2,8};)",
	handler: function(w)
	{
		createTiddlyElement(w.output,"span").innerHTML = w.matchText;
	}
}

];

//--
//-- Wikifier
//--

function getParser(tiddler,format)
{
	if(tiddler) {
		if(!format)
			format = tiddler.fields["wikiformat"];
		var i;
		if(format) {
			for(i in config.parsers) {
				if(format == config.parsers[i].format)
					return config.parsers[i];
			}
		} else {
			for(i in config.parsers) {
				if(tiddler.isTagged(config.parsers[i].formatTag))
					return config.parsers[i];
			}
		}
	}
	return formatter;
}

function wikify(source,output,highlightRegExp,tiddler)
{
	if(source) {
		var wikifier = new Wikifier(source,getParser(tiddler),highlightRegExp,tiddler);
		var t0 = new Date();
		wikifier.subWikify(output);
		if(tiddler && config.options.chkDisplayInstrumentation)
			displayMessage("wikify:" +tiddler.title+ " in " + (new Date()-t0) + " ms");
	}
}

function wikifyStatic(source,highlightRegExp,tiddler,format)
{
	var e = createTiddlyElement(document.body,"pre");
	e.style.display = "none";
	var html = "";
	if(source && source != "") {
		if(!tiddler)
			tiddler = new Tiddler("temp");
		var wikifier = new Wikifier(source,getParser(tiddler,format),highlightRegExp,tiddler);
		wikifier.isStatic = true;
		wikifier.subWikify(e);
		html = e.innerHTML;
		removeNode(e);
	}
	return html;
}

function wikifyPlain(title,theStore,limit)
{
	if(!theStore)
		theStore = store;
	if(theStore.tiddlerExists(title) || theStore.isShadowTiddler(title)) {
		return wikifyPlainText(theStore.getTiddlerText(title),limit,tiddler);
	} else {
		return "";
	}
}

function wikifyPlainText(text,limit,tiddler)
{
	if(limit > 0)
		text = text.substr(0,limit);
	var wikifier = new Wikifier(text,formatter,null,tiddler);
	return wikifier.wikifyPlain();
}

function highlightify(source,output,highlightRegExp,tiddler)
{
	if(source) {
		var wikifier = new Wikifier(source,formatter,highlightRegExp,tiddler);
		wikifier.outputText(output,0,source.length);
	}
}

function Wikifier(source,formatter,highlightRegExp,tiddler)
{
	this.source = source;
	this.output = null;
	this.formatter = formatter;
	this.nextMatch = 0;
	this.autoLinkWikiWords = tiddler && tiddler.autoLinkWikiWords() == false ? false : true;
	this.highlightRegExp = highlightRegExp;
	this.highlightMatch = null;
	this.isStatic = false;
	if(highlightRegExp) {
		highlightRegExp.lastIndex = 0;
		this.highlightMatch = highlightRegExp.exec(source);
	}
	this.tiddler = tiddler;
}

Wikifier.prototype.wikifyPlain = function()
{
	var e = createTiddlyElement(document.body,"div");
	e.style.display = "none";
	this.subWikify(e);
	var text = getPlainText(e);
	removeNode(e);
	return text;
};

Wikifier.prototype.subWikify = function(output,terminator)
{
	try {
		if(terminator)
			this.subWikifyTerm(output,new RegExp("(" + terminator + ")","mg"));
		else
			this.subWikifyUnterm(output);
	} catch(ex) {
		showException(ex);
	}
};

Wikifier.prototype.subWikifyUnterm = function(output)
{
	var oldOutput = this.output;
	this.output = output;
	this.formatter.formatterRegExp.lastIndex = this.nextMatch;
	var formatterMatch = this.formatter.formatterRegExp.exec(this.source);
	while(formatterMatch) {
		// Output any text before the match
		if(formatterMatch.index > this.nextMatch)
			this.outputText(this.output,this.nextMatch,formatterMatch.index);
		// Set the match parameters for the handler
		this.matchStart = formatterMatch.index;
		this.matchLength = formatterMatch[0].length;
		this.matchText = formatterMatch[0];
		this.nextMatch = this.formatter.formatterRegExp.lastIndex;
		for(var t=1; t<formatterMatch.length; t++) {
			if(formatterMatch[t]) {
				this.formatter.formatters[t-1].handler(this);
				this.formatter.formatterRegExp.lastIndex = this.nextMatch;
				break;
			}
		}
		formatterMatch = this.formatter.formatterRegExp.exec(this.source);
	}
	if(this.nextMatch < this.source.length) {
		this.outputText(this.output,this.nextMatch,this.source.length);
		this.nextMatch = this.source.length;
	}
	this.output = oldOutput;
};

Wikifier.prototype.subWikifyTerm = function(output,terminatorRegExp)
{
	var oldOutput = this.output;
	this.output = output;
	terminatorRegExp.lastIndex = this.nextMatch;
	var terminatorMatch = terminatorRegExp.exec(this.source);
	this.formatter.formatterRegExp.lastIndex = this.nextMatch;
	var formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);
	while(terminatorMatch || formatterMatch) {
		if(terminatorMatch && (!formatterMatch || terminatorMatch.index <= formatterMatch.index)) {
			if(terminatorMatch.index > this.nextMatch)
				this.outputText(this.output,this.nextMatch,terminatorMatch.index);
			this.matchText = terminatorMatch[1];
			this.matchLength = terminatorMatch[1].length;
			this.matchStart = terminatorMatch.index;
			this.nextMatch = this.matchStart + this.matchLength;
			this.output = oldOutput;
			return;
		}
		if(formatterMatch.index > this.nextMatch)
			this.outputText(this.output,this.nextMatch,formatterMatch.index);
		this.matchStart = formatterMatch.index;
		this.matchLength = formatterMatch[0].length;
		this.matchText = formatterMatch[0];
		this.nextMatch = this.formatter.formatterRegExp.lastIndex;
		for(var t=1; t<formatterMatch.length; t++) {
			if(formatterMatch[t]) {
				this.formatter.formatters[t-1].handler(this);
				this.formatter.formatterRegExp.lastIndex = this.nextMatch;
				break;
			}
		}
		terminatorRegExp.lastIndex = this.nextMatch;
		terminatorMatch = terminatorRegExp.exec(this.source);
		formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);
	}
	if(this.nextMatch < this.source.length) {
		this.outputText(this.output,this.nextMatch,this.source.length);
		this.nextMatch = this.source.length;
	}
	this.output = oldOutput;
};

Wikifier.prototype.outputText = function(place,startPos,endPos)
{
	while(this.highlightMatch && (this.highlightRegExp.lastIndex > startPos) && (this.highlightMatch.index < endPos) && (startPos < endPos)) {
		if(this.highlightMatch.index > startPos) {
			createTiddlyText(place,this.source.substring(startPos,this.highlightMatch.index));
			startPos = this.highlightMatch.index;
		}
		var highlightEnd = Math.min(this.highlightRegExp.lastIndex,endPos);
		var theHighlight = createTiddlyElement(place,"span",null,"highlight",this.source.substring(startPos,highlightEnd));
		startPos = highlightEnd;
		if(startPos >= this.highlightRegExp.lastIndex)
			this.highlightMatch = this.highlightRegExp.exec(this.source);
	}
	if(startPos < endPos) {
		createTiddlyText(place,this.source.substring(startPos,endPos));
	}
};

//--
//-- Macro definitions
//--

config.macros.today.handler = function(place,macroName,params)
{
	var now = new Date();
	var text = params[0] ? now.formatString(params[0].trim()) : now.toLocaleString();
	jQuery("<span/>").text(text).appendTo(place);
};

config.macros.version.handler = function(place)
{
	jQuery("<span/>").text(formatVersion()).appendTo(place);
};

config.macros.list.handler = function(place,macroName,params)
{
	var type = params[0] || "all";
	var list = document.createElement("ul");
	place.appendChild(list);
	if(this[type].prompt)
		createTiddlyElement(list,"li",null,"listTitle",this[type].prompt);
	var results;
	if(this[type].handler)
		results = this[type].handler(params);
	for(var t = 0; t < results.length; t++) {
		var li = document.createElement("li");
		list.appendChild(li);
		createTiddlyLink(li,typeof results[t] == "string" ? results[t] : results[t].title,true);
	}
};

config.macros.list.all.handler = function(params)
{
	return store.reverseLookup("tags","excludeLists",false,"title");
};

config.macros.list.missing.handler = function(params)
{
	return store.getMissingLinks();
};

config.macros.list.orphans.handler = function(params)
{
	return store.getOrphans();
};

config.macros.list.shadowed.handler = function(params)
{
	return store.getShadowed();
};

config.macros.list.touched.handler = function(params)
{
	return store.getTouched();
};

config.macros.list.filter.handler = function(params)
{
	var filter = params[1];
	var results = [];
	if(filter) {
		var tiddlers = store.filterTiddlers(filter);
		for(var t=0; t<tiddlers.length; t++)
			results.push(tiddlers[t].title);
	}
	return results;
};

config.macros.allTags.handler = function(place,macroName,params)
{
	var tags = store.getTags(params[0]);
	var ul = createTiddlyElement(place,"ul");
	if(tags.length == 0)
		createTiddlyElement(ul,"li",null,"listTitle",this.noTags);
	for(var t=0; t<tags.length; t++) {
		var title = tags[t][0];
		var info = getTiddlyLinkInfo(title);
		var li = createTiddlyElement(ul,"li");
		var btn = createTiddlyButton(li,title + " (" + tags[t][1] + ")",this.tooltip.format([title]),onClickTag,info.classes);
		btn.setAttribute("tag",title);
		btn.setAttribute("refresh","link");
		btn.setAttribute("tiddlyLink",title);
	}
};

config.macros.timeline.handler = function(place,macroName,params)
{
	var field = params[0] || "modified";
	var tiddlers = store.reverseLookup("tags","excludeLists",false,field);
	var lastDay = "";
	var last = params[1] ? tiddlers.length-Math.min(tiddlers.length,parseInt(params[1])) : 0;
	var dateFormat = params[2] || this.dateFormat;
	for(var t=tiddlers.length-1; t>=last; t--) {
		var tiddler = tiddlers[t];
		var theDay = tiddler[field].convertToLocalYYYYMMDDHHMM().substr(0,8);
		if(theDay != lastDay) {
			var ul = document.createElement("ul");
			place.appendChild(ul);
			createTiddlyElement(ul,"li",null,"listTitle",tiddler[field].formatString(dateFormat));
			lastDay = theDay;
		}
		createTiddlyElement(ul,"li",null,"listLink").appendChild(createTiddlyLink(place,tiddler.title,true));
	}
};

config.macros.tiddler.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("name",null,true,false,true);
	var names = params[0]["name"];
	var tiddlerName = names[0];
	var className = names[1] || null;
	var args = params[0]["with"];
	var wrapper = createTiddlyElement(place,"span",null,className);
	if(!args) {
		wrapper.setAttribute("refresh","content");
		wrapper.setAttribute("tiddler",tiddlerName);
	}
	var text = store.getTiddlerText(tiddlerName);
	if(text) {
		var stack = config.macros.tiddler.tiddlerStack;
		if(stack.indexOf(tiddlerName) !== -1)
			return;
		stack.push(tiddlerName);
		try {
			var n = args ? Math.min(args.length,9) : 0;
			for(var i=0; i<n; i++) {
				var placeholderRE = new RegExp("\\$" + (i + 1),"mg");
				text = text.replace(placeholderRE,args[i]);
			}
			config.macros.tiddler.renderText(wrapper,text,tiddlerName,params);
		} finally {
			stack.pop();
		}
	}
};

config.macros.tiddler.renderText = function(place,text,tiddlerName,params)
{
	wikify(text,place,null,store.getTiddler(tiddlerName));
};

config.macros.tiddler.tiddlerStack = [];

config.macros.tag.handler = function(place,macroName,params)
{
	createTagButton(place,params[0],null,params[1],params[2]);
};

config.macros.tags.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var ul = createTiddlyElement(place,"ul");
	var title = getParam(params,"anon","");
	if(title && store.tiddlerExists(title))
		tiddler = store.getTiddler(title);
	var sep = getParam(params,"sep"," ");
	var lingo = config.views.wikified.tag;
	var prompt = tiddler.tags.length == 0 ? lingo.labelNoTags : lingo.labelTags;
	createTiddlyElement(ul,"li",null,"listTitle",prompt.format([tiddler.title]));
	for(var t=0; t<tiddler.tags.length; t++) {
		createTagButton(createTiddlyElement(ul,"li"),tiddler.tags[t],tiddler.title);
		if(t<tiddler.tags.length-1)
			createTiddlyText(ul,sep);
	}
};

config.macros.tagging.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var ul = createTiddlyElement(place,"ul");
	var title = getParam(params,"anon","");
	if(title == "" && tiddler instanceof Tiddler)
		title = tiddler.title;
	var sep = getParam(params,"sep"," ");
	ul.setAttribute("title",this.tooltip.format([title]));
	var tagged = store.getTaggedTiddlers(title);
	var prompt = tagged.length == 0 ? this.labelNotTag : this.label;
	createTiddlyElement(ul,"li",null,"listTitle",prompt.format([title,tagged.length]));
	for(var t=0; t<tagged.length; t++) {
		createTiddlyLink(createTiddlyElement(ul,"li"),tagged[t].title,true);
		if(t<tagged.length-1)
			createTiddlyText(ul,sep);
	}
};

config.macros.closeAll.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.closeAll.onClick = function(e)
{
	story.closeAllTiddlers();
	return false;
};

config.macros.permaview.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.permaview.onClick = function(e)
{
	story.permaView();
	return false;
};

config.macros.saveChanges.handler = function(place,macroName,params)
{
	if(!readOnly)
		createTiddlyButton(place,params[0] || this.label,params[1] || this.prompt,this.onClick,null,null,this.accessKey);
};

config.macros.saveChanges.onClick = function(e)
{
	saveChanges();
	return false;
};

config.macros.slider.onClickSlider = function(ev)
{
	var e = ev || window.event;
	var n = this.nextSibling;
	var cookie = n.getAttribute("cookie");
	var isOpen = n.style.display != "none";
	if(config.options.chkAnimate && anim && typeof Slider == "function")
		anim.startAnimating(new Slider(n,!isOpen,null,"none"));
	else
		n.style.display = isOpen ? "none" : "block";
	config.options[cookie] = !isOpen;
	saveOptionCookie(cookie);
	return false;
};

config.macros.slider.createSlider = function(place,cookie,title,tooltip)
{
	var c = cookie || "";
	var btn = createTiddlyButton(place,title,tooltip,this.onClickSlider);
	var panel = createTiddlyElement(null,"div",null,"sliderPanel");
	panel.setAttribute("cookie",c);
	panel.style.display = config.options[c] ? "block" : "none";
	place.appendChild(panel);
	return panel;
};

config.macros.slider.handler = function(place,macroName,params)
{
	var panel = this.createSlider(place,params[0],params[2],params[3]);
	var text = store.getTiddlerText(params[1]);
	panel.setAttribute("refresh","content");
	panel.setAttribute("tiddler",params[1]);
	if(text)
		wikify(text,panel,null,store.getTiddler(params[1]));
};

// <<gradient [[tiddler name]] vert|horiz rgb rgb rgb rgb... >>
config.macros.gradient.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var panel = wikifier ? createTiddlyElement(place,"div",null,"gradient") : place;
	panel.style.position = "relative";
	panel.style.overflow = "hidden";
	panel.style.zIndex = "0";
	if(wikifier) {
		var styles = config.formatterHelpers.inlineCssHelper(wikifier);
		config.formatterHelpers.applyCssHelper(panel,styles);
	}
	params = paramString.parseParams("color");
	var locolors = [], hicolors = [];
	for(var t=2; t<params.length; t++) {
		var c = params[t].value;
		if(params[t].name == "snap") {
			hicolors[hicolors.length-1] = c;
		} else {
			locolors.push(c);
			hicolors.push(c);
		}
	}
	drawGradient(panel,params[1].value != "vert",locolors,hicolors);
	if(wikifier)
		wikifier.subWikify(panel,">>");
	if(document.all) {
		panel.style.height = "100%";
		panel.style.width = "100%";
	}
};

config.macros.message.handler = function(place,macroName,params)
{
	if(params[0]) {
		var names = params[0].split(".");
		var lookupMessage = function(root,nameIndex) {
				if(names[nameIndex] in root) {
					if(nameIndex < names.length-1)
						return (lookupMessage(root[names[nameIndex]],nameIndex+1));
					else
						return root[names[nameIndex]];
				} else
					return null;
			};
		var m = lookupMessage(config,0);
		if(m == null)
			m = lookupMessage(window,0);
		createTiddlyText(place,m.toString().format(params.splice(1)));
	}
};


config.macros.view.views = {
	text: function(value,place,params,wikifier,paramString,tiddler) {
		highlightify(value,place,highlightHack,tiddler);
	},
	link: function(value,place,params,wikifier,paramString,tiddler) {
		createTiddlyLink(place,value,true);
	},
	wikified: function(value,place,params,wikifier,paramString,tiddler) {
		if(params[2])
			value=params[2].unescapeLineBreaks().format([value]);
		wikify(value,place,highlightHack,tiddler);
	},
	date: function(value,place,params,wikifier,paramString,tiddler) {
		value = Date.convertFromYYYYMMDDHHMM(value);
		createTiddlyText(place,value.formatString(params[2] ? params[2] : config.views.wikified.dateFormat));
	}
};

config.macros.view.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if((tiddler instanceof Tiddler) && params[0]) {
		var value = store.getValue(tiddler,params[0]);
		if(value) {
			var type = params[1] || config.macros.view.defaultView;
			var handler = config.macros.view.views[type];
			if(handler)
				handler(value,place,params,wikifier,paramString,tiddler);
		}
	}
};

config.macros.edit.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var field = params[0];
	var rows = params[1] || 0;
	var defVal = params[2] || '';
	if((tiddler instanceof Tiddler) && field) {
		story.setDirty(tiddler.title,true);
		var e,v;
		if(field != "text" && !rows) {
			e = createTiddlyElement(null,"input");
			if(tiddler.isReadOnly())
				e.setAttribute("readOnly","readOnly");
			e.setAttribute("edit",field);
			e.setAttribute("type","text");
			e.value = store.getValue(tiddler,field) || defVal;
			e.setAttribute("size","40");
			e.setAttribute("autocomplete","off");
			place.appendChild(e);
		} else {
			var wrapper1 = createTiddlyElement(null,"fieldset",null,"fieldsetFix");
			var wrapper2 = createTiddlyElement(wrapper1,"div");
			e = createTiddlyElement(wrapper2,"textarea");
			if(tiddler.isReadOnly())
				e.setAttribute("readOnly","readOnly");
			e.value = v = store.getValue(tiddler,field) || defVal;
			rows = rows || 10;
			var lines = v.match(/\n/mg);
			var maxLines = Math.max(parseInt(config.options.txtMaxEditRows),5);
			if(lines != null && lines.length > rows)
				rows = lines.length + 5;
			rows = Math.min(rows,maxLines);
			e.setAttribute("rows",rows);
			e.setAttribute("edit",field);
			place.appendChild(wrapper1);
		}
		return e;
	}
};

config.macros.tagChooser.onClick = function(ev)
{
	var e = ev || window.event;
	var lingo = config.views.editor.tagChooser;
	var popup = Popup.create(this);
	var tags = store.getTags(this.getAttribute("tags"));
	if(tags.length == 0)
		jQuery("<li/>").text(lingo.popupNone).appendTo(jQuery(popup));
	for(var t=0; t<tags.length; t++) {
		var tag = createTiddlyButton(createTiddlyElement(popup,"li"),tags[t][0],lingo.tagTooltip.format([tags[t][0]]),config.macros.tagChooser.onTagClick);
		tag.setAttribute("tag",tags[t][0]);
		tag.setAttribute("tiddler",this.getAttribute("tiddler"));
	}
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
};

config.macros.tagChooser.onTagClick = function(ev)
{
	var e = ev || window.event;
	if(e.metaKey || e.ctrlKey) stopEvent(e); //# keep popup open on CTRL-click
	var tag = this.getAttribute("tag");
	var title = this.getAttribute("tiddler");
	if(!readOnly)
		story.setTiddlerTag(title,tag,0);
	return false;
};

config.macros.tagChooser.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(tiddler instanceof Tiddler) {
		var lingo = config.views.editor.tagChooser;
		var btn = createTiddlyButton(place,lingo.text,lingo.tooltip,this.onClick);
		btn.setAttribute("tiddler",tiddler.title);
		btn.setAttribute("tags",params[0]);
	}
};

config.macros.refreshDisplay.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.refreshDisplay.onClick = function(e)
{
	refreshAll();
	return false;
};

config.macros.annotations.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var title = tiddler ? tiddler.title : null;
	var a = title ? config.annotations[title] : null;
	if(!tiddler || !title || !a)
		return;
	var text = a.format([title]);
	wikify(text,createTiddlyElement(place,"div",null,"annotation"),null,tiddler);
};

//--
//-- NewTiddler and NewJournal macros
//--

config.macros.newTiddler.createNewTiddlerButton = function(place,title,params,label,prompt,accessKey,newFocus,isJournal)
{
	var tags = [];
	for(var t=1; t<params.length; t++) {
		if((params[t].name == "anon" && t != 1) || (params[t].name == "tag"))
			tags.push(params[t].value);
	}
	label = getParam(params,"label",label);
	prompt = getParam(params,"prompt",prompt);
	accessKey = getParam(params,"accessKey",accessKey);
	newFocus = getParam(params,"focus",newFocus);
	var customFields = getParam(params,"fields","");
	if(!customFields && !store.isShadowTiddler(title))
		customFields = String.encodeHashMap(config.defaultCustomFields);
	var btn = createTiddlyButton(place,label,prompt,this.onClickNewTiddler,null,null,accessKey);
	btn.setAttribute("newTitle",title);
	btn.setAttribute("isJournal",isJournal ? "true" : "false");
	if(tags.length > 0)
		btn.setAttribute("params",tags.join("|"));
	btn.setAttribute("newFocus",newFocus);
	btn.setAttribute("newTemplate",getParam(params,"template",DEFAULT_EDIT_TEMPLATE));
	if(customFields !== "")
		btn.setAttribute("customFields",customFields);
	var text = getParam(params,"text");
	if(text !== undefined)
		btn.setAttribute("newText",text);
	return btn;
};

config.macros.newTiddler.onClickNewTiddler = function()
{
	var title = this.getAttribute("newTitle");
	if(this.getAttribute("isJournal") == "true") {
		title = new Date().formatString(title.trim());
	}
	var params = this.getAttribute("params");
	var tags = params ? params.split("|") : [];
	var focus = this.getAttribute("newFocus");
	var template = this.getAttribute("newTemplate");
	var customFields = this.getAttribute("customFields");
	if(!customFields && !store.isShadowTiddler(title))
		customFields = String.encodeHashMap(config.defaultCustomFields);
	story.displayTiddler(null,title,template,false,null,null);
	var tiddlerElem = story.getTiddler(title);
	if(customFields)
		story.addCustomFields(tiddlerElem,customFields);
	var text = this.getAttribute("newText");
	if(typeof text == "string" && story.getTiddlerField(title,"text"))
		story.getTiddlerField(title,"text").value = text.format([title]);
	for(var t=0;t<tags.length;t++)
		story.setTiddlerTag(title,tags[t],+1);
	story.focusTiddler(title,focus);
	return false;
};

config.macros.newTiddler.handler = function(place,macroName,params,wikifier,paramString)
{
	if(!readOnly) {
		params = paramString.parseParams("anon",null,true,false,false);
		var title = params[1] && params[1].name == "anon" ? params[1].value : this.title;
		title = getParam(params,"title",title);
		this.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,"title",false);
	}
};

config.macros.newJournal.handler = function(place,macroName,params,wikifier,paramString)
{
	if(!readOnly) {
		params = paramString.parseParams("anon",null,true,false,false);
		var title = params[1] && params[1].name == "anon" ? params[1].value : config.macros.timeline.dateFormat;
		title = getParam(params,"title",title);
		config.macros.newTiddler.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,"text",true);
	}
};

//--
//-- Search macro
//--

config.macros.search.handler = function(place,macroName,params)
{
	var searchTimeout = null;
	var btn = createTiddlyButton(place,this.label,this.prompt,this.onClick,"searchButton");
	var txt = createTiddlyElement(null,"input",null,"txtOptionInput searchField");
	if(params[0])
		txt.value = params[0];
	if(config.browser.isSafari) {
		txt.setAttribute("type","search");
		txt.setAttribute("results","5");
	} else {
		txt.setAttribute("type","text");
	}
	place.appendChild(txt);
	txt.onkeyup = this.onKeyPress;
	txt.onfocus = this.onFocus;
	txt.setAttribute("size",this.sizeTextbox);
	txt.setAttribute("accessKey",params[1] || this.accessKey);
	txt.setAttribute("autocomplete","off");
	txt.setAttribute("lastSearchText","");
};

// Global because there's only ever one outstanding incremental search timer
config.macros.search.timeout = null;

config.macros.search.doSearch = function(txt)
{
	if(txt.value.length > 0) {
		story.search(txt.value,config.options.chkCaseSensitiveSearch,config.options.chkRegExpSearch);
		txt.setAttribute("lastSearchText",txt.value);
	}
};

config.macros.search.onClick = function(e)
{
	config.macros.search.doSearch(this.nextSibling);
	return false;
};

config.macros.search.onKeyPress = function(ev)
{
	var e = ev || window.event;
	switch(e.keyCode) {
		case 13: // Ctrl-Enter
		case 10: // Ctrl-Enter on IE PC
			config.macros.search.doSearch(this);
			break;
		case 27: // Escape
			this.value = "";
			clearMessage();
			break;
	}
	if(config.options.chkIncrementalSearch) {
		if(this.value.length > 2) {
			if(this.value != this.getAttribute("lastSearchText")) {
				if(config.macros.search.timeout)
					clearTimeout(config.macros.search.timeout);
				var txt = this;
				config.macros.search.timeout = setTimeout(function() {config.macros.search.doSearch(txt);},500);
			}
		} else {
			if(config.macros.search.timeout)
				clearTimeout(config.macros.search.timeout);
		}
	}
};

config.macros.search.onFocus = function(e)
{
	this.select();
};

//--
//-- Tabs macro
//--

config.macros.tabs.handler = function(place,macroName,params)
{
	var cookie = params[0];
	var numTabs = (params.length-1)/3;
	var wrapper = createTiddlyElement(null,"div",null,"tabsetWrapper " + cookie);
	var tabset = createTiddlyElement(wrapper,"div",null,"tabset");
	tabset.setAttribute("cookie",cookie);
	var validTab = false;
	for(var t=0; t<numTabs; t++) {
		var label = params[t*3+1];
		var prompt = params[t*3+2];
		var content = params[t*3+3];
		var tab = createTiddlyButton(tabset,label,prompt,this.onClickTab,"tab tabUnselected");
		tab.setAttribute("tab",label);
		tab.setAttribute("content",content);
		tab.title = prompt;
		if(config.options[cookie] == label)
			validTab = true;
	}
	if(!validTab)
		config.options[cookie] = params[1];
	place.appendChild(wrapper);
	this.switchTab(tabset,config.options[cookie]);
};

config.macros.tabs.onClickTab = function(e)
{
	config.macros.tabs.switchTab(this.parentNode,this.getAttribute("tab"));
	return false;
};

config.macros.tabs.switchTab = function(tabset,tab)
{
	var cookie = tabset.getAttribute("cookie");
	var theTab = null;
	var nodes = tabset.childNodes;
	for(var t=0; t<nodes.length; t++) {
		if(nodes[t].getAttribute && nodes[t].getAttribute("tab") == tab) {
			theTab = nodes[t];
			theTab.className = "tab tabSelected";
		} else {
			nodes[t].className = "tab tabUnselected";
		}
	}
	if(theTab) {
		if(tabset.nextSibling && tabset.nextSibling.className == "tabContents")
			removeNode(tabset.nextSibling);
		var tabContent = createTiddlyElement(null,"div",null,"tabContents");
		tabset.parentNode.insertBefore(tabContent,tabset.nextSibling);
		var contentTitle = theTab.getAttribute("content");
		wikify(store.getTiddlerText(contentTitle),tabContent,null,store.getTiddler(contentTitle));
		if(cookie) {
			config.options[cookie] = tab;
			saveOptionCookie(cookie);
		}
	}
};

//--
//-- Tiddler toolbar
//--

// Create a toolbar command button
config.macros.toolbar.createCommand = function(place,commandName,tiddler,className)
{
	if(typeof commandName != "string") {
		var c = null;
		for(var t in config.commands) {
			if(config.commands[t] == commandName)
				c = t;
		}
		commandName = c;
	}
	if((tiddler instanceof Tiddler) && (typeof commandName == "string")) {
		var command = config.commands[commandName];
		if(command.isEnabled ? command.isEnabled(tiddler) : this.isCommandEnabled(command,tiddler)) {
			var text = command.getText ? command.getText(tiddler) : this.getCommandText(command,tiddler);
			var tooltip = command.getTooltip ? command.getTooltip(tiddler) : this.getCommandTooltip(command,tiddler);
			var cmd;
			switch(command.type) {
			case "popup":
				cmd = this.onClickPopup;
				break;
			case "command":
			default:
				cmd = this.onClickCommand;
				break;
			}
			var btn = createTiddlyButton(null,text,tooltip,cmd);
			btn.setAttribute("commandName",commandName);
			btn.setAttribute("tiddler",tiddler.title);
			if(className)
				jQuery(btn).addClass(className);
			place.appendChild(btn);
		}
	}
};

config.macros.toolbar.isCommandEnabled = function(command,tiddler)
{
	var title = tiddler.title;
	var ro = tiddler.isReadOnly();
	var shadow = store.isShadowTiddler(title) && !store.tiddlerExists(title);
	return (!ro || (ro && !command.hideReadOnly)) && !(shadow && command.hideShadow);
};

config.macros.toolbar.getCommandText = function(command,tiddler)
{
	return tiddler.isReadOnly() && command.readOnlyText || command.text;
};

config.macros.toolbar.getCommandTooltip = function(command,tiddler)
{
	return tiddler.isReadOnly() && command.readOnlyTooltip || command.tooltip;
};

config.macros.toolbar.onClickCommand = function(ev)
{
	var e = ev || window.event;
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	var command = config.commands[this.getAttribute("commandName")];
	return command.handler(e,this,this.getAttribute("tiddler"));
};

config.macros.toolbar.onClickPopup = function(ev)
{
	var e = ev || window.event;
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	var popup = Popup.create(this);
	var command = config.commands[this.getAttribute("commandName")];
	var title = this.getAttribute("tiddler");
	var tiddler = store.fetchTiddler(title);
	popup.setAttribute("tiddler",title);
	command.handlePopup(popup,title);
	Popup.show();
	return false;
};

// Invoke the first command encountered from a given place that is tagged with a specified class
config.macros.toolbar.invokeCommand = function(place,className,event)
{
	var children = place.getElementsByTagName("a");
	for(var t=0; t<children.length; t++) {
		var c = children[t];
		if(hasClass(c,className) && c.getAttribute && c.getAttribute("commandName")) {
			if(c.onclick instanceof Function)
				c.onclick.call(c,event);
			break;
		}
	}
};

config.macros.toolbar.onClickMore = function(ev)
{
	var e = this.nextSibling;
	e.style.display = "inline";
	this.style.display = "none";
	return false;
};

config.macros.toolbar.onClickLess = function(ev)
{
	var e = this.parentNode;
	var m = e.previousSibling;
	e.style.display = "none";
	m.style.display = "inline";
	return false;
};

config.macros.toolbar.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	for(var t=0; t<params.length; t++) {
		var c = params[t];
		switch(c) {
		case "!":
			createTiddlyText(place,this.separator);
			break;
		case "*":
			createTiddlyElement(place,"br");
			break;
		case "<":
			var btn = createTiddlyButton(place,this.lessLabel,this.lessPrompt,config.macros.toolbar.onClickLess);
			jQuery(btn).addClass("lessCommand");
			break;
		case ">":
			var btn = createTiddlyButton(place,this.moreLabel,this.morePrompt,config.macros.toolbar.onClickMore);
			jQuery(btn).addClass("moreCommand");
			var e = createTiddlyElement(place,"span",null,"moreCommand");
			e.style.display = "none";
			place = e;
			break;
		default:
			var className = "";
			switch(c.substr(0,1)) {
			case "+":
				className = "defaultCommand";
				c = c.substr(1);
				break;
			case "-":
				className = "cancelCommand";
				c = c.substr(1);
				break;
			}
			if(c in config.commands)
				this.createCommand(place,c,tiddler,className);
			break;
		}
	}
};

//--
//-- Menu and toolbar commands
//--

config.commands.closeTiddler.handler = function(event,src,title)
{
	if(story.isDirty(title) && !readOnly) {
		if(!confirm(config.commands.cancelTiddler.warning.format([title])))
			return false;
	}
	story.setDirty(title,false);
	story.closeTiddler(title,true);
	return false;
};

config.commands.closeOthers.handler = function(event,src,title)
{
	story.closeAllTiddlers(title);
	return false;
};

config.commands.editTiddler.handler = function(event,src,title)
{
	clearMessage();
	var tiddlerElem = story.getTiddler(title);
	var fields = tiddlerElem.getAttribute("tiddlyFields");
	story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE,false,null,fields);
	story.focusTiddler(title,config.options.txtEditorFocus||"text");
	return false;
};

config.commands.saveTiddler.handler = function(event,src,title)
{
	var newTitle = story.saveTiddler(title,event.shiftKey);
	if(newTitle)
		story.displayTiddler(null,newTitle);
	return false;
};

config.commands.cancelTiddler.handler = function(event,src,title)
{
	if(story.hasChanges(title) && !readOnly) {
		if(!confirm(this.warning.format([title])))
			return false;
	}
	story.setDirty(title,false);
	story.displayTiddler(null,title);
	return false;
};

config.commands.deleteTiddler.handler = function(event,src,title)
{
	var deleteIt = true;
	if(config.options.chkConfirmDelete)
		deleteIt = confirm(this.warning.format([title]));
	if(deleteIt) {
		store.removeTiddler(title);
		story.closeTiddler(title,true);
		autoSaveChanges();
	}
	return false;
};

config.commands.permalink.handler = function(event,src,title)
{
	var t = encodeURIComponent(String.encodeTiddlyLink(title));
	if(window.location.hash != t)
		window.location.hash = t;
	return false;
};

config.commands.references.handlePopup = function(popup,title)
{
	var references = store.getReferringTiddlers(title);
	var c = false;
	for(var r=0; r<references.length; r++) {
		if(references[r].title != title && !references[r].isTagged("excludeLists")) {
			createTiddlyLink(createTiddlyElement(popup,"li"),references[r].title,true);
			c = true;
		}
	}
	if(!c)
		createTiddlyElement(popup,"li",null,"disabled",this.popupNone);
};

config.commands.jump.handlePopup = function(popup,title)
{
	story.forEachTiddler(function(title,element) {
		createTiddlyLink(createTiddlyElement(popup,"li"),title,true,null,false,null,true);
		});
};

config.commands.syncing.handlePopup = function(popup,title)
{
	var tiddler = store.fetchTiddler(title);
	if(!tiddler)
		return;
	var serverType = tiddler.getServerType();
	var serverHost = tiddler.fields["server.host"];
	var serverWorkspace = tiddler.fields["server.workspace"];
	if(!serverWorkspace)
		serverWorkspace = "";
	if(serverType) {
		var e = createTiddlyElement(popup,"li",null,"popupMessage");
		e.innerHTML = config.commands.syncing.currentlySyncing.format([serverType,serverHost,serverWorkspace]);
	} else {
		createTiddlyElement(popup,"li",null,"popupMessage",config.commands.syncing.notCurrentlySyncing);
	}
	if(serverType) {
		createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
		var btn = createTiddlyButton(createTiddlyElement(popup,"li"),this.captionUnSync,null,config.commands.syncing.onChooseServer);
		btn.setAttribute("tiddler",title);
		btn.setAttribute("server.type","");
	}
	createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
	createTiddlyElement(popup,"li",null,"popupMessage",config.commands.syncing.chooseServer);
	var feeds = store.getTaggedTiddlers("systemServer","title");
	for(var t=0; t<feeds.length; t++) {
		var f = feeds[t];
		var feedServerType = store.getTiddlerSlice(f.title,"Type");
		if(!feedServerType)
			feedServerType = "file";
		var feedServerHost = store.getTiddlerSlice(f.title,"URL");
		if(!feedServerHost)
			feedServerHost = "";
		var feedServerWorkspace = store.getTiddlerSlice(f.title,"Workspace");
		if(!feedServerWorkspace)
			feedServerWorkspace = "";
		var caption = f.title;
		if(serverType == feedServerType && serverHost == feedServerHost && serverWorkspace == feedServerWorkspace) {
			caption = config.commands.syncing.currServerMarker + caption;
		} else {
			caption = config.commands.syncing.notCurrServerMarker + caption;
		}
		btn = createTiddlyButton(createTiddlyElement(popup,"li"),caption,null,config.commands.syncing.onChooseServer);
		btn.setAttribute("tiddler",title);
		btn.setAttribute("server.type",feedServerType);
		btn.setAttribute("server.host",feedServerHost);
		btn.setAttribute("server.workspace",feedServerWorkspace);
	}
};

config.commands.syncing.onChooseServer = function(e)
{
	var tiddler = this.getAttribute("tiddler");
	var serverType = this.getAttribute("server.type");
	if(serverType) {
		store.addTiddlerFields(tiddler,{
			"server.type": serverType,
			"server.host": this.getAttribute("server.host"),
			"server.workspace": this.getAttribute("server.workspace")
			});
	} else {
		store.setValue(tiddler,"server",null);
	}
	return false;
};

config.commands.fields.handlePopup = function(popup,title)
{
	var tiddler = store.fetchTiddler(title);
	if(!tiddler)
		return;
	var items = [];
	store.forEachField(tiddler,function(tiddler,fieldName,value){items.push({field:fieldName,value:value});},true);
	items.sort(function(a,b) {return a.field < b.field ? -1 : (a.field == b.field ? 0 : +1);});
	if(items.length > 0)
		ListView.create(popup,items,this.listViewTemplate);
	else
		createTiddlyElement(popup,"div",null,null,this.emptyText);
};

//--
//-- Tiddler() object
//--

function Tiddler(title)
{
	this.title = title;
	this.text = "";
	this.modifier = null;
	this.created = new Date();
	this.modified = this.created;
	this.links = [];
	this.linksUpdated = false;
	this.tags = [];
	this.fields = {};
	return this;
}

Tiddler.prototype.getLinks = function()
{
	if(this.linksUpdated==false)
		this.changed();
	return this.links;
};

// Returns the fields that are inherited in string field:"value" field2:"value2" format
Tiddler.prototype.getInheritedFields = function()
{
	var f = {};
	for(var i in this.fields) {
		if(i=="server.host" || i=="server.workspace" || i=="wikiformat"|| i=="server.type") {
			f[i] = this.fields[i];
		}
	}
	return String.encodeHashMap(f);
};

// Increment the changeCount of a tiddler
Tiddler.prototype.incChangeCount = function()
{
	var c = this.fields['changecount'];
	c = c ? parseInt(c,10) : 0;
	this.fields['changecount'] = String(c+1);
};

// Clear the changeCount of a tiddler
Tiddler.prototype.clearChangeCount = function()
{
	if(this.fields['changecount']) {
		delete this.fields['changecount'];
	}
};

Tiddler.prototype.doNotSave = function()
{
	return this.fields['doNotSave'];
};

// Returns true if the tiddler has been updated since the tiddler was created or downloaded
Tiddler.prototype.isTouched = function()
{
	var changeCount = this.fields['changecount'];
	if(changeCount === undefined)
		changeCount = 0;
	return changeCount > 0;
};

// Change the text and other attributes of a tiddler
Tiddler.prototype.set = function(title,text,modifier,modified,tags,created,fields)
{
	this.assign(title,text,modifier,modified,tags,created,fields);
	this.changed();
	return this;
};

// Change the text and other attributes of a tiddler without triggered a tiddler.changed() call
Tiddler.prototype.assign = function(title,text,modifier,modified,tags,created,fields)
{
	if(title != undefined)
		this.title = title;
	if(text != undefined)
		this.text = text;
	if(modifier != undefined)
		this.modifier = modifier;
	if(modified != undefined)
		this.modified = modified;
	if(created != undefined)
		this.created = created;
	if(fields != undefined)
		this.fields = fields;
	if(tags != undefined)
		this.tags = (typeof tags == "string") ? tags.readBracketedList() : tags;
	else if(this.tags == undefined)
		this.tags = [];
	return this;
};

// Get the tags for a tiddler as a string (space delimited, using [[brackets]] for tags containing spaces)
Tiddler.prototype.getTags = function()
{
	return String.encodeTiddlyLinkList(this.tags);
};

// Test if a tiddler carries a tag
Tiddler.prototype.isTagged = function(tag)
{
	return this.tags.indexOf(tag) != -1;
};

// Static method to convert "\n" to newlines, "\s" to "\"
Tiddler.unescapeLineBreaks = function(text)
{
	return text ? text.unescapeLineBreaks() : "";
};

// Convert newlines to "\n", "\" to "\s"
Tiddler.prototype.escapeLineBreaks = function()
{
	return this.text.escapeLineBreaks();
};

// Updates the secondary information (like links[] array) after a change to a tiddler
Tiddler.prototype.changed = function()
{
	this.links = [];
	var text = this.text;
	// remove 'quoted' text before scanning tiddler source
	text = text.replace(/\/%((?:.|\n)*?)%\//g,"").
		replace(/\{{3}((?:.|\n)*?)\}{3}/g,"").
		replace(/"""((?:.|\n)*?)"""/g,"").
		replace(/\<nowiki\>((?:.|\n)*?)\<\/nowiki\>/g,"").
		replace(/\<html\>((?:.|\n)*?)\<\/html\>/g,"").
		replace(/\<script((?:.|\n)*?)\<\/script\>/g,"");
	var t = this.autoLinkWikiWords() ? 0 : 1;
	var tiddlerLinkRegExp = t==0 ? config.textPrimitives.tiddlerAnyLinkRegExp : config.textPrimitives.tiddlerForcedLinkRegExp;
	tiddlerLinkRegExp.lastIndex = 0;
	var formatMatch = tiddlerLinkRegExp.exec(text);
	while(formatMatch) {
		var lastIndex = tiddlerLinkRegExp.lastIndex;
		if(t==0 && formatMatch[1] && formatMatch[1] != this.title) {
			// wikiWordLink
			if(formatMatch.index > 0) {
				var preRegExp = new RegExp(config.textPrimitives.unWikiLink+"|"+config.textPrimitives.anyLetter,"mg");
				preRegExp.lastIndex = formatMatch.index-1;
				var preMatch = preRegExp.exec(text);
				if(preMatch.index != formatMatch.index-1)
					this.links.pushUnique(formatMatch[1]);
			} else {
				this.links.pushUnique(formatMatch[1]);
			}
		}
		else if(formatMatch[2-t] && !config.formatterHelpers.isExternalLink(formatMatch[3-t])) // titledBrackettedLink
			this.links.pushUnique(formatMatch[3-t]);
		else if(formatMatch[4-t] && formatMatch[4-t] != this.title) // brackettedLink
			this.links.pushUnique(formatMatch[4-t]);
		tiddlerLinkRegExp.lastIndex = lastIndex;
		formatMatch = tiddlerLinkRegExp.exec(text);
	}
	this.linksUpdated = true;
};

Tiddler.prototype.getSubtitle = function()
{
	var modifier = this.modifier;
	if(!modifier)
		modifier = config.messages.subtitleUnknown;
	var modified = this.modified;
	if(modified)
		modified = modified.toLocaleString();
	else
		modified = config.messages.subtitleUnknown;
	return config.messages.tiddlerLinkTooltip.format([this.title,modifier,modified]);
};

Tiddler.prototype.isReadOnly = function()
{
	return readOnly;
};

Tiddler.prototype.autoLinkWikiWords = function()
{
	return !(this.isTagged("systemConfig") || this.isTagged("excludeMissing"));
};

Tiddler.prototype.getServerType = function()
{
	var serverType = null;
	if(this.fields['server.type'])
		serverType = this.fields['server.type'];
	if(!serverType)
		serverType = this.fields['wikiformat'];
	if(serverType && !config.adaptors[serverType])
		serverType = null;
	return serverType;
};

Tiddler.prototype.getAdaptor = function()
{
	var serverType = this.getServerType();
	return serverType ? new config.adaptors[serverType]() : null;
};

//--
//-- TiddlyWiki() object contains Tiddler()s
//--

function TiddlyWiki()
{
	var tiddlers = {}; // Hashmap by name of tiddlers
	this.tiddlersUpdated = false;
	this.namedNotifications = []; // Array of {name:,notify:} of notification functions
	this.notificationLevel = 0;
	this.slices = {}; // map tiddlerName->(map sliceName->sliceValue). Lazy.
	this.clear = function() {
		tiddlers = {};
		this.setDirty(false);
	};
	this.fetchTiddler = function(title) {
		var t = tiddlers[title];
		return t instanceof Tiddler ? t : null;
	};
	this.deleteTiddler = function(title) {
		delete this.slices[title];
		delete tiddlers[title];
	};
	this.addTiddler = function(tiddler) {
		delete this.slices[tiddler.title];
		tiddlers[tiddler.title] = tiddler;
	};
	this.forEachTiddler = function(callback) {
		for(var t in tiddlers) {
			var tiddler = tiddlers[t];
			if(tiddler instanceof Tiddler)
				callback.call(this,t,tiddler);
		}
	};
}

TiddlyWiki.prototype.setDirty = function(dirty)
{
	this.dirty = dirty;
};

TiddlyWiki.prototype.isDirty = function()
{
	return this.dirty;
};

TiddlyWiki.prototype.tiddlerExists = function(title)
{
	var t = this.fetchTiddler(title);
	return t != undefined;
};

TiddlyWiki.prototype.isShadowTiddler = function(title)
{
	return config.shadowTiddlers[title] === undefined ? false : true;
};

TiddlyWiki.prototype.createTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(!tiddler) {
		tiddler = new Tiddler(title);
		this.addTiddler(tiddler);
		this.setDirty(true);
	}
	return tiddler;
};

TiddlyWiki.prototype.getTiddler = function(title)
{
	var t = this.fetchTiddler(title);
	if(t != undefined)
		return t;
	else
		return null;
};

TiddlyWiki.prototype.getShadowTiddlerText = function(title)
{
	if(typeof config.shadowTiddlers[title] == "string")
		return config.shadowTiddlers[title];
	else
		return "";
};

// Retrieve tiddler contents
TiddlyWiki.prototype.getTiddlerText = function(title,defaultText)
{
	if(!title)
		return defaultText;
	var pos = title.indexOf(config.textPrimitives.sectionSeparator);
	var section = null;
	if(pos != -1) {
		section = title.substr(pos + config.textPrimitives.sectionSeparator.length);
		title = title.substr(0,pos);
	}
	pos = title.indexOf(config.textPrimitives.sliceSeparator);
	if(pos != -1) {
		var slice = this.getTiddlerSlice(title.substr(0,pos),title.substr(pos + config.textPrimitives.sliceSeparator.length));
		if(slice)
			return slice;
	}
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		if(!section)
			return tiddler.text;
		var re = new RegExp("(^!{1,6}" + section.escapeRegExp() + "[ \t]*\n)","mg");
		re.lastIndex = 0;
		var match = re.exec(tiddler.text);
		if(match) {
			var t = tiddler.text.substr(match.index+match[1].length);
			var re2 = /^!/mg;
			re2.lastIndex = 0;
			match = re2.exec(t); //# search for the next heading
			if(match)
				t = t.substr(0,match.index-1);//# don't include final \n
			return t;
		}
		return defaultText;
	}
	if(this.isShadowTiddler(title))
		return this.getShadowTiddlerText(title);
	if(defaultText != undefined)
		return defaultText;
	return null;
};

TiddlyWiki.prototype.getRecursiveTiddlerText = function(title,defaultText,depth)
{
	var bracketRegExp = new RegExp("(?:\\[\\[([^\\]]+)\\]\\])","mg");
	var text = this.getTiddlerText(title,null);
	if(text == null)
		return defaultText;
	var textOut = [];
	var lastPos = 0;
	do {
		var match = bracketRegExp.exec(text);
		if(match) {
			textOut.push(text.substr(lastPos,match.index-lastPos));
			if(match[1]) {
				if(depth <= 0)
					textOut.push(match[1]);
				else
					textOut.push(this.getRecursiveTiddlerText(match[1],"[[" + match[1] + "]]",depth-1));
			}
			lastPos = match.index + match[0].length;
		} else {
			textOut.push(text.substr(lastPos));
		}
	} while(match);
	return textOut.join("");
};

TiddlyWiki.prototype.slicesRE = /(?:^([\'\/]{0,2})~?([\.\w]+)\:\1[\t\x20]*([^\n]+)[\t\x20]*$)|(?:^\|([\'\/]{0,2})~?([\.\w]+)\:?\4\|[\t\x20]*([^\n]+)[\t\x20]*\|$)/gm;

// @internal
TiddlyWiki.prototype.calcAllSlices = function(title)
{
	var slices = {};
	var text = this.getTiddlerText(title,"");
	this.slicesRE.lastIndex = 0;
	var m = this.slicesRE.exec(text);
	while(m) {
		if(m[2])
			slices[m[2]] = m[3];
		else
			slices[m[5]] = m[6];
		m = this.slicesRE.exec(text);
	}
	return slices;
};

// Returns the slice of text of the given name
TiddlyWiki.prototype.getTiddlerSlice = function(title,sliceName)
{
	var slices = this.slices[title];
	if(!slices) {
		slices = this.calcAllSlices(title);
		this.slices[title] = slices;
	}
	return slices[sliceName];
};

// Build an hashmap of the specified named slices of a tiddler
TiddlyWiki.prototype.getTiddlerSlices = function(title,sliceNames)
{
	var r = {};
	for(var t=0; t<sliceNames.length; t++) {
		var slice = this.getTiddlerSlice(title,sliceNames[t]);
		if(slice)
			r[sliceNames[t]] = slice;
	}
	return r;
};

TiddlyWiki.prototype.suspendNotifications = function()
{
	this.notificationLevel--;
};

TiddlyWiki.prototype.resumeNotifications = function()
{
	this.notificationLevel++;
};

// Invoke the notification handlers for a particular tiddler
TiddlyWiki.prototype.notify = function(title,doBlanket)
{
	if(!this.notificationLevel) {
		for(var t=0; t<this.namedNotifications.length; t++) {
			var n = this.namedNotifications[t];
			if((n.name == null && doBlanket) || (n.name == title))
				n.notify(title);
		}
	}
};

// Invoke the notification handlers for all tiddlers
TiddlyWiki.prototype.notifyAll = function()
{
	if(!this.notificationLevel) {
		for(var t=0; t<this.namedNotifications.length; t++) {
			var n = this.namedNotifications[t];
			if(n.name)
				n.notify(n.name);
		}
	}
};

// Add a notification handler to a tiddler
TiddlyWiki.prototype.addNotification = function(title,fn)
{
	for(var i=0; i<this.namedNotifications.length; i++) {
		if((this.namedNotifications[i].name == title) && (this.namedNotifications[i].notify == fn))
			return this;
	}
	this.namedNotifications.push({name: title, notify: fn});
	return this;
};

TiddlyWiki.prototype.removeTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		this.deleteTiddler(title);
		this.notify(title,true);
		this.setDirty(true);
	}
};

// Reset the sync status of a freshly synced tiddler
TiddlyWiki.prototype.resetTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		tiddler.clearChangeCount();
		this.notify(title,true);
		this.setDirty(true);
	}
};

TiddlyWiki.prototype.setTiddlerTag = function(title,status,tag)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		var t = tiddler.tags.indexOf(tag);
		if(t != -1)
			tiddler.tags.splice(t,1);
		if(status)
			tiddler.tags.push(tag);
		tiddler.changed();
		tiddler.incChangeCount();
		this.notify(title,true);
		this.setDirty(true);
	}
};

TiddlyWiki.prototype.addTiddlerFields = function(title,fields)
{
	var tiddler = this.fetchTiddler(title);
	if(!tiddler)
		return;
	merge(tiddler.fields,fields);
	tiddler.changed();
	tiddler.incChangeCount();
	this.notify(title,true);
	this.setDirty(true);
};

// Store tiddler in TiddlyWiki instance
TiddlyWiki.prototype.saveTiddler = function(title,newTitle,newBody,modifier,modified,tags,fields,clearChangeCount,created)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		created = created || tiddler.created; // Preserve created date
		this.deleteTiddler(title);
	} else {
		created = created || modified;
		tiddler = new Tiddler();
	}
	tiddler.set(newTitle,newBody,modifier,modified,tags,created,fields);
	this.addTiddler(tiddler);
	if(clearChangeCount)
		tiddler.clearChangeCount();
	else
		tiddler.incChangeCount();
	if(title != newTitle)
		this.notify(title,true);
	this.notify(newTitle,true);
	this.setDirty(true);
	return tiddler;
};

TiddlyWiki.prototype.incChangeCount = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler)
		tiddler.incChangeCount();
};

TiddlyWiki.prototype.getLoader = function()
{
	if(!this.loader)
		this.loader = new TW21Loader();
	return this.loader;
};

TiddlyWiki.prototype.getSaver = function()
{
	if(!this.saver)
		this.saver = new TW21Saver();
	return this.saver;
};

// Return all tiddlers formatted as an HTML string
TiddlyWiki.prototype.allTiddlersAsHtml = function()
{
	return this.getSaver().externalize(store);
};

// Load contents of a TiddlyWiki from an HTML DIV
TiddlyWiki.prototype.loadFromDiv = function(src,idPrefix,noUpdate)
{
	this.idPrefix = idPrefix;
	var storeElem = (typeof src == "string") ? document.getElementById(src) : src;
	if(!storeElem)
		return;
	var tiddlers = this.getLoader().loadTiddlers(this,storeElem.childNodes);
	this.setDirty(false);
	if(!noUpdate) {
		for(var i = 0;i<tiddlers.length; i++)
			tiddlers[i].changed();
	}
	jQuery().trigger("loadTiddlers");
};

// Load contents of a TiddlyWiki from a string
// Returns null if there's an error
TiddlyWiki.prototype.importTiddlyWiki = function(text)
{
	var posDiv = locateStoreArea(text);
	if(!posDiv)
		return null;
	var content = "<" + "html><" + "body>" + text.substring(posDiv[0],posDiv[1] + endSaveArea.length) + "<" + "/body><" + "/html>";
	// Create the iframe
	var iframe = document.createElement("iframe");
	iframe.style.display = "none";
	document.body.appendChild(iframe);
	var doc = iframe.document;
	if(iframe.contentDocument)
		doc = iframe.contentDocument; // For NS6
	else if(iframe.contentWindow)
		doc = iframe.contentWindow.document; // For IE5.5 and IE6
	// Put the content in the iframe
	doc.open();
	doc.writeln(content);
	doc.close();
	// Load the content into a TiddlyWiki() object
	var storeArea = doc.getElementById("storeArea");
	this.loadFromDiv(storeArea,"store");
	// Get rid of the iframe
	iframe.parentNode.removeChild(iframe);
	return this;
};

TiddlyWiki.prototype.updateTiddlers = function()
{
	this.tiddlersUpdated = true;
	this.forEachTiddler(function(title,tiddler) {
		tiddler.changed();
	});
};

// Return an array of tiddlers matching a search regular expression
TiddlyWiki.prototype.search = function(searchRegExp,sortField,excludeTag,match)
{
	var candidates = this.reverseLookup("tags",excludeTag,!!match);
	var results = [];
	for(var t=0; t<candidates.length; t++) {
		if((candidates[t].title.search(searchRegExp) != -1) || (candidates[t].text.search(searchRegExp) != -1))
			results.push(candidates[t]);
	}
	if(!sortField)
		sortField = "title";
	results.sort(function(a,b) {return a[sortField] < b[sortField] ? -1 : (a[sortField] == b[sortField] ? 0 : +1);});
	return results;
};

// Returns a list of all tags in use
//   excludeTag - if present, excludes tags that are themselves tagged with excludeTag
// Returns an array of arrays where [tag][0] is the name of the tag and [tag][1] is the number of occurances
TiddlyWiki.prototype.getTags = function(excludeTag)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		for(var g=0; g<tiddler.tags.length; g++) {
			var tag = tiddler.tags[g];
			var n = true;
			for(var c=0; c<results.length; c++) {
				if(results[c][0] == tag) {
					n = false;
					results[c][1]++;
				}
			}
			if(n && excludeTag) {
				var t = this.fetchTiddler(tag);
				if(t && t.isTagged(excludeTag))
					n = false;
			}
			if(n)
				results.push([tag,1]);
		}
	});
	results.sort(function(a,b) {return a[0].toLowerCase() < b[0].toLowerCase() ? -1 : (a[0].toLowerCase() == b[0].toLowerCase() ? 0 : +1);});
	return results;
};

// Return an array of the tiddlers that are tagged with a given tag
TiddlyWiki.prototype.getTaggedTiddlers = function(tag,sortField)
{
	return this.reverseLookup("tags",tag,true,sortField);
};

// Return an array of the tiddlers that link to a given tiddler
TiddlyWiki.prototype.getReferringTiddlers = function(title,unusedParameter,sortField)
{
	if(!this.tiddlersUpdated)
		this.updateTiddlers();
	return this.reverseLookup("links",title,true,sortField);
};

// Return an array of the tiddlers that do or do not have a specified entry in the specified storage array (ie, "links" or "tags")
// lookupMatch == true to match tiddlers, false to exclude tiddlers
TiddlyWiki.prototype.reverseLookup = function(lookupField,lookupValue,lookupMatch,sortField)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		var f = !lookupMatch;
		for(var lookup=0; lookup<tiddler[lookupField].length; lookup++) {
			if(tiddler[lookupField][lookup] == lookupValue)
				f = lookupMatch;
		}
		if(f)
			results.push(tiddler);
	});
	if(!sortField)
		sortField = "title";
	results.sort(function(a,b) {return a[sortField] < b[sortField] ? -1 : (a[sortField] == b[sortField] ? 0 : +1);});
	return results;
};

// Return the tiddlers as a sorted array
TiddlyWiki.prototype.getTiddlers = function(field,excludeTag)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		if(excludeTag == undefined || !tiddler.isTagged(excludeTag))
			results.push(tiddler);
	});
	if(field)
		results.sort(function(a,b) {return a[field] < b[field] ? -1 : (a[field] == b[field] ? 0 : +1);});
	return results;
};

// Return array of names of tiddlers that are referred to but not defined
TiddlyWiki.prototype.getMissingLinks = function(sortField)
{
	if(!this.tiddlersUpdated)
		this.updateTiddlers();
	var results = [];
	this.forEachTiddler(function (title,tiddler) {
		if(tiddler.isTagged("excludeMissing") || tiddler.isTagged("systemConfig"))
			return;
		for(var n=0; n<tiddler.links.length;n++) {
			var link = tiddler.links[n];
			if(this.fetchTiddler(link) == null && !this.isShadowTiddler(link))
				results.pushUnique(link);
		}
	});
	results.sort();
	return results;
};

// Return an array of names of tiddlers that are defined but not referred to
TiddlyWiki.prototype.getOrphans = function()
{
	var results = [];
	this.forEachTiddler(function (title,tiddler) {
		if(this.getReferringTiddlers(title).length == 0 && !tiddler.isTagged("excludeLists"))
			results.push(title);
	});
	results.sort();
	return results;
};

// Return an array of names of all the shadow tiddlers
TiddlyWiki.prototype.getShadowed = function()
{
	var results = [];
	for(var t in config.shadowTiddlers) {
		if(this.isShadowTiddler(t))
			results.push(t);
	}
	results.sort();
	return results;
};

// Return an array of tiddlers that have been touched since they were downloaded or created
TiddlyWiki.prototype.getTouched = function()
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		if(tiddler.isTouched())
			results.push(tiddler);
		});
	results.sort();
	return results;
};

// Resolves a Tiddler reference or tiddler title into a Tiddler object, or null if it doesn't exist
TiddlyWiki.prototype.resolveTiddler = function(tiddler)
{
	var t = (typeof tiddler == "string") ? this.getTiddler(tiddler) : tiddler;
	return t instanceof Tiddler ? t : null;
};

// Filter a list of tiddlers
TiddlyWiki.prototype.filterTiddlers = function(filter)
{
	var results = [];
	if(filter) {
		var tiddler;
		var re = /([^\s\[\]]+)|(?:\[([ \w]+)\[([^\]]+)\]\])|(?:\[\[([^\]]+)\]\])/mg;
		var match = re.exec(filter);
		while(match) {
			if(match[1] || match[4]) {
				var title = match[1] || match[4];
				tiddler = this.fetchTiddler(title);
				if(tiddler) {
					results.pushUnique(tiddler);
				} else if(this.isShadowTiddler(title)) {
					tiddler = new Tiddler();
					tiddler.set(title,this.getTiddlerText(title));
					results.pushUnique(tiddler);
				} else {
					results.pushUnique(new Tiddler(title));
				}
			} else if(match[2]) {
				switch(match[2]) {
					case "tag":
						var matched = this.getTaggedTiddlers(match[3]);
						for(var m = 0; m < matched.length; m++)
							results.pushUnique(matched[m]);
						break;
					case "sort":
						results = this.sortTiddlers(results,match[3]);
						break;
				}
			}
			match = re.exec(filter);
		}
	}
	return results;
};

// Sort a list of tiddlers
TiddlyWiki.prototype.sortTiddlers = function(tiddlers,field)
{
	var asc = +1;
	switch(field.substr(0,1)) {
	case "-":
		asc = -1;
		// Note: this fall-through is intentional
		/*jsl:fallthru*/
	case "+":
		field = field.substr(1);
		break;
	}
	if(TiddlyWiki.standardFieldAccess[field])
		tiddlers.sort(function(a,b) {return a[field] < b[field] ? -asc : (a[field] == b[field] ? 0 : asc);});
	else
		tiddlers.sort(function(a,b) {return a.fields[field] < b.fields[field] ? -asc : (a.fields[field] == b.fields[field] ? 0 : +asc);});
	return tiddlers;
};

// Returns true if path is a valid field name (path),
// i.e. a sequence of identifiers, separated by "."
TiddlyWiki.isValidFieldName = function(name)
{
	var match = /[a-zA-Z_]\w*(\.[a-zA-Z_]\w*)*/.exec(name);
	return match && (match[0] == name);
};

// Throws an exception when name is not a valid field name.
TiddlyWiki.checkFieldName = function(name)
{
	if(!TiddlyWiki.isValidFieldName(name))
		throw config.messages.invalidFieldName.format([name]);
};

function StringFieldAccess(n,readOnly)
{
	this.set = readOnly ?
			function(t,v) {if(v != t[n]) throw config.messages.fieldCannotBeChanged.format([n]);} :
			function(t,v) {if(v != t[n]) {t[n] = v; return true;}};
	this.get = function(t) {return t[n];};
}

function DateFieldAccess(n)
{
	this.set = function(t,v) {
		var d = v instanceof Date ? v : Date.convertFromYYYYMMDDHHMM(v);
		if(d != t[n]) {
			t[n] = d; return true;
		}
	};
	this.get = function(t) {return t[n].convertToYYYYMMDDHHMM();};
}

function LinksFieldAccess(n)
{
	this.set = function(t,v) {
		var s = (typeof v == "string") ? v.readBracketedList() : v;
		if(s.toString() != t[n].toString()) {
			t[n] = s; return true;
		}
	};
	this.get = function(t) {return String.encodeTiddlyLinkList(t[n]);};
}

TiddlyWiki.standardFieldAccess = {
	// The set functions return true when setting the data has changed the value.
	"title":    new StringFieldAccess("title",true),
	// Handle the "tiddler" field name as the title
	"tiddler":  new StringFieldAccess("title",true),
	"text":     new StringFieldAccess("text"),
	"modifier": new StringFieldAccess("modifier"),
	"modified": new DateFieldAccess("modified"),
	"created":  new DateFieldAccess("created"),
	"tags":     new LinksFieldAccess("tags")
};

TiddlyWiki.isStandardField = function(name)
{
	return TiddlyWiki.standardFieldAccess[name] != undefined;
};

// Sets the value of the given field of the tiddler to the value.
// Setting an ExtendedField's value to null or undefined removes the field.
// Setting a namespace to undefined removes all fields of that namespace.
// The fieldName is case-insensitive.
// All values will be converted to a string value.
TiddlyWiki.prototype.setValue = function(tiddler,fieldName,value)
{
	TiddlyWiki.checkFieldName(fieldName);
	var t = this.resolveTiddler(tiddler);
	if(!t)
		return;
	fieldName = fieldName.toLowerCase();
	var isRemove = (value === undefined) || (value === null);
	var accessor = TiddlyWiki.standardFieldAccess[fieldName];
	if(accessor) {
		if(isRemove)
			// don't remove StandardFields
			return;
		var h = TiddlyWiki.standardFieldAccess[fieldName];
		if(!h.set(t,value))
			return;
	} else {
		var oldValue = t.fields[fieldName];
		if(isRemove) {
			if(oldValue !== undefined) {
				// deletes a single field
				delete t.fields[fieldName];
			} else {
				// no concrete value is defined for the fieldName
				// so we guess this is a namespace path.
				// delete all fields in a namespace
				var re = new RegExp("^"+fieldName+"\\.");
				var dirty = false;
				for(var n in t.fields) {
					if(n.match(re)) {
						delete t.fields[n];
						dirty = true;
					}
				}
				if(!dirty)
					return;
			}
		} else {
			// the "normal" set case. value is defined (not null/undefined)
			// For convenience provide a nicer conversion Date->String
			value = value instanceof Date ? value.convertToYYYYMMDDHHMMSSMMM() : String(value);
			if(oldValue == value)
				return;
			t.fields[fieldName] = value;
		}
	}
	// When we are here the tiddler/store really was changed.
	this.notify(t.title,true);
	if(!fieldName.match(/^temp\./))
		this.setDirty(true);
};

// Returns the value of the given field of the tiddler.
// The fieldName is case-insensitive.
// Will only return String values (or undefined).
TiddlyWiki.prototype.getValue = function(tiddler,fieldName)
{
	var t = this.resolveTiddler(tiddler);
	if(!t)
		return undefined;
	fieldName = fieldName.toLowerCase();
	var accessor = TiddlyWiki.standardFieldAccess[fieldName];
	if(accessor) {
		return accessor.get(t);
	}
	return t.fields[fieldName];
};

// Calls the callback function for every field in the tiddler.
// When callback function returns a non-false value the iteration stops
// and that value is returned.
// The order of the fields is not defined.
// @param callback a function(tiddler,fieldName,value).
TiddlyWiki.prototype.forEachField = function(tiddler,callback,onlyExtendedFields)
{
	var t = this.resolveTiddler(tiddler);
	if(!t)
		return undefined;
	var n,result;
	for(n in t.fields) {
		result = callback(t,n,t.fields[n]);
		if(result)
			return result;
		}
	if(onlyExtendedFields)
		return undefined;
	for(n in TiddlyWiki.standardFieldAccess) {
		if(n == "tiddler")
			// even though the "title" field can also be referenced through the name "tiddler"
			// we only visit this field once.
			continue;
		result = callback(t,n,TiddlyWiki.standardFieldAccess[n].get(t));
		if(result)
			return result;
	}
	return undefined;
};

//--
//-- Story functions
//--

function Story(containerId,idPrefix)
{
	this.container = containerId;
	this.idPrefix = idPrefix;
	this.highlightRegExp = null;
	this.tiddlerId = function(title) {
		var id = this.idPrefix + title;
		return id==this.container ? this.idPrefix + "_" + title : id;
	};
	this.containerId = function() {
		return this.container;
	};
}

Story.prototype.getTiddler = function(title)
{
	return document.getElementById(this.tiddlerId(title));
};

Story.prototype.getContainer = function()
{
	return document.getElementById(this.containerId());
};

Story.prototype.forEachTiddler = function(fn)
{
	var place = this.getContainer();
	if(!place)
		return;
	var e = place.firstChild;
	while(e) {
		var n = e.nextSibling;
		var title = e.getAttribute("tiddler");
		fn.call(this,title,e);
		e = n;
	}
};

Story.prototype.displayDefaultTiddlers = function()
{
	this.displayTiddlers(null,store.filterTiddlers(store.getTiddlerText("DefaultTiddlers")));
};

Story.prototype.displayTiddlers = function(srcElement,titles,template,animate,unused,customFields,toggle)
{
	for(var t = titles.length-1;t>=0;t--)
		this.displayTiddler(srcElement,titles[t],template,animate,unused,customFields);
};

Story.prototype.displayTiddler = function(srcElement,tiddler,template,animate,unused,customFields,toggle,animationSrc)
{
	var title = (tiddler instanceof Tiddler) ? tiddler.title : tiddler;
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem) {
		if(toggle)
			this.closeTiddler(title,true);
		else
			this.refreshTiddler(title,template,false,customFields);
	} else {
		var place = this.getContainer();
		var before = this.positionTiddler(srcElement);
		tiddlerElem = this.createTiddler(place,before,title,template,customFields);
	}
	if(animationSrc && typeof animationSrc !== "string") {
		srcElement = animationSrc;
	}
	if(srcElement && typeof srcElement !== "string") {
		if(config.options.chkAnimate && (animate == undefined || animate == true) && anim && typeof Zoomer == "function" && typeof Scroller == "function")
			anim.startAnimating(new Zoomer(title,srcElement,tiddlerElem),new Scroller(tiddlerElem));
		else
			window.scrollTo(0,ensureVisible(tiddlerElem));
	}
};

Story.prototype.positionTiddler = function(srcElement)
{
	var place = this.getContainer();
	var before = null;
	if(typeof srcElement == "string") {
		switch(srcElement) {
		case "top":
			before = place.firstChild;
			break;
		case "bottom":
			before = null;
			break;
		}
	} else {
		var after = this.findContainingTiddler(srcElement);
		if(after == null) {
			before = place.firstChild;
		} else if(after.nextSibling) {
			before = after.nextSibling;
			if(before.nodeType != 1)
				before = null;
		}
	}
	return before;
};

Story.prototype.createTiddler = function(place,before,title,template,customFields)
{
	var tiddlerElem = createTiddlyElement(null,"div",this.tiddlerId(title),"tiddler");
	tiddlerElem.setAttribute("refresh","tiddler");
	if(customFields)
		tiddlerElem.setAttribute("tiddlyFields",customFields);
	place.insertBefore(tiddlerElem,before);
	var defaultText = null;
	if(!store.tiddlerExists(title) && !store.isShadowTiddler(title))
		defaultText = this.loadMissingTiddler(title,customFields,tiddlerElem);
	this.refreshTiddler(title,template,false,customFields,defaultText);
	return tiddlerElem;
};

Story.prototype.loadMissingTiddler = function(title,fields,tiddlerElem)
{
	var getTiddlerCallback = function(context)
	{
		var tiddler = context.tiddler;
		if(tiddler && tiddler.text) {
			if(!tiddler.created)
				tiddler.created = new Date();
			if(!tiddler.modified)
				tiddler.modified = tiddler.created;
			store.saveTiddler(tiddler.title,tiddler.title,tiddler.text,tiddler.modifier,tiddler.modified,tiddler.tags,tiddler.fields,true,tiddler.created);
			autoSaveChanges();
		}
		context.adaptor.close();
		delete context.adpator;
	};

	var tiddler = new Tiddler(title);
	tiddler.fields = typeof fields == "string" ? fields.decodeHashMap() : fields||{};
	var context = {serverType:tiddler.getServerType()};
	if(!context.serverType)
		return;
	context.host = tiddler.fields['server.host'];
	context.workspace = tiddler.fields['server.workspace'];
	var adaptor = new config.adaptors[context.serverType];
	adaptor.getTiddler(title,context,null,getTiddlerCallback);
	return config.messages.loadingMissingTiddler.format([title,context.serverType,context.host,context.workspace]);
};

Story.prototype.chooseTemplateForTiddler = function(title,template)
{
	if(!template)
		template = DEFAULT_VIEW_TEMPLATE;
	if(template == DEFAULT_VIEW_TEMPLATE || template == DEFAULT_EDIT_TEMPLATE)
		template = config.tiddlerTemplates[template];
	return template;
};

Story.prototype.getTemplateForTiddler = function(title,template,tiddler)
{
	return store.getRecursiveTiddlerText(template,null,10);
};

Story.prototype.refreshTiddler = function(title,template,force,customFields,defaultText)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem) {
		if(tiddlerElem.getAttribute("dirty") == "true" && !force)
			return tiddlerElem;
		template = this.chooseTemplateForTiddler(title,template);
		var currTemplate = tiddlerElem.getAttribute("template");
		if((template != currTemplate) || force) {
			var tiddler = store.getTiddler(title);
			if(!tiddler) {
				tiddler = new Tiddler();
				if(store.isShadowTiddler(title)) {
					var tags = [];
					tiddler.set(title,store.getTiddlerText(title),config.views.wikified.shadowModifier,version.date,tags,version.date);
				} else {
					var text = template=="EditTemplate" ?
								config.views.editor.defaultText.format([title]) :
								config.views.wikified.defaultText.format([title]);
					text = defaultText || text;
					var fields = customFields ? customFields.decodeHashMap() : null;
					tiddler.set(title,text,config.views.wikified.defaultModifier,version.date,[],version.date,fields);
				}
			}
			tiddlerElem.setAttribute("tags",tiddler.tags.join(" "));
			tiddlerElem.setAttribute("tiddler",title);
			tiddlerElem.setAttribute("template",template);
			tiddlerElem.onmouseover = this.onTiddlerMouseOver;
			tiddlerElem.onmouseout = this.onTiddlerMouseOut;
			tiddlerElem.ondblclick = this.onTiddlerDblClick;
			tiddlerElem[window.event?"onkeydown":"onkeypress"] = this.onTiddlerKeyPress;
			tiddlerElem.innerHTML = this.getTemplateForTiddler(title,template,tiddler);
			applyHtmlMacros(tiddlerElem,tiddler);
			if(store.getTaggedTiddlers(title).length > 0)
				addClass(tiddlerElem,"isTag");
			else
				removeClass(tiddlerElem,"isTag");
			if(store.tiddlerExists(title)) {
				removeClass(tiddlerElem,"shadow");
				removeClass(tiddlerElem,"missing");
			} else {
				addClass(tiddlerElem, store.isShadowTiddler(title) ? "shadow" : "missing");
			}
			if(customFields)
				this.addCustomFields(tiddlerElem,customFields);
			forceReflow();
		}
	}
	return tiddlerElem;
};

Story.prototype.addCustomFields = function(place,customFields)
{
	var fields = customFields.decodeHashMap();
	var w = createTiddlyElement(place,"div",null,"customFields");
	w.style.display = "none";
	for(var t in fields) {
		var e = document.createElement("input");
		e.setAttribute("type","text");
		e.setAttribute("value",fields[t]);
		w.appendChild(e);
		e.setAttribute("edit",t);
	}
};

Story.prototype.refreshAllTiddlers = function(force)
{
	var e = this.getContainer().firstChild;
	while(e) {
		var template = e.getAttribute("template");
		if(template && e.getAttribute("dirty") != "true") {
			this.refreshTiddler(e.getAttribute("tiddler"),force ? null : template,true);
		}
		e = e.nextSibling;
	}
};

Story.prototype.onTiddlerMouseOver = function(e)
{
	addClass(this, "selected");
};

Story.prototype.onTiddlerMouseOut = function(e)
{
	removeClass(this,"selected");
};

Story.prototype.onTiddlerDblClick = function(ev)
{
	var e = ev || window.event;
	var target = resolveTarget(e);
	if(target && target.nodeName.toLowerCase() != "input" && target.nodeName.toLowerCase() != "textarea") {
		if(document.selection && document.selection.empty)
			document.selection.empty();
		config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
		e.cancelBubble = true;
		if(e.stopPropagation) e.stopPropagation();
		return true;
	}
	return false;
};

Story.prototype.onTiddlerKeyPress = function(ev)
{
	var e = ev || window.event;
	clearMessage();
	var consume = false;
	var title = this.getAttribute("tiddler");
	var target = resolveTarget(e);
	switch(e.keyCode) {
	case 9: // Tab
		if(config.options.chkInsertTabs && target.tagName.toLowerCase() == "textarea") {
			replaceSelection(target,String.fromCharCode(9));
			consume = true;
		}
		if(config.isOpera) {
			target.onblur = function() {
				this.focus();
				this.onblur = null;
			};
		}
		break;
	case 13: // Ctrl-Enter
	case 10: // Ctrl-Enter on IE PC
	case 77: // Ctrl-Enter is "M" on some platforms
		if(e.ctrlKey) {
			blurElement(this);
			config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
			consume = true;
		}
		break;
	case 27: // Escape
		blurElement(this);
		config.macros.toolbar.invokeCommand(this,"cancelCommand",e);
		consume = true;
		break;
	}
	e.cancelBubble = consume;
	if(consume) {
		if(e.stopPropagation) e.stopPropagation(); // Stop Propagation
		e.returnValue = true; // Cancel The Event in IE
		if(e.preventDefault ) e.preventDefault(); // Cancel The Event in Moz
	}
	return !consume;
};

Story.prototype.getTiddlerField = function(title,field)
{
	var tiddlerElem = this.getTiddler(title);
	var e = null;
	if(tiddlerElem ) {
		var children = tiddlerElem.getElementsByTagName("*");
		for(var t=0; t<children.length; t++) {
			var c = children[t];
			if(c.tagName.toLowerCase() == "input" || c.tagName.toLowerCase() == "textarea") {
				if(!e)
					e = c;
				if(c.getAttribute("edit") == field)
					e = c;
			}
		}
	}
	return e;
};

Story.prototype.focusTiddler = function(title,field)
{
	var e = this.getTiddlerField(title,field);
	if(e) {
		e.focus();
		e.select();
	}
};

Story.prototype.blurTiddler = function(title)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem && tiddlerElem.focus && tiddlerElem.blur) {
		tiddlerElem.focus();
		tiddlerElem.blur();
	}
};

Story.prototype.setTiddlerField = function(title,tag,mode,field)
{
	var c = this.getTiddlerField(title,field);
	var tags = c.value.readBracketedList();
	tags.setItem(tag,mode);
	c.value = String.encodeTiddlyLinkList(tags);
};

Story.prototype.setTiddlerTag = function(title,tag,mode)
{
	this.setTiddlerField(title,tag,mode,"tags");
};

Story.prototype.closeTiddler = function(title,animate,unused)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem) {
		clearMessage();
		this.scrubTiddler(tiddlerElem);
		if(config.options.chkAnimate && animate && anim && typeof Slider == "function")
			anim.startAnimating(new Slider(tiddlerElem,false,null,"all"));
		else {
			removeNode(tiddlerElem);
			forceReflow();
		}
	}
};

Story.prototype.scrubTiddler = function(tiddlerElem)
{
	tiddlerElem.id = null;
};

Story.prototype.setDirty = function(title,dirty)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem)
		tiddlerElem.setAttribute("dirty",dirty ? "true" : "false");
};

Story.prototype.isDirty = function(title)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem)
		return tiddlerElem.getAttribute("dirty") == "true";
	return null;
};

Story.prototype.areAnyDirty = function()
{
	var r = false;
	this.forEachTiddler(function(title,element) {
		if(this.isDirty(title))
			r = true;
	});
	return r;
};

Story.prototype.closeAllTiddlers = function(exclude)
{
	clearMessage();
	this.forEachTiddler(function(title,element) {
		if((title != exclude) && element.getAttribute("dirty") != "true")
			this.closeTiddler(title);
	});
	window.scrollTo(0,ensureVisible(this.container));
};

Story.prototype.isEmpty = function()
{
	var place = this.getContainer();
	return place && place.firstChild == null;
};

Story.prototype.search = function(text,useCaseSensitive,useRegExp)
{
	this.closeAllTiddlers();
	highlightHack = new RegExp(useRegExp ? text : text.escapeRegExp(),useCaseSensitive ? "mg" : "img");
	var matches = store.search(highlightHack,"title","excludeSearch");
	this.displayTiddlers(null,matches);
	highlightHack = null;
	var q = useRegExp ? "/" : "'";
	if(matches.length > 0)
		displayMessage(config.macros.search.successMsg.format([matches.length.toString(),q + text + q]));
	else
		displayMessage(config.macros.search.failureMsg.format([q + text + q]));
};

Story.prototype.findContainingTiddler = function(e)
{
	while(e && !hasClass(e,"tiddler"))
		e = e.parentNode;
	return e;
};

Story.prototype.gatherSaveFields = function(e,fields)
{
	if(e && e.getAttribute) {
		var f = e.getAttribute("edit");
		if(f)
			fields[f] = e.value.replace(/\r/mg,"");
		if(e.hasChildNodes()) {
			var c = e.childNodes;
			for(var t=0; t<c.length; t++)
				this.gatherSaveFields(c[t],fields);
		}
	}
};

Story.prototype.hasChanges = function(title)
{
	var e = this.getTiddler(title);
	if(e) {
		var fields = {};
		this.gatherSaveFields(e,fields);
		var tiddler = store.fetchTiddler(title);
		if(!tiddler)
			return false;
		for(var n in fields) {
			if(store.getValue(title,n) != fields[n])
				return true;
		}
	}
	return false;
};

Story.prototype.saveTiddler = function(title,minorUpdate)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem) {
		var fields = {};
		this.gatherSaveFields(tiddlerElem,fields);
		var newTitle = fields.title || title;
		if(!store.tiddlerExists(newTitle))
			newTitle = newTitle.trim();
		if(store.tiddlerExists(newTitle) && newTitle != title) {
			if(!confirm(config.messages.overwriteWarning.format([newTitle.toString()])))
				return null;
		}
		if(newTitle != title)
			this.closeTiddler(newTitle,false);
		tiddlerElem.id = this.tiddlerId(newTitle);
		tiddlerElem.setAttribute("tiddler",newTitle);
		tiddlerElem.setAttribute("template",DEFAULT_VIEW_TEMPLATE);
		tiddlerElem.setAttribute("dirty","false");
		if(config.options.chkForceMinorUpdate)
			minorUpdate = !minorUpdate;
		if(!store.tiddlerExists(newTitle))
			minorUpdate = false;
		var newDate = new Date();
		if(store.tiddlerExists(title)) {
			var extendedFields = store.fetchTiddler(title).fields;
		} else {
			extendedFields = merge({},config.defaultCustomFields);
		}
		for(var n in fields) {
			if(!TiddlyWiki.isStandardField(n))
				extendedFields[n] = fields[n];
		}
		var tiddler = store.saveTiddler(title,newTitle,fields.text,minorUpdate ? undefined : config.options.txtUserName,minorUpdate ? undefined : newDate,fields.tags,extendedFields);
		autoSaveChanges(null,[tiddler]);
		return newTitle;
	}
	return null;
};

Story.prototype.permaView = function()
{
	var links = [];
	this.forEachTiddler(function(title,element) {
		links.push(String.encodeTiddlyLink(title));
	});
	var t = encodeURIComponent(links.join(" "));
	if(t == "")
		t = "#";
	if(window.location.hash != t)
		window.location.hash = t;
};

Story.prototype.switchTheme = function(theme)
{
	if(safeMode)
		return;

	var isAvailable = function(title) {
		var s = title ? title.indexOf(config.textPrimitives.sectionSeparator) : -1;
		if(s!=-1)
			title = title.substr(0,s);
		return store.tiddlerExists(title) || store.isShadowTiddler(title);
	};

	var getSlice = function(theme,slice) {
		var r;
		if(readOnly)
			r = store.getTiddlerSlice(theme,slice+"ReadOnly") || store.getTiddlerSlice(theme,"Web"+slice);
		r = r || store.getTiddlerSlice(theme,slice);
		if(r && r.indexOf(config.textPrimitives.sectionSeparator)==0)
			r = theme + r;
		return isAvailable(r) ? r : slice;
	};

	var replaceNotification = function(i,name,theme,slice) {
		var newName = getSlice(theme,slice);
		if(name!=newName && store.namedNotifications[i].name==name) {
			store.namedNotifications[i].name = newName;
			return newName;
		}
		return name;
	};

	var pt = config.refresherData.pageTemplate;
	var vi = DEFAULT_VIEW_TEMPLATE;
	var vt = config.tiddlerTemplates[vi];
	var ei = DEFAULT_EDIT_TEMPLATE;
	var et = config.tiddlerTemplates[ei];

	for(var i=0; i<config.notifyTiddlers.length; i++) {
		var name = config.notifyTiddlers[i].name;
		switch(name) {
		case "PageTemplate":
			config.refresherData.pageTemplate = replaceNotification(i,config.refresherData.pageTemplate,theme,name);
			break;
		case "StyleSheet":
			removeStyleSheet(config.refresherData.styleSheet);
			config.refresherData.styleSheet = replaceNotification(i,config.refresherData.styleSheet,theme,name);
			break;
		case "ColorPalette":
			config.refresherData.colorPalette = replaceNotification(i,config.refresherData.colorPalette,theme,name);
			break;
		default:
			break;
		}
	}
	config.tiddlerTemplates[vi] = getSlice(theme,"ViewTemplate");
	config.tiddlerTemplates[ei] = getSlice(theme,"EditTemplate");
	if(!startingUp) {
		if(config.refresherData.pageTemplate!=pt || config.tiddlerTemplates[vi]!=vt || config.tiddlerTemplates[ei]!=et) {
			refreshAll();
			this.refreshAllTiddlers(true);
		} else {
			setStylesheet(store.getRecursiveTiddlerText(config.refresherData.styleSheet,"",10),config.refreshers.styleSheet);
		}
		config.options.txtTheme = theme;
		saveOptionCookie("txtTheme");
	}
};

//--
//-- Backstage
//--

var backstage = {
	area: null,
	toolbar: null,
	button: null,
	showButton: null,
	hideButton: null,
	cloak: null,
	panel: null,
	panelBody: null,
	panelFooter: null,
	currTabName: null,
	currTabElem: null,
	content: null,

	init: function() {
		var cmb = config.messages.backstage;
		this.area = document.getElementById("backstageArea");
		this.toolbar = document.getElementById("backstageToolbar");
		this.button = document.getElementById("backstageButton");
		this.button.style.display = "block";
		var t = cmb.open.text + " " + glyph("bentArrowLeft");
		this.showButton = createTiddlyButton(this.button,t,cmb.open.tooltip,
						function(e) {backstage.show(); return false;},null,"backstageShow");
		t = glyph("bentArrowRight") + " " + cmb.close.text;
		this.hideButton = createTiddlyButton(this.button,t,cmb.close.tooltip,
						function(e) {backstage.hide(); return false;},null,"backstageHide");
		this.cloak = document.getElementById("backstageCloak");
		this.panel = document.getElementById("backstagePanel");
		this.panelFooter = createTiddlyElement(this.panel,"div",null,"backstagePanelFooter");
		this.panelBody = createTiddlyElement(this.panel,"div",null,"backstagePanelBody");
		this.cloak.onmousedown = function(e) {backstage.switchTab(null);};
		createTiddlyText(this.toolbar,cmb.prompt);
		for(t=0; t<config.backstageTasks.length; t++) {
			var taskName = config.backstageTasks[t];
			var task = config.tasks[taskName];
			var handler = task.action ? this.onClickCommand : this.onClickTab;
			var text = task.text + (task.action ? "" : glyph("downTriangle"));
			var btn = createTiddlyButton(this.toolbar,text,task.tooltip,handler,"backstageTab");
			addClass(btn,task.action ? "backstageAction" : "backstageTask");
			btn.setAttribute("task", taskName);
			}
		this.content = document.getElementById("contentWrapper");
		if(config.options.chkBackstage)
			this.show();
		else
			this.hide();
	},

	isVisible: function() {
		return this.area ? this.area.style.display == "block" : false;
	},

	show: function() {
		this.area.style.display = "block";
		if(anim && config.options.chkAnimate) {
			backstage.toolbar.style.left = findWindowWidth() + "px";
			var p = [{style: "left", start: findWindowWidth(), end: 0, template: "%0px"}];
			anim.startAnimating(new Morpher(backstage.toolbar,config.animDuration,p));
		} else {
			backstage.area.style.left = "0px";
		}
		jQuery(this.showButton).hide();
		jQuery(this.hideButton).show();
		config.options.chkBackstage = true;
		saveOptionCookie("chkBackstage");
		addClass(this.content,"backstageVisible");
	},

	hide: function() {
		if(this.currTabElem) {
			this.switchTab(null);
		} else {
			backstage.toolbar.style.left = "0px";
			if(anim && config.options.chkAnimate) {
				var p = [{style: "left", start: 0, end: findWindowWidth(), template: "%0px"}];
				var c = function(element,properties) {backstage.area.style.display = "none";};
				anim.startAnimating(new Morpher(backstage.toolbar,config.animDuration,p,c));
			} else {
				this.area.style.display = "none";
			}
			this.showButton.style.display = "block";
			this.hideButton.style.display = "none";
			config.options.chkBackstage = false;
			saveOptionCookie("chkBackstage");
			removeClass(this.content, "backstageVisible");
		}
	},

	onClickCommand: function(e) {
		var task = config.tasks[this.getAttribute("task")];
		displayMessage(task);
		if(task.action) {
			backstage.switchTab(null);
			task.action();
		}
		return false;
	},

	onClickTab: function(e) {
		backstage.switchTab(this.getAttribute("task"));
		return false;
	},

	// Switch to a given tab, or none if null is passed
	switchTab: function(tabName) {
		var tabElem = null;
		var e = this.toolbar.firstChild;
		while(e)
			{
			if(e.getAttribute && e.getAttribute("task") == tabName)
				tabElem = e;
			e = e.nextSibling;
			}
		if(tabName == backstage.currTabName) {
			backstage.hidePanel();
			return;
		}
		if(backstage.currTabElem) {
			removeClass(this.currTabElem, "backstageSelTab");
		}
		if(tabElem && tabName) {
			backstage.preparePanel();
			addClass(tabElem,"backstageSelTab");
			var task = config.tasks[tabName];
			wikify(task.content,backstage.panelBody,null,null);
			backstage.showPanel();
		} else if(backstage.currTabElem) {
			backstage.hidePanel();
		}
		backstage.currTabName = tabName;
		backstage.currTabElem = tabElem;
	},

	isPanelVisible: function() {
		return backstage.panel ? backstage.panel.style.display == "block" : false;
	},

	preparePanel: function() {
		backstage.cloak.style.height = findWindowHeight() + "px";
		backstage.cloak.style.display = "block";
		removeChildren(backstage.panelBody);
		return backstage.panelBody;
	},

	showPanel: function() {
		backstage.panel.style.display = "block";
		if(anim && config.options.chkAnimate) {
			backstage.panel.style.top = (-backstage.panel.offsetHeight) + "px";
			var p = [{style: "top", start: -backstage.panel.offsetHeight, end: 0, template: "%0px"}];
			anim.startAnimating(new Morpher(backstage.panel,config.animDuration,p),new Scroller(backstage.panel,false));
		} else {
			backstage.panel.style.top = "0px";
		}
		return backstage.panelBody;
	},

	hidePanel: function() {
		if(backstage.currTabElem)
			removeClass(backstage.currTabElem, "backstageSelTab");
		backstage.currTabElem = null;
		backstage.currTabName = null;
		if(anim && config.options.chkAnimate) {
			var p = [
				{style: "top", start: 0, end: -(backstage.panel.offsetHeight), template: "%0px"},
				{style: "display", atEnd: "none"}
			];
			var c = function(element,properties) {backstage.cloak.style.display = "none";};
			anim.startAnimating(new Morpher(backstage.panel,config.animDuration,p,c));
		} else {
			jQuery([backstage.panel,backstage.cloak]).hide();
		}
	}
};

config.macros.backstage = {};

config.macros.backstage.handler = function(place,macroName,params)
{
	var backstageTask = config.tasks[params[0]];
	if(backstageTask)
		createTiddlyButton(place,backstageTask.text,backstageTask.tooltip,function(e) {backstage.switchTab(params[0]); return false;});
};

//--
//-- ImportTiddlers macro
//--

config.macros.importTiddlers.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(readOnly) {
		createTiddlyElement(place,"div",null,"marked",this.readOnlyWarning);
		return;
	}
	var w = new Wizard();
	w.createWizard(place,this.wizardTitle);
	this.restart(w);
};

config.macros.importTiddlers.onCancel = function(e)
{
	var wizard = new Wizard(this);
	var place = wizard.clear();
	config.macros.importTiddlers.restart(wizard);
	return false;
};

config.macros.importTiddlers.onClose = function(e)
{
	backstage.hidePanel();
	return false;
};

config.macros.importTiddlers.restart = function(wizard)
{
	wizard.addStep(this.step1Title,this.step1Html);
	var s = wizard.getElement("selTypes");
	for(var t in config.adaptors) {
		var e = createTiddlyElement(s,"option",null,null,config.adaptors[t].serverLabel ? config.adaptors[t].serverLabel : t);
		e.value = t;
	}
	if(config.defaultAdaptor)
		s.value = config.defaultAdaptor;
	s = wizard.getElement("selFeeds");
	var feeds = this.getFeeds();
	for(t in feeds) {
		e = createTiddlyElement(s,"option",null,null,t);
		e.value = t;
	}
	wizard.setValue("feeds",feeds);
	s.onchange = config.macros.importTiddlers.onFeedChange;
	var fileInput = wizard.getElement("txtBrowse");
	fileInput.onchange = config.macros.importTiddlers.onBrowseChange;
	fileInput.onkeyup = config.macros.importTiddlers.onBrowseChange;
	wizard.setButtons([{caption: this.openLabel, tooltip: this.openPrompt, onClick: config.macros.importTiddlers.onOpen}]);
	wizard.formElem.action = "javascript:;";
	wizard.formElem.onsubmit = function() {
		if(!this.txtPath || this.txtPath.value.length) //# check for manually entered path in first step
			this.lastChild.firstChild.onclick();
	};
};

config.macros.importTiddlers.getFeeds = function()
{
	var feeds = {};
	var tagged = store.getTaggedTiddlers("systemServer","title");
	for(var t=0; t<tagged.length; t++) {
		var title = tagged[t].title;
		var serverType = store.getTiddlerSlice(title,"Type");
		if(!serverType)
			serverType = "file";
		feeds[title] = {title: title,
						url: store.getTiddlerSlice(title,"URL"),
						workspace: store.getTiddlerSlice(title,"Workspace"),
						workspaceList: store.getTiddlerSlice(title,"WorkspaceList"),
						tiddlerFilter: store.getTiddlerSlice(title,"TiddlerFilter"),
						serverType: serverType,
						description: store.getTiddlerSlice(title,"Description")};
	}
	return feeds;
};

config.macros.importTiddlers.onFeedChange = function(e)
{
	var wizard = new Wizard(this);
	var selTypes = wizard.getElement("selTypes");
	var fileInput = wizard.getElement("txtPath");
	var feeds = wizard.getValue("feeds");
	var f = feeds[this.value];
	if(f) {
		selTypes.value = f.serverType;
		fileInput.value = f.url;
		wizard.setValue("feedName",f.serverType);
		wizard.setValue("feedHost",f.url);
		wizard.setValue("feedWorkspace",f.workspace);
		wizard.setValue("feedWorkspaceList",f.workspaceList);
		wizard.setValue("feedTiddlerFilter",f.tiddlerFilter);
	}
	return false;
};

config.macros.importTiddlers.onBrowseChange = function(e)
{
	var wizard = new Wizard(this);
	var fileInput = wizard.getElement("txtPath");
	fileInput.value = config.macros.importTiddlers.getURLFromLocalPath(this.value);
	var serverType = wizard.getElement("selTypes");
	serverType.value = "file";
	return true;
};

config.macros.importTiddlers.getURLFromLocalPath = function(v)
{
	if(!v||!v.length)
		return v;
	v = v.replace(/\\/g,"/"); // use "/" for cross-platform consistency
	var u;
	var t = v.split(":");
	var p = t[1]||t[0]; // remove drive letter (if any)
	if (t[1] && (t[0]=="http"||t[0]=="https"||t[0]=="file")) {
		u = v;
	} else if(p.substr(0,1)=="/") {
		u = document.location.protocol + "//" + document.location.hostname + (t[1] ? "/" : "") + v;
	} else {
		var c = document.location.href.replace(/\\/g,"/");
		var pos = c.lastIndexOf("/");
		if (pos!=-1)
			c = c.substr(0,pos); // remove filename
		u = c + "/" + p;
	}
	return u;
};

config.macros.importTiddlers.onOpen = function(e)
{
	var wizard = new Wizard(this);
	var fileInput = wizard.getElement("txtPath");
	var url = fileInput.value;
	var serverType = wizard.getElement("selTypes").value || config.defaultAdaptor;
	var adaptor = new config.adaptors[serverType]();
	wizard.setValue("adaptor",adaptor);
	wizard.setValue("serverType",serverType);
	wizard.setValue("host",url);
	var ret = adaptor.openHost(url,null,wizard,config.macros.importTiddlers.onOpenHost);
	if(ret !== true)
		displayMessage(ret);
	wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.statusOpenHost);
	return false;
};

config.macros.importTiddlers.onOpenHost = function(context,wizard)
{
	var adaptor = wizard.getValue("adaptor");
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onOpenHost: " + context.statusText);
	var ret = adaptor.getWorkspaceList(context,wizard,config.macros.importTiddlers.onGetWorkspaceList);
	if(ret !== true)
		displayMessage(ret);
	wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.statusGetWorkspaceList);
};

config.macros.importTiddlers.onGetWorkspaceList = function(context,wizard)
{
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onGetWorkspaceList: " + context.statusText);
	wizard.setValue("context",context);
	var workspace = wizard.getValue("feedWorkspace");
	if(!workspace && context.workspaces.length==1)
		workspace = context.workspaces[0].title;
	if(workspace) {
		var ret = context.adaptor.openWorkspace(workspace,context,wizard,config.macros.importTiddlers.onOpenWorkspace);
		if(ret !== true)
			displayMessage(ret);
		wizard.setValue("workspace",workspace);
		wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.statusOpenWorkspace);
		return;
	}
	wizard.addStep(config.macros.importTiddlers.step2Title,config.macros.importTiddlers.step2Html);
	var s = wizard.getElement("selWorkspace");
	s.onchange = config.macros.importTiddlers.onWorkspaceChange;
	for(var t=0; t<context.workspaces.length; t++) {
		var e = createTiddlyElement(s,"option",null,null,context.workspaces[t].title);
		e.value = context.workspaces[t].title;
	}
	var workspaceList = wizard.getValue("feedWorkspaceList");
	if(workspaceList) {
		var list = workspaceList.parseParams("workspace",null,false,true);
		for(var n=1; n<list.length; n++) {
			if(context.workspaces.findByField("title",list[n].value) == null) {
				e = createTiddlyElement(s,"option",null,null,list[n].value);
				e.value = list[n].value;
			}
		}
	}
	if(workspace) {
		t = wizard.getElement("txtWorkspace");
		t.value = workspace;
	}
	wizard.setButtons([{caption: config.macros.importTiddlers.openLabel, tooltip: config.macros.importTiddlers.openPrompt, onClick: config.macros.importTiddlers.onChooseWorkspace}]);
};

config.macros.importTiddlers.onWorkspaceChange = function(e)
{
	var wizard = new Wizard(this);
	var t = wizard.getElement("txtWorkspace");
	t.value = this.value;
	this.selectedIndex = 0;
	return false;
};

config.macros.importTiddlers.onChooseWorkspace = function(e)
{
	var wizard = new Wizard(this);
	var adaptor = wizard.getValue("adaptor");
	var workspace = wizard.getElement("txtWorkspace").value;
	wizard.setValue("workspace",workspace);
	var context = wizard.getValue("context");
	var ret = adaptor.openWorkspace(workspace,context,wizard,config.macros.importTiddlers.onOpenWorkspace);
	if(ret !== true)
		displayMessage(ret);
	wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.statusOpenWorkspace);
	return false;
};

config.macros.importTiddlers.onOpenWorkspace = function(context,wizard)
{
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onOpenWorkspace: " + context.statusText);
	var adaptor = wizard.getValue("adaptor");
	var ret = adaptor.getTiddlerList(context,wizard,config.macros.importTiddlers.onGetTiddlerList,wizard.getValue("feedTiddlerFilter"));
	if(ret !== true)
		displayMessage(ret);
	wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.statusGetTiddlerList);
};

config.macros.importTiddlers.onGetTiddlerList = function(context,wizard)
{
	if(context.status !== true) {
		wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.errorGettingTiddlerList);
		return;
	}
	// Extract data for the listview
	var listedTiddlers = [];
	if(context.tiddlers) {
		for(var n=0; n<context.tiddlers.length; n++) {
			var tiddler = context.tiddlers[n];
			listedTiddlers.push({
				title: tiddler.title,
				modified: tiddler.modified,
				modifier: tiddler.modifier,
				text: tiddler.text ? wikifyPlainText(tiddler.text,100) : "",
				tags: tiddler.tags,
				size: tiddler.text ? tiddler.text.length : 0,
				tiddler: tiddler
			});
		}
	}
	listedTiddlers.sort(function(a,b) {return a.title < b.title ? -1 : (a.title == b.title ? 0 : +1);});
	// Display the listview
	wizard.addStep(config.macros.importTiddlers.step3Title,config.macros.importTiddlers.step3Html);
	var markList = wizard.getElement("markList");
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	var listView = ListView.create(listWrapper,listedTiddlers,config.macros.importTiddlers.listViewTemplate);
	wizard.setValue("listView",listView);
	wizard.setValue("context",context);
	var txtSaveTiddler = wizard.getElement("txtSaveTiddler");
	txtSaveTiddler.value = config.macros.importTiddlers.generateSystemServerName(wizard);
	wizard.setButtons([
			{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel},
			{caption: config.macros.importTiddlers.importLabel, tooltip: config.macros.importTiddlers.importPrompt, onClick: config.macros.importTiddlers.doImport}
		]);
};

config.macros.importTiddlers.generateSystemServerName = function(wizard)
{
	var serverType = wizard.getValue("serverType");
	var host = wizard.getValue("host");
	var workspace = wizard.getValue("workspace");
	var pattern = config.macros.importTiddlers[workspace ? "systemServerNamePattern" : "systemServerNamePatternNoWorkspace"];
	return pattern.format([serverType,host,workspace]);
};

config.macros.importTiddlers.saveServerTiddler = function(wizard)
{
	var txtSaveTiddler = wizard.getElement("txtSaveTiddler").value;
	if(store.tiddlerExists(txtSaveTiddler)) {
		if(!confirm(config.macros.importTiddlers.confirmOverwriteSaveTiddler.format([txtSaveTiddler])))
			return;
		store.suspendNotifications();
		store.removeTiddler(txtSaveTiddler);
		store.resumeNotifications();
	}
	var serverType = wizard.getValue("serverType");
	var host = wizard.getValue("host");
	var workspace = wizard.getValue("workspace");
	var text = config.macros.importTiddlers.serverSaveTemplate.format([serverType,host,workspace]);
	store.saveTiddler(txtSaveTiddler,txtSaveTiddler,text,config.macros.importTiddlers.serverSaveModifier,new Date(),["systemServer"]);
};

config.macros.importTiddlers.doImport = function(e)
{
	var wizard = new Wizard(this);
	if(wizard.getElement("chkSave").checked)
		config.macros.importTiddlers.saveServerTiddler(wizard);
	var chkSync = wizard.getElement("chkSync").checked;
	wizard.setValue("sync",chkSync);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	var adaptor = wizard.getValue("adaptor");
	var overwrite = [];
	var t;
	for(t=0; t<rowNames.length; t++) {
		if(store.tiddlerExists(rowNames[t]))
			overwrite.push(rowNames[t]);
	}
	if(overwrite.length > 0) {
		if(!confirm(config.macros.importTiddlers.confirmOverwriteText.format([overwrite.join(", ")])))
			return false;
	}
	wizard.addStep(config.macros.importTiddlers.step4Title.format([rowNames.length]),config.macros.importTiddlers.step4Html);
	for(t=0; t<rowNames.length; t++) {
		var link = document.createElement("div");
		createTiddlyLink(link,rowNames[t],true);
		var place = wizard.getElement("markReport");
		place.parentNode.insertBefore(link,place);
	}
	wizard.setValue("remainingImports",rowNames.length);
	wizard.setButtons([
			{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}
		],config.macros.importTiddlers.statusDoingImport);
	var wizardContext = wizard.getValue("context");
	var tiddlers = wizardContext ? wizardContext.tiddlers : [];
	for(t=0; t<rowNames.length; t++) {
		var context = {
			allowSynchronous:true,
			tiddler:tiddlers[tiddlers.findByField("title",rowNames[t])]
		};
		adaptor.getTiddler(rowNames[t],context,wizard,config.macros.importTiddlers.onGetTiddler);
	}
	return false;
};

config.macros.importTiddlers.onGetTiddler = function(context,wizard)
{
	if(!context.status)
		displayMessage("Error in importTiddlers.onGetTiddler: " + context.statusText);
	var tiddler = context.tiddler;
	store.suspendNotifications();
	store.saveTiddler(tiddler.title, tiddler.title, tiddler.text, tiddler.modifier, tiddler.modified, tiddler.tags, tiddler.fields, true, tiddler.created);
	if(!wizard.getValue("sync")) {
		store.setValue(tiddler.title,'server',null);
	}
	store.resumeNotifications();
	if(!context.isSynchronous)
		store.notify(tiddler.title,true);
	var remainingImports = wizard.getValue("remainingImports")-1;
	wizard.setValue("remainingImports",remainingImports);
	if(remainingImports == 0) {
		if(context.isSynchronous) {
			store.notifyAll();
			refreshDisplay();
		}
		wizard.setButtons([
				{caption: config.macros.importTiddlers.doneLabel, tooltip: config.macros.importTiddlers.donePrompt, onClick: config.macros.importTiddlers.onClose}
			],config.macros.importTiddlers.statusDoneImport);
		autoSaveChanges();
	}
};

//--
//-- Upgrade macro
//--

config.macros.upgrade.handler = function(place)
{
	var w = new Wizard();
	w.createWizard(place,this.wizardTitle);
	w.addStep(this.step1Title,this.step1Html.format([this.source,this.source]));
	w.setButtons([{caption: this.upgradeLabel, tooltip: this.upgradePrompt, onClick: this.onClickUpgrade}]);
};

config.macros.upgrade.onClickUpgrade = function(e)
{
	var me = config.macros.upgrade;
	var w = new Wizard(this);
	if(window.location.protocol != "file:") {
		alert(me.errorCantUpgrade);
		return false;
	}
	if(story.areAnyDirty() || store.isDirty()) {
		alert(me.errorNotSaved);
		return false;
	}
	var localPath = getLocalPath(document.location.toString());
	var backupPath = getBackupPath(localPath,me.backupExtension);
	w.setValue("backupPath",backupPath);
	w.setButtons([],me.statusPreparingBackup);
	var original = loadOriginal(localPath);
	w.setButtons([],me.statusSavingBackup);
	var backup = copyFile(backupPath,localPath);
	if(!backup)
		backup = saveFile(backupPath,original);
	if(!backup) {
		w.setButtons([],me.errorSavingBackup);
		alert(me.errorSavingBackup);
		return false;
	}
	w.setButtons([],me.statusLoadingCore);
	var load = loadRemoteFile(me.source,me.onLoadCore,w);
	if(typeof load == "string") {
		w.setButtons([],me.errorLoadingCore);
		alert(me.errorLoadingCore);
		return false;
	}
	return false;
};

config.macros.upgrade.onLoadCore = function(status,params,responseText,url,xhr)
{
	var me = config.macros.upgrade;
	var w = params;
	var errMsg;
	if(!status)
		errMsg = me.errorLoadingCore;
	var newVer = me.extractVersion(responseText);
	if(!newVer)
		errMsg = me.errorCoreFormat;
	if(errMsg) {
		w.setButtons([],errMsg);
		alert(errMsg);
		return;
	}
	var onStartUpgrade = function(e) {
		w.setButtons([],me.statusSavingCore);
		var localPath = getLocalPath(document.location.toString());
		saveFile(localPath,responseText);
		w.setButtons([],me.statusReloadingCore);
		var backupPath = w.getValue("backupPath");
		var newLoc = document.location.toString() + "?time=" + new Date().convertToYYYYMMDDHHMM() + "#upgrade:[[" + encodeURI(backupPath) + "]]";
		window.setTimeout(function () {window.location = newLoc;},10);
	};
	var step2 = [me.step2Html_downgrade,me.step2Html_restore,me.step2Html_upgrade][compareVersions(version,newVer) + 1];
	w.addStep(me.step2Title,step2.format([formatVersion(newVer),formatVersion(version)]));
	w.setButtons([{caption: me.startLabel, tooltip: me.startPrompt, onClick: onStartUpgrade},{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}]);
};

config.macros.upgrade.onCancel = function(e)
{
	var me = config.macros.upgrade;
	var w = new Wizard(this);
	w.addStep(me.step3Title,me.step3Html);
	w.setButtons([]);
	return false;
};

config.macros.upgrade.extractVersion = function(upgradeFile)
{
	var re = /^var version = \{title: "([^"]+)", major: (\d+), minor: (\d+), revision: (\d+)(, beta: (\d+)){0,1}, date: new Date\("([^"]+)"\)/mg;
	var m = re.exec(upgradeFile);
	return  m ? {title: m[1], major: m[2], minor: m[3], revision: m[4], beta: m[6], date: new Date(m[7])} : null;
};

function upgradeFrom(path)
{
	var importStore = new TiddlyWiki();
	var tw = loadFile(path);
	if(window.netscape !== undefined)
		tw = convertUTF8ToUnicode(tw);
	importStore.importTiddlyWiki(tw);
	importStore.forEachTiddler(function(title,tiddler) {
		if(!store.getTiddler(title)) {
			store.addTiddler(tiddler);
		}
	});
	refreshDisplay();
	saveChanges(); //# To create appropriate Markup* sections
	alert(config.messages.upgradeDone.format([formatVersion()]));
	window.location = window.location.toString().substr(0,window.location.toString().lastIndexOf("?"));
}

//--
//-- Sync macro
//--

// Synchronisation handlers
config.syncers = {};

// Sync state.
var currSync = null;

// sync macro
config.macros.sync.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(!wikifier.isStatic)
		this.startSync(place);
};

config.macros.sync.cancelSync = function()
{
	currSync = null;
};

config.macros.sync.startSync = function(place)
{
	if(currSync)
		config.macros.sync.cancelSync();
	currSync = {};
	currSync.syncList = this.getSyncableTiddlers();
	currSync.syncTasks = this.createSyncTasks(currSync.syncList);
	this.preProcessSyncableTiddlers(currSync.syncList);
	var wizard = new Wizard();
	currSync.wizard = wizard;
	wizard.createWizard(place,this.wizardTitle);
	wizard.addStep(this.step1Title,this.step1Html);
	var markList = wizard.getElement("markList");
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	currSync.listView = ListView.create(listWrapper,currSync.syncList,this.listViewTemplate);
	this.processSyncableTiddlers(currSync.syncList);
	wizard.setButtons([{caption: this.syncLabel, tooltip: this.syncPrompt, onClick: this.doSync}]);
};

config.macros.sync.getSyncableTiddlers = function()
{
	var list = [];
	store.forEachTiddler(function(title,tiddler) {
		var syncItem = {};
		syncItem.serverType = tiddler.getServerType();
		syncItem.serverHost = tiddler.fields['server.host'];
		if(syncItem.serverType && syncItem.serverHost) {
			syncItem.adaptor = new config.adaptors[syncItem.serverType];
			syncItem.serverWorkspace = tiddler.fields['server.workspace'];
			syncItem.tiddler = tiddler;
			syncItem.title = tiddler.title;
			syncItem.isTouched = tiddler.isTouched();
			syncItem.selected = syncItem.isTouched;
			syncItem.syncStatus = config.macros.sync.syncStatusList[syncItem.isTouched ? "changedLocally" : "none"];
			syncItem.status = syncItem.syncStatus.text;
			list.push(syncItem);
		}
		});
	list.sort(function(a,b) {return a.title < b.title ? -1 : (a.title == b.title ? 0 : +1);});
	return list;
};

config.macros.sync.preProcessSyncableTiddlers = function(syncList)
{
	for(var i=0; i<syncList.length; i++) {
		var si = syncList[i];
		si.serverUrl = si.adaptor.generateTiddlerInfo(si.tiddler).uri;
	}
};

config.macros.sync.processSyncableTiddlers = function(syncList)
{
	for(var i=0; i<syncList.length; i++) {
		var si = syncList[i];
		if(si.syncStatus.display)
			si.rowElement.style.display = si.syncStatus.display;
		if(si.syncStatus.className)
			si.rowElement.className = si.syncStatus.className;
	}
};

config.macros.sync.createSyncTasks = function(syncList)
{
	var syncTasks = [];
	for(var i=0; i<syncList.length; i++) {
		var si = syncList[i];
		var r = null;
		for(var j=0; j<syncTasks.length; j++) {
			var cst = syncTasks[j];
			if(si.serverType == cst.serverType && si.serverHost == cst.serverHost && si.serverWorkspace == cst.serverWorkspace)
				r = cst;
		}
		if(r) {
			si.syncTask = r;
			r.syncItems.push(si);
		} else {
			si.syncTask = this.createSyncTask(si);
			syncTasks.push(si.syncTask);
		}
	}
	return syncTasks;
};

config.macros.sync.createSyncTask = function(syncItem)
{
	var st = {};
	st.serverType = syncItem.serverType;
	st.serverHost = syncItem.serverHost;
	st.serverWorkspace = syncItem.serverWorkspace;
	st.syncItems = [syncItem];

	var openWorkspaceCallback = function(context,syncItems) {
		if(context.status) {
			context.adaptor.getTiddlerList(context,syncItems,getTiddlerListCallback);
			return true;
		}
		displayMessage(context.statusText);
		return false;
	};

	var getTiddlerListCallback = function(context,sycnItems) {
		if(!context.status) {
			displayMessage(context.statusText);
			return false;
		}
		syncItems = context.userParams;
		var tiddlers = context.tiddlers;
		for(var i=0; i<syncItems.length; i++) {
			var si = syncItems[i];
			var f = tiddlers.findByField("title",si.title);
			if(f !== null) {
				if(tiddlers[f].fields['server.page.revision'] > si.tiddler.fields['server.page.revision']) {
					si.syncStatus = config.macros.sync.syncStatusList[si.isTouched ? 'changedBoth' : 'changedServer'];
				}
			} else {
				si.syncStatus = config.macros.sync.syncStatusList.notFound;
			}
			config.macros.sync.updateSyncStatus(si);
		}
		return true;
	};
	var context = {host:st.serverHost,workspace:st.serverWorkspace};
	syncItem.adaptor.openHost(st.serverHost);
	syncItem.adaptor.openWorkspace(st.serverWorkspace,context,st.syncItems,openWorkspaceCallback);
	return st;
};

config.macros.sync.updateSyncStatus = function(syncItem)
{
	var e = syncItem.colElements["status"];
	removeChildren(e);
	createTiddlyText(e,syncItem.syncStatus.text);
	if(syncItem.syncStatus.display)
		syncItem.rowElement.style.display = syncItem.syncStatus.display;
	if(syncItem.syncStatus.className)
		syncItem.rowElement.className = syncItem.syncStatus.className;
};

config.macros.sync.doSync = function(e)
{
	var getTiddlerCallback = function(context,syncItem) {
		if(syncItem) {
			var tiddler = context.tiddler;
			store.saveTiddler(tiddler.title,tiddler.title,tiddler.text,tiddler.modifier,tiddler.modified,tiddler.tags,tiddler.fields,true,tiddler.created);
			syncItem.syncStatus = config.macros.sync.syncStatusList.gotFromServer;
			config.macros.sync.updateSyncStatus(syncItem);
		}
	};
	var putTiddlerCallback = function(context,syncItem) {
		if(syncItem) {
			store.resetTiddler(context.title);
			syncItem.syncStatus = config.macros.sync.syncStatusList.putToServer;
			config.macros.sync.updateSyncStatus(syncItem);
		}
	};

	var rowNames = ListView.getSelectedRows(currSync.listView);
	var sl = config.macros.sync.syncStatusList;
	for(var i=0; i<currSync.syncList.length; i++) {
		var si = currSync.syncList[i];
		if(rowNames.indexOf(si.title) != -1) {
			var r = true;
			switch(si.syncStatus) {
			case sl.changedServer:
				r = si.adaptor.getTiddler(syncItem.title,null,si,getTiddlerCallback);
				break;
			case sl.notFound:
			case sl.changedLocally:
			case sl.changedBoth:
				r = si.adaptor.putTiddler(si.tiddler,null,si,putTiddlerCallback);
				break;
			default:
				break;
			}
			if(!r)
				displayMessage("Error in doSync: " + r);
		}
	}
	return false;
};

//--
//-- Manager UI for groups of tiddlers
//--

config.macros.plugins.handler = function(place,macroName,params,wikifier,paramString)
{
	var wizard = new Wizard();
	wizard.createWizard(place,this.wizardTitle);
	wizard.addStep(this.step1Title,this.step1Html);
	var markList = wizard.getElement("markList");
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	listWrapper.setAttribute("refresh","macro");
	listWrapper.setAttribute("macroName","plugins");
	listWrapper.setAttribute("params",paramString);
	this.refresh(listWrapper,paramString);
};

config.macros.plugins.refresh = function(listWrapper,params)
{
	var wizard = new Wizard(listWrapper);
	var selectedRows = [];
	ListView.forEachSelector(listWrapper,function(e,rowName) {
			if(e.checked)
				selectedRows.push(e.getAttribute("rowName"));
		});
	removeChildren(listWrapper);
	params = params.parseParams("anon");
	var plugins = installedPlugins.slice(0);
	var t,tiddler,p;
	var configTiddlers = store.getTaggedTiddlers("systemConfig");
	for(t=0; t<configTiddlers.length; t++) {
		tiddler = configTiddlers[t];
		if(plugins.findByField("title",tiddler.title) == null) {
			p = getPluginInfo(tiddler);
			p.executed = false;
			p.log.splice(0,0,this.skippedText);
			plugins.push(p);
		}
	}
	for(t=0; t<plugins.length; t++) {
		p = plugins[t];
		p.size = p.tiddler.text ? p.tiddler.text.length : 0;
		p.forced = p.tiddler.isTagged("systemConfigForce");
		p.disabled = p.tiddler.isTagged("systemConfigDisable");
		p.Selected = selectedRows.indexOf(plugins[t].title) != -1;
	}
	if(plugins.length == 0) {
		createTiddlyElement(listWrapper,"em",null,null,this.noPluginText);
		wizard.setButtons([]);
	} else {
		var listView = ListView.create(listWrapper,plugins,this.listViewTemplate,this.onSelectCommand);
		wizard.setValue("listView",listView);
		wizard.setButtons([
				{caption: config.macros.plugins.removeLabel, tooltip: config.macros.plugins.removePrompt, onClick: config.macros.plugins.doRemoveTag},
				{caption: config.macros.plugins.deleteLabel, tooltip: config.macros.plugins.deletePrompt, onClick: config.macros.plugins.doDelete}
			]);
	}
};

config.macros.plugins.doRemoveTag = function(e)
{
	var wizard = new Wizard(this);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	if(rowNames.length == 0) {
		alert(config.messages.nothingSelected);
	} else {
		for(var t=0; t<rowNames.length; t++)
			store.setTiddlerTag(rowNames[t],false,"systemConfig");
	}
};

config.macros.plugins.doDelete = function(e)
{
	var wizard = new Wizard(this);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	if(rowNames.length == 0) {
		alert(config.messages.nothingSelected);
	} else {
		if(confirm(config.macros.plugins.confirmDeleteText.format([rowNames.join(", ")]))) {
			for(var t=0; t<rowNames.length; t++) {
				store.removeTiddler(rowNames[t]);
				story.closeTiddler(rowNames[t],true);
			}
		}
	}
};

//--
//-- Message area
//--

function getMessageDiv()
{
	var msgArea = document.getElementById("messageArea");
	if(!msgArea)
		return null;
	if(!msgArea.hasChildNodes())
		createTiddlyButton(createTiddlyElement(msgArea,"div",null,"messageToolbar"),
			config.messages.messageClose.text,
			config.messages.messageClose.tooltip,
			clearMessage);
	msgArea.style.display = "block";
	return createTiddlyElement(msgArea,"div");
}

function displayMessage(text,linkText)
{
	var e = getMessageDiv();
	if(!e) {
		alert(text);
		return;
	}
	if(linkText) {
		var link = createTiddlyElement(e,"a",null,null,text);
		link.href = linkText;
		link.target = "_blank";
	} else {
		e.appendChild(document.createTextNode(text));
	}
}

function clearMessage()
{
	var msgArea = document.getElementById("messageArea");
	if(msgArea) {
		removeChildren(msgArea);
		msgArea.style.display = "none";
	}
	return false;
}

//--
//-- Refresh mechanism
//--

config.notifyTiddlers = [
	{name: "StyleSheetLayout", notify: refreshStyles},
	{name: "StyleSheetColors", notify: refreshStyles},
	{name: "StyleSheet", notify: refreshStyles},
	{name: "StyleSheetPrint", notify: refreshStyles},
	{name: "PageTemplate", notify: refreshPageTemplate},
	{name: "SiteTitle", notify: refreshPageTitle},
	{name: "SiteSubtitle", notify: refreshPageTitle},
	{name: "ColorPalette", notify: refreshColorPalette},
	{name: null, notify: refreshDisplay}
];

config.refreshers = {
	link: function(e,changeList)
		{
		var title = e.getAttribute("tiddlyLink");
		refreshTiddlyLink(e,title);
		return true;
		},

	tiddler: function(e,changeList)
		{
		var title = e.getAttribute("tiddler");
		var template = e.getAttribute("template");
		if(changeList && changeList.indexOf(title) != -1 && !story.isDirty(title))
			story.refreshTiddler(title,template,true);
		else
			refreshElements(e,changeList);
		return true;
		},

	content: function(e,changeList)
		{
		var title = e.getAttribute("tiddler");
		var force = e.getAttribute("force");
		if(force != null || changeList == null || changeList.indexOf(title) != -1) {
			removeChildren(e);
			wikify(store.getTiddlerText(title,""),e,null,store.fetchTiddler(title));
			return true;
		} else
			return false;
		},

	macro: function(e,changeList)
		{
		var macro = e.getAttribute("macroName");
		var params = e.getAttribute("params");
		if(macro)
			macro = config.macros[macro];
		if(macro && macro.refresh)
			macro.refresh(e,params);
		return true;
		}
};

config.refresherData = {
	styleSheet: "StyleSheet",
	defaultStyleSheet: "StyleSheet",
	pageTemplate: "PageTemplate",
	defaultPageTemplate: "PageTemplate",
	colorPalette: "ColorPalette",
	defaultColorPalette: "ColorPalette"
};

function refreshElements(root,changeList)
{
	var nodes = root.childNodes;
	for(var c=0; c<nodes.length; c++) {
		var e = nodes[c], type = null;
		if(e.getAttribute && (e.tagName ? e.tagName != "IFRAME" : true))
			type = e.getAttribute("refresh");
		var refresher = config.refreshers[type];
		var refreshed = false;
		if(refresher != undefined)
			refreshed = refresher(e,changeList);
		if(e.hasChildNodes() && !refreshed)
			refreshElements(e,changeList);
	}
}

function applyHtmlMacros(root,tiddler)
{
	var e = root.firstChild;
	while(e) {
		var nextChild = e.nextSibling;
		if(e.getAttribute) {
			var macro = e.getAttribute("macro");
			if(macro) {
				e.removeAttribute("macro");
				var params = "";
				var p = macro.indexOf(" ");
				if(p != -1) {
					params = macro.substr(p+1);
					macro = macro.substr(0,p);
				}
				invokeMacro(e,macro,params,null,tiddler);
			}
		}
		if(e.hasChildNodes())
			applyHtmlMacros(e,tiddler);
		e = nextChild;
	}
}

function refreshPageTemplate(title)
{
	var stash = jQuery("<div/>").appendTo("body").hide()[0];
	var display = story.getContainer();
	var nodes,t;
	if(display) {
		nodes = display.childNodes;
		for(t=nodes.length-1; t>=0; t--)
			stash.appendChild(nodes[t]);
	}
	var wrapper = document.getElementById("contentWrapper");

	var isAvailable = function(title) {
		var s = title ? title.indexOf(config.textPrimitives.sectionSeparator) : -1;
		if(s!=-1)
			title = title.substr(0,s);
		return store.tiddlerExists(title) || store.isShadowTiddler(title);
	};
	if(!title || !isAvailable(title))
		title = config.refresherData.pageTemplate;
	if(!isAvailable(title))
		title = config.refresherData.defaultPageTemplate; //# this one is always avaialable
	wrapper.innerHTML = store.getRecursiveTiddlerText(title,null,10);
	applyHtmlMacros(wrapper);
	refreshElements(wrapper);
	display = story.getContainer();
	removeChildren(display);
	if(!display)
		display = createTiddlyElement(wrapper,"div",story.containerId());
	nodes = stash.childNodes;
	for(t=nodes.length-1; t>=0; t--)
		display.appendChild(nodes[t]);
	removeNode(stash);
}

function refreshDisplay(hint)
{
	if(typeof hint == "string")
		hint = [hint];
	var e = document.getElementById("contentWrapper");
	refreshElements(e,hint);
	if(backstage.isPanelVisible()) {
		e = document.getElementById("backstage");
		refreshElements(e,hint);
	}
}

function refreshPageTitle()
{
	document.title = getPageTitle();
}

function getPageTitle()
{
	var st = wikifyPlain("SiteTitle");
	var ss = wikifyPlain("SiteSubtitle");
	return st + ((st == "" || ss == "") ? "" : " - ") + ss;
}

function refreshStyles(title,doc)
{
	setStylesheet(title == null ? "" : store.getRecursiveTiddlerText(title,"",10),title,doc || document);
}

function refreshColorPalette(title)
{
	if(!startingUp)
		refreshAll();
}

function refreshAll()
{
	refreshPageTemplate();
	refreshDisplay();
	refreshStyles("StyleSheetLayout");
	refreshStyles("StyleSheetColors");
	refreshStyles(config.refresherData.styleSheet);
	refreshStyles("StyleSheetPrint");
}

//--
//-- Options stuff
//--

config.optionHandlers = {
	'txt': {
		get: function(name) {return encodeCookie(config.options[name].toString());},
		set: function(name,value) {config.options[name] = decodeCookie(value);}
	},
	'chk': {
		get: function(name) {return config.options[name] ? "true" : "false";},
		set: function(name,value) {config.options[name] = value == "true";}
	}
};

function loadOptionsCookie()
{
	if(safeMode)
		return;
	var cookies = document.cookie.split(";");
	for(var c=0; c<cookies.length; c++) {
		var p = cookies[c].indexOf("=");
		if(p != -1) {
			var name = cookies[c].substr(0,p).trim();
			var value = cookies[c].substr(p+1).trim();
			var optType = name.substr(0,3);
			if(config.optionHandlers[optType] && config.optionHandlers[optType].set)
				config.optionHandlers[optType].set(name,value);
		}
	}
}

function saveOptionCookie(name)
{
	if(safeMode)
		return;
	var c = name + "=";
	var optType = name.substr(0,3);
	if(config.optionHandlers[optType] && config.optionHandlers[optType].get)
		c += config.optionHandlers[optType].get(name);
	c += "; expires=Fri, 1 Jan 2038 12:00:00 UTC; path=/";
	document.cookie = c;
}

function removeCookie(name)
{
	document.cookie = name + "=; expires=Thu, 01-Jan-1970 00:00:01 UTC; path=/;";
}

function encodeCookie(s)
{
	return escape(convertUnicodeToHtmlEntities(s));
}

function decodeCookie(s)
{
	s = unescape(s);
	var re = /&#[0-9]{1,5};/g;
	return s.replace(re,function($0) {return String.fromCharCode(eval($0.replace(/[&#;]/g,"")));});
}


config.macros.option.genericCreate = function(place,type,opt,className,desc)
{
	var typeInfo = config.macros.option.types[type];
	var c = document.createElement(typeInfo.elementType);
	if(typeInfo.typeValue)
		c.setAttribute("type",typeInfo.typeValue);
	c[typeInfo.eventName] = typeInfo.onChange;
	c.setAttribute("option",opt);
	c.className = className || typeInfo.className;
	if(config.optionsDesc[opt])
		c.setAttribute("title",config.optionsDesc[opt]);
	place.appendChild(c);
	if(desc != "no")
		createTiddlyText(place,config.optionsDesc[opt] || opt);
	c[typeInfo.valueField] = config.options[opt];
	return c;
};

config.macros.option.genericOnChange = function(e)
{
	var opt = this.getAttribute("option");
	if(opt) {
		var optType = opt.substr(0,3);
		var handler = config.macros.option.types[optType];
		if(handler.elementType && handler.valueField)
			config.macros.option.propagateOption(opt,handler.valueField,this[handler.valueField],handler.elementType,this);
	}
	return true;
};

config.macros.option.types = {
	'txt': {
		elementType: "input",
		valueField: "value",
		eventName: "onchange",
		className: "txtOptionInput",
		create: config.macros.option.genericCreate,
		onChange: config.macros.option.genericOnChange
	},
	'chk': {
		elementType: "input",
		valueField: "checked",
		eventName: "onclick",
		className: "chkOptionInput",
		typeValue: "checkbox",
		create: config.macros.option.genericCreate,
		onChange: config.macros.option.genericOnChange
	}
};

config.macros.option.propagateOption = function(opt,valueField,value,elementType,elem)
{
	config.options[opt] = value;
	saveOptionCookie(opt);
	var nodes = document.getElementsByTagName(elementType);
	for(var t=0; t<nodes.length; t++) {
		var optNode = nodes[t].getAttribute("option");
		if(opt == optNode && nodes[t]!=elem)
			nodes[t][valueField] = value;
	}
};

config.macros.option.handler = function(place,macroName,params,wikifier,paramString)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var opt = (params[1] && params[1].name == "anon") ? params[1].value : getParam(params,"name",null);
	var className = (params[2] && params[2].name == "anon") ? params[2].value : getParam(params,"class",null);
	var desc = getParam(params,"desc","no");
	var type = opt.substr(0,3);
	var h = config.macros.option.types[type];
	if(h && h.create)
		h.create(place,type,opt,className,desc);
};

config.macros.options.handler = function(place,macroName,params,wikifier,paramString)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var showUnknown = getParam(params,"showUnknown","no");
	var wizard = new Wizard();
	wizard.createWizard(place,this.wizardTitle);
	wizard.addStep(this.step1Title,this.step1Html);
	var markList = wizard.getElement("markList");
	var chkUnknown = wizard.getElement("chkUnknown");
	chkUnknown.checked = showUnknown == "yes";
	chkUnknown.onchange = this.onChangeUnknown;
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	wizard.setValue("listWrapper",listWrapper);
	this.refreshOptions(listWrapper,showUnknown == "yes");
};

config.macros.options.refreshOptions = function(listWrapper,showUnknown)
{
	var opts = [];
	for(var n in config.options) {
		var opt = {};
		opt.option = "";
		opt.name = n;
		opt.lowlight = !config.optionsDesc[n];
		opt.description = opt.lowlight ? this.unknownDescription : config.optionsDesc[n];
		if(!opt.lowlight || showUnknown)
			opts.push(opt);
	}
	opts.sort(function(a,b) {return a.name.substr(3) < b.name.substr(3) ? -1 : (a.name.substr(3) == b.name.substr(3) ? 0 : +1);});
	var listview = ListView.create(listWrapper,opts,this.listViewTemplate);
	for(n=0; n<opts.length; n++) {
		var type = opts[n].name.substr(0,3);
		var h = config.macros.option.types[type];
		if(h && h.create) {
			h.create(opts[n].colElements['option'],type,opts[n].name,null,"no");
		}
	}
};

config.macros.options.onChangeUnknown = function(e)
{
	var wizard = new Wizard(this);
	var listWrapper = wizard.getValue("listWrapper");
	removeChildren(listWrapper);
	config.macros.options.refreshOptions(listWrapper,this.checked);
	return false;
};

//--
//-- Saving
//--

var saveUsingSafari = false;

var startSaveArea = '<div id="' + 'storeArea">'; // Split up into two so that indexOf() of this source doesn't find it
var endSaveArea = '</d' + 'iv>';

// If there are unsaved changes, force the user to confirm before exitting
function confirmExit()
{
	hadConfirmExit = true;
	if((store && store.isDirty && store.isDirty()) || (story && story.areAnyDirty && story.areAnyDirty()))
		return config.messages.confirmExit;
}

// Give the user a chance to save changes before exitting
function checkUnsavedChanges()
{
	if(store && store.isDirty && store.isDirty() && window.hadConfirmExit === false) {
		if(confirm(config.messages.unsavedChangesWarning))
			saveChanges();
	}
}

function updateLanguageAttribute(s)
{
	if(config.locale) {
		var mRE = /(<html(?:.*?)?)(?: xml:lang\="([a-z]+)")?(?: lang\="([a-z]+)")?>/;
		var m = mRE.exec(s);
		if(m) {
			var t = m[1];
			if(m[2])
				t += ' xml:lang="' + config.locale + '"';
			if(m[3])
				t += ' lang="' + config.locale + '"';
			t += ">";
			s = s.substr(0,m.index) + t + s.substr(m.index+m[0].length);
		}
	}
	return s;
}

function updateMarkupBlock(s,blockName,tiddlerName)
{
	return s.replaceChunk(
			"<!--%0-START-->".format([blockName]),
			"<!--%0-END-->".format([blockName]),
			"\n" + convertUnicodeToFileFormat(store.getRecursiveTiddlerText(tiddlerName,"")) + "\n");
}

function updateOriginal(original,posDiv,localPath)
{
	if(!posDiv)
		posDiv = locateStoreArea(original);
	if(!posDiv) {
		alert(config.messages.invalidFileError.format([localPath]));
		return null;
	}
	var revised = original.substr(0,posDiv[0] + startSaveArea.length) + "\n" +
				convertUnicodeToFileFormat(store.allTiddlersAsHtml()) + "\n" +
				original.substr(posDiv[1]);
	var newSiteTitle = convertUnicodeToFileFormat(getPageTitle()).htmlEncode();
	revised = revised.replaceChunk("<title"+">","</title"+">"," " + newSiteTitle + " ");
	revised = updateLanguageAttribute(revised);
	revised = updateMarkupBlock(revised,"PRE-HEAD","MarkupPreHead");
	revised = updateMarkupBlock(revised,"POST-HEAD","MarkupPostHead");
	revised = updateMarkupBlock(revised,"PRE-BODY","MarkupPreBody");
	revised = updateMarkupBlock(revised,"POST-SCRIPT","MarkupPostBody");
	return revised;
}

function locateStoreArea(original)
{
	// Locate the storeArea div's
	var posOpeningDiv = original.indexOf(startSaveArea);
	var limitClosingDiv = original.indexOf("<"+"!--POST-STOREAREA--"+">");
	if(limitClosingDiv == -1)
		limitClosingDiv = original.indexOf("<"+"!--POST-BODY-START--"+">");
	var posClosingDiv = original.lastIndexOf(endSaveArea,limitClosingDiv == -1 ? original.length : limitClosingDiv);
	return (posOpeningDiv != -1 && posClosingDiv != -1) ? [posOpeningDiv,posClosingDiv] : null;
}

function autoSaveChanges(onlyIfDirty,tiddlers)
{
	if(config.options.chkAutoSave)
		saveChanges(onlyIfDirty,tiddlers);
}

function loadOriginal(localPath)
{
	return loadFile(localPath);
}

// Save this tiddlywiki with the pending changes
function saveChanges(onlyIfDirty,tiddlers)
{
	if(onlyIfDirty && !store.isDirty())
		return;
	clearMessage();
	var t0 = new Date();
	var originalPath = document.location.toString();
	if(originalPath.substr(0,5) != "file:") {
		alert(config.messages.notFileUrlError);
		if(store.tiddlerExists(config.messages.saveInstructions))
			story.displayTiddler(null,config.messages.saveInstructions);
		return;
	}
	var localPath = getLocalPath(originalPath);
	var original = loadOriginal(localPath);
	if(original == null) {
		alert(config.messages.cantSaveError);
		if(store.tiddlerExists(config.messages.saveInstructions))
			story.displayTiddler(null,config.messages.saveInstructions);
		return;
	}
	var posDiv = locateStoreArea(original);
	if(!posDiv) {
		alert(config.messages.invalidFileError.format([localPath]));
		return;
	}
	saveMain(localPath,original,posDiv);
	if(config.options.chkSaveBackups)
		saveBackup(localPath,original);
	if(config.options.chkSaveEmptyTemplate)
		saveEmpty(localPath,original,posDiv);
	if(config.options.chkGenerateAnRssFeed && saveRss instanceof Function)
		saveRss(localPath);
	if(config.options.chkDisplayInstrumentation)
		displayMessage("saveChanges " + (new Date()-t0) + " ms");
}

function saveMain(localPath,original,posDiv)
{
	var save;
	try {
		var revised = updateOriginal(original,posDiv,localPath);
		save = saveFile(localPath,revised);
	} catch (ex) {
		showException(ex);
	}
	if(save) {
		displayMessage(config.messages.mainSaved,"file://" + localPath);
		store.setDirty(false);
	} else {
		alert(config.messages.mainFailed);
	}
}

function saveBackup(localPath,original)
{
	var backupPath = getBackupPath(localPath);
	var backup = copyFile(backupPath,localPath);
	if(!backup)
		backup = saveFile(backupPath,original);
	if(backup)
		displayMessage(config.messages.backupSaved,"file://" + backupPath);
	else
		alert(config.messages.backupFailed);
}

function saveEmpty(localPath,original,posDiv)
{
	var emptyPath,p;
	if((p = localPath.lastIndexOf("/")) != -1)
		emptyPath = localPath.substr(0,p) + "/";
	else if((p = localPath.lastIndexOf("\\")) != -1)
		emptyPath = localPath.substr(0,p) + "\\";
	else
		emptyPath = localPath + ".";
	emptyPath += "empty.html";
	var empty = original.substr(0,posDiv[0] + startSaveArea.length) + original.substr(posDiv[1]);
	var emptySave = saveFile(emptyPath,empty);
	if(emptySave)
		displayMessage(config.messages.emptySaved,"file://" + emptyPath);
	else
		alert(config.messages.emptyFailed);
}

function getLocalPath(origPath)
{
	var originalPath = convertUriToUTF8(origPath,config.options.txtFileSystemCharSet);
	// Remove any location or query part of the URL
	var argPos = originalPath.indexOf("?");
	if(argPos != -1)
		originalPath = originalPath.substr(0,argPos);
	var hashPos = originalPath.indexOf("#");
	if(hashPos != -1)
		originalPath = originalPath.substr(0,hashPos);
	// Convert file://localhost/ to file:///
	if(originalPath.indexOf("file://localhost/") == 0)
		originalPath = "file://" + originalPath.substr(16);
	// Convert to a native file format
	var localPath;
	if(originalPath.charAt(9) == ":") // pc local file
		localPath = unescape(originalPath.substr(8)).replace(new RegExp("/","g"),"\\");
	else if(originalPath.indexOf("file://///") == 0) // FireFox pc network file
		localPath = "\\\\" + unescape(originalPath.substr(10)).replace(new RegExp("/","g"),"\\");
	else if(originalPath.indexOf("file:///") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(7));
	else if(originalPath.indexOf("file:/") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(5));
	else // pc network file
		localPath = "\\\\" + unescape(originalPath.substr(7)).replace(new RegExp("/","g"),"\\");
	return localPath;
}

function getBackupPath(localPath,title,extension)
{
	var slash = "\\";
	var dirPathPos = localPath.lastIndexOf("\\");
	if(dirPathPos == -1) {
		dirPathPos = localPath.lastIndexOf("/");
		slash = "/";
	}
	var backupFolder = config.options.txtBackupFolder;
	if(!backupFolder || backupFolder == "")
		backupFolder = ".";
	var backupPath = localPath.substr(0,dirPathPos) + slash + backupFolder + localPath.substr(dirPathPos);
	backupPath = backupPath.substr(0,backupPath.lastIndexOf(".")) + ".";
	if(title)
		backupPath += title.replace(/[\\\/\*\?\":<> ]/g,"_") + ".";
	backupPath += (new Date()).convertToYYYYMMDDHHMMSSMMM() + "." + (extension || "html");
	return backupPath;
}

//--
//-- RSS Saving
//--

function saveRss(localPath)
{
	var rssPath = localPath.substr(0,localPath.lastIndexOf(".")) + ".xml";
	if(saveFile(rssPath,convertUnicodeToFileFormat(generateRss())))
		displayMessage(config.messages.rssSaved,"file://" + rssPath);
	else
		alert(config.messages.rssFailed);
}

tiddlerToRssItem = function(tiddler,uri)
{
	var s = "<title" + ">" + tiddler.title.htmlEncode() + "</title" + ">\n";
	s += "<description>" + wikifyStatic(tiddler.text,null,tiddler).htmlEncode() + "</description>\n";
	for(var i=0; i<tiddler.tags.length; i++)
		s += "<category>" + tiddler.tags[i] + "</category>\n";
	s += "<link>" + uri + "#" + encodeURIComponent(String.encodeTiddlyLink(tiddler.title)) + "</link>\n";
	s +="<pubDate>" + tiddler.modified.toGMTString() + "</pubDate>\n";
	return s;
};

function generateRss()
{
	var s = [];
	var d = new Date();
	var u = store.getTiddlerText("SiteUrl");
	// Assemble the header
	s.push("<" + "?xml version=\"1.0\"?" + ">");
	s.push("<rss version=\"2.0\">");
	s.push("<channel>");
	s.push("<title" + ">" + wikifyPlain("SiteTitle").htmlEncode() + "</title" + ">");
	if(u)
		s.push("<link>" + u.htmlEncode() + "</link>");
	s.push("<description>" + wikifyPlain("SiteSubtitle").htmlEncode() + "</description>");
	s.push("<language>" + config.locale + "</language>");
	s.push("<copyright>Copyright " + d.getFullYear() + " " + config.options.txtUserName.htmlEncode() + "</copyright>");
	s.push("<pubDate>" + d.toGMTString() + "</pubDate>");
	s.push("<lastBuildDate>" + d.toGMTString() + "</lastBuildDate>");
	s.push("<docs>http://blogs.law.harvard.edu/tech/rss</docs>");
	s.push("<generator>TiddlyWiki " + formatVersion() + "</generator>");
	// The body
	var tiddlers = store.getTiddlers("modified","excludeLists");
	var n = config.numRssItems > tiddlers.length ? 0 : tiddlers.length-config.numRssItems;
	for(var i=tiddlers.length-1; i>=n; i--) {
		s.push("<item>\n" + tiddlerToRssItem(tiddlers[i],u) + "\n</item>");
	}
	// And footer
	s.push("</channel>");
	s.push("</rss>");
	// Save it all
	return s.join("\n");
}

//--
//-- Filesystem code
//--

function convertUTF8ToUnicode(u)
{
	return config.browser.isOpera || !window.netscape ? manualConvertUTF8ToUnicode(u) : mozConvertUTF8ToUnicode(u);
}

function manualConvertUTF8ToUnicode(utf)
{
	var uni = utf;
	var src = 0;
	var dst = 0;
	var b1, b2, b3;
	var c;
	while(src < utf.length) {
		b1 = utf.charCodeAt(src++);
		if(b1 < 0x80) {
			dst++;
		} else if(b1 < 0xE0) {
			b2 = utf.charCodeAt(src++);
			c = String.fromCharCode(((b1 & 0x1F) << 6) | (b2 & 0x3F));
			uni = uni.substring(0,dst++).concat(c,utf.substr(src));
		} else {
			b2 = utf.charCodeAt(src++);
			b3 = utf.charCodeAt(src++);
			c = String.fromCharCode(((b1 & 0xF) << 12) | ((b2 & 0x3F) << 6) | (b3 & 0x3F));
			uni = uni.substring(0,dst++).concat(c,utf.substr(src));
		}
	}
	return uni;
}

function mozConvertUTF8ToUnicode(u)
{
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
		converter.charset = "UTF-8";
	} catch(ex) {
		return manualConvertUTF8ToUnicode(u);
	} // fallback
	var s = converter.ConvertToUnicode(u);
	var fin = converter.Finish();
	return fin.length > 0 ? s+fin : s;
}

function convertUnicodeToFileFormat(s)
{
	if(!config.browser.isIE)
		return s;
	else
		return convertUnicodeToHtmlEntities(s);
}

function convertUnicodeToHtmlEntities(s)
{
	var re = /[^\u0000-\u007F]/g;
	return s.replace(re,function($0) {return "&#" + $0.charCodeAt(0).toString() + ";";});
}

function convertUnicodeToUTF8(s)
{
// return convertUnicodeToFileFormat to allow plugin migration
	return convertUnicodeToFileFormat(s);
}

function manualConvertUnicodeToUTF8(s)
{
	return unescape(encodeURIComponent(s));
}

function mozConvertUnicodeToUTF8(s)
{
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
		converter.charset = "UTF-8";
	} catch(ex) {
		return manualConvertUnicodeToUTF8(s);
	} // fallback
	var u = converter.ConvertFromUnicode(s);
	var fin = converter.Finish();
	return fin.length > 0 ? u + fin : u;
}

function convertUriToUTF8(uri,charSet)
{
	if(window.netscape == undefined || charSet == undefined || charSet == "")
		return uri;
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/utf8converterservice;1"].getService(Components.interfaces.nsIUTF8ConverterService);
	} catch(ex) {
		return uri;
	}
	return converter.convertURISpecToUTF8(uri,charSet);
}

//--
//-- Server adaptor base class
//--

function AdaptorBase()
{
	this.host = null;
	this.store = null;
	return this;
}

AdaptorBase.prototype.close = function()
{
	return true;
};

AdaptorBase.prototype.fullHostName = function(host)
{
	if(!host)
		return '';
	host = host.trim();
	if(!host.match(/:\/\//))
		host = 'http://' + host;
	if(host.substr(host.length-1) == '/')
		host = host.substr(0,host.length-1);
	return host;
};

AdaptorBase.minHostName = function(host)
{
	return host ? host.replace(/^http:\/\//,'').replace(/\/$/,'') : '';
};

AdaptorBase.prototype.setContext = function(context,userParams,callback)
{
	if(!context) context = {};
	context.userParams = userParams;
	if(callback) context.callback = callback;
	context.adaptor = this;
	if(!context.host)
		context.host = this.host;
	context.host = this.fullHostName(context.host);
	if(!context.workspace)
		context.workspace = this.workspace;
	return context;
};

// Open the specified host
AdaptorBase.prototype.openHost = function(host,context,userParams,callback)
{
	this.host = host;
	context = this.setContext(context,userParams,callback);
	context.status = true;
	if(callback)
		window.setTimeout(function() {context.callback(context,userParams);},10);
	return true;
};

// Open the specified workspace
AdaptorBase.prototype.openWorkspace = function(workspace,context,userParams,callback)
{
	this.workspace = workspace;
	context = this.setContext(context,userParams,callback);
	context.status = true;
	if(callback)
		window.setTimeout(function() {callback(context,userParams);},10);
	return true;
};

//--
//-- Server adaptor for talking to static TiddlyWiki files
//--

function FileAdaptor()
{
}

FileAdaptor.prototype = new AdaptorBase();

FileAdaptor.serverType = 'file';
FileAdaptor.serverLabel = 'TiddlyWiki';

FileAdaptor.loadTiddlyWikiCallback = function(status,context,responseText,url,xhr)
{
	context.status = status;
	if(!status) {
		context.statusText = "Error reading file";
	} else {
		context.adaptor.store = new TiddlyWiki();
		if(!context.adaptor.store.importTiddlyWiki(responseText)) {
			context.statusText = config.messages.invalidFileError.format([url]);
			context.status = false;
		}
	}
	context.complete(context,context.userParams);
};

// Get the list of workspaces on a given server
FileAdaptor.prototype.getWorkspaceList = function(context,userParams,callback)
{
	context = this.setContext(context,userParams,callback);
	context.workspaces = [{title:"(default)"}];
	context.status = true;
	if(callback)
		window.setTimeout(function() {callback(context,userParams);},10);
	return true;
};

// Gets the list of tiddlers within a given workspace
FileAdaptor.prototype.getTiddlerList = function(context,userParams,callback,filter)
{
	context = this.setContext(context,userParams,callback);
	if(!context.filter)
		context.filter = filter;
	context.complete = FileAdaptor.getTiddlerListComplete;
	if(this.store) {
		var ret = context.complete(context,context.userParams);
	} else {
		ret = loadRemoteFile(context.host,FileAdaptor.loadTiddlyWikiCallback,context);
		if(typeof ret != "string")
			ret = true;
	}
	return ret;
};

FileAdaptor.getTiddlerListComplete = function(context,userParams)
{
	if(context.status) {
		if(context.filter) {
			context.tiddlers = context.adaptor.store.filterTiddlers(context.filter);
		} else {
			context.tiddlers = [];
			context.adaptor.store.forEachTiddler(function(title,tiddler) {context.tiddlers.push(tiddler);});
		}
		for(var i=0; i<context.tiddlers.length; i++) {
			context.tiddlers[i].fields['server.type'] = FileAdaptor.serverType;
			context.tiddlers[i].fields['server.host'] = AdaptorBase.minHostName(context.host);
			context.tiddlers[i].fields['server.page.revision'] = context.tiddlers[i].modified.convertToYYYYMMDDHHMM();
		}
		context.status = true;
	}
	if(context.callback) {
		window.setTimeout(function() {context.callback(context,userParams);},10);
	}
	return true;
};

FileAdaptor.prototype.generateTiddlerInfo = function(tiddler)
{
	var info = {};
	info.uri = tiddler.fields['server.host'] + "#" + tiddler.title;
	return info;
};

// Retrieve a tiddler from a given workspace on a given server
FileAdaptor.prototype.getTiddler = function(title,context,userParams,callback)
{
	context = this.setContext(context,userParams,callback);
	context.title = title;
	context.complete = FileAdaptor.getTiddlerComplete;
	return context.adaptor.store ?
		context.complete(context,context.userParams) :
		loadRemoteFile(context.host,FileAdaptor.loadTiddlyWikiCallback,context);
};

FileAdaptor.getTiddlerComplete = function(context,userParams)
{
	var t = context.adaptor.store.fetchTiddler(context.title);
	t.fields['server.type'] = FileAdaptor.serverType;
	t.fields['server.host'] = AdaptorBase.minHostName(context.host);
	t.fields['server.page.revision'] = t.modified.convertToYYYYMMDDHHMM();
	context.tiddler = t;
	context.status = true;
	if(context.allowSynchronous) {
		context.isSynchronous = true;
		context.callback(context,userParams);
	} else {
		window.setTimeout(function() {context.callback(context,userParams);},10);
	}
	return true;
};

FileAdaptor.prototype.close = function()
{
	delete this.store;
	this.store = null;
};

config.adaptors[FileAdaptor.serverType] = FileAdaptor;

config.defaultAdaptor = FileAdaptor.serverType;

//--
//-- HTTP request code
//--

function ajaxReq(args)
{
	if(window.Components && window.netscape && window.netscape.security && document.location.protocol.indexOf("http") == -1)
		window.netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
	return jQuery.ajax(args);
}

//--
//-- TiddlyWiki-specific utility functions
//--

// Returns TiddlyWiki version string
function formatVersion(v)
{
	v = v || version;
	return v.major + "." + v.minor + "." + v.revision +
		(v.alpha ? " (alpha " + v.alpha + ")" : "") +
		(v.beta ? " (beta " + v.beta + ")" : "");
}

function compareVersions(v1,v2)
{
	var a = ["major","minor","revision"];
	for(var i = 0; i<a.length; i++) {
		var x1 = v1[a[i]] || 0;
		var x2 = v2[a[i]] || 0;
		if(x1<x2)
			return 1;
		if(x1>x2)
			return -1;
	}
	x1 = v1.beta || 9999;
	x2 = v2.beta || 9999;
	if(x1<x2)
		return 1;
	return x1 > x2 ? -1 : 0;
}

function createTiddlyButton(parent,text,tooltip,action,className,id,accessKey,attribs)
{
	var btn = document.createElement("a");
	if(action) {
		btn.onclick = action;
		btn.setAttribute("href","javascript:;");
	}
	if(tooltip)
		btn.setAttribute("title",tooltip);
	if(text)
		btn.appendChild(document.createTextNode(text));
	btn.className = className || "button";
	if(id)
		btn.id = id;
	if(attribs) {
		for(var i in attribs) {
			btn.setAttribute(i,attribs[i]);
		}
	}
	if(parent)
		parent.appendChild(btn);
	if(accessKey)
		btn.setAttribute("accessKey",accessKey);
	return btn;
}

function createTiddlyLink(place,title,includeText,className,isStatic,linkedFromTiddler,noToggle)
{
	var text = includeText ? title : null;
	var i = getTiddlyLinkInfo(title,className);
	var btn = isStatic ? createExternalLink(place,store.getTiddlerText("SiteUrl",null) + "#" + title) : createTiddlyButton(place,text,i.subTitle,onClickTiddlerLink,i.classes);
	if(isStatic)
		btn.className += ' ' + className;
	btn.setAttribute("refresh","link");
	btn.setAttribute("tiddlyLink",title);
	if(noToggle)
		btn.setAttribute("noToggle","true");
	if(linkedFromTiddler) {
		var fields = linkedFromTiddler.getInheritedFields();
		if(fields)
			btn.setAttribute("tiddlyFields",fields);
	}
	return btn;
}

function refreshTiddlyLink(e,title)
{
	var i = getTiddlyLinkInfo(title,e.className);
	e.className = i.classes;
	e.title = i.subTitle;
}

function getTiddlyLinkInfo(title,currClasses)
{
	var classes = currClasses ? currClasses.split(" ") : [];
	classes.pushUnique("tiddlyLink");
	var tiddler = store.fetchTiddler(title);
	var subTitle;
	if(tiddler) {
		subTitle = tiddler.getSubtitle();
		classes.pushUnique("tiddlyLinkExisting");
		classes.remove("tiddlyLinkNonExisting");
		classes.remove("shadow");
	} else {
		classes.remove("tiddlyLinkExisting");
		classes.pushUnique("tiddlyLinkNonExisting");
		if(store.isShadowTiddler(title)) {
			subTitle = config.messages.shadowedTiddlerToolTip.format([title]);
			classes.pushUnique("shadow");
		} else {
			subTitle = config.messages.undefinedTiddlerToolTip.format([title]);
			classes.remove("shadow");
		}
	}
	if(typeof config.annotations[title]=="string")
		subTitle = config.annotations[title];
	return {classes: classes.join(" "),subTitle: subTitle};
}

function createExternalLink(place,url)
{
	var link = document.createElement("a");
	link.className = "externalLink";
	link.href = url;
	link.title = config.messages.externalLinkTooltip.format([url]);
	if(config.options.chkOpenInNewWindow)
		link.target = "_blank";
	place.appendChild(link);
	return link;
}

// Event handler for clicking on a tiddly link
function onClickTiddlerLink(ev)
{
	var e = ev || window.event;
	var target = resolveTarget(e);
	var link = target;
	var title = null;
	var fields = null;
	var noToggle = null;
	do {
		title = link.getAttribute("tiddlyLink");
		fields = link.getAttribute("tiddlyFields");
		noToggle = link.getAttribute("noToggle");
		link = link.parentNode;
	} while(title == null && link != null);
	if(!store.isShadowTiddler(title)) {
		var f = fields ? fields.decodeHashMap() : {};
		fields = String.encodeHashMap(merge(f,config.defaultCustomFields,true));
	}
	if(title) {
		var toggling = e.metaKey || e.ctrlKey;
		if(config.options.chkToggleLinks)
			toggling = !toggling;
		if(noToggle)
			toggling = false;
		if(store.getTiddler(title))
			fields = null;
		story.displayTiddler(target,title,null,true,null,fields,toggling);
	}
	clearMessage();
	return false;
}

// Create a button for a tag with a popup listing all the tiddlers that it tags
function createTagButton(place,tag,excludeTiddler,title,tooltip)
{
	var btn = createTiddlyButton(place,title||tag,(tooltip||config.views.wikified.tag.tooltip).format([tag]),onClickTag);
	btn.setAttribute("tag",tag);
	if(excludeTiddler)
		btn.setAttribute("tiddler",excludeTiddler);
	return btn;
}

// Event handler for clicking on a tiddler tag
function onClickTag(ev)
{
	var e = ev || window.event;
	var popup = Popup.create(this);
	var tag = this.getAttribute("tag");
	var title = this.getAttribute("tiddler");
	if(popup && tag) {
		var tagged = store.getTaggedTiddlers(tag);
		var titles = [];
		var li,r;
		for(r=0;r<tagged.length;r++) {
			if(tagged[r].title != title)
				titles.push(tagged[r].title);
		}
		var lingo = config.views.wikified.tag;
		if(titles.length > 0) {
			var openAll = createTiddlyButton(createTiddlyElement(popup,"li"),lingo.openAllText.format([tag]),lingo.openAllTooltip,onClickTagOpenAll);
			openAll.setAttribute("tag",tag);
			createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
			for(r=0; r<titles.length; r++) {
				createTiddlyLink(createTiddlyElement(popup,"li"),titles[r],true);
			}
		} else {
			createTiddlyElement(popup,"li",null,"disabled",lingo.popupNone.format([tag]));
		}
		createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
		var h = createTiddlyLink(createTiddlyElement(popup,"li"),tag,false);
		createTiddlyText(h,lingo.openTag.format([tag]));
	}
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
}

// Event handler for 'open all' on a tiddler popup
function onClickTagOpenAll(ev)
{
	var tiddlers = store.getTaggedTiddlers(this.getAttribute("tag"));
	story.displayTiddlers(this,tiddlers);
	return false;
}

function onClickError(ev)
{
	var e = ev || window.event;
	var popup = Popup.create(this);
	var lines = this.getAttribute("errorText").split("\n");
	for(var t=0; t<lines.length; t++)
		createTiddlyElement(popup,"li",null,null,lines[t]);
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
}

function createTiddlyDropDown(place,onchange,options,defaultValue)
{
	var sel = createTiddlyElement(place,"select");
	sel.onchange = onchange;
	for(var t=0; t<options.length; t++) {
		var e = createTiddlyElement(sel,"option",null,null,options[t].caption);
		e.value = options[t].name;
		if(options[t].name == defaultValue)
			e.selected = true;
	}
	return sel;
}

function createTiddlyPopup(place,caption,tooltip,tiddler)
{
	if(tiddler.text) {
		createTiddlyLink(place,caption,true);
		var btn = createTiddlyButton(place,glyph("downArrow"),tooltip,onClickTiddlyPopup,"tiddlerPopupButton");
		btn.tiddler = tiddler;
	} else {
		createTiddlyText(place,caption);
	}
}

function onClickTiddlyPopup(ev)
{
	var e = ev || window.event;
	var tiddler = this.tiddler;
	if(tiddler.text) {
		var popup = Popup.create(this,"div","popupTiddler");
		wikify(tiddler.text,popup,null,tiddler);
		Popup.show();
	}
	if(e) e.cancelBubble = true;
	if(e && e.stopPropagation) e.stopPropagation();
	return false;
}

function createTiddlyError(place,title,text)
{
	var btn = createTiddlyButton(place,title,null,onClickError,"errorButton");
	if(text) btn.setAttribute("errorText",text);
}

function merge(dst,src,preserveExisting)
{
	for(var i in src) {
		if(!preserveExisting || dst[i] === undefined)
			dst[i] = src[i];
	}
	return dst;
}

// Returns a string containing the description of an exception, optionally prepended by a message
function exceptionText(e,message)
{
	var s = e.description || e.toString();
	return message ? "%0:\n%1".format([message,s]) : s;
}

// Displays an alert of an exception description with optional message
function showException(e,message)
{
	alert(exceptionText(e,message));
}

function alertAndThrow(m)
{
	alert(m);
	throw(m);
}

function glyph(name)
{
	var g = config.glyphs;
	var b = g.currBrowser;
	if(b == null) {
		b = 0;
		while(!g.browsers[b]() && b < g.browsers.length-1)
			b++;
		g.currBrowser = b;
	}
	if(!g.codes[name])
		return "";
	return g.codes[name][b];
}

if(!window.console) {
	console = {tiddlywiki:true,log:function(message) {displayMessage(message);}};
}

//-
//- Animation engine
//-

function Animator()
{
	this.running = 0; // Incremented at start of each animation, decremented afterwards. If zero, the interval timer is disabled
	this.timerID = 0; // ID of the timer used for animating
	this.animations = []; // List of animations in progress
	return this;
}

// Start animation engine
Animator.prototype.startAnimating = function() //# Variable number of arguments
{
	for(var t=0; t<arguments.length; t++)
		this.animations.push(arguments[t]);
	if(this.running == 0) {
		var me = this;
		this.timerID = window.setInterval(function() {me.doAnimate(me);},10);
	}
	this.running += arguments.length;
};

// Perform an animation engine tick, calling each of the known animation modules
Animator.prototype.doAnimate = function(me)
{
	var a = 0;
	while(a < me.animations.length) {
		var animation = me.animations[a];
		if(animation.tick()) {
			a++;
		} else {
			me.animations.splice(a,1);
			if(--me.running == 0)
				window.clearInterval(me.timerID);
		}
	}
};

Animator.slowInSlowOut = function(progress)
{
	return(1-((Math.cos(progress * Math.PI)+1)/2));
};

//--
//-- Morpher animation
//--

// Animate a set of properties of an element
function Morpher(element,duration,properties,callback)
{
	this.element = element;
	this.duration = duration;
	this.properties = properties;
	this.startTime = new Date();
	this.endTime = Number(this.startTime) + duration;
	this.callback = callback;
	this.tick();
	return this;
}

Morpher.prototype.assignStyle = function(element,style,value)
{
	switch(style) {
	case "-tw-vertScroll":
		window.scrollTo(findScrollX(),value);
		break;
	case "-tw-horizScroll":
		window.scrollTo(value,findScrollY());
		break;
	default:
		element.style[style] = value;
		break;
	}
};

Morpher.prototype.stop = function()
{
	for(var t=0; t<this.properties.length; t++) {
		var p = this.properties[t];
		if(p.atEnd !== undefined) {
			this.assignStyle(this.element,p.style,p.atEnd);
		}
	}
	if(this.callback)
		this.callback(this.element,this.properties);
};

Morpher.prototype.tick = function()
{
	var currTime = Number(new Date());
	var progress = Animator.slowInSlowOut(Math.min(1,(currTime-this.startTime)/this.duration));
	for(var t=0; t<this.properties.length; t++) {
		var p = this.properties[t];
		if(p.start !== undefined && p.end !== undefined) {
			var template = p.template || "%0";
			switch(p.format) {
			case undefined:
			case "style":
				var v = p.start + (p.end-p.start) * progress;
				this.assignStyle(this.element,p.style,template.format([v]));
				break;
			case "color":
				break;
			}
		}
	}
	if(currTime >= this.endTime) {
		this.stop();
		return false;
	}
	return true;
};

//--
//-- Zoomer animation
//--

function Zoomer(text,startElement,targetElement,unused)
{
	var e = createTiddlyElement(document.body,"div",null,"zoomer");
	createTiddlyElement(e,"div",null,null,text);
	var winWidth = findWindowWidth();
	var winHeight = findWindowHeight();
	var p = [
		{style: 'left', start: findPosX(startElement), end: findPosX(targetElement), template: '%0px'},
		{style: 'top', start: findPosY(startElement), end: findPosY(targetElement), template: '%0px'},
		{style: 'width', start: Math.min(startElement.scrollWidth,winWidth), end: Math.min(targetElement.scrollWidth,winWidth), template: '%0px', atEnd: 'auto'},
		{style: 'height', start: Math.min(startElement.scrollHeight,winHeight), end: Math.min(targetElement.scrollHeight,winHeight), template: '%0px', atEnd: 'auto'},
		{style: 'fontSize', start: 8, end: 24, template: '%0pt'}
	];
	var c = function(element,properties) {removeNode(element);};
	return new Morpher(e,config.animDuration,p,c);
}

//--
//-- Scroller animation
//--

function Scroller(targetElement)
{
	var p = [{style: '-tw-vertScroll', start: findScrollY(), end: ensureVisible(targetElement)}];
	return new Morpher(targetElement,config.animDuration,p);
}

//--
//-- Slider animation
//--

// deleteMode - "none", "all" [delete target element and it's children], [only] "children" [but not the target element]
function Slider(element,opening,unused,deleteMode)
{
	element.style.overflow = 'hidden';
	if(opening)
		element.style.height = '0px'; // Resolves a Firefox flashing bug
	element.style.display = 'block';
	var left = findPosX(element);
	var width = element.scrollWidth;
	var height = element.scrollHeight;
	var winWidth = findWindowWidth();
	var p = [];
	var c = null;
	if(opening) {
		p.push({style: 'height', start: 0, end: height, template: '%0px', atEnd: 'auto'});
		p.push({style: 'opacity', start: 0, end: 1, template: '%0'});
		p.push({style: 'filter', start: 0, end: 100, template: 'alpha(opacity:%0)'});
	} else {
		p.push({style: 'height', start: height, end: 0, template: '%0px'});
		p.push({style: 'display', atEnd: 'none'});
		p.push({style: 'opacity', start: 1, end: 0, template: '%0'});
		p.push({style: 'filter', start: 100, end: 0, template: 'alpha(opacity:%0)'});
		switch(deleteMode) {
		case "all":
			c = function(element,properties) {removeNode(element);};
			break;
		case "children":
			c = function(element,properties) {removeChildren(element);};
			break;
		}
	}
	return new Morpher(element,config.animDuration,p,c);
}

//--
//-- Popup menu
//--

var Popup = {
	stack: [] // Array of objects with members root: and popup:
	};

Popup.create = function(root,elem,className)
{
	var stackPosition = this.find(root,"popup");
	Popup.remove(stackPosition+1);
	var popup = createTiddlyElement(document.body,elem || "ol","popup",className || "popup");
	popup.stackPosition = stackPosition;
	Popup.stack.push({root: root, popup: popup});
	return popup;
};

Popup.onDocumentClick = function(ev)
{
	var e = ev || window.event;
	if(e.eventPhase == undefined)
		Popup.remove();
	else if(e.eventPhase == Event.BUBBLING_PHASE || e.eventPhase == Event.AT_TARGET)
		Popup.remove();
	return true;
};

Popup.show = function(valign,halign,offset)
{
	var curr = Popup.stack[Popup.stack.length-1];
	this.place(curr.root,curr.popup,valign,halign,offset);
	addClass(curr.root,"highlight");
	if(config.options.chkAnimate && anim && typeof Scroller == "function")
		anim.startAnimating(new Scroller(curr.popup));
	else
		window.scrollTo(0,ensureVisible(curr.popup));
};

Popup.place = function(root,popup,valign,halign,offset)
{
	if(!offset)
		var offset = {x:0,y:0};
	if(popup.stackPosition >= 0 && !valign && !halign) {
		offset.x = offset.x + root.offsetWidth;
	} else {
		offset.x = (halign == "right") ? offset.x + root.offsetWidth : offset.x;
		offset.y = (valign == "top") ? offset.y : offset.y + root.offsetHeight;
	}
	var rootLeft = findPosX(root);
	var rootTop = findPosY(root);
	var popupLeft = rootLeft + offset.x;
	var popupTop = rootTop + offset.y;
	var winWidth = findWindowWidth();
	if(popup.offsetWidth > winWidth*0.75)
		popup.style.width = winWidth*0.75 + "px";
	var popupWidth = popup.offsetWidth;
	var scrollWidth = winWidth - document.body.offsetWidth;
	if(popupLeft + popupWidth > winWidth - scrollWidth - 1) {
		if(halign == "right")
			popupLeft = popupLeft - root.offsetWidth - popupWidth;
		else
			popupLeft = winWidth - popupWidth - scrollWidth - 1;
	}
	popup.style.left = popupLeft + "px";
	popup.style.top = popupTop + "px";
	popup.style.display = "block";
};

Popup.find = function(e)
{
	var pos = -1;
	for (var t=this.stack.length-1; t>=0; t--) {
		if(isDescendant(e,this.stack[t].popup))
			pos = t;
	}
	return pos;
};

Popup.remove = function(pos)
{
	if(!pos) var pos = 0;
	if(Popup.stack.length > pos) {
		Popup.removeFrom(pos);
	}
};

Popup.removeFrom = function(from)
{
	for(var t=Popup.stack.length-1; t>=from; t--) {
		var p = Popup.stack[t];
		removeClass(p.root,"highlight");
		removeNode(p.popup);
	}
	Popup.stack = Popup.stack.slice(0,from);
};

//--
//-- Wizard support
//--

function Wizard(elem)
{
	if(elem) {
		this.formElem = findRelated(elem,"wizard","className");
		this.bodyElem = findRelated(this.formElem.firstChild,"wizardBody","className","nextSibling");
		this.footElem = findRelated(this.formElem.firstChild,"wizardFooter","className","nextSibling");
	} else {
		this.formElem = null;
		this.bodyElem = null;
		this.footElem = null;
	}
}

Wizard.prototype.setValue = function(name,value)
{
	if(this.formElem)
		this.formElem[name] = value;
};

Wizard.prototype.getValue = function(name)
{
	return this.formElem ? this.formElem[name] : null;
};

Wizard.prototype.createWizard = function(place,title)
{
	this.formElem = createTiddlyElement(place,"form",null,"wizard");
	createTiddlyElement(this.formElem,"h1",null,null,title);
	this.bodyElem = createTiddlyElement(this.formElem,"div",null,"wizardBody");
	this.footElem = createTiddlyElement(this.formElem,"div",null,"wizardFooter");
};

Wizard.prototype.clear = function()
{
	removeChildren(this.bodyElem);
};

Wizard.prototype.setButtons = function(buttonInfo,status)
{
	removeChildren(this.footElem);
	for(var t=0; t<buttonInfo.length; t++) {
		createTiddlyButton(this.footElem,buttonInfo[t].caption,buttonInfo[t].tooltip,buttonInfo[t].onClick);
		insertSpacer(this.footElem);
		}
	if(typeof status == "string") {
		createTiddlyElement(this.footElem,"span",null,"status",status);
	}
};

Wizard.prototype.addStep = function(stepTitle,html)
{
	removeChildren(this.bodyElem);
	var w = createTiddlyElement(this.bodyElem,"div");
	createTiddlyElement(w,"h2",null,null,stepTitle);
	var step = createTiddlyElement(w,"div",null,"wizardStep");
	step.innerHTML = html;
	applyHtmlMacros(step,tiddler);
};

Wizard.prototype.getElement = function(name)
{
	return this.formElem.elements[name];
};

//--
//-- ListView gadget
//--

var ListView = {};

// Create a listview
ListView.create = function(place,listObject,listTemplate,callback,className)
{
	var table = createTiddlyElement(place,"table",null,className || "listView twtable");
	var thead = createTiddlyElement(table,"thead");
	var r = createTiddlyElement(thead,"tr");
	for(var t=0; t<listTemplate.columns.length; t++) {
		var columnTemplate = listTemplate.columns[t];
		var c = createTiddlyElement(r,"th");
		var colType = ListView.columnTypes[columnTemplate.type];
		if(colType && colType.createHeader) {
			colType.createHeader(c,columnTemplate,t);
			if(columnTemplate.className)
				addClass(c,columnTemplate.className);
		}
	}
	var tbody = createTiddlyElement(table,"tbody");
	for(var rc=0; rc<listObject.length; rc++) {
		var rowObject = listObject[rc];
		r = createTiddlyElement(tbody,"tr");
		for(c=0; c<listTemplate.rowClasses.length; c++) {
			if(rowObject[listTemplate.rowClasses[c].field])
				addClass(r,listTemplate.rowClasses[c].className);
		}
		rowObject.rowElement = r;
		rowObject.colElements = {};
		for(var cc=0; cc<listTemplate.columns.length; cc++) {
			c = createTiddlyElement(r,"td");
			columnTemplate = listTemplate.columns[cc];
			var field = columnTemplate.field;
			colType = ListView.columnTypes[columnTemplate.type];
			if(colType && colType.createItem) {
				colType.createItem(c,rowObject,field,columnTemplate,cc,rc);
				if(columnTemplate.className)
					addClass(c,columnTemplate.className);
			}
			rowObject.colElements[field] = c;
		}
	}
	if(callback && listTemplate.actions)
		createTiddlyDropDown(place,ListView.getCommandHandler(callback),listTemplate.actions);
	if(callback && listTemplate.buttons) {
		for(t=0; t<listTemplate.buttons.length; t++) {
			var a = listTemplate.buttons[t];
			if(a && a.name != "")
				createTiddlyButton(place,a.caption,null,ListView.getCommandHandler(callback,a.name,a.allowEmptySelection));
		}
	}
	return table;
};

ListView.getCommandHandler = function(callback,name,allowEmptySelection)
{
	return function(e) {
		var view = findRelated(this,"TABLE",null,"previousSibling");
		var tiddlers = [];
		ListView.forEachSelector(view,function(e,rowName) {
					if(e.checked)
						tiddlers.push(rowName);
					});
		if(tiddlers.length == 0 && !allowEmptySelection) {
			alert(config.messages.nothingSelected);
		} else {
			if(this.nodeName.toLowerCase() == "select") {
				callback(view,this.value,tiddlers);
				this.selectedIndex = 0;
			} else {
				callback(view,name,tiddlers);
			}
		}
	};
};

// Invoke a callback for each selector checkbox in the listview
ListView.forEachSelector = function(view,callback)
{
	var checkboxes = view.getElementsByTagName("input");
	var hadOne = false;
	for(var t=0; t<checkboxes.length; t++) {
		var cb = checkboxes[t];
		if(cb.getAttribute("type") == "checkbox") {
			var rn = cb.getAttribute("rowName");
			if(rn) {
				callback(cb,rn);
				hadOne = true;
			}
		}
	}
	return hadOne;
};

ListView.getSelectedRows = function(view)
{
	var rowNames = [];
	ListView.forEachSelector(view,function(e,rowName) {
				if(e.checked)
					rowNames.push(rowName);
				});
	return rowNames;
};

ListView.columnTypes = {};

ListView.columnTypes.String = {
	createHeader: function(place,columnTemplate,col)
		{
			createTiddlyText(place,columnTemplate.title);
		},
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				createTiddlyText(place,v);
		}
};

ListView.columnTypes.WikiText = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				wikify(v,place,null,null);
		}
};

ListView.columnTypes.Tiddler = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined && v.title)
				createTiddlyPopup(place,v.title,config.messages.listView.tiddlerTooltip,v);
		}
};

ListView.columnTypes.Size = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined) {
				var t = 0;
				while(t<config.messages.sizeTemplates.length-1 && v<config.messages.sizeTemplates[t].unit)
					t++;
				createTiddlyText(place,config.messages.sizeTemplates[t].template.format([Math.round(v/config.messages.sizeTemplates[t].unit)]));
			}
		}
};

ListView.columnTypes.Link = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			var c = columnTemplate.text;
			if(v != undefined)
				createTiddlyText(createExternalLink(place,v),c || v);
		}
};

ListView.columnTypes.Date = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				createTiddlyText(place,v.formatString(columnTemplate.dateFormat));
		}
};

ListView.columnTypes.StringList = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined) {
				for(var t=0; t<v.length; t++) {
					createTiddlyText(place,v[t]);
					createTiddlyElement(place,"br");
				}
			}
		}
};

ListView.columnTypes.Selector = {
	createHeader: function(place,columnTemplate,col)
		{
			createTiddlyCheckbox(place,null,false,this.onHeaderChange);
		},
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var e = createTiddlyCheckbox(place,null,listObject[field],null);
			e.setAttribute("rowName",listObject[columnTemplate.rowName]);
		},
	onHeaderChange: function(e)
		{
			var state = this.checked;
			var view = findRelated(this,"TABLE");
			if(!view)
				return;
			ListView.forEachSelector(view,function(e,rowName) {
								e.checked = state;
							});
		}
};

ListView.columnTypes.Tags = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var tags = listObject[field];
			createTiddlyText(place,String.encodeTiddlyLinkList(tags));
		}
};

ListView.columnTypes.Boolean = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			if(listObject[field] == true)
				createTiddlyText(place,columnTemplate.trueText);
			if(listObject[field] == false)
				createTiddlyText(place,columnTemplate.falseText);
		}
};

ListView.columnTypes.TagCheckbox = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var e = createTiddlyCheckbox(place,null,listObject[field],this.onChange);
			e.setAttribute("tiddler",listObject.title);
			e.setAttribute("tag",columnTemplate.tag);
		},
	onChange : function(e)
		{
			var tag = this.getAttribute("tag");
			var tiddler = this.getAttribute("tiddler");
			store.setTiddlerTag(tiddler,this.checked,tag);
		}
};

ListView.columnTypes.TiddlerLink = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined) {
				var link = createTiddlyLink(place,listObject[columnTemplate.tiddlerLink],false,null);
				createTiddlyText(link,listObject[field]);
			}
		}
};

//--
//-- Augmented methods for the JavaScript Number(), Array(), String() and Date() objects
//--

// Clamp a number to a range
Number.prototype.clamp = function(min,max)
{
	var c = this;
	if(c < min)
		c = min;
	if(c > max)
		c = max;
	return Number(c);
};

// Add indexOf function if browser does not support it
if(!Array.indexOf) {
Array.prototype.indexOf = function(item,from)
{
	if(!from)
		from = 0;
	for(var i=from; i<this.length; i++) {
		if(this[i] === item)
			return i;
	}
	return -1;
};}

// Find an entry in a given field of the members of an array
Array.prototype.findByField = function(field,value)
{
	for(var t=0; t<this.length; t++) {
		if(this[t][field] === value)
			return t;
	}
	return null;
};

// Return whether an entry exists in an array
Array.prototype.contains = function(item)
{
	return this.indexOf(item) != -1;
};

// Adds, removes or toggles a particular value within an array
//  value - value to add
//  mode - +1 to add value, -1 to remove value, 0 to toggle it
Array.prototype.setItem = function(value,mode)
{
	var p = this.indexOf(value);
	if(mode == 0)
		mode = (p == -1) ? +1 : -1;
	if(mode == +1) {
		if(p == -1)
			this.push(value);
	} else if(mode == -1) {
		if(p != -1)
			this.splice(p,1);
	}
};

// Return whether one of a list of values exists in an array
Array.prototype.containsAny = function(items)
{
	for(var i=0; i<items.length; i++) {
		if(this.indexOf(items[i]) != -1)
			return true;
	}
	return false;
};

// Return whether all of a list of values exists in an array
Array.prototype.containsAll = function(items)
{
	for(var i = 0; i<items.length; i++) {
		if(this.indexOf(items[i]) == -1)
			return false;
	}
	return true;
};

// Push a new value into an array only if it is not already present in the array. If the optional unique parameter is false, it reverts to a normal push
Array.prototype.pushUnique = function(item,unique)
{
	if(unique === false) {
		this.push(item);
	} else {
		if(this.indexOf(item) == -1)
			this.push(item);
	}
};

Array.prototype.remove = function(item)
{
	var p = this.indexOf(item);
	if(p != -1)
		this.splice(p,1);
};

if(!Array.prototype.map) {
Array.prototype.map = function(fn,thisObj)
{
	var scope = thisObj || window;
	var a = [];
	for(var i=0, j=this.length; i < j; ++i) {
		a.push(fn.call(scope,this[i],i,this));
	}
	return a;
};}

// Get characters from the right end of a string
String.prototype.right = function(n)
{
	return n < this.length ? this.slice(this.length-n) : this;
};

// Trim whitespace from both ends of a string
String.prototype.trim = function()
{
	return this.replace(/^\s*|\s*$/g,"");
};

// Convert a string from a CSS style property name to a JavaScript style name ("background-color" -> "backgroundColor")
String.prototype.unDash = function()
{
	var s = this.split("-");
	if(s.length > 1) {
		for(var t=1; t<s.length; t++)
			s[t] = s[t].substr(0,1).toUpperCase() + s[t].substr(1);
	}
	return s.join("");
};

// Substitute substrings from an array into a format string that includes '%1'-type specifiers
String.prototype.format = function(substrings)
{
	var subRegExp = /(?:%(\d+))/mg;
	var currPos = 0;
	var r = [];
	do {
		var match = subRegExp.exec(this);
		if(match && match[1]) {
			if(match.index > currPos)
				r.push(this.substring(currPos,match.index));
			r.push(substrings[parseInt(match[1])]);
			currPos = subRegExp.lastIndex;
		}
	} while(match);
	if(currPos < this.length)
		r.push(this.substring(currPos,this.length));
	return r.join("");
};

// Escape any special RegExp characters with that character preceded by a backslash
String.prototype.escapeRegExp = function()
{
	var s = "\\^$*+?()=!|,{}[].";
	var c = this;
	for(var t=0; t<s.length; t++)
		c = c.replace(new RegExp("\\" + s.substr(t,1),"g"),"\\" + s.substr(t,1));
	return c;
};

// Convert "\" to "\s", newlines to "\n" (and remove carriage returns)
String.prototype.escapeLineBreaks = function()
{
	return this.replace(/\\/mg,"\\s").replace(/\n/mg,"\\n").replace(/\r/mg,"");
};

// Convert "\n" to newlines, "\b" to " ", "\s" to "\" (and remove carriage returns)
String.prototype.unescapeLineBreaks = function()
{
	return this.replace(/\\n/mg,"\n").replace(/\\b/mg," ").replace(/\\s/mg,"\\").replace(/\r/mg,"");
};

// Convert & to "&amp;", < to "&lt;", > to "&gt;" and " to "&quot;"
String.prototype.htmlEncode = function()
{
	return this.replace(/&/mg,"&amp;").replace(/</mg,"&lt;").replace(/>/mg,"&gt;").replace(/\"/mg,"&quot;");
};

// Convert "&amp;" to &, "&lt;" to <, "&gt;" to > and "&quot;" to "
String.prototype.htmlDecode = function()
{
	return this.replace(/&lt;/mg,"<").replace(/&gt;/mg,">").replace(/&quot;/mg,"\"").replace(/&amp;/mg,"&");
};

// Convert a string to it's JSON representation by encoding control characters, double quotes and backslash. See json.org
String.prototype.toJSONString = function()
{
	var m = {
		'\b': '\\b',
		'\f': '\\f',
		'\n': '\\n',
		'\r': '\\r',
		'\t': '\\t',
		'"' : '\\"',
		'\\': '\\\\'
		};
	var replaceFn = function(a,b) {
		var c = m[b];
		if(c)
			return c;
		c = b.charCodeAt();
		return '\\u00' + Math.floor(c / 16).toString(16) + (c % 16).toString(16);
		};
	if(/["\\\x00-\x1f]/.test(this))
		return '"' + this.replace(/([\x00-\x1f\\"])/g,replaceFn) + '"';
	return '"' + this + '"';
};

// Parse a space-separated string of name:value parameters
// The result is an array of objects:
//   result[0] = object with a member for each parameter name, value of that member being an array of values
//   result[1..n] = one object for each parameter, with 'name' and 'value' members
String.prototype.parseParams = function(defaultName,defaultValue,allowEval,noNames,cascadeDefaults)
{
	var parseToken = function(match,p) {
		var n;
		if(match[p]) // Double quoted
			n = match[p];
		else if(match[p+1]) // Single quoted
			n = match[p+1];
		else if(match[p+2]) // Double-square-bracket quoted
			n = match[p+2];
		else if(match[p+3]) // Double-brace quoted
			try {
				n = match[p+3];
				if(allowEval)
					n = window.eval(n);
			} catch(ex) {
				throw "Unable to evaluate {{" + match[p+3] + "}}: " + exceptionText(ex);
			}
		else if(match[p+4]) // Unquoted
			n = match[p+4];
		else if(match[p+5]) // empty quote
			n = "";
		return n;
	};
	var r = [{}];
	var dblQuote = "(?:\"((?:(?:\\\\\")|[^\"])+)\")";
	var sngQuote = "(?:'((?:(?:\\\\\')|[^'])+)')";
	var dblSquare = "(?:\\[\\[((?:\\s|\\S)*?)\\]\\])";
	var dblBrace = "(?:\\{\\{((?:\\s|\\S)*?)\\}\\})";
	var unQuoted = noNames ? "([^\"'\\s]\\S*)" : "([^\"':\\s][^\\s:]*)";
	var emptyQuote = "((?:\"\")|(?:''))";
	var skipSpace = "(?:\\s*)";
	var token = "(?:" + dblQuote + "|" + sngQuote + "|" + dblSquare + "|" + dblBrace + "|" + unQuoted + "|" + emptyQuote + ")";
	var re = noNames ? new RegExp(token,"mg") : new RegExp(skipSpace + token + skipSpace + "(?:(\\:)" + skipSpace + token + ")?","mg");
	var params = [];
	do {
		var match = re.exec(this);
		if(match) {
			var n = parseToken(match,1);
			if(noNames) {
				r.push({name:"",value:n});
			} else {
				var v = parseToken(match,8);
				if(v == null && defaultName) {
					v = n;
					n = defaultName;
				} else if(v == null && defaultValue) {
					v = defaultValue;
				}
				r.push({name:n,value:v});
				if(cascadeDefaults) {
					defaultName = n;
					defaultValue = v;
				}
			}
		}
	} while(match);
	// Summarise parameters into first element
	for(var t=1; t<r.length; t++) {
		if(r[0][r[t].name])
			r[0][r[t].name].push(r[t].value);
		else
			r[0][r[t].name] = [r[t].value];
	}
	return r;
};

// Process a string list of macro parameters into an array. Parameters can be quoted with "", '',
// [[]], {{ }} or left unquoted (and therefore space-separated). Double-braces {{}} results in
// an *evaluated* parameter: e.g. {{config.options.txtUserName}} results in the current user's name.
String.prototype.readMacroParams = function()
{
	var p = this.parseParams("list",null,true,true);
	var n = [];
	for(var t=1; t<p.length; t++)
		n.push(p[t].value);
	return n;
};

// Process a string list of unique tiddler names into an array. Tiddler names that have spaces in them must be [[bracketed]]
String.prototype.readBracketedList = function(unique)
{
	var p = this.parseParams("list",null,false,true);
	var n = [];
	for(var t=1; t<p.length; t++) {
		if(p[t].value)
			n.pushUnique(p[t].value,unique);
	}
	return n;
};

// Returns array with start and end index of chunk between given start and end marker, or undefined.
String.prototype.getChunkRange = function(start,end)
{
	var s = this.indexOf(start);
	if(s != -1) {
		s += start.length;
		var e = this.indexOf(end,s);
		if(e != -1)
			return [s,e];
	}
};

// Replace a chunk of a string given start and end markers
String.prototype.replaceChunk = function(start,end,sub)
{
	var r = this.getChunkRange(start,end);
	return r ? this.substring(0,r[0]) + sub + this.substring(r[1]) : this;
};

// Returns a chunk of a string between start and end markers, or undefined
String.prototype.getChunk = function(start,end)
{
	var r = this.getChunkRange(start,end);
	if(r)
		return this.substring(r[0],r[1]);
};


// Static method to bracket a string with double square brackets if it contains a space
String.encodeTiddlyLink = function(title)
{
	return title.indexOf(" ") == -1 ? title : "[[" + title + "]]";
};

// Static method to encodeTiddlyLink for every item in an array and join them with spaces
String.encodeTiddlyLinkList = function(list)
{
	if(list) {
		var results = [];
		for(var t=0; t<list.length; t++)
			results.push(String.encodeTiddlyLink(list[t]));
		return results.join(" ");
	} else {
		return "";
	}
};

// Convert a string as a sequence of name:"value" pairs into a hashmap
String.prototype.decodeHashMap = function()
{
	var fields = this.parseParams("anon","",false);
	var r = {};
	for(var t=1; t<fields.length; t++)
		r[fields[t].name] = fields[t].value;
	return r;
};

// Static method to encode a hashmap into a name:"value"... string
String.encodeHashMap = function(hashmap)
{
	var r = [];
	for(var t in hashmap)
		r.push(t + ':"' + hashmap[t] + '"');
	return r.join(" ");
};

// Static method to left-pad a string with 0s to a certain width
String.zeroPad = function(n,d)
{
	var s = n.toString();
	if(s.length < d)
		s = "000000000000000000000000000".substr(0,d-s.length) + s;
	return s;
};

String.prototype.startsWith = function(prefix)
{
	return !prefix || this.substring(0,prefix.length) == prefix;
};

// Returns the first value of the given named parameter.
function getParam(params,name,defaultValue)
{
	if(!params)
		return defaultValue;
	var p = params[0][name];
	return p ? p[0] : defaultValue;
}

// Returns the first value of the given boolean named parameter.
function getFlag(params,name,defaultValue)
{
	return !!getParam(params,name,defaultValue);
}

// Substitute date components into a string
Date.prototype.formatString = function(template)
{
	var t = template.replace(/0hh12/g,String.zeroPad(this.getHours12(),2));
	t = t.replace(/hh12/g,this.getHours12());
	t = t.replace(/0hh/g,String.zeroPad(this.getHours(),2));
	t = t.replace(/hh/g,this.getHours());
	t = t.replace(/mmm/g,config.messages.dates.shortMonths[this.getMonth()]);
	t = t.replace(/0mm/g,String.zeroPad(this.getMinutes(),2));
	t = t.replace(/mm/g,this.getMinutes());
	t = t.replace(/0ss/g,String.zeroPad(this.getSeconds(),2));
	t = t.replace(/ss/g,this.getSeconds());
	t = t.replace(/[ap]m/g,this.getAmPm().toLowerCase());
	t = t.replace(/[AP]M/g,this.getAmPm().toUpperCase());
	t = t.replace(/wYYYY/g,this.getYearForWeekNo());
	t = t.replace(/wYY/g,String.zeroPad(this.getYearForWeekNo()-2000,2));
	t = t.replace(/YYYY/g,this.getFullYear());
	t = t.replace(/YY/g,String.zeroPad(this.getFullYear()-2000,2));
	t = t.replace(/MMM/g,config.messages.dates.months[this.getMonth()]);
	t = t.replace(/0MM/g,String.zeroPad(this.getMonth()+1,2));
	t = t.replace(/MM/g,this.getMonth()+1);
	t = t.replace(/0WW/g,String.zeroPad(this.getWeek(),2));
	t = t.replace(/WW/g,this.getWeek());
	t = t.replace(/DDD/g,config.messages.dates.days[this.getDay()]);
	t = t.replace(/ddd/g,config.messages.dates.shortDays[this.getDay()]);
	t = t.replace(/0DD/g,String.zeroPad(this.getDate(),2));
	t = t.replace(/DDth/g,this.getDate()+this.daySuffix());
	t = t.replace(/DD/g,this.getDate());
	var tz = this.getTimezoneOffset();
	var atz = Math.abs(tz);
	t = t.replace(/TZD/g,(tz < 0 ? '+' : '-') + String.zeroPad(Math.floor(atz / 60),2) + ':' + String.zeroPad(atz % 60,2));
	t = t.replace(/\\/g,"");
	return t;
};

Date.prototype.getWeek = function()
{
	var dt = new Date(this.getTime());
	var d = dt.getDay();
	if(d==0) d=7;// JavaScript Sun=0, ISO Sun=7
	dt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week to calculate weekNo
	var n = Math.floor((dt.getTime()-new Date(dt.getFullYear(),0,1)+3600000)/86400000);
	return Math.floor(n/7)+1;
};

Date.prototype.getYearForWeekNo = function()
{
	var dt = new Date(this.getTime());
	var d = dt.getDay();
	if(d==0) d=7;// JavaScript Sun=0, ISO Sun=7
	dt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week
	return dt.getFullYear();
};

Date.prototype.getHours12 = function()
{
	var h = this.getHours();
	return h > 12 ? h-12 : ( h > 0 ? h : 12 );
};

Date.prototype.getAmPm = function()
{
	return this.getHours() >= 12 ? config.messages.dates.pm : config.messages.dates.am;
};

Date.prototype.daySuffix = function()
{
	return config.messages.dates.daySuffixes[this.getDate()-1];
};

// Convert a date to local YYYYMMDDHHMM string format
Date.prototype.convertToLocalYYYYMMDDHHMM = function()
{
	return this.getFullYear() + String.zeroPad(this.getMonth()+1,2) + String.zeroPad(this.getDate(),2) + String.zeroPad(this.getHours(),2) + String.zeroPad(this.getMinutes(),2);
};

// Convert a date to UTC YYYYMMDDHHMM string format
Date.prototype.convertToYYYYMMDDHHMM = function()
{
	return this.getUTCFullYear() + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2);
};

// Convert a date to UTC YYYYMMDD.HHMMSSMMM string format
Date.prototype.convertToYYYYMMDDHHMMSSMMM = function()
{
	return this.getUTCFullYear() + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + "." + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2) + String.zeroPad(this.getUTCSeconds(),2) + String.zeroPad(this.getUTCMilliseconds(),4);
};

// Static method to create a date from a UTC YYYYMMDDHHMM format string
Date.convertFromYYYYMMDDHHMM = function(d)
{
	var hh = d.substr(8,2) || "00";
	var mm = d.substr(10,2) || "00";
	return new Date(Date.UTC(parseInt(d.substr(0,4),10),
			parseInt(d.substr(4,2),10)-1,
			parseInt(d.substr(6,2),10),
			parseInt(hh,10),
			parseInt(mm,10),0,0));
};

//--
//-- RGB colour object
//--

// Construct an RGB colour object from a '#rrggbb', '#rgb' or 'rgb(n,n,n)' string or from separate r,g,b values
function RGB(r,g,b)
{
	this.r = 0;
	this.g = 0;
	this.b = 0;
	if(typeof r == "string") {
		if(r.substr(0,1) == "#") {
			if(r.length == 7) {
				this.r = parseInt(r.substr(1,2),16)/255;
				this.g = parseInt(r.substr(3,2),16)/255;
				this.b = parseInt(r.substr(5,2),16)/255;
			} else {
				this.r = parseInt(r.substr(1,1),16)/15;
				this.g = parseInt(r.substr(2,1),16)/15;
				this.b = parseInt(r.substr(3,1),16)/15;
			}
		} else {
			var rgbPattern = /rgb\s*\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/;
			var c = r.match(rgbPattern);
			if(c) {
				this.r = parseInt(c[1],10)/255;
				this.g = parseInt(c[2],10)/255;
				this.b = parseInt(c[3],10)/255;
			}
		}
	} else {
		this.r = r;
		this.g = g;
		this.b = b;
	}
	return this;
}

// Mixes this colour with another in a specified proportion
// c = other colour to mix
// f = 0..1 where 0 is this colour and 1 is the new colour
// Returns an RGB object
RGB.prototype.mix = function(c,f)
{
	return new RGB(this.r + (c.r-this.r) * f,this.g + (c.g-this.g) * f,this.b + (c.b-this.b) * f);
};

// Return an rgb colour as a #rrggbb format hex string
RGB.prototype.toString = function()
{
	return "#" + ("0" + Math.floor(this.r.clamp(0,1) * 255).toString(16)).right(2) +
				 ("0" + Math.floor(this.g.clamp(0,1) * 255).toString(16)).right(2) +
				 ("0" + Math.floor(this.b.clamp(0,1) * 255).toString(16)).right(2);
};

//--
//-- DOM utilities - many derived from www.quirksmode.org
//--

// Resolve the target object of an event
function resolveTarget(e)
{
	var obj;
	if(e.target)
		obj = e.target;
	else if(e.srcElement)
		obj = e.srcElement;
	if(obj.nodeType == 3) // defeat Safari bug
		obj = obj.parentNode;
	return obj;
}

function drawGradient(place,horiz,locolors,hicolors)
{
	if(!hicolors)
		hicolors = locolors;
	for(var t=0; t<= 100; t+=2) {
		var bar = document.createElement("div");
		place.appendChild(bar);
		bar.style.position = "absolute";
		bar.style.left = horiz ? t + "%" : 0;
		bar.style.top = horiz ? 0 : t + "%";
		bar.style.width = horiz ? (101-t) + "%" : "100%";
		bar.style.height = horiz ? "100%" : (101-t) + "%";
		bar.style.zIndex = -1;
		var p = t/100*(locolors.length-1);
		var hc = hicolors[Math.floor(p)];
		if(typeof hc == "string")
			hc = new RGB(hc);
		var lc = locolors[Math.ceil(p)];
		if(typeof lc == "string")
			lc = new RGB(lc);
		bar.style.backgroundColor = hc.mix(lc,p-Math.floor(p)).toString();
	}
}

function createTiddlyCheckbox(parent,caption,checked,onChange)
{
	var cb = document.createElement("input");
	cb.setAttribute("type","checkbox");
	cb.onclick = onChange;
	parent.appendChild(cb);
	cb.checked = checked;
	cb.className = "chkOptionInput";
	if(caption)
		wikify(caption,parent);
	return cb;
}

function createTiddlyElement(parent,element,id,className,text,attribs)
{
	var e = document.createElement(element);
	if(className != null)
		e.className = className;
	if(id != null)
		e.setAttribute("id",id);
	if(text != null)
		e.appendChild(document.createTextNode(text));
	if(attribs) {
		for(var n in attribs) {
			e.setAttribute(n,attribs[n]);
		}
	}
	if(parent != null)
		parent.appendChild(e);
	return e;
}

function addEvent(obj,type,fn)
{
	if(obj.attachEvent) {
		obj["e"+type+fn] = fn;
		obj[type+fn] = function(){obj["e"+type+fn](window.event);};
		obj.attachEvent("on"+type,obj[type+fn]);
	} else {
		obj.addEventListener(type,fn,false);
	}
}

function removeEvent(obj,type,fn)
{
	if(obj.detachEvent) {
		obj.detachEvent("on"+type,obj[type+fn]);
		obj[type+fn] = null;
	} else {
		obj.removeEventListener(type,fn,false);
	}
}


// Find the closest relative with a given property value (property defaults to tagName, relative defaults to parentNode)
function findRelated(e,value,name,relative)
{
	name = name || "tagName";
	relative = relative || "parentNode";
	if(name == "className") {
		while(e && !hasClass(e,value)) {
			e = e[relative];
		}
	} else {
		while(e && e[name] != value) {
			e = e[relative];
		}
	}
	return e;
}

// Get the scroll position for window.scrollTo necessary to scroll a given element into view
function ensureVisible(e)
{
	var posTop = findPosY(e);
	var posBot = posTop + e.offsetHeight;
	var winTop = findScrollY();
	var winHeight = findWindowHeight();
	var winBot = winTop + winHeight;
	if(posTop < winTop) {
		return posTop;
	} else if(posBot > winBot) {
		if(e.offsetHeight < winHeight)
			return posTop - (winHeight - e.offsetHeight);
		else
			return posTop;
	} else {
		return winTop;
	}
}

// Get the current width of the display window
function findWindowWidth()
{
	return window.innerWidth || document.documentElement.clientWidth;
}

// Get the current height of the display window
function findWindowHeight()
{
	return window.innerHeight || document.documentElement.clientHeight;
}

// Get the current horizontal page scroll position
function findScrollX()
{
	return window.scrollX || document.documentElement.scrollLeft;
}

// Get the current vertical page scroll position
function findScrollY()
{
	return window.scrollY || document.documentElement.scrollTop;
}

function findPosX(obj)
{
	var curleft = 0;
	while(obj.offsetParent) {
		curleft += obj.offsetLeft;
		obj = obj.offsetParent;
	}
	return curleft;
}

function findPosY(obj)
{
	var curtop = 0;
	while(obj.offsetParent) {
		curtop += obj.offsetTop;
		obj = obj.offsetParent;
	}
	return curtop;
}

// Blur a particular element
function blurElement(e)
{
	if(e && e.focus && e.blur) {
		e.focus();
		e.blur();
	}
}

// Create a non-breaking space
function insertSpacer(place)
{
	var e = document.createTextNode(String.fromCharCode(160));
	if(place)
		place.appendChild(e);
	return e;
}

// Add a stylesheet, replacing any previous custom stylesheet
function setStylesheet(s,id,doc)
{
	if(!id)
		id = "customStyleSheet";
	if(!doc)
		doc = document;
	var n = doc.getElementById(id);
	if(doc.createStyleSheet) {
		// Test for IE's non-standard createStyleSheet method
		if(n)
			n.parentNode.removeChild(n);
		// This failed without the &nbsp;
		doc.getElementsByTagName("head")[0].insertAdjacentHTML("beforeEnd","&nbsp;<style id='" + id + "'>" + s + "</style>");
	} else {
		if(n) {
			n.replaceChild(doc.createTextNode(s),n.firstChild);
		} else {
			n = doc.createElement("style");
			n.type = "text/css";
			n.id = id;
			n.appendChild(doc.createTextNode(s));
			doc.getElementsByTagName("head")[0].appendChild(n);
		}
	}
}

function removeStyleSheet(id)
{
	var e = document.getElementById(id);
	if(e)
		e.parentNode.removeChild(e);
}

// Force the browser to do a document reflow when needed to workaround browser bugs
function forceReflow()
{
	if(config.browser.isGecko) {
		setStylesheet("body {top:0px;margin-top:0px;}","forceReflow");
		setTimeout(function() {setStylesheet("","forceReflow");},1);
	}
}

// Replace the current selection of a textarea or text input and scroll it into view
function replaceSelection(e,text)
{
	if(e.setSelectionRange) {
		var oldpos = e.selectionStart;
		var isRange = e.selectionEnd > e.selectionStart;
		e.value = e.value.substr(0,e.selectionStart) + text + e.value.substr(e.selectionEnd);
		e.setSelectionRange(isRange ? oldpos : oldpos + text.length,oldpos + text.length);
		var linecount = e.value.split("\n").length;
		var thisline = e.value.substr(0,e.selectionStart).split("\n").length-1;
		e.scrollTop = Math.floor((thisline - e.rows / 2) * e.scrollHeight / linecount);
	} else if(document.selection) {
		var range = document.selection.createRange();
		if(range.parentElement() == e) {
			var isCollapsed = range.text == "";
			range.text = text;
			if(!isCollapsed) {
				range.moveStart("character", -text.length);
				range.select();
			}
		}
	}
}

// Returns the text of the given (text) node, possibly merging subsequent text nodes
function getNodeText(e)
{
	var t = "";
	while(e && e.nodeName == "#text") {
		t += e.nodeValue;
		e = e.nextSibling;
	}
	return t;
}

// Returns true if the element e has a given ancestor element
function isDescendant(e,ancestor)
{
	while(e) {
		if(e === ancestor)
			return true;
		e = e.parentNode;
	}
	return false;
}


// deprecate the following...

// Prevent an event from bubbling
function stopEvent(e)
{
	var ev = e || window.event;
	ev.cancelBubble = true;
	if(ev.stopPropagation) ev.stopPropagation();
	return false;
}

// Remove any event handlers or non-primitve custom attributes
function scrubNode(e)
{
	if(!config.browser.isIE)
		return;
	var att = e.attributes;
	if(att) {
		for(var t=0; t<att.length; t++) {
			var n = att[t].name;
			if(n !== "style" && (typeof e[n] === "function" || (typeof e[n] === "object" && e[n] != null))) {
				try {
					e[n] = null;
				} catch(ex) {
				}
			}
		}
	}
	var c = e.firstChild;
	while(c) {
		scrubNode(c);
		c = c.nextSibling;
	}
}

function addClass(e,className)
{
	jQuery(e).addClass(className);
}

function removeClass(e,className)
{
	jQuery(e).removeClass(className);
}

function hasClass(e,className)
{
	return jQuery(e).hasClass(className);
}

// Remove all children of a node
function removeChildren(e)
{
	jQuery(e).empty();
}

function createTiddlyText(parent,text)
{
	return jQuery(parent).append(text);
}

// Return the content of an element as plain text with no formatting
function getPlainText(e)
{
	return jQuery(e).text();
}

// Remove a node and all it's children
function removeNode(e)
{
	jQuery(e).remove();
}

//--
//-- LoaderBase and SaverBase
//--

function LoaderBase() {}

LoaderBase.prototype.loadTiddler = function(store,node,tiddlers)
{
	var title = this.getTitle(store,node);
	if(safeMode && store.isShadowTiddler(title))
		return;
	if(title) {
		var tiddler = store.createTiddler(title);
		this.internalizeTiddler(store,tiddler,title,node);
		tiddlers.push(tiddler);
	}
};

LoaderBase.prototype.loadTiddlers = function(store,nodes)
{
	var tiddlers = [];
	for(var t = 0; t < nodes.length; t++) {
		try {
			this.loadTiddler(store,nodes[t],tiddlers);
		} catch(ex) {
			showException(ex,config.messages.tiddlerLoadError.format([this.getTitle(store,nodes[t])]));
		}
	}
	return tiddlers;
};

function SaverBase() {}

SaverBase.prototype.externalize = function(store)
{
	var results = [];
	var tiddlers = store.getTiddlers("title");
	for(var t = 0; t < tiddlers.length; t++) {
		if(!tiddlers[t].doNotSave())
			results.push(this.externalizeTiddler(store, tiddlers[t]));
	}
	return results.join("\n");
};

//--
//-- TW21Loader (inherits from LoaderBase)
//--

function TW21Loader() {}

TW21Loader.prototype = new LoaderBase();

TW21Loader.prototype.getTitle = function(store,node)
{
	var title = null;
	if(node.getAttribute) {
		title = node.getAttribute("title");
		if(!title)
			title = node.getAttribute("tiddler");
	}
	if(!title && node.id) {
		var lenPrefix = store.idPrefix.length;
		if(node.id.substr(0,lenPrefix) == store.idPrefix)
			title = node.id.substr(lenPrefix);
	}
	return title;
};

TW21Loader.prototype.internalizeTiddler = function(store,tiddler,title,node)
{
	var e = node.firstChild;
	var text = null;
	if(node.getAttribute("tiddler")) {
		text = getNodeText(e).unescapeLineBreaks();
	} else {
		while(e.nodeName!="PRE" && e.nodeName!="pre") {
			e = e.nextSibling;
		}
		text = e.innerHTML.replace(/\r/mg,"").htmlDecode();
	}
	var modifier = node.getAttribute("modifier");
	var c = node.getAttribute("created");
	var m = node.getAttribute("modified");
	var created = c ? Date.convertFromYYYYMMDDHHMM(c) : version.date;
	var modified = m ? Date.convertFromYYYYMMDDHHMM(m) : created;
	var tags = node.getAttribute("tags");
	var fields = {};
	var attrs = node.attributes;
	for(var i = attrs.length-1; i >= 0; i--) {
		var name = attrs[i].name;
		if(attrs[i].specified && !TiddlyWiki.isStandardField(name)) {
			fields[name] = attrs[i].value.unescapeLineBreaks();
		}
	}
	tiddler.assign(title,text,modifier,modified,tags,created,fields);
	return tiddler;
};

//--
//-- TW21Saver (inherits from SaverBase)
//--

function TW21Saver() {}

TW21Saver.prototype = new SaverBase();

TW21Saver.prototype.externalizeTiddler = function(store,tiddler)
{
	try {
		var extendedAttributes = "";
		var usePre = config.options.chkUsePreForStorage;
		store.forEachField(tiddler,
			function(tiddler,fieldName,value) {
				// don't store stuff from the temp namespace
				if(typeof value != "string")
					value = "";
				if(!fieldName.match(/^temp\./))
					extendedAttributes += ' %0="%1"'.format([fieldName,value.escapeLineBreaks().htmlEncode()]);
			},true);
		var created = tiddler.created;
		var modified = tiddler.modified;
		var attributes = tiddler.modifier ? ' modifier="' + tiddler.modifier.htmlEncode() + '"' : "";
		attributes += (usePre && created == version.date) ? "" :' created="' + created.convertToYYYYMMDDHHMM() + '"';
		attributes += (usePre && modified == created) ? "" : ' modified="' + modified.convertToYYYYMMDDHHMM() +'"';
		var tags = tiddler.getTags();
		if(!usePre || tags)
			attributes += ' tags="' + tags.htmlEncode() + '"';
		return ('<div %0="%1"%2%3>%4</'+'div>').format([
				usePre ? "title" : "tiddler",
				tiddler.title.htmlEncode(),
				attributes,
				extendedAttributes,
				usePre ? "\n<pre>" + tiddler.text.htmlEncode() + "</pre>\n" : tiddler.text.escapeLineBreaks().htmlEncode()
			]);
	} catch (ex) {
		throw exceptionText(ex,config.messages.tiddlerSaveError.format([tiddler.title]));
	}
};

//]]>
</script>
<script id="jsdeprecatedArea" type="text/javascript">
//<![CDATA[
//--
//-- Deprecated Filesystem code
//-- Use the jQuery.file functions directly instead
//--

function saveFile(filePath,content)
{
	return jQuery.file.save(filePath,content);
}

function loadFile(filePath)
{
	return jQuery.file.load(filePath);
}

function copyFile(dest,source)
{
	return jQuery.file.copy(dest,source);
}

//--
//-- Deprecated Tiddler code
//--

// @Deprecated: Use tiddlerToRssItem(tiddler,uri) instead
Tiddler.prototype.toRssItem = function(uri)
{
	return tiddlerToRssItem(this,uri);
};

// @Deprecated: Use "<item>\n" + tiddlerToRssItem(tiddler,uri)  + "\n</item>" instead
Tiddler.prototype.saveToRss = function(uri)
{
	return "<item>\n" + tiddlerToRssItem(this,uri) + "\n</item>";
};

// @Deprecated: Use jQuery.encoding.digests.hexSha1Str instead
Tiddler.prototype.generateFingerprint = function()
{
	return "0x" + Crypto.hexSha1Str(this.text);
};

//--
//-- Deprecated HTTP request code
//-- Use the jQuery ajax functions directly instead
//--

function loadRemoteFile(url,callback,params)
{
	return httpReq("GET",url,callback,params);
}

function doHttp(type,url,data,contentType,username,password,callback,params,headers,allowCache)
{
	return httpReq(type,url,callback,params,headers,data,contentType,username,password,allowCache);
}

function httpReq(type,url,callback,params,headers,data,contentType,username,password,allowCache)
{
	var options = {
		type:type,
		url:url,
		processData:false,
		data:data,
		cache:allowCache ? false : true,
		beforeSend: function(xhr) {
			for(var i in headers)
				xhr.setRequestHeader(i,headers[i]);
			xhr.setRequestHeader("X-Requested-With", "TiddlyWiki " + formatVersion());
		}
	};

	if(callback) {
		options.complete = function(xhr,textStatus) {
			if(jQuery.httpSuccess(xhr))
				callback(true,params,xhr.responseText,url,xhr);
			else
				callback(false,params,null,url,xhr);
		};
	}
	if(contentType)
		options.contentType = contentType;
	if(username)
		options.username = username;
	if(password)
		options.password = password;
	if(window.Components && window.netscape && window.netscape.security && document.location.protocol.indexOf("http") == -1)
		window.netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
	jQuery.ajax(options);
}

//--
//-- Deprecated Crypto functions and associated conversion routines.
//-- Use the jQuery.encoding functions directly instead.
//--

// Crypto 'namespace'
function Crypto() {}

// Convert a string to an array of big-endian 32-bit words
Crypto.strToBe32s = function(str)
{
	return jQuery.encoding.strToBe32s(str);
};

// Convert an array of big-endian 32-bit words to a string
Crypto.be32sToStr = function(be)
{
	return jQuery.encoding.be32sToStr(be);
};

// Convert an array of big-endian 32-bit words to a hex string
Crypto.be32sToHex = function(be)
{
	return jQuery.encoding.be32sToHex(be);
};

// Return, in hex, the SHA-1 hash of a string
Crypto.hexSha1Str = function(str)
{
	return jQuery.encoding.digests.hexSha1Str(str);
};

// Return the SHA-1 hash of a string
Crypto.sha1Str = function(str)
{
	return jQuery.encoding.digests.sha1Str(str);
};

// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
Crypto.sha1 = function(x,blen)
{
	return jQuery.encoding.digests.sha1(x,blen);
};

//]]>
</script>
<script id="jslibArea" type="text/javascript">
//<![CDATA[
/*
 * jQuery JavaScript Library v1.3.2
 * http://jquery.com/
 *
 * Copyright (c) 2009 John Resig
 * Dual licensed under the MIT and GPL licenses.
 * http://docs.jquery.com/License
 *
 * Date: 2009-02-19 17:34:21 -0500 (Thu, 19 Feb 2009)
 * Revision: 6246
 */
(function(){var l=this,g,y=l.jQuery,p=l.$,o=l.jQuery=l.$=function(E,F){return new o.fn.init(E,F)},D=/^[^<]*(<(.|\s)+>)[^>]*$|^#([\w-]+)$/,f=/^.[^:#\[\.,]*$/;o.fn=o.prototype={init:function(E,H){E=E||document;if(E.nodeType){this[0]=E;this.length=1;this.context=E;return this}if(typeof E==="string"){var G=D.exec(E);if(G&&(G[1]||!H)){if(G[1]){E=o.clean([G[1]],H)}else{var I=document.getElementById(G[3]);if(I&&I.id!=G[3]){return o().find(E)}var F=o(I||[]);F.context=document;F.selector=E;return F}}else{return o(H).find(E)}}else{if(o.isFunction(E)){return o(document).ready(E)}}if(E.selector&&E.context){this.selector=E.selector;this.context=E.context}return this.setArray(o.isArray(E)?E:o.makeArray(E))},selector:"",jquery:"1.3.2",size:function(){return this.length},get:function(E){return E===g?Array.prototype.slice.call(this):this[E]},pushStack:function(F,H,E){var G=o(F);G.prevObject=this;G.context=this.context;if(H==="find"){G.selector=this.selector+(this.selector?" ":"")+E}else{if(H){G.selector=this.selector+"."+H+"("+E+")"}}return G},setArray:function(E){this.length=0;Array.prototype.push.apply(this,E);return this},each:function(F,E){return o.each(this,F,E)},index:function(E){return o.inArray(E&&E.jquery?E[0]:E,this)},attr:function(F,H,G){var E=F;if(typeof F==="string"){if(H===g){return this[0]&&o[G||"attr"](this[0],F)}else{E={};E[F]=H}}return this.each(function(I){for(F in E){o.attr(G?this.style:this,F,o.prop(this,E[F],G,I,F))}})},css:function(E,F){if((E=="width"||E=="height")&&parseFloat(F)<0){F=g}return this.attr(E,F,"curCSS")},text:function(F){if(typeof F!=="object"&&F!=null){return this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(F))}var E="";o.each(F||this,function(){o.each(this.childNodes,function(){if(this.nodeType!=8){E+=this.nodeType!=1?this.nodeValue:o.fn.text([this])}})});return E},wrapAll:function(E){if(this[0]){var F=o(E,this[0].ownerDocument).clone();if(this[0].parentNode){F.insertBefore(this[0])}F.map(function(){var G=this;while(G.firstChild){G=G.firstChild}return G}).append(this)}return this},wrapInner:function(E){return this.each(function(){o(this).contents().wrapAll(E)})},wrap:function(E){return this.each(function(){o(this).wrapAll(E)})},append:function(){return this.domManip(arguments,true,function(E){if(this.nodeType==1){this.appendChild(E)}})},prepend:function(){return this.domManip(arguments,true,function(E){if(this.nodeType==1){this.insertBefore(E,this.firstChild)}})},before:function(){return this.domManip(arguments,false,function(E){this.parentNode.insertBefore(E,this)})},after:function(){return this.domManip(arguments,false,function(E){this.parentNode.insertBefore(E,this.nextSibling)})},end:function(){return this.prevObject||o([])},push:[].push,sort:[].sort,splice:[].splice,find:function(E){if(this.length===1){var F=this.pushStack([],"find",E);F.length=0;o.find(E,this[0],F);return F}else{return this.pushStack(o.unique(o.map(this,function(G){return o.find(E,G)})),"find",E)}},clone:function(G){var E=this.map(function(){if(!o.support.noCloneEvent&&!o.isXMLDoc(this)){var I=this.outerHTML;if(!I){var J=this.ownerDocument.createElement("div");J.appendChild(this.cloneNode(true));I=J.innerHTML}return o.clean([I.replace(/ jQuery\d+="(?:\d+|null)"/g,"").replace(/^\s*/,"")])[0]}else{return this.cloneNode(true)}});if(G===true){var H=this.find("*").andSelf(),F=0;E.find("*").andSelf().each(function(){if(this.nodeName!==H[F].nodeName){return}var I=o.data(H[F],"events");for(var K in I){for(var J in I[K]){o.event.add(this,K,I[K][J],I[K][J].data)}}F++})}return E},filter:function(E){return this.pushStack(o.isFunction(E)&&o.grep(this,function(G,F){return E.call(G,F)})||o.multiFilter(E,o.grep(this,function(F){return F.nodeType===1})),"filter",E)},closest:function(E){var G=o.expr.match.POS.test(E)?o(E):null,F=0;return this.map(function(){var H=this;while(H&&H.ownerDocument){if(G?G.index(H)>-1:o(H).is(E)){o.data(H,"closest",F);return H}H=H.parentNode;F++}})},not:function(E){if(typeof E==="string"){if(f.test(E)){return this.pushStack(o.multiFilter(E,this,true),"not",E)}else{E=o.multiFilter(E,this)}}var F=E.length&&E[E.length-1]!==g&&!E.nodeType;return this.filter(function(){return F?o.inArray(this,E)<0:this!=E})},add:function(E){return this.pushStack(o.unique(o.merge(this.get(),typeof E==="string"?o(E):o.makeArray(E))))},is:function(E){return !!E&&o.multiFilter(E,this).length>0},hasClass:function(E){return !!E&&this.is("."+E)},val:function(K){if(K===g){var E=this[0];if(E){if(o.nodeName(E,"option")){return(E.attributes.value||{}).specified?E.value:E.text}if(o.nodeName(E,"select")){var I=E.selectedIndex,L=[],M=E.options,H=E.type=="select-one";if(I<0){return null}for(var F=H?I:0,J=H?I+1:M.length;F<J;F++){var G=M[F];if(G.selected){K=o(G).val();if(H){return K}L.push(K)}}return L}return(E.value||"").replace(/\r/g,"")}return g}if(typeof K==="number"){K+=""}return this.each(function(){if(this.nodeType!=1){return}if(o.isArray(K)&&/radio|checkbox/.test(this.type)){this.checked=(o.inArray(this.value,K)>=0||o.inArray(this.name,K)>=0)}else{if(o.nodeName(this,"select")){var N=o.makeArray(K);o("option",this).each(function(){this.selected=(o.inArray(this.value,N)>=0||o.inArray(this.text,N)>=0)});if(!N.length){this.selectedIndex=-1}}else{this.value=K}}})},html:function(E){return E===g?(this[0]?this[0].innerHTML.replace(/ jQuery\d+="(?:\d+|null)"/g,""):null):this.empty().append(E)},replaceWith:function(E){return this.after(E).remove()},eq:function(E){return this.slice(E,+E+1)},slice:function(){return this.pushStack(Array.prototype.slice.apply(this,arguments),"slice",Array.prototype.slice.call(arguments).join(","))},map:function(E){return this.pushStack(o.map(this,function(G,F){return E.call(G,F,G)}))},andSelf:function(){return this.add(this.prevObject)},domManip:function(J,M,L){if(this[0]){var I=(this[0].ownerDocument||this[0]).createDocumentFragment(),F=o.clean(J,(this[0].ownerDocument||this[0]),I),H=I.firstChild;if(H){for(var G=0,E=this.length;G<E;G++){L.call(K(this[G],H),this.length>1||G>0?I.cloneNode(true):I)}}if(F){o.each(F,z)}}return this;function K(N,O){return M&&o.nodeName(N,"table")&&o.nodeName(O,"tr")?(N.getElementsByTagName("tbody")[0]||N.appendChild(N.ownerDocument.createElement("tbody"))):N}}};o.fn.init.prototype=o.fn;function z(E,F){if(F.src){o.ajax({url:F.src,async:false,dataType:"script"})}else{o.globalEval(F.text||F.textContent||F.innerHTML||"")}if(F.parentNode){F.parentNode.removeChild(F)}}function e(){return +new Date}o.extend=o.fn.extend=function(){var J=arguments[0]||{},H=1,I=arguments.length,E=false,G;if(typeof J==="boolean"){E=J;J=arguments[1]||{};H=2}if(typeof J!=="object"&&!o.isFunction(J)){J={}}if(I==H){J=this;--H}for(;H<I;H++){if((G=arguments[H])!=null){for(var F in G){var K=J[F],L=G[F];if(J===L){continue}if(E&&L&&typeof L==="object"&&!L.nodeType){J[F]=o.extend(E,K||(L.length!=null?[]:{}),L)}else{if(L!==g){J[F]=L}}}}}return J};var b=/z-?index|font-?weight|opacity|zoom|line-?height/i,q=document.defaultView||{},s=Object.prototype.toString;o.extend({noConflict:function(E){l.$=p;if(E){l.jQuery=y}return o},isFunction:function(E){return s.call(E)==="[object Function]"},isArray:function(E){return s.call(E)==="[object Array]"},isXMLDoc:function(E){return E.nodeType===9&&E.documentElement.nodeName!=="HTML"||!!E.ownerDocument&&o.isXMLDoc(E.ownerDocument)},globalEval:function(G){if(G&&/\S/.test(G)){var F=document.getElementsByTagName("head")[0]||document.documentElement,E=document.createElement("script");E.type="text/javascript";if(o.support.scriptEval){E.appendChild(document.createTextNode(G))}else{E.text=G}F.insertBefore(E,F.firstChild);F.removeChild(E)}},nodeName:function(F,E){return F.nodeName&&F.nodeName.toUpperCase()==E.toUpperCase()},each:function(G,K,F){var E,H=0,I=G.length;if(F){if(I===g){for(E in G){if(K.apply(G[E],F)===false){break}}}else{for(;H<I;){if(K.apply(G[H++],F)===false){break}}}}else{if(I===g){for(E in G){if(K.call(G[E],E,G[E])===false){break}}}else{for(var J=G[0];H<I&&K.call(J,H,J)!==false;J=G[++H]){}}}return G},prop:function(H,I,G,F,E){if(o.isFunction(I)){I=I.call(H,F)}return typeof I==="number"&&G=="curCSS"&&!b.test(E)?I+"px":I},className:{add:function(E,F){o.each((F||"").split(/\s+/),function(G,H){if(E.nodeType==1&&!o.className.has(E.className,H)){E.className+=(E.className?" ":"")+H}})},remove:function(E,F){if(E.nodeType==1){E.className=F!==g?o.grep(E.className.split(/\s+/),function(G){return !o.className.has(F,G)}).join(" "):""}},has:function(F,E){return F&&o.inArray(E,(F.className||F).toString().split(/\s+/))>-1}},swap:function(H,G,I){var E={};for(var F in G){E[F]=H.style[F];H.style[F]=G[F]}I.call(H);for(var F in G){H.style[F]=E[F]}},css:function(H,F,J,E){if(F=="width"||F=="height"){var L,G={position:"absolute",visibility:"hidden",display:"block"},K=F=="width"?["Left","Right"]:["Top","Bottom"];function I(){L=F=="width"?H.offsetWidth:H.offsetHeight;if(E==="border"){return}o.each(K,function(){if(!E){L-=parseFloat(o.curCSS(H,"padding"+this,true))||0}if(E==="margin"){L+=parseFloat(o.curCSS(H,"margin"+this,true))||0}else{L-=parseFloat(o.curCSS(H,"border"+this+"Width",true))||0}})}if(H.offsetWidth!==0){I()}else{o.swap(H,G,I)}return Math.max(0,Math.round(L))}return o.curCSS(H,F,J)},curCSS:function(I,F,G){var L,E=I.style;if(F=="opacity"&&!o.support.opacity){L=o.attr(E,"opacity");return L==""?"1":L}if(F.match(/float/i)){F=w}if(!G&&E&&E[F]){L=E[F]}else{if(q.getComputedStyle){if(F.match(/float/i)){F="float"}F=F.replace(/([A-Z])/g,"-$1").toLowerCase();var M=q.getComputedStyle(I,null);if(M){L=M.getPropertyValue(F)}if(F=="opacity"&&L==""){L="1"}}else{if(I.currentStyle){var J=F.replace(/\-(\w)/g,function(N,O){return O.toUpperCase()});L=I.currentStyle[F]||I.currentStyle[J];if(!/^\d+(px)?$/i.test(L)&&/^\d/.test(L)){var H=E.left,K=I.runtimeStyle.left;I.runtimeStyle.left=I.currentStyle.left;E.left=L||0;L=E.pixelLeft+"px";E.left=H;I.runtimeStyle.left=K}}}}return L},clean:function(F,K,I){K=K||document;if(typeof K.createElement==="undefined"){K=K.ownerDocument||K[0]&&K[0].ownerDocument||document}if(!I&&F.length===1&&typeof F[0]==="string"){var H=/^<(\w+)\s*\/?>$/.exec(F[0]);if(H){return[K.createElement(H[1])]}}var G=[],E=[],L=K.createElement("div");o.each(F,function(P,S){if(typeof S==="number"){S+=""}if(!S){return}if(typeof S==="string"){S=S.replace(/(<(\w+)[^>]*?)\/>/g,function(U,V,T){return T.match(/^(abbr|br|col|img|input|link|meta|param|hr|area|embed)$/i)?U:V+"></"+T+">"});var O=S.replace(/^\s+/,"").substring(0,10).toLowerCase();var Q=!O.indexOf("<opt")&&[1,"<select multiple='multiple'>","</select>"]||!O.indexOf("<leg")&&[1,"<fieldset>","</fieldset>"]||O.match(/^<(thead|tbody|tfoot|colg|cap)/)&&[1,"<table>","</table>"]||!O.indexOf("<tr")&&[2,"<table><tbody>","</tbody></table>"]||(!O.indexOf("<td")||!O.indexOf("<th"))&&[3,"<table><tbody><tr>","</tr></tbody></table>"]||!O.indexOf("<col")&&[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"]||!o.support.htmlSerialize&&[1,"div<div>","</div>"]||[0,"",""];L.innerHTML=Q[1]+S+Q[2];while(Q[0]--){L=L.lastChild}if(!o.support.tbody){var R=/<tbody/i.test(S),N=!O.indexOf("<table")&&!R?L.firstChild&&L.firstChild.childNodes:Q[1]=="<table>"&&!R?L.childNodes:[];for(var M=N.length-1;M>=0;--M){if(o.nodeName(N[M],"tbody")&&!N[M].childNodes.length){N[M].parentNode.removeChild(N[M])}}}if(!o.support.leadingWhitespace&&/^\s/.test(S)){L.insertBefore(K.createTextNode(S.match(/^\s*/)[0]),L.firstChild)}S=o.makeArray(L.childNodes)}if(S.nodeType){G.push(S)}else{G=o.merge(G,S)}});if(I){for(var J=0;G[J];J++){if(o.nodeName(G[J],"script")&&(!G[J].type||G[J].type.toLowerCase()==="text/javascript")){E.push(G[J].parentNode?G[J].parentNode.removeChild(G[J]):G[J])}else{if(G[J].nodeType===1){G.splice.apply(G,[J+1,0].concat(o.makeArray(G[J].getElementsByTagName("script"))))}I.appendChild(G[J])}}return E}return G},attr:function(J,G,K){if(!J||J.nodeType==3||J.nodeType==8){return g}var H=!o.isXMLDoc(J),L=K!==g;G=H&&o.props[G]||G;if(J.tagName){var F=/href|src|style/.test(G);if(G=="selected"&&J.parentNode){J.parentNode.selectedIndex}if(G in J&&H&&!F){if(L){if(G=="type"&&o.nodeName(J,"input")&&J.parentNode){throw"type property can't be changed"}J[G]=K}if(o.nodeName(J,"form")&&J.getAttributeNode(G)){return J.getAttributeNode(G).nodeValue}if(G=="tabIndex"){var I=J.getAttributeNode("tabIndex");return I&&I.specified?I.value:J.nodeName.match(/(button|input|object|select|textarea)/i)?0:J.nodeName.match(/^(a|area)$/i)&&J.href?0:g}return J[G]}if(!o.support.style&&H&&G=="style"){return o.attr(J.style,"cssText",K)}if(L){J.setAttribute(G,""+K)}var E=!o.support.hrefNormalized&&H&&F?J.getAttribute(G,2):J.getAttribute(G);return E===null?g:E}if(!o.support.opacity&&G=="opacity"){if(L){J.zoom=1;J.filter=(J.filter||"").replace(/alpha\([^)]*\)/,"")+(parseInt(K)+""=="NaN"?"":"alpha(opacity="+K*100+")")}return J.filter&&J.filter.indexOf("opacity=")>=0?(parseFloat(J.filter.match(/opacity=([^)]*)/)[1])/100)+"":""}G=G.replace(/-([a-z])/ig,function(M,N){return N.toUpperCase()});if(L){J[G]=K}return J[G]},trim:function(E){return(E||"").replace(/^\s+|\s+$/g,"")},makeArray:function(G){var E=[];if(G!=null){var F=G.length;if(F==null||typeof G==="string"||o.isFunction(G)||G.setInterval){E[0]=G}else{while(F){E[--F]=G[F]}}}return E},inArray:function(G,H){for(var E=0,F=H.length;E<F;E++){if(H[E]===G){return E}}return -1},merge:function(H,E){var F=0,G,I=H.length;if(!o.support.getAll){while((G=E[F++])!=null){if(G.nodeType!=8){H[I++]=G}}}else{while((G=E[F++])!=null){H[I++]=G}}return H},unique:function(K){var F=[],E={};try{for(var G=0,H=K.length;G<H;G++){var J=o.data(K[G]);if(!E[J]){E[J]=true;F.push(K[G])}}}catch(I){F=K}return F},grep:function(F,J,E){var G=[];for(var H=0,I=F.length;H<I;H++){if(!E!=!J(F[H],H)){G.push(F[H])}}return G},map:function(E,J){var F=[];for(var G=0,H=E.length;G<H;G++){var I=J(E[G],G);if(I!=null){F[F.length]=I}}return F.concat.apply([],F)}});var C=navigator.userAgent.toLowerCase();o.browser={version:(C.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[0,"0"])[1],safari:/webkit/.test(C),opera:/opera/.test(C),msie:/msie/.test(C)&&!/opera/.test(C),mozilla:/mozilla/.test(C)&&!/(compatible|webkit)/.test(C)};o.each({parent:function(E){return E.parentNode},parents:function(E){return o.dir(E,"parentNode")},next:function(E){return o.nth(E,2,"nextSibling")},prev:function(E){return o.nth(E,2,"previousSibling")},nextAll:function(E){return o.dir(E,"nextSibling")},prevAll:function(E){return o.dir(E,"previousSibling")},siblings:function(E){return o.sibling(E.parentNode.firstChild,E)},children:function(E){return o.sibling(E.firstChild)},contents:function(E){return o.nodeName(E,"iframe")?E.contentDocument||E.contentWindow.document:o.makeArray(E.childNodes)}},function(E,F){o.fn[E]=function(G){var H=o.map(this,F);if(G&&typeof G=="string"){H=o.multiFilter(G,H)}return this.pushStack(o.unique(H),E,G)}});o.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(E,F){o.fn[E]=function(G){var J=[],L=o(G);for(var K=0,H=L.length;K<H;K++){var I=(K>0?this.clone(true):this).get();o.fn[F].apply(o(L[K]),I);J=J.concat(I)}return this.pushStack(J,E,G)}});o.each({removeAttr:function(E){o.attr(this,E,"");if(this.nodeType==1){this.removeAttribute(E)}},addClass:function(E){o.className.add(this,E)},removeClass:function(E){o.className.remove(this,E)},toggleClass:function(F,E){if(typeof E!=="boolean"){E=!o.className.has(this,F)}o.className[E?"add":"remove"](this,F)},remove:function(E){if(!E||o.filter(E,[this]).length){o("*",this).add([this]).each(function(){o.event.remove(this);o.removeData(this)});if(this.parentNode){this.parentNode.removeChild(this)}}},empty:function(){o(this).children().remove();while(this.firstChild){this.removeChild(this.firstChild)}}},function(E,F){o.fn[E]=function(){return this.each(F,arguments)}});function j(E,F){return E[0]&&parseInt(o.curCSS(E[0],F,true),10)||0}var h="jQuery"+e(),v=0,A={};o.extend({cache:{},data:function(F,E,G){F=F==l?A:F;var H=F[h];if(!H){H=F[h]=++v}if(E&&!o.cache[H]){o.cache[H]={}}if(G!==g){o.cache[H][E]=G}return E?o.cache[H][E]:H},removeData:function(F,E){F=F==l?A:F;var H=F[h];if(E){if(o.cache[H]){delete o.cache[H][E];E="";for(E in o.cache[H]){break}if(!E){o.removeData(F)}}}else{try{delete F[h]}catch(G){if(F.removeAttribute){F.removeAttribute(h)}}delete o.cache[H]}},queue:function(F,E,H){if(F){E=(E||"fx")+"queue";var G=o.data(F,E);if(!G||o.isArray(H)){G=o.data(F,E,o.makeArray(H))}else{if(H){G.push(H)}}}return G},dequeue:function(H,G){var E=o.queue(H,G),F=E.shift();if(!G||G==="fx"){F=E[0]}if(F!==g){F.call(H)}}});o.fn.extend({data:function(E,G){var H=E.split(".");H[1]=H[1]?"."+H[1]:"";if(G===g){var F=this.triggerHandler("getData"+H[1]+"!",[H[0]]);if(F===g&&this.length){F=o.data(this[0],E)}return F===g&&H[1]?this.data(H[0]):F}else{return this.trigger("setData"+H[1]+"!",[H[0],G]).each(function(){o.data(this,E,G)})}},removeData:function(E){return this.each(function(){o.removeData(this,E)})},queue:function(E,F){if(typeof E!=="string"){F=E;E="fx"}if(F===g){return o.queue(this[0],E)}return this.each(function(){var G=o.queue(this,E,F);if(E=="fx"&&G.length==1){G[0].call(this)}})},dequeue:function(E){return this.each(function(){o.dequeue(this,E)})}});
/*
 * Sizzle CSS Selector Engine - v0.9.3
 *  Copyright 2009, The Dojo Foundation
 *  Released under the MIT, BSD, and GPL Licenses.
 *  More information: http://sizzlejs.com/
 */
(function(){var R=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?/g,L=0,H=Object.prototype.toString;var F=function(Y,U,ab,ac){ab=ab||[];U=U||document;if(U.nodeType!==1&&U.nodeType!==9){return[]}if(!Y||typeof Y!=="string"){return ab}var Z=[],W,af,ai,T,ad,V,X=true;R.lastIndex=0;while((W=R.exec(Y))!==null){Z.push(W[1]);if(W[2]){V=RegExp.rightContext;break}}if(Z.length>1&&M.exec(Y)){if(Z.length===2&&I.relative[Z[0]]){af=J(Z[0]+Z[1],U)}else{af=I.relative[Z[0]]?[U]:F(Z.shift(),U);while(Z.length){Y=Z.shift();if(I.relative[Y]){Y+=Z.shift()}af=J(Y,af)}}}else{var ae=ac?{expr:Z.pop(),set:E(ac)}:F.find(Z.pop(),Z.length===1&&U.parentNode?U.parentNode:U,Q(U));af=F.filter(ae.expr,ae.set);if(Z.length>0){ai=E(af)}else{X=false}while(Z.length){var ah=Z.pop(),ag=ah;if(!I.relative[ah]){ah=""}else{ag=Z.pop()}if(ag==null){ag=U}I.relative[ah](ai,ag,Q(U))}}if(!ai){ai=af}if(!ai){throw"Syntax error, unrecognized expression: "+(ah||Y)}if(H.call(ai)==="[object Array]"){if(!X){ab.push.apply(ab,ai)}else{if(U.nodeType===1){for(var aa=0;ai[aa]!=null;aa++){if(ai[aa]&&(ai[aa]===true||ai[aa].nodeType===1&&K(U,ai[aa]))){ab.push(af[aa])}}}else{for(var aa=0;ai[aa]!=null;aa++){if(ai[aa]&&ai[aa].nodeType===1){ab.push(af[aa])}}}}}else{E(ai,ab)}if(V){F(V,U,ab,ac);if(G){hasDuplicate=false;ab.sort(G);if(hasDuplicate){for(var aa=1;aa<ab.length;aa++){if(ab[aa]===ab[aa-1]){ab.splice(aa--,1)}}}}}return ab};F.matches=function(T,U){return F(T,null,null,U)};F.find=function(aa,T,ab){var Z,X;if(!aa){return[]}for(var W=0,V=I.order.length;W<V;W++){var Y=I.order[W],X;if((X=I.match[Y].exec(aa))){var U=RegExp.leftContext;if(U.substr(U.length-1)!=="\\"){X[1]=(X[1]||"").replace(/\\/g,"");Z=I.find[Y](X,T,ab);if(Z!=null){aa=aa.replace(I.match[Y],"");break}}}}if(!Z){Z=T.getElementsByTagName("*")}return{set:Z,expr:aa}};F.filter=function(ad,ac,ag,W){var V=ad,ai=[],aa=ac,Y,T,Z=ac&&ac[0]&&Q(ac[0]);while(ad&&ac.length){for(var ab in I.filter){if((Y=I.match[ab].exec(ad))!=null){var U=I.filter[ab],ah,af;T=false;if(aa==ai){ai=[]}if(I.preFilter[ab]){Y=I.preFilter[ab](Y,aa,ag,ai,W,Z);if(!Y){T=ah=true}else{if(Y===true){continue}}}if(Y){for(var X=0;(af=aa[X])!=null;X++){if(af){ah=U(af,Y,X,aa);var ae=W^!!ah;if(ag&&ah!=null){if(ae){T=true}else{aa[X]=false}}else{if(ae){ai.push(af);T=true}}}}}if(ah!==g){if(!ag){aa=ai}ad=ad.replace(I.match[ab],"");if(!T){return[]}break}}}if(ad==V){if(T==null){throw"Syntax error, unrecognized expression: "+ad}else{break}}V=ad}return aa};var I=F.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF_-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF_-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF_-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF_-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*_-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF_-]|\\.)+)(?:\((['"]*)((?:\([^\)]+\)|[^\2\(\)]*)+)\2\))?/},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(T){return T.getAttribute("href")}},relative:{"+":function(aa,T,Z){var X=typeof T==="string",ab=X&&!/\W/.test(T),Y=X&&!ab;if(ab&&!Z){T=T.toUpperCase()}for(var W=0,V=aa.length,U;W<V;W++){if((U=aa[W])){while((U=U.previousSibling)&&U.nodeType!==1){}aa[W]=Y||U&&U.nodeName===T?U||false:U===T}}if(Y){F.filter(T,aa,true)}},">":function(Z,U,aa){var X=typeof U==="string";if(X&&!/\W/.test(U)){U=aa?U:U.toUpperCase();for(var V=0,T=Z.length;V<T;V++){var Y=Z[V];if(Y){var W=Y.parentNode;Z[V]=W.nodeName===U?W:false}}}else{for(var V=0,T=Z.length;V<T;V++){var Y=Z[V];if(Y){Z[V]=X?Y.parentNode:Y.parentNode===U}}if(X){F.filter(U,Z,true)}}},"":function(W,U,Y){var V=L++,T=S;if(!U.match(/\W/)){var X=U=Y?U:U.toUpperCase();T=P}T("parentNode",U,V,W,X,Y)},"~":function(W,U,Y){var V=L++,T=S;if(typeof U==="string"&&!U.match(/\W/)){var X=U=Y?U:U.toUpperCase();T=P}T("previousSibling",U,V,W,X,Y)}},find:{ID:function(U,V,W){if(typeof V.getElementById!=="undefined"&&!W){var T=V.getElementById(U[1]);return T?[T]:[]}},NAME:function(V,Y,Z){if(typeof Y.getElementsByName!=="undefined"){var U=[],X=Y.getElementsByName(V[1]);for(var W=0,T=X.length;W<T;W++){if(X[W].getAttribute("name")===V[1]){U.push(X[W])}}return U.length===0?null:U}},TAG:function(T,U){return U.getElementsByTagName(T[1])}},preFilter:{CLASS:function(W,U,V,T,Z,aa){W=" "+W[1].replace(/\\/g,"")+" ";if(aa){return W}for(var X=0,Y;(Y=U[X])!=null;X++){if(Y){if(Z^(Y.className&&(" "+Y.className+" ").indexOf(W)>=0)){if(!V){T.push(Y)}}else{if(V){U[X]=false}}}}return false},ID:function(T){return T[1].replace(/\\/g,"")},TAG:function(U,T){for(var V=0;T[V]===false;V++){}return T[V]&&Q(T[V])?U[1]:U[1].toUpperCase()},CHILD:function(T){if(T[1]=="nth"){var U=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(T[2]=="even"&&"2n"||T[2]=="odd"&&"2n+1"||!/\D/.test(T[2])&&"0n+"+T[2]||T[2]);T[2]=(U[1]+(U[2]||1))-0;T[3]=U[3]-0}T[0]=L++;return T},ATTR:function(X,U,V,T,Y,Z){var W=X[1].replace(/\\/g,"");if(!Z&&I.attrMap[W]){X[1]=I.attrMap[W]}if(X[2]==="~="){X[4]=" "+X[4]+" "}return X},PSEUDO:function(X,U,V,T,Y){if(X[1]==="not"){if(X[3].match(R).length>1||/^\w/.test(X[3])){X[3]=F(X[3],null,null,U)}else{var W=F.filter(X[3],U,V,true^Y);if(!V){T.push.apply(T,W)}return false}}else{if(I.match.POS.test(X[0])||I.match.CHILD.test(X[0])){return true}}return X},POS:function(T){T.unshift(true);return T}},filters:{enabled:function(T){return T.disabled===false&&T.type!=="hidden"},disabled:function(T){return T.disabled===true},checked:function(T){return T.checked===true},selected:function(T){T.parentNode.selectedIndex;return T.selected===true},parent:function(T){return !!T.firstChild},empty:function(T){return !T.firstChild},has:function(V,U,T){return !!F(T[3],V).length},header:function(T){return/h\d/i.test(T.nodeName)},text:function(T){return"text"===T.type},radio:function(T){return"radio"===T.type},checkbox:function(T){return"checkbox"===T.type},file:function(T){return"file"===T.type},password:function(T){return"password"===T.type},submit:function(T){return"submit"===T.type},image:function(T){return"image"===T.type},reset:function(T){return"reset"===T.type},button:function(T){return"button"===T.type||T.nodeName.toUpperCase()==="BUTTON"},input:function(T){return/input|select|textarea|button/i.test(T.nodeName)}},setFilters:{first:function(U,T){return T===0},last:function(V,U,T,W){return U===W.length-1},even:function(U,T){return T%2===0},odd:function(U,T){return T%2===1},lt:function(V,U,T){return U<T[3]-0},gt:function(V,U,T){return U>T[3]-0},nth:function(V,U,T){return T[3]-0==U},eq:function(V,U,T){return T[3]-0==U}},filter:{PSEUDO:function(Z,V,W,aa){var U=V[1],X=I.filters[U];if(X){return X(Z,W,V,aa)}else{if(U==="contains"){return(Z.textContent||Z.innerText||"").indexOf(V[3])>=0}else{if(U==="not"){var Y=V[3];for(var W=0,T=Y.length;W<T;W++){if(Y[W]===Z){return false}}return true}}}},CHILD:function(T,W){var Z=W[1],U=T;switch(Z){case"only":case"first":while(U=U.previousSibling){if(U.nodeType===1){return false}}if(Z=="first"){return true}U=T;case"last":while(U=U.nextSibling){if(U.nodeType===1){return false}}return true;case"nth":var V=W[2],ac=W[3];if(V==1&&ac==0){return true}var Y=W[0],ab=T.parentNode;if(ab&&(ab.sizcache!==Y||!T.nodeIndex)){var X=0;for(U=ab.firstChild;U;U=U.nextSibling){if(U.nodeType===1){U.nodeIndex=++X}}ab.sizcache=Y}var aa=T.nodeIndex-ac;if(V==0){return aa==0}else{return(aa%V==0&&aa/V>=0)}}},ID:function(U,T){return U.nodeType===1&&U.getAttribute("id")===T},TAG:function(U,T){return(T==="*"&&U.nodeType===1)||U.nodeName===T},CLASS:function(U,T){return(" "+(U.className||U.getAttribute("class"))+" ").indexOf(T)>-1},ATTR:function(Y,W){var V=W[1],T=I.attrHandle[V]?I.attrHandle[V](Y):Y[V]!=null?Y[V]:Y.getAttribute(V),Z=T+"",X=W[2],U=W[4];return T==null?X==="!=":X==="="?Z===U:X==="*="?Z.indexOf(U)>=0:X==="~="?(" "+Z+" ").indexOf(U)>=0:!U?Z&&T!==false:X==="!="?Z!=U:X==="^="?Z.indexOf(U)===0:X==="$="?Z.substr(Z.length-U.length)===U:X==="|="?Z===U||Z.substr(0,U.length+1)===U+"-":false},POS:function(X,U,V,Y){var T=U[2],W=I.setFilters[T];if(W){return W(X,V,U,Y)}}}};var M=I.match.POS;for(var O in I.match){I.match[O]=RegExp(I.match[O].source+/(?![^\[]*\])(?![^\(]*\))/.source)}var E=function(U,T){U=Array.prototype.slice.call(U);if(T){T.push.apply(T,U);return T}return U};try{Array.prototype.slice.call(document.documentElement.childNodes)}catch(N){E=function(X,W){var U=W||[];if(H.call(X)==="[object Array]"){Array.prototype.push.apply(U,X)}else{if(typeof X.length==="number"){for(var V=0,T=X.length;V<T;V++){U.push(X[V])}}else{for(var V=0;X[V];V++){U.push(X[V])}}}return U}}var G;if(document.documentElement.compareDocumentPosition){G=function(U,T){var V=U.compareDocumentPosition(T)&4?-1:U===T?0:1;if(V===0){hasDuplicate=true}return V}}else{if("sourceIndex" in document.documentElement){G=function(U,T){var V=U.sourceIndex-T.sourceIndex;if(V===0){hasDuplicate=true}return V}}else{if(document.createRange){G=function(W,U){var V=W.ownerDocument.createRange(),T=U.ownerDocument.createRange();V.selectNode(W);V.collapse(true);T.selectNode(U);T.collapse(true);var X=V.compareBoundaryPoints(Range.START_TO_END,T);if(X===0){hasDuplicate=true}return X}}}}(function(){var U=document.createElement("form"),V="script"+(new Date).getTime();U.innerHTML="<input name='"+V+"'/>";var T=document.documentElement;T.insertBefore(U,T.firstChild);if(!!document.getElementById(V)){I.find.ID=function(X,Y,Z){if(typeof Y.getElementById!=="undefined"&&!Z){var W=Y.getElementById(X[1]);return W?W.id===X[1]||typeof W.getAttributeNode!=="undefined"&&W.getAttributeNode("id").nodeValue===X[1]?[W]:g:[]}};I.filter.ID=function(Y,W){var X=typeof Y.getAttributeNode!=="undefined"&&Y.getAttributeNode("id");return Y.nodeType===1&&X&&X.nodeValue===W}}T.removeChild(U)})();(function(){var T=document.createElement("div");T.appendChild(document.createComment(""));if(T.getElementsByTagName("*").length>0){I.find.TAG=function(U,Y){var X=Y.getElementsByTagName(U[1]);if(U[1]==="*"){var W=[];for(var V=0;X[V];V++){if(X[V].nodeType===1){W.push(X[V])}}X=W}return X}}T.innerHTML="<a href='#'></a>";if(T.firstChild&&typeof T.firstChild.getAttribute!=="undefined"&&T.firstChild.getAttribute("href")!=="#"){I.attrHandle.href=function(U){return U.getAttribute("href",2)}}})();if(document.querySelectorAll){(function(){var T=F,U=document.createElement("div");U.innerHTML="<p class='TEST'></p>";if(U.querySelectorAll&&U.querySelectorAll(".TEST").length===0){return}F=function(Y,X,V,W){X=X||document;if(!W&&X.nodeType===9&&!Q(X)){try{return E(X.querySelectorAll(Y),V)}catch(Z){}}return T(Y,X,V,W)};F.find=T.find;F.filter=T.filter;F.selectors=T.selectors;F.matches=T.matches})()}if(document.getElementsByClassName&&document.documentElement.getElementsByClassName){(function(){var T=document.createElement("div");T.innerHTML="<div class='test e'></div><div class='test'></div>";if(T.getElementsByClassName("e").length===0){return}T.lastChild.className="e";if(T.getElementsByClassName("e").length===1){return}I.order.splice(1,0,"CLASS");I.find.CLASS=function(U,V,W){if(typeof V.getElementsByClassName!=="undefined"&&!W){return V.getElementsByClassName(U[1])}}})()}function P(U,Z,Y,ad,aa,ac){var ab=U=="previousSibling"&&!ac;for(var W=0,V=ad.length;W<V;W++){var T=ad[W];if(T){if(ab&&T.nodeType===1){T.sizcache=Y;T.sizset=W}T=T[U];var X=false;while(T){if(T.sizcache===Y){X=ad[T.sizset];break}if(T.nodeType===1&&!ac){T.sizcache=Y;T.sizset=W}if(T.nodeName===Z){X=T;break}T=T[U]}ad[W]=X}}}function S(U,Z,Y,ad,aa,ac){var ab=U=="previousSibling"&&!ac;for(var W=0,V=ad.length;W<V;W++){var T=ad[W];if(T){if(ab&&T.nodeType===1){T.sizcache=Y;T.sizset=W}T=T[U];var X=false;while(T){if(T.sizcache===Y){X=ad[T.sizset];break}if(T.nodeType===1){if(!ac){T.sizcache=Y;T.sizset=W}if(typeof Z!=="string"){if(T===Z){X=true;break}}else{if(F.filter(Z,[T]).length>0){X=T;break}}}T=T[U]}ad[W]=X}}}var K=document.compareDocumentPosition?function(U,T){return U.compareDocumentPosition(T)&16}:function(U,T){return U!==T&&(U.contains?U.contains(T):true)};var Q=function(T){return T.nodeType===9&&T.documentElement.nodeName!=="HTML"||!!T.ownerDocument&&Q(T.ownerDocument)};var J=function(T,aa){var W=[],X="",Y,V=aa.nodeType?[aa]:aa;while((Y=I.match.PSEUDO.exec(T))){X+=Y[0];T=T.replace(I.match.PSEUDO,"")}T=I.relative[T]?T+"*":T;for(var Z=0,U=V.length;Z<U;Z++){F(T,V[Z],W)}return F.filter(X,W)};o.find=F;o.filter=F.filter;o.expr=F.selectors;o.expr[":"]=o.expr.filters;F.selectors.filters.hidden=function(T){return T.offsetWidth===0||T.offsetHeight===0};F.selectors.filters.visible=function(T){return T.offsetWidth>0||T.offsetHeight>0};F.selectors.filters.animated=function(T){return o.grep(o.timers,function(U){return T===U.elem}).length};o.multiFilter=function(V,T,U){if(U){V=":not("+V+")"}return F.matches(V,T)};o.dir=function(V,U){var T=[],W=V[U];while(W&&W!=document){if(W.nodeType==1){T.push(W)}W=W[U]}return T};o.nth=function(X,T,V,W){T=T||1;var U=0;for(;X;X=X[V]){if(X.nodeType==1&&++U==T){break}}return X};o.sibling=function(V,U){var T=[];for(;V;V=V.nextSibling){if(V.nodeType==1&&V!=U){T.push(V)}}return T};return;l.Sizzle=F})();o.event={add:function(I,F,H,K){if(I.nodeType==3||I.nodeType==8){return}if(I.setInterval&&I!=l){I=l}if(!H.guid){H.guid=this.guid++}if(K!==g){var G=H;H=this.proxy(G);H.data=K}var E=o.data(I,"events")||o.data(I,"events",{}),J=o.data(I,"handle")||o.data(I,"handle",function(){return typeof o!=="undefined"&&!o.event.triggered?o.event.handle.apply(arguments.callee.elem,arguments):g});J.elem=I;o.each(F.split(/\s+/),function(M,N){var O=N.split(".");N=O.shift();H.type=O.slice().sort().join(".");var L=E[N];if(o.event.specialAll[N]){o.event.specialAll[N].setup.call(I,K,O)}if(!L){L=E[N]={};if(!o.event.special[N]||o.event.special[N].setup.call(I,K,O)===false){if(I.addEventListener){I.addEventListener(N,J,false)}else{if(I.attachEvent){I.attachEvent("on"+N,J)}}}}L[H.guid]=H;o.event.global[N]=true});I=null},guid:1,global:{},remove:function(K,H,J){if(K.nodeType==3||K.nodeType==8){return}var G=o.data(K,"events"),F,E;if(G){if(H===g||(typeof H==="string"&&H.charAt(0)==".")){for(var I in G){this.remove(K,I+(H||""))}}else{if(H.type){J=H.handler;H=H.type}o.each(H.split(/\s+/),function(M,O){var Q=O.split(".");O=Q.shift();var N=RegExp("(^|\\.)"+Q.slice().sort().join(".*\\.")+"(\\.|$)");if(G[O]){if(J){delete G[O][J.guid]}else{for(var P in G[O]){if(N.test(G[O][P].type)){delete G[O][P]}}}if(o.event.specialAll[O]){o.event.specialAll[O].teardown.call(K,Q)}for(F in G[O]){break}if(!F){if(!o.event.special[O]||o.event.special[O].teardown.call(K,Q)===false){if(K.removeEventListener){K.removeEventListener(O,o.data(K,"handle"),false)}else{if(K.detachEvent){K.detachEvent("on"+O,o.data(K,"handle"))}}}F=null;delete G[O]}}})}for(F in G){break}if(!F){var L=o.data(K,"handle");if(L){L.elem=null}o.removeData(K,"events");o.removeData(K,"handle")}}},trigger:function(I,K,H,E){var G=I.type||I;if(!E){I=typeof I==="object"?I[h]?I:o.extend(o.Event(G),I):o.Event(G);if(G.indexOf("!")>=0){I.type=G=G.slice(0,-1);I.exclusive=true}if(!H){I.stopPropagation();if(this.global[G]){o.each(o.cache,function(){if(this.events&&this.events[G]){o.event.trigger(I,K,this.handle.elem)}})}}if(!H||H.nodeType==3||H.nodeType==8){return g}I.result=g;I.target=H;K=o.makeArray(K);K.unshift(I)}I.currentTarget=H;var J=o.data(H,"handle");if(J){J.apply(H,K)}if((!H[G]||(o.nodeName(H,"a")&&G=="click"))&&H["on"+G]&&H["on"+G].apply(H,K)===false){I.result=false}if(!E&&H[G]&&!I.isDefaultPrevented()&&!(o.nodeName(H,"a")&&G=="click")){this.triggered=true;try{H[G]()}catch(L){}}this.triggered=false;if(!I.isPropagationStopped()){var F=H.parentNode||H.ownerDocument;if(F){o.event.trigger(I,K,F,true)}}},handle:function(K){var J,E;K=arguments[0]=o.event.fix(K||l.event);K.currentTarget=this;var L=K.type.split(".");K.type=L.shift();J=!L.length&&!K.exclusive;var I=RegExp("(^|\\.)"+L.slice().sort().join(".*\\.")+"(\\.|$)");E=(o.data(this,"events")||{})[K.type];for(var G in E){var H=E[G];if(J||I.test(H.type)){K.handler=H;K.data=H.data;var F=H.apply(this,arguments);if(F!==g){K.result=F;if(F===false){K.preventDefault();K.stopPropagation()}}if(K.isImmediatePropagationStopped()){break}}}},props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode metaKey newValue originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" "),fix:function(H){if(H[h]){return H}var F=H;H=o.Event(F);for(var G=this.props.length,J;G;){J=this.props[--G];H[J]=F[J]}if(!H.target){H.target=H.srcElement||document}if(H.target.nodeType==3){H.target=H.target.parentNode}if(!H.relatedTarget&&H.fromElement){H.relatedTarget=H.fromElement==H.target?H.toElement:H.fromElement}if(H.pageX==null&&H.clientX!=null){var I=document.documentElement,E=document.body;H.pageX=H.clientX+(I&&I.scrollLeft||E&&E.scrollLeft||0)-(I.clientLeft||0);H.pageY=H.clientY+(I&&I.scrollTop||E&&E.scrollTop||0)-(I.clientTop||0)}if(!H.which&&((H.charCode||H.charCode===0)?H.charCode:H.keyCode)){H.which=H.charCode||H.keyCode}if(!H.metaKey&&H.ctrlKey){H.metaKey=H.ctrlKey}if(!H.which&&H.button){H.which=(H.button&1?1:(H.button&2?3:(H.button&4?2:0)))}return H},proxy:function(F,E){E=E||function(){return F.apply(this,arguments)};E.guid=F.guid=F.guid||E.guid||this.guid++;return E},special:{ready:{setup:B,teardown:function(){}}},specialAll:{live:{setup:function(E,F){o.event.add(this,F[0],c)},teardown:function(G){if(G.length){var E=0,F=RegExp("(^|\\.)"+G[0]+"(\\.|$)");o.each((o.data(this,"events").live||{}),function(){if(F.test(this.type)){E++}});if(E<1){o.event.remove(this,G[0],c)}}}}}};o.Event=function(E){if(!this.preventDefault){return new o.Event(E)}if(E&&E.type){this.originalEvent=E;this.type=E.type}else{this.type=E}this.timeStamp=e();this[h]=true};function k(){return false}function u(){return true}o.Event.prototype={preventDefault:function(){this.isDefaultPrevented=u;var E=this.originalEvent;if(!E){return}if(E.preventDefault){E.preventDefault()}E.returnValue=false},stopPropagation:function(){this.isPropagationStopped=u;var E=this.originalEvent;if(!E){return}if(E.stopPropagation){E.stopPropagation()}E.cancelBubble=true},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=u;this.stopPropagation()},isDefaultPrevented:k,isPropagationStopped:k,isImmediatePropagationStopped:k};var a=function(F){var E=F.relatedTarget;while(E&&E!=this){try{E=E.parentNode}catch(G){E=this}}if(E!=this){F.type=F.data;o.event.handle.apply(this,arguments)}};o.each({mouseover:"mouseenter",mouseout:"mouseleave"},function(F,E){o.event.special[E]={setup:function(){o.event.add(this,F,a,E)},teardown:function(){o.event.remove(this,F,a)}}});o.fn.extend({bind:function(F,G,E){return F=="unload"?this.one(F,G,E):this.each(function(){o.event.add(this,F,E||G,E&&G)})},one:function(G,H,F){var E=o.event.proxy(F||H,function(I){o(this).unbind(I,E);return(F||H).apply(this,arguments)});return this.each(function(){o.event.add(this,G,E,F&&H)})},unbind:function(F,E){return this.each(function(){o.event.remove(this,F,E)})},trigger:function(E,F){return this.each(function(){o.event.trigger(E,F,this)})},triggerHandler:function(E,G){if(this[0]){var F=o.Event(E);F.preventDefault();F.stopPropagation();o.event.trigger(F,G,this[0]);return F.result}},toggle:function(G){var E=arguments,F=1;while(F<E.length){o.event.proxy(G,E[F++])}return this.click(o.event.proxy(G,function(H){this.lastToggle=(this.lastToggle||0)%F;H.preventDefault();return E[this.lastToggle++].apply(this,arguments)||false}))},hover:function(E,F){return this.mouseenter(E).mouseleave(F)},ready:function(E){B();if(o.isReady){E.call(document,o)}else{o.readyList.push(E)}return this},live:function(G,F){var E=o.event.proxy(F);E.guid+=this.selector+G;o(document).bind(i(G,this.selector),this.selector,E);return this},die:function(F,E){o(document).unbind(i(F,this.selector),E?{guid:E.guid+this.selector+F}:null);return this}});function c(H){var E=RegExp("(^|\\.)"+H.type+"(\\.|$)"),G=true,F=[];o.each(o.data(this,"events").live||[],function(I,J){if(E.test(J.type)){var K=o(H.target).closest(J.data)[0];if(K){F.push({elem:K,fn:J})}}});F.sort(function(J,I){return o.data(J.elem,"closest")-o.data(I.elem,"closest")});o.each(F,function(){if(this.fn.call(this.elem,H,this.fn.data)===false){return(G=false)}});return G}function i(F,E){return["live",F,E.replace(/\./g,"`").replace(/ /g,"|")].join(".")}o.extend({isReady:false,readyList:[],ready:function(){if(!o.isReady){o.isReady=true;if(o.readyList){o.each(o.readyList,function(){this.call(document,o)});o.readyList=null}o(document).triggerHandler("ready")}}});var x=false;function B(){if(x){return}x=true;if(document.addEventListener){document.addEventListener("DOMContentLoaded",function(){document.removeEventListener("DOMContentLoaded",arguments.callee,false);o.ready()},false)}else{if(document.attachEvent){document.attachEvent("onreadystatechange",function(){if(document.readyState==="complete"){document.detachEvent("onreadystatechange",arguments.callee);o.ready()}});if(document.documentElement.doScroll&&l==l.top){(function(){if(o.isReady){return}try{document.documentElement.doScroll("left")}catch(E){setTimeout(arguments.callee,0);return}o.ready()})()}}}o.event.add(l,"load",o.ready)}o.each(("blur,focus,load,resize,scroll,unload,click,dblclick,mousedown,mouseup,mousemove,mouseover,mouseout,mouseenter,mouseleave,change,select,submit,keydown,keypress,keyup,error").split(","),function(F,E){o.fn[E]=function(G){return G?this.bind(E,G):this.trigger(E)}});o(l).bind("unload",function(){for(var E in o.cache){if(E!=1&&o.cache[E].handle){o.event.remove(o.cache[E].handle.elem)}}});(function(){o.support={};var F=document.documentElement,G=document.createElement("script"),K=document.createElement("div"),J="script"+(new Date).getTime();K.style.display="none";K.innerHTML='   <link/><table></table><a href="/a" style="color:red;float:left;opacity:.5;">a</a><select><option>text</option></select><object><param/></object>';var H=K.getElementsByTagName("*"),E=K.getElementsByTagName("a")[0];if(!H||!H.length||!E){return}o.support={leadingWhitespace:K.firstChild.nodeType==3,tbody:!K.getElementsByTagName("tbody").length,objectAll:!!K.getElementsByTagName("object")[0].getElementsByTagName("*").length,htmlSerialize:!!K.getElementsByTagName("link").length,style:/red/.test(E.getAttribute("style")),hrefNormalized:E.getAttribute("href")==="/a",opacity:E.style.opacity==="0.5",cssFloat:!!E.style.cssFloat,scriptEval:false,noCloneEvent:true,boxModel:null};G.type="text/javascript";try{G.appendChild(document.createTextNode("window."+J+"=1;"))}catch(I){}F.insertBefore(G,F.firstChild);if(l[J]){o.support.scriptEval=true;delete l[J]}F.removeChild(G);if(K.attachEvent&&K.fireEvent){K.attachEvent("onclick",function(){o.support.noCloneEvent=false;K.detachEvent("onclick",arguments.callee)});K.cloneNode(true).fireEvent("onclick")}o(function(){var L=document.createElement("div");L.style.width=L.style.paddingLeft="1px";document.body.appendChild(L);o.boxModel=o.support.boxModel=L.offsetWidth===2;document.body.removeChild(L).style.display="none"})})();var w=o.support.cssFloat?"cssFloat":"styleFloat";o.props={"for":"htmlFor","class":"className","float":w,cssFloat:w,styleFloat:w,readonly:"readOnly",maxlength:"maxLength",cellspacing:"cellSpacing",rowspan:"rowSpan",tabindex:"tabIndex"};o.fn.extend({_load:o.fn.load,load:function(G,J,K){if(typeof G!=="string"){return this._load(G)}var I=G.indexOf(" ");if(I>=0){var E=G.slice(I,G.length);G=G.slice(0,I)}var H="GET";if(J){if(o.isFunction(J)){K=J;J=null}else{if(typeof J==="object"){J=o.param(J);H="POST"}}}var F=this;o.ajax({url:G,type:H,dataType:"html",data:J,complete:function(M,L){if(L=="success"||L=="notmodified"){F.html(E?o("<div/>").append(M.responseText.replace(/<script(.|\s)*?\/script>/g,"")).find(E):M.responseText)}if(K){F.each(K,[M.responseText,L,M])}}});return this},serialize:function(){return o.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?o.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||/select|textarea/i.test(this.nodeName)||/text|hidden|password|search/i.test(this.type))}).map(function(E,F){var G=o(this).val();return G==null?null:o.isArray(G)?o.map(G,function(I,H){return{name:F.name,value:I}}):{name:F.name,value:G}}).get()}});o.each("ajaxStart,ajaxStop,ajaxComplete,ajaxError,ajaxSuccess,ajaxSend".split(","),function(E,F){o.fn[F]=function(G){return this.bind(F,G)}});var r=e();o.extend({get:function(E,G,H,F){if(o.isFunction(G)){H=G;G=null}return o.ajax({type:"GET",url:E,data:G,success:H,dataType:F})},getScript:function(E,F){return o.get(E,null,F,"script")},getJSON:function(E,F,G){return o.get(E,F,G,"json")},post:function(E,G,H,F){if(o.isFunction(G)){H=G;G={}}return o.ajax({type:"POST",url:E,data:G,success:H,dataType:F})},ajaxSetup:function(E){o.extend(o.ajaxSettings,E)},ajaxSettings:{url:location.href,global:true,type:"GET",contentType:"application/x-www-form-urlencoded",processData:true,async:true,xhr:function(){return l.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest()},accepts:{xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"}},lastModified:{},ajax:function(M){M=o.extend(true,M,o.extend(true,{},o.ajaxSettings,M));var W,F=/=\?(&|$)/g,R,V,G=M.type.toUpperCase();if(M.data&&M.processData&&typeof M.data!=="string"){M.data=o.param(M.data)}if(M.dataType=="jsonp"){if(G=="GET"){if(!M.url.match(F)){M.url+=(M.url.match(/\?/)?"&":"?")+(M.jsonp||"callback")+"=?"}}else{if(!M.data||!M.data.match(F)){M.data=(M.data?M.data+"&":"")+(M.jsonp||"callback")+"=?"}}M.dataType="json"}if(M.dataType=="json"&&(M.data&&M.data.match(F)||M.url.match(F))){W="jsonp"+r++;if(M.data){M.data=(M.data+"").replace(F,"="+W+"$1")}M.url=M.url.replace(F,"="+W+"$1");M.dataType="script";l[W]=function(X){V=X;I();L();l[W]=g;try{delete l[W]}catch(Y){}if(H){H.removeChild(T)}}}if(M.dataType=="script"&&M.cache==null){M.cache=false}if(M.cache===false&&G=="GET"){var E=e();var U=M.url.replace(/(\?|&)_=.*?(&|$)/,"$1_="+E+"$2");M.url=U+((U==M.url)?(M.url.match(/\?/)?"&":"?")+"_="+E:"")}if(M.data&&G=="GET"){M.url+=(M.url.match(/\?/)?"&":"?")+M.data;M.data=null}if(M.global&&!o.active++){o.event.trigger("ajaxStart")}var Q=/^(\w+:)?\/\/([^\/?#]+)/.exec(M.url);if(M.dataType=="script"&&G=="GET"&&Q&&(Q[1]&&Q[1]!=location.protocol||Q[2]!=location.host)){var H=document.getElementsByTagName("head")[0];var T=document.createElement("script");T.src=M.url;if(M.scriptCharset){T.charset=M.scriptCharset}if(!W){var O=false;T.onload=T.onreadystatechange=function(){if(!O&&(!this.readyState||this.readyState=="loaded"||this.readyState=="complete")){O=true;I();L();T.onload=T.onreadystatechange=null;H.removeChild(T)}}}H.appendChild(T);return g}var K=false;var J=M.xhr();if(M.username){J.open(G,M.url,M.async,M.username,M.password)}else{J.open(G,M.url,M.async)}try{if(M.data){J.setRequestHeader("Content-Type",M.contentType)}if(M.ifModified){J.setRequestHeader("If-Modified-Since",o.lastModified[M.url]||"Thu, 01 Jan 1970 00:00:00 GMT")}J.setRequestHeader("X-Requested-With","XMLHttpRequest");J.setRequestHeader("Accept",M.dataType&&M.accepts[M.dataType]?M.accepts[M.dataType]+", */*":M.accepts._default)}catch(S){}if(M.beforeSend&&M.beforeSend(J,M)===false){if(M.global&&!--o.active){o.event.trigger("ajaxStop")}J.abort();return false}if(M.global){o.event.trigger("ajaxSend",[J,M])}var N=function(X){if(J.readyState==0){if(P){clearInterval(P);P=null;if(M.global&&!--o.active){o.event.trigger("ajaxStop")}}}else{if(!K&&J&&(J.readyState==4||X=="timeout")){K=true;if(P){clearInterval(P);P=null}R=X=="timeout"?"timeout":!o.httpSuccess(J)?"error":M.ifModified&&o.httpNotModified(J,M.url)?"notmodified":"success";if(R=="success"){try{V=o.httpData(J,M.dataType,M)}catch(Z){R="parsererror"}}if(R=="success"){var Y;try{Y=J.getResponseHeader("Last-Modified")}catch(Z){}if(M.ifModified&&Y){o.lastModified[M.url]=Y}if(!W){I()}}else{o.handleError(M,J,R)}L();if(X){J.abort()}if(M.async){J=null}}}};if(M.async){var P=setInterval(N,13);if(M.timeout>0){setTimeout(function(){if(J&&!K){N("timeout")}},M.timeout)}}try{J.send(M.data)}catch(S){o.handleError(M,J,null,S)}if(!M.async){N()}function I(){if(M.success){M.success(V,R)}if(M.global){o.event.trigger("ajaxSuccess",[J,M])}}function L(){if(M.complete){M.complete(J,R)}if(M.global){o.event.trigger("ajaxComplete",[J,M])}if(M.global&&!--o.active){o.event.trigger("ajaxStop")}}return J},handleError:function(F,H,E,G){if(F.error){F.error(H,E,G)}if(F.global){o.event.trigger("ajaxError",[H,F,G])}},active:0,httpSuccess:function(F){try{return !F.status&&location.protocol=="file:"||(F.status>=200&&F.status<300)||F.status==304||F.status==1223}catch(E){}return false},httpNotModified:function(G,E){try{var H=G.getResponseHeader("Last-Modified");return G.status==304||H==o.lastModified[E]}catch(F){}return false},httpData:function(J,H,G){var F=J.getResponseHeader("content-type"),E=H=="xml"||!H&&F&&F.indexOf("xml")>=0,I=E?J.responseXML:J.responseText;if(E&&I.documentElement.tagName=="parsererror"){throw"parsererror"}if(G&&G.dataFilter){I=G.dataFilter(I,H)}if(typeof I==="string"){if(H=="script"){o.globalEval(I)}if(H=="json"){I=l["eval"]("("+I+")")}}return I},param:function(E){var G=[];function H(I,J){G[G.length]=encodeURIComponent(I)+"="+encodeURIComponent(J)}if(o.isArray(E)||E.jquery){o.each(E,function(){H(this.name,this.value)})}else{for(var F in E){if(o.isArray(E[F])){o.each(E[F],function(){H(F,this)})}else{H(F,o.isFunction(E[F])?E[F]():E[F])}}}return G.join("&").replace(/%20/g,"+")}});var m={},n,d=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]];function t(F,E){var G={};o.each(d.concat.apply([],d.slice(0,E)),function(){G[this]=F});return G}o.fn.extend({show:function(J,L){if(J){return this.animate(t("show",3),J,L)}else{for(var H=0,F=this.length;H<F;H++){var E=o.data(this[H],"olddisplay");this[H].style.display=E||"";if(o.css(this[H],"display")==="none"){var G=this[H].tagName,K;if(m[G]){K=m[G]}else{var I=o("<"+G+" />").appendTo("body");K=I.css("display");if(K==="none"){K="block"}I.remove();m[G]=K}o.data(this[H],"olddisplay",K)}}for(var H=0,F=this.length;H<F;H++){this[H].style.display=o.data(this[H],"olddisplay")||""}return this}},hide:function(H,I){if(H){return this.animate(t("hide",3),H,I)}else{for(var G=0,F=this.length;G<F;G++){var E=o.data(this[G],"olddisplay");if(!E&&E!=="none"){o.data(this[G],"olddisplay",o.css(this[G],"display"))}}for(var G=0,F=this.length;G<F;G++){this[G].style.display="none"}return this}},_toggle:o.fn.toggle,toggle:function(G,F){var E=typeof G==="boolean";return o.isFunction(G)&&o.isFunction(F)?this._toggle.apply(this,arguments):G==null||E?this.each(function(){var H=E?G:o(this).is(":hidden");o(this)[H?"show":"hide"]()}):this.animate(t("toggle",3),G,F)},fadeTo:function(E,G,F){return this.animate({opacity:G},E,F)},animate:function(I,F,H,G){var E=o.speed(F,H,G);return this[E.queue===false?"each":"queue"](function(){var K=o.extend({},E),M,L=this.nodeType==1&&o(this).is(":hidden"),J=this;for(M in I){if(I[M]=="hide"&&L||I[M]=="show"&&!L){return K.complete.call(this)}if((M=="height"||M=="width")&&this.style){K.display=o.css(this,"display");K.overflow=this.style.overflow}}if(K.overflow!=null){this.style.overflow="hidden"}K.curAnim=o.extend({},I);o.each(I,function(O,S){var R=new o.fx(J,K,O);if(/toggle|show|hide/.test(S)){R[S=="toggle"?L?"show":"hide":S](I)}else{var Q=S.toString().match(/^([+-]=)?([\d+-.]+)(.*)$/),T=R.cur(true)||0;if(Q){var N=parseFloat(Q[2]),P=Q[3]||"px";if(P!="px"){J.style[O]=(N||1)+P;T=((N||1)/R.cur(true))*T;J.style[O]=T+P}if(Q[1]){N=((Q[1]=="-="?-1:1)*N)+T}R.custom(T,N,P)}else{R.custom(T,S,"")}}});return true})},stop:function(F,E){var G=o.timers;if(F){this.queue([])}this.each(function(){for(var H=G.length-1;H>=0;H--){if(G[H].elem==this){if(E){G[H](true)}G.splice(H,1)}}});if(!E){this.dequeue()}return this}});o.each({slideDown:t("show",1),slideUp:t("hide",1),slideToggle:t("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"}},function(E,F){o.fn[E]=function(G,H){return this.animate(F,G,H)}});o.extend({speed:function(G,H,F){var E=typeof G==="object"?G:{complete:F||!F&&H||o.isFunction(G)&&G,duration:G,easing:F&&H||H&&!o.isFunction(H)&&H};E.duration=o.fx.off?0:typeof E.duration==="number"?E.duration:o.fx.speeds[E.duration]||o.fx.speeds._default;E.old=E.complete;E.complete=function(){if(E.queue!==false){o(this).dequeue()}if(o.isFunction(E.old)){E.old.call(this)}};return E},easing:{linear:function(G,H,E,F){return E+F*G},swing:function(G,H,E,F){return((-Math.cos(G*Math.PI)/2)+0.5)*F+E}},timers:[],fx:function(F,E,G){this.options=E;this.elem=F;this.prop=G;if(!E.orig){E.orig={}}}});o.fx.prototype={update:function(){if(this.options.step){this.options.step.call(this.elem,this.now,this)}(o.fx.step[this.prop]||o.fx.step._default)(this);if((this.prop=="height"||this.prop=="width")&&this.elem.style){this.elem.style.display="block"}},cur:function(F){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null)){return this.elem[this.prop]}var E=parseFloat(o.css(this.elem,this.prop,F));return E&&E>-10000?E:parseFloat(o.curCSS(this.elem,this.prop))||0},custom:function(I,H,G){this.startTime=e();this.start=I;this.end=H;this.unit=G||this.unit||"px";this.now=this.start;this.pos=this.state=0;var E=this;function F(J){return E.step(J)}F.elem=this.elem;if(F()&&o.timers.push(F)&&!n){n=setInterval(function(){var K=o.timers;for(var J=0;J<K.length;J++){if(!K[J]()){K.splice(J--,1)}}if(!K.length){clearInterval(n);n=g}},13)}},show:function(){this.options.orig[this.prop]=o.attr(this.elem.style,this.prop);this.options.show=true;this.custom(this.prop=="width"||this.prop=="height"?1:0,this.cur());o(this.elem).show()},hide:function(){this.options.orig[this.prop]=o.attr(this.elem.style,this.prop);this.options.hide=true;this.custom(this.cur(),0)},step:function(H){var G=e();if(H||G>=this.options.duration+this.startTime){this.now=this.end;this.pos=this.state=1;this.update();this.options.curAnim[this.prop]=true;var E=true;for(var F in this.options.curAnim){if(this.options.curAnim[F]!==true){E=false}}if(E){if(this.options.display!=null){this.elem.style.overflow=this.options.overflow;this.elem.style.display=this.options.display;if(o.css(this.elem,"display")=="none"){this.elem.style.display="block"}}if(this.options.hide){o(this.elem).hide()}if(this.options.hide||this.options.show){for(var I in this.options.curAnim){o.attr(this.elem.style,I,this.options.orig[I])}}this.options.complete.call(this.elem)}return false}else{var J=G-this.startTime;this.state=J/this.options.duration;this.pos=o.easing[this.options.easing||(o.easing.swing?"swing":"linear")](this.state,J,0,1,this.options.duration);this.now=this.start+((this.end-this.start)*this.pos);this.update()}return true}};o.extend(o.fx,{speeds:{slow:600,fast:200,_default:400},step:{opacity:function(E){o.attr(E.elem.style,"opacity",E.now)},_default:function(E){if(E.elem.style&&E.elem.style[E.prop]!=null){E.elem.style[E.prop]=E.now+E.unit}else{E.elem[E.prop]=E.now}}}});if(document.documentElement.getBoundingClientRect){o.fn.offset=function(){if(!this[0]){return{top:0,left:0}}if(this[0]===this[0].ownerDocument.body){return o.offset.bodyOffset(this[0])}var G=this[0].getBoundingClientRect(),J=this[0].ownerDocument,F=J.body,E=J.documentElement,L=E.clientTop||F.clientTop||0,K=E.clientLeft||F.clientLeft||0,I=G.top+(self.pageYOffset||o.boxModel&&E.scrollTop||F.scrollTop)-L,H=G.left+(self.pageXOffset||o.boxModel&&E.scrollLeft||F.scrollLeft)-K;return{top:I,left:H}}}else{o.fn.offset=function(){if(!this[0]){return{top:0,left:0}}if(this[0]===this[0].ownerDocument.body){return o.offset.bodyOffset(this[0])}o.offset.initialized||o.offset.initialize();var J=this[0],G=J.offsetParent,F=J,O=J.ownerDocument,M,H=O.documentElement,K=O.body,L=O.defaultView,E=L.getComputedStyle(J,null),N=J.offsetTop,I=J.offsetLeft;while((J=J.parentNode)&&J!==K&&J!==H){M=L.getComputedStyle(J,null);N-=J.scrollTop,I-=J.scrollLeft;if(J===G){N+=J.offsetTop,I+=J.offsetLeft;if(o.offset.doesNotAddBorder&&!(o.offset.doesAddBorderForTableAndCells&&/^t(able|d|h)$/i.test(J.tagName))){N+=parseInt(M.borderTopWidth,10)||0,I+=parseInt(M.borderLeftWidth,10)||0}F=G,G=J.offsetParent}if(o.offset.subtractsBorderForOverflowNotVisible&&M.overflow!=="visible"){N+=parseInt(M.borderTopWidth,10)||0,I+=parseInt(M.borderLeftWidth,10)||0}E=M}if(E.position==="relative"||E.position==="static"){N+=K.offsetTop,I+=K.offsetLeft}if(E.position==="fixed"){N+=Math.max(H.scrollTop,K.scrollTop),I+=Math.max(H.scrollLeft,K.scrollLeft)}return{top:N,left:I}}}o.offset={initialize:function(){if(this.initialized){return}var L=document.body,F=document.createElement("div"),H,G,N,I,M,E,J=L.style.marginTop,K='<div style="position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;"><div></div></div><table style="position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;" cellpadding="0" cellspacing="0"><tr><td></td></tr></table>';M={position:"absolute",top:0,left:0,margin:0,border:0,width:"1px",height:"1px",visibility:"hidden"};for(E in M){F.style[E]=M[E]}F.innerHTML=K;L.insertBefore(F,L.firstChild);H=F.firstChild,G=H.firstChild,I=H.nextSibling.firstChild.firstChild;this.doesNotAddBorder=(G.offsetTop!==5);this.doesAddBorderForTableAndCells=(I.offsetTop===5);H.style.overflow="hidden",H.style.position="relative";this.subtractsBorderForOverflowNotVisible=(G.offsetTop===-5);L.style.marginTop="1px";this.doesNotIncludeMarginInBodyOffset=(L.offsetTop===0);L.style.marginTop=J;L.removeChild(F);this.initialized=true},bodyOffset:function(E){o.offset.initialized||o.offset.initialize();var G=E.offsetTop,F=E.offsetLeft;if(o.offset.doesNotIncludeMarginInBodyOffset){G+=parseInt(o.curCSS(E,"marginTop",true),10)||0,F+=parseInt(o.curCSS(E,"marginLeft",true),10)||0}return{top:G,left:F}}};o.fn.extend({position:function(){var I=0,H=0,F;if(this[0]){var G=this.offsetParent(),J=this.offset(),E=/^body|html$/i.test(G[0].tagName)?{top:0,left:0}:G.offset();J.top-=j(this,"marginTop");J.left-=j(this,"marginLeft");E.top+=j(G,"borderTopWidth");E.left+=j(G,"borderLeftWidth");F={top:J.top-E.top,left:J.left-E.left}}return F},offsetParent:function(){var E=this[0].offsetParent||document.body;while(E&&(!/^body|html$/i.test(E.tagName)&&o.css(E,"position")=="static")){E=E.offsetParent}return o(E)}});o.each(["Left","Top"],function(F,E){var G="scroll"+E;o.fn[G]=function(H){if(!this[0]){return null}return H!==g?this.each(function(){this==l||this==document?l.scrollTo(!F?H:o(l).scrollLeft(),F?H:o(l).scrollTop()):this[G]=H}):this[0]==l||this[0]==document?self[F?"pageYOffset":"pageXOffset"]||o.boxModel&&document.documentElement[G]||document.body[G]:this[0][G]}});o.each(["Height","Width"],function(I,G){var E=I?"Left":"Top",H=I?"Right":"Bottom",F=G.toLowerCase();o.fn["inner"+G]=function(){return this[0]?o.css(this[0],F,false,"padding"):null};o.fn["outer"+G]=function(K){return this[0]?o.css(this[0],F,false,K?"margin":"border"):null};var J=G.toLowerCase();o.fn[J]=function(K){return this[0]==l?document.compatMode=="CSS1Compat"&&document.documentElement["client"+G]||document.body["client"+G]:this[0]==document?Math.max(document.documentElement["client"+G],document.body["scroll"+G],document.documentElement["scroll"+G],document.body["offset"+G],document.documentElement["offset"+G]):K===g?(this.length?o.css(this[0],J):null):this.css(J,typeof K==="string"?K:K+"px")}})})();
//]]>
</script>
<script id="jqueryArea" type="text/javascript">
//<![CDATA[
/*
jquery.file.js

jQuery plugin for loading a file and saving data to a file

Copyright (c) UnaMesa Association 2009

Dual licensed under the MIT and GPL licenses:
  http://www.opensource.org/licenses/mit-license.php
  http://www.gnu.org/licenses/gpl.html
*/

(function($) {
	if(!$.file) {
		$.file = {};
	}

	$.extend($.file,{
		currentDriver: null,
		driverList: ["activeX", "mozilla", "tiddlySaver", "javaLiveConnect"],
		
		getDriver: function() {
			if(this.currentDriver === null) {
				for(var t=0; t<this.driverList.length; t++) {
					if(this.currentDriver === null && drivers[this.driverList[t]].isAvailable && drivers[this.driverList[t]].isAvailable())
						this.currentDriver = drivers[this.driverList[t]];
				}
			}
			return this.currentDriver;
		},
		load: function(filePath) {
			return this.getDriver().loadFile(filePath);
		},
		save: function(filePath,content) {
			return this.getDriver().saveFile(filePath,content);
		},
		copy: function(dest,source) {
			if(this.getDriver().copyFile)
				return this.currentDriver.copyFile(dest,source);
			else
				return false;
		}
	});

	// Private implementations for each browser
	
	var drivers = {};
	
	drivers.activeX = {
		name: "activeX",
		isAvailable: function() {
			try {
				var fso = new ActiveXObject("Scripting.FileSystemObject");
			} catch(ex) {
				return false;
			}
			return true;
		},
		loadFile: function(filePath) {
			// Returns null if it can't do it, false if there's an error, or a string of the content if successful
			try {
				var fso = new ActiveXObject("Scripting.FileSystemObject");
				var file = fso.OpenTextFile(filePath,1);
				var content = file.ReadAll();
				file.Close();
			} catch(ex) {
				return null;
			}
			return content;
		},
		createPath: function(path) {
			var pos = path.lastIndexOf("\\");
			if(pos!=-1)
				path = path.substring(0,pos+1);
			var scan = [path];
			try {
				var fso = new ActiveXObject("Scripting.FileSystemObject");
				var parent = fso.GetParentFolderName(path);
				while(parent && !fso.FolderExists(parent)) {
					scan.push(parent);
					parent = fso.GetParentFolderName(parent);
				}
				for(i=scan.length-1;i>=0;i--) {
					if(!fso.FolderExists(scan[i])) {
						fso.CreateFolder(scan[i]);
					}
				}
				return true;
			} catch(ex) {
			}
			return false;
		},
		copyFile: function(dest,source) {
			drivers.activeX.createPath(dest);
			try {
				var fso = new ActiveXObject("Scripting.FileSystemObject");
				fso.GetFile(source).Copy(dest);
			} catch(ex) {
				return false;
			}
			return true;
		},
		saveFile: function(filePath,content) {
			// Returns null if it can't do it, false if there's an error, true if it saved OK
			drivers.activeX.createPath(filePath);
			try {
				var fso = new ActiveXObject("Scripting.FileSystemObject");
				var file = fso.OpenTextFile(filePath,2,-1,0);
				file.Write(content);
				file.Close();
			} catch (ex) {
				return null;
			}
			return true;
		}
	};

	drivers.mozilla = {
		name: "mozilla",
		isAvailable: function() {
			return !!window.Components;
		},
		loadFile: function(filePath) {
			// Returns null if it can't do it, false if there's an error, or a string of the content if successful
			if(window.Components) {
				try {
					netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
					var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
					file.initWithPath(filePath);
					if(!file.exists())
						return null;
					var inputStream = Components.classes["@mozilla.org/network/file-input-stream;1"].createInstance(Components.interfaces.nsIFileInputStream);
					inputStream.init(file,0x01,4,null);
					var converter = Components.classes["@mozilla.org/intl/converter-input-stream;1"].createInstance(Components.interfaces.nsIConverterInputStream);
					converter.init(inputStream, "UTF-8", 0, 0);
					var buffer = {};
					var result = [];
					while(converter.readString(-1,buffer) != 0) {
						result.push(buffer.value);
					}
					converter.close();
					inputStream.close();
					return result.join("");
				} catch(ex) {
					return false;
				}
			}
			return null;
		},
		saveFile: function(filePath,content) {
			// Returns null if it can't do it, false if there's an error, true if it saved OK
			if(window.Components) {
				try {
					netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
					var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
					file.initWithPath(filePath);
					if(!file.exists())
						file.create(0,0664);
					var out = Components.classes["@mozilla.org/network/file-output-stream;1"].createInstance(Components.interfaces.nsIFileOutputStream);
					out.init(file,0x22,4,null);
					var converter = Components.classes["@mozilla.org/intl/converter-output-stream;1"].createInstance(Components.interfaces.nsIConverterOutputStream);
					converter.init(out, "UTF-8", 0, 0);
					converter.writeString(content);
					converter.close();
					out.close();
					return true;
				} catch(ex) {
					alert("Exception while attempting to save\n\n" + ex);
					return false;
				}
			}
			return null;
		}
	};
	
	$(function() {
		drivers.tiddlySaver.loadApplet();
	});

	drivers.tiddlySaver = {
		name: "tiddlySaver",
		loadApplet: function() {
			if(!document.applets["TiddlySaver"] && !$.browser.mozilla && !$.browser.msie) {
				$(document.body).append("<applet style='position:absolute;left:-1px' name='TiddlySaver' code='TiddlySaver.class' archive='TiddlySaver.jar' width='1'height='1'></applet>");
			}
		},
		isAvailable: function() {
			return !!document.applets["TiddlySaver"];
		},
		loadFile: function(filePath) {
			var r;
			try {
				if(document.applets["TiddlySaver"]) {
					r = document.applets["TiddlySaver"].loadFile(javaUrlToFilename(filePath),"UTF-8");
					return (r === undefined || r === null) ? null : String(r);
				}
			} catch(ex) {
			}
			return null;
		},
		saveFile: function(filePath,content) {
			try {
				if(document.applets["TiddlySaver"])
					return document.applets["TiddlySaver"].saveFile(javaUrlToFilename(filePath),"UTF-8",content);
			} catch(ex) {
			}
			return null;
		}
	}

	drivers.javaLiveConnect = {
		name: "javaLiveConnect",
		isAvailable: function() {
			return !!window.java && !!window.java.io && !!window.java.io.FileReader;
		},
		loadFile: function(filePath) {
			var r;
			var content = [];
			try {
				r = new java.io.BufferedReader(new java.io.FileReader(javaUrlToFilename(filePath)));
				var line;
				while((line = r.readLine()) != null)
					content.push(new String(line));
				r.close();
			} catch(ex) {
				return null;
			}
			return content.join("\n") + "\n";
		},
		saveFile: function(filePath,content) {
			try {
				var s = new java.io.PrintStream(new java.io.FileOutputStream(javaUrlToFilename(filePath)));
				s.print(content);
				s.close();
			} catch(ex) {
				return null;
			}
			return true;
		}
	}

	function javaUrlToFilename(url) {
		var f = "//localhost";
		if(url.indexOf(f) == 0)
			return url.substring(f.length);
		var i = url.indexOf(":");
		return i > 0 ? url.substring(i-1) : url;
	}

})(jQuery);
/*
jquery.encoding.digests.sha1.js

SHA-1 digest and associated utility functions

Copyright (c) UnaMesa Association 2009

Dual licensed under the MIT and GPL licenses:
  http://www.opensource.org/licenses/mit-license.php
  http://www.gnu.org/licenses/gpl.html
*/

(function($) {

if(!$.encoding)
	$.encoding = {};
	$.extend($.encoding,{
		strToBe32s: function(str) {
			// Convert a string to an array of big-endian 32-bit words
			var be=[];
			var len=Math.floor(str.length/4);
			var i, j;
			for(i=0, j=0; i<len; i++, j+=4) {
				be[i]=((str.charCodeAt(j)&0xff) << 24)|((str.charCodeAt(j+1)&0xff) << 16)|((str.charCodeAt(j+2)&0xff) << 8)|(str.charCodeAt(j+3)&0xff);
			}
			while(j<str.length) {
				be[j>>2] |= (str.charCodeAt(j)&0xff)<<(24-(j*8)%32);
				j++;
			}
			return be;
		},
		be32sToStr: function(be) {
			// Convert an array of big-endian 32-bit words to a string
			var str='';
			for(var i=0;i<be.length*32;i+=8) {
				str += String.fromCharCode((be[i>>5]>>>(24-i%32)) & 0xff);
			}
			return str;
		},
		be32sToHex: function(be) {
			// Convert an array of big-endian 32-bit words to a hex string
			var hex='0123456789ABCDEF';
			var str='';
			for(var i=0;i<be.length*4;i++) {
				str += hex.charAt((be[i>>2]>>((3-i%4)*8+4))&0xF) + hex.charAt((be[i>>2]>>((3-i%4)*8))&0xF);
			}
			return str;
		}
	});
})(jQuery);


(function($) {

if(!$.encoding.digests)
	$.encoding.digests = {};
	$.extend($.encoding.digests,{
		hexSha1Str: function(str) {
			// Return, in hex, the SHA-1 hash of a string
			return $.encoding.be32sToHex($.encoding.digests.sha1Str(str));
		},
		sha1Str: function(str) {
			// Return the SHA-1 hash of a string
			return sha1($.encoding.strToBe32s(str),str.length);
		},
		sha1: function(x,blen) {
			// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
			return sha1($.encoding.strToBe32s(str),str.length);
		}
	});

	// Private functions.
	function sha1(x,blen) {
		// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
		function add32(a,b) {
			// Add 32-bit integers, wrapping at 32 bits
			// Uses 16-bit operations internally to work around bugs in some JavaScript interpreters.
			var lsw=(a&0xFFFF)+(b&0xFFFF);
			var msw=(a>>16)+(b>>16)+(lsw>>16);
			return (msw<<16)|(lsw&0xFFFF);
		}
		function AA(a,b,c,d,e) {
			// Cryptographic round helper function. Add five 32-bit integers, wrapping at 32 bits, second parameter is rotated left 5 bits before the addition
			// Uses 16-bit operations internally to work around bugs in some JavaScript interpreters.
			b=(b>>>27)|(b<<5);
			var lsw=(a&0xFFFF)+(b&0xFFFF)+(c&0xFFFF)+(d&0xFFFF)+(e&0xFFFF);
			var msw=(a>>16)+(b>>16)+(c>>16)+(d>>16)+(e>>16)+(lsw>>16);
			return (msw<<16)|(lsw&0xFFFF);
		}
		function RR(w,j) {
			// Cryptographic round helper function.
			var n=w[j-3]^w[j-8]^w[j-14]^w[j-16];
			return (n>>>31)|(n<<1);
		}
	
		var len=blen*8;
		x[len>>5] |= 0x80 << (24-len%32);
		x[((len+64>>9)<<4)+15]=len;
		var w=new Array(80);
	
		var k1=0x5A827999;
		var k2=0x6ED9EBA1;
		var k3=0x8F1BBCDC;
		var k4=0xCA62C1D6;

		var h0=0x67452301;
		var h1=0xEFCDAB89;
		var h2=0x98BADCFE;
		var h3=0x10325476;
		var h4=0xC3D2E1F0;

		for(var i=0;i<x.length;i+=16) {
			var j=0;
			var t;
			var a=h0;
			var b=h1;
			var c=h2;
			var d=h3;
			var e=h4;
			while(j<16) {
				w[j]=x[i+j];
				t=AA(e,a,d^(b&(c^d)),w[j],k1);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			while(j<20) {
				w[j]=RR(w,j);
				t=AA(e,a,d^(b&(c^d)),w[j],k1);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			while(j<40) {
				w[j]=RR(w,j);
				t=AA(e,a,b^c^d,w[j],k2);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			while(j<60) {
				w[j]=RR(w,j);
				t=AA(e,a,(b&c)|(d&(b|c)),w[j],k3);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			while(j<80) {
				w[j]=RR(w,j);
				t=AA(e,a,b^c^d,w[j],k4);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			h0=add32(h0,a);
			h1=add32(h1,b);
			h2=add32(h2,c);
			h3=add32(h3,d);
			h4=add32(h4,e);
		}
		return [h0,h1,h2,h3,h4];
	}
})(jQuery);
//]]>
</script>
<!--POST-SCRIPT-START-->

<!--POST-SCRIPT-END-->
</body>
</html>
