<html><body><article><span></span><div><div></div><section><h1>Wikipedia: The strange case of the wandering semicolon</h1><h2>And how this change and other small changes  helped increased moderation on mobile</h2><div><div><div><div></div></div><div></div><p>This has also been posted on <a href="http://jdlrobson.com/posts/2020-01-14_Wikipedia--The-strange-case-of-the-wandering-semicolon-10073de4ee5.html" target="_blank" rel="noopener nofollow">my personal blog.</a></p><p>On a day in November, with the support of others¹, a somewhat absurd bug involving semicolons that took a week to fix was finally squashed. It was part of a group of changes that had led to a 47% bump in moderation tool usage on mobile. What follows is my account of this unremarkable incident as a reminder that a bug is never elementary; I will reflect on the the art of making progress in legacy code without disruption; and I will boldly hypothesize how the removal of a semicolon will improve the Wikipedia encyclopedia.</p><figure><div><div><div><div><div><img src="https://cdn-images-1.medium.com/max/800/1*jtTQIUP9CHf5bbieS2u0Vg.jpeg" role="presentation"></div><noscript><img class="cu t u hg ak" src="https://miro.medium.com/max/6144/1*jtTQIUP9CHf5bbieS2u0Vg.jpeg" width="3072" height="3485" role="presentation"/></noscript></div></div></div></div><figcaption>Just a semicolon smashing a window… it will make sense later. (Source: sketch by <a href="https://linzybearswings.wordpress.com/" target="_blank" rel="noopener nofollow">Linz Lim</a> cc-by-sa)</figcaption></figure><h2>Disaster strikes</h2><p>This was not the usual kind of semicolon drama that developers are familiar with. I didn’t crash a site with a PHP syntax (<a href="https://wikitech.wikimedia.org/wiki/Incident_documentation/20151005-MediaWiki" target="_blank" rel="noopener nofollow">at least not this time</a>). I didn’t add a semicolon in a string boundary by accident. This was a semicolon in one of our many user interfaces for editors hidden away behind the scenes. It was a semicolon that was plaguing the mobile interface, making it a little more confusing.</p><p>Thursday was when the drama began to unfold. Like a virus, semicolons were showing up in all sorts of places. If you are an editor you may have noticed some semicolons in your editing interfaces that were not there a week ago. For instance, notice these two semicolons before the date:</p><figure><div><div><div><div><div><img src="https://cdn-images-1.medium.com/max/800/1*H90ESA9kRn_4ONPTujHt3Q.png" role="presentation"></div><noscript><img class="cu t u hg ak" src="https://miro.medium.com/max/2820/1*H90ESA9kRn_4ONPTujHt3Q.png" width="1410" height="585" role="presentation"/></noscript></div></div></div></div><figcaption>The emicolons we were up against (Source: own work, compiling screenshots by Zoranzoki21, Xaosflux, Huji, Formatierer and myself)</figcaption></figure><p>The bug reports were coming in — seven in total. All of them described the same underlying issue but in a different flavor. Semicolons had disappeared in some places — in some places pushing words together that shouldn’t be together! In some cases they’d appeared where they were not before. I was pointed to <a href="https://en.wikipedia.org/wiki/Wikipedia:Village_pump_(technical)#Problems_with_separators_and_semicolons_on_RecentChanges,_Watchlist,_History_and_Contributions" target="_blank" rel="noopener nofollow">a long detailed conversation on English Wikipedia</a> where editors reported semicolons were appearing in unexpected places. One reported:</p><blockquote><p>“I’m a big fan of semicolons, used correctly; this one, I have to say, just looks weird.”</p></blockquote><p>Another pondered:</p><blockquote><p>“There could be a reason for this, perhaps?”</p></blockquote><p>A third added:</p><blockquote><p>“I don’t remember there being an announcement of this happening. Is this a glitch or an intended <em>feature</em>?”</p></blockquote><figure><div><div><div><div><div><img src="https://cdn-images-1.medium.com/max/800/1*ruF1khlTsH5oUqDIH3DtOw.png" role="presentation"></div><noscript><img class="cu t u hg ak" src="https://miro.medium.com/max/2680/1*ruF1khlTsH5oUqDIH3DtOw.png" width="1340" height="771" role="presentation"/></noscript></div></div></div></div><figcaption>This shows the extent of discussions on English Wikipedia about the semicolon. “I’m a big fan of semicolons, used correctly; this one, I have to say, just looks weird.” (Source: own work, screenshot)</figcaption></figure><p>A semicolon is clearly not a feature. It’s not something you write blog posts about. <strong><em>“Wikipedia finally removes semicolon from mobile”</em></strong> is not exactly the kind of “feature” you might see at the top of Hacker News or Reddit. However, here I am writing about it.</p><p>So, how did we get here?</p><h2>How we got here</h2><p>The team has been slowly winding down the <a href="https://www.mediawiki.org/wiki/Reading/Web/Advanced_mobile_contributions" target="_blank" rel="noopener nofollow">Advanced Mobile Contributions project</a>. This project has added various moderation features to the Wikipedia mobile site². It also had strong, inflexible requirements from our department which were:</p><p>1 ) Don’t interfere with the desktop experience.</p><p>2) Don’t interfere with the standard mobile experience of ordinary users. </p><p>3) Make legacy interfaces available on mobile to users that opt in.</p><p>These requirements have been challenging to us; although mobile and desktop sites use different stylesheets, they  share a lot of the same HTML. The HTML of these ten-year-old interfaces were built squarely with desktop in mind.</p><p>While some of this work has been adding links to the interface to missing moderation features, the real challenge has been making the legacy interfaces that those pages link to usable on a mobile device.</p><p>This work has involved taking complicated legacy interfaces that were built over ten years ago, and trying to mold them into things that are presentable on mobile, while at the same time making sure nobody using the desktop version noticed. While the engineer in me would ideally burn them all to the ground and rewrite them from scratch, we didn’t have enough people to commit to such a redesign. Instead, the goal was to get them into mobile in the quickest possible way “warts and all”.</p><p><a href="https://en.wikipedia.org/wiki/Special:RecentChanges?hidebots=1&amp;hidecategorization=1&amp;hideWikibase=1&amp;limit=50&amp;days=7&amp;urlversion=2" target="_blank" rel="noopener nofollow">The RecentChanges moderation tool</a> (which shows edits across the site, so our editors can watch out for vandalism) is a good example. Many assumptions on the desktop site had been made about how the page should look, and those assumptions didn’t help present the same page on mobile. The desktop site used semicolons, ellipses, and brackets to separate content. It did this in raw HTML. This screenshot hopefully illustrates the problem:</p><figure><div><div><div><div><div><img src="https://cdn-images-1.medium.com/max/800/1*_Fm1eBDZuCCljtN2cQ38YQ.png" role="presentation"></div><noscript><img class="cu t u hg ak" src="https://miro.medium.com/max/2510/1*_Fm1eBDZuCCljtN2cQ38YQ.png" width="1255" height="605" role="presentation"/></noscript></div></div></div></div><figcaption>The content in the rectangles is actually presentational HTML — not content. In mobile we wanted to stack this content, so to do that we had to move this HTML into CSS. (Source: own work)</figcaption></figure><p>While we might imagine further improvements to such a page, remember we were not looking to make too many drastic changes as we didn’t want to touch the desktop site. My company is a non-profit. The goal was to remove a semicolon not to start a revolution.</p><p>On mobile we decided to stack this information vertically, like so:</p><figure><div><div><div><div><div><img src="https://cdn-images-1.medium.com/max/800/1*g7kJwBkhzymRnXQ67KJn1A.png" role="presentation"></div><noscript><img class="cu t u hg ak" src="https://miro.medium.com/max/2158/1*g7kJwBkhzymRnXQ67KJn1A.png" width="1079" height="692" role="presentation"/></noscript></div></div></div></div><figcaption>The Recent Change page we strived for on mobile screens (Source: screenshot, own work)</figcaption></figure><p>To do that, we had to get creative with CSS to ensure we kept things the same to desktop users while being able to change it based on the display media.</p><p>Luckily we found <a href="https://github.com/wikimedia/mediawiki/blob/master/resources/src/mediawiki.interface.helpers.styles.less" target="_blank" rel="noopener nofollow">a solution</a> using <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Media_Queries/Using_media_queries" target="_blank" rel="noopener nofollow">CSS media queries</a> and <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Pseudo-elements" target="_blank" rel="noopener nofollow">CSS pseudo elements</a> to do exactly that.</p><p>After such changes <a href="https://en.m.wikipedia.org/wiki/Special:RecentChanges?hidebots=1&amp;hidecategorization=1&amp;hideWikibase=1&amp;limit=50&amp;days=7&amp;urlversion=2" target="_blank" rel="noopener nofollow">the RecentChanges moderation tool</a> was looking good, but it had one nagging problem — a forgotten semicolon lingered in the UI after the page titles.</p><figure><div><div><div><div><img src="https://cdn-images-1.medium.com/max/800/1*sB8pRqFPRM25HKwLlj-yCQ.png" role="presentation"></div><noscript><img class="cu t u hg ak" src="https://miro.medium.com/max/1120/1*sB8pRqFPRM25HKwLlj-yCQ.png" width="560" height="741" role="presentation"/></noscript></div></div></div><figcaption>One problem remained — a semicolon trailed the titles (see text Creatures (company) and Segra Field)</figcaption></figure><p>The follow up task “<a href="https://phabricator.wikimedia.org/T233649" target="_blank" rel="noopener nofollow">Stray semicolon in RecentChanges, Watchlist, History and Contributions interface”</a> looked like <em>just</em> a one line change, continuing the work we had already done to remove unwanted “..” and unwanted parentheses.</p><p>Inspecting the HTML, I saw that the semicolon was in the raw HTML of the page. It served a purpose in the desktop version of the page by helping separate the content in each of the rows. However in the mobile mode it was redundant. I decided to move the semicolon from the HTML into a desktop only style sheet.</p><p>So I picked the bug up, I found where the semicolon was in the HTML and deleted it. Using the class name of the element that followed the semicolon, I added a CSS rule to the associated page. A fellow developer reviewed it, and like me, thought everything looked straightforward and the patch was merged. I focused on other things. As I did, the Earth orbited the sun. Light turned to darkness. Darkness to light.</p><p>The patch started to distribute out to our many websites. Then, the first bug report came in. The semicolon was not being translated into our many languages.</p><p>For those wondering how semicolons are translatable — this was news to me too — In French, a space must always proceed a semicolon, and here are some places where a semicolon is not the same semicolon we use in English:</p><blockquote><p>In Urdu:<br>؛;</p><p>In Persian:<br>؛</p></blockquote><p>That was relatively straightforward to fix. We have devised ways to <a href="https://github.com/wikimedia/mediawiki/blob/master/resources/src/mediawiki.interface.helpers.styles.less#L46" target="_blank" rel="noopener nofollow">translate pseudo element content</a>. The fix was quickly merged and deployed by a volunteer. I thought I was done; however more bug reports came in.</p><p>My semicolon logic was still not right. I had made some bad assumptions about where the semicolon was needed. I had assumed it would always show before a timestamp, but that was not true. The ten-year-old code was badly organized and badly documented. There were various edge cases in our complicated ecosystem. I sat down and wrote a spec and some very explicit quality assurance steps to make sure the undocumented behavior was documented.</p><p><a href="https://gerrit.wikimedia.org/r/#/c/mediawiki/core/+/549919/" target="_blank" rel="noopener nofollow">My final patch</a>, with the help of retroactively defining its behavior with bug reports from editors, was mostly an extensive documentation block to explain the behavior to the poor soul that would work on this code in future. The best thing a developer can do is write documentation for a future user, no matter how obvious it may seem. Developers that complain about documentation blocks need to be slapped with a wet fish.</p><p>On Tuesday, the patch had still not been merged due to the Veterans Day holiday. Nobody was around to review and deploy the patch.</p><p>Back on the discussion page, another anonymous user, possibly impatiently, asked “why is this still a problem?” The patch rolled out shortly after. Everyone involved was a little exhausted. An editor complained about semicolons that had always been there (I checked with git blame) and I wondered if anyone knew why we needed a semicolon at all? What would Kurt Vonnegut say? I decided those questions were best left for another day.</p><p>This exercise for me was a good reminder to never assume things and to treat every bug with caution, no matter how trivial it looks. There is no such thing as an easy bug. All bugs lead to other bugs.</p><h2>Reflection</h2><p><a href="https://phabricator.wikimedia.org/T219348" target="_blank" rel="noopener nofollow">Much of the hard work</a> to get our moderation tools available on a mobile phone was spent carefully dissecting legacy code like this. Even though we’ve tried to minimize the disruption to desktop users, there were a few exceptions. The semicolon incident was one of three incidents that got the attention of editors.</p><p>There was the <a href="https://en.wikipedia.org/wiki/Wikipedia:Village_pump_(technical)/Archive_173#Hideous_history_page" target="_blank" rel="noopener nofollow">Hideous history page incident</a>” when some editors were angry that the touch areas for our form inputs, which had been made larger. While our intentions were to follow <a href="https://ukhomeoffice.github.io/accessibility-posters/physical" target="_blank" rel="noopener nofollow">accessibility recommendations</a>, some felt that the enlarged form got in the way of their workflow by pushing down other content. It should be “collapsed by default” said one.</p><p>There was the <a href="https://en.wikipedia.org/wiki/Wikipedia:Village_pump_(technical)/Archive_176#User_contributions_changes" target="_blank" rel="noopener nofollow">User Contributions incident</a>, when, learning from the feedback of hideous history page incident, we collapsed a form by default, but the feedback was that we should not be collapsing the form that was a vital part of someone’s workflow. “Would prefer if it was expanded by default tbh” one user remarked. 🙄</p><p>There was also the <a href="https://en.wikipedia.org/wiki/Wikipedia:Village_pump_(technical)/Archive_176#Alarming_%22only_a_preview_message%22" target="_blank" rel="noopener nofollow">Alarming “only a preview message”</a> incident when we standardized the styles of a semantically identical component to avoid shipping unnecessary bytes to mobile mode.</p><p>The crux of this is that it was impossible to please everyone during this,project. but we worked hard to keep a healthy balance. It’s amazing we pulled it off.</p><p>Sometimes the things that we work on that make a difference are not newsworthy, retweet-able, technically stimulating or even noticeable. Even with the semicolon incident resolved, there was no pat on the back or thank you. Silence was the best reward. The work we do might not use the latest technologies or be glamorous, but there is an art to making progress without disruption.</p><p>I will tell anyone that is available to listen, that being a skilled software engineering is not always about your code. It doesn’t matter what frameworks you use. Ultimately it’s an exercise in problem solving and supportive collaboration between co-conspirators. It’s about <a target="_blank" rel="noopener" href="/@dlyall/why-all-software-engineers-should-wear-a-ring-on-their-little-right-finger-31c82403b2eb?source=your_stories_page---------------------------">being responsible</a> and being honest — <a target="_blank" rel="noopener" href="/freely-sharing-the-sum-of-all-knowledge/why-it-took-a-long-time-to-build-that-tiny-link-preview-on-wikipedia-d5bd734df8fe">a  feature can take a lot of time if it’s being done well</a>. It’s about understanding if a semicolon is important or useful. And it’s about being able to have that conversation.</p><p>One of our editors <a href="https://phabricator.wikimedia.org/p/abian/" target="_blank" rel="noopener nofollow">abian</a> put it so succinctly when he shared <a href="https://phabricator.wikimedia.org/T117736#5556001" target="_blank" rel="noopener nofollow">these kind words</a>:</p><blockquote><p>It’s a great idea for users to generate content collaboratively and horizontally, but this model doesn’t favor process efficiency, user experience or innovation, so these areas require skilled professionals who fight against tradition, stagnation, short term and subjectivity.</p></blockquote><h2>How does this improve the encyclopedia?</h2><p>The  <a href="https://en.wikipedia.org/wiki/Broken_windows_theory" target="_blank" rel="noopener nofollow">Broken Windows Theory</a> is a theory that says signs of crime encourage further crime. Similarly, in Wikipedia, bad experiences encourage further bad experiences.</p><p>I believe Wikipedia’s mobile experience has suffered because many editors have been unable to use tools inside mobile that they need to carry out their work and have been forced to live in the desktop experience of the site. As a result, they haven’t used mobile. As a result, they haven’t seen the broken windows that readers see. Barely anyone complained about the stray semicolon in the mobile site, but on the other hand, when a semicolon disappeared and appeared in places on the desktop site, seven bug reports get opened and everyone seemed to care about it.</p><p>The semicolon incident gives me hope, that if broken windows are being noticed in desktop, they will soon be noticed in mobile. It was pretty cool that our editors got this riled up about a semicolon. Imagine what happens when they get riled up about an experience that is unusable on a mobile phone. There’s no longer an excuse to be an editor using the desktop site on a mobile phone³.</p><p>I have nothing to concrete to point to you except several artifacts. A semicolon has gone; a form now has input fields that are actually big enough to be touchable on a mobile screen; certain forms are now collapsible and get out of your way when you no longer need them; there are links to certain features that previously were not there.</p><p>The amount of design and product wrangling⁴ that’s gone into this project is staggering. While to the outsider observer, we’ve simply added a bunch of links to the mobile experience, we’ve done it in a remarkably elegant way that doesn’t overload the user with information. Menu hierarchies have been revisited, and we’ve frequently had to make trade-offs between beautiful and functional.</p><p>My team, with the support of some wonderful volunteers providing feedback and triaging support⁴, has been making minor tweaks to HTML and CSS across the site, and these small things make a difference and should be celebrated. The advanced mobile contributions project has been about that. It’s been about small tweaks here there and everywhere.</p><p>The mountain of small thankless changes at times have felt repetitive and uninspiring, but we churned our way through them. On their own as bug fixes they are meaningless. The end results look unremarkable. However, when combined they build something incredible but less tangible — a better mobile experience.</p><p>Of course, our data, does give something more tangible. We're seeing <a href="https://phabricator.wikimedia.org/T234559#5627577" target="_blank" rel="noopener nofollow">an increase of 47% of moderation actions on mobile.</a> So clearly, every semicolon removal makes a difference.</p><figure><div><div><div><div><img src="https://cdn-images-1.medium.com/max/800/1*q7P2gin-37rr2Z0lTgQgiA.png" role="presentation"></div><noscript><img class="cu t u hg ak" src="https://miro.medium.com/max/1226/1*q7P2gin-37rr2Z0lTgQgiA.png" width="613" height="355" role="presentation"/></noscript></div></div></div><figcaption>The mobile interface for logged in users now  has links to various moderation tools that you probably don’t even know about, but they are important things that keep the site alive … and now are functional on mobile. (Source: own work)</figcaption></figure></div></div></section><hr><section><div><div><p>¹ Thanks in particular to Volker, Jan, Zoran, Xaosflux and Huji for your help in resolving the semicolon matter.</p><p>² Logged in users get more from Wikipedia. Logged in users can also opt into additional parts of the experience using <a href="https://en.m.wikipedia.org/wiki/Special:MobileOptions" target="_blank" rel="noopener nofollow">our settings page</a></p><p>³ If there is a reason you feel you still cannot edit from a mobile device please let us know on the <a href="https://www.mediawiki.org/wiki/Talk:Reading/Web/Advanced_mobile_contributions" target="_blank" rel="noopener nofollow">advanced mobile contributions talk page</a>: </p><p>⁴ Hat tip to Alex and Volker for juggling all the different design pieces and Olga for making sure we didn’t get stuck in the weeds (sometimes you need someone to stop you going into Semicolon swamps).</p><p>⁴ Thanks to Ammarpad, Masumrezarock100, stjn, Zoran and Pelagic and everyone else who has been involved for your input,codeand guidance to our team during these UX and standardisation efforts.</p></div></div></section></div><footer>This blog post is available to read and comment on <a href="https://medium.com/p/10073de4ee5?source=jdlrobson.com">Medium.com</a>.</footer></article>
            </body></html>