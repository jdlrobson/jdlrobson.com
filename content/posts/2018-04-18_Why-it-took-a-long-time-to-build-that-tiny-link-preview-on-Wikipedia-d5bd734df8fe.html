<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Why it took a long time to build that tiny link preview on Wikipedia</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Why it took a long time to build that tiny link preview on Wikipedia</h1>
</header>
<section data-field="subtitle" class="p-summary">
Yesterday, my team completed the launch of “page previews” — a feature now deployed to hundreds of language editions of Wikipedia. We are…
</section>
<section data-field="body" class="e-content">
<section name="070c" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h1 name="ff61" id="ff61" class="graf graf--h3 graf--leading graf--title">Why it took a long time to build that tiny link preview on Wikipedia</h1><h2 name="a794" id="a794" class="graf graf--h4 graf-after--h3 graf--subtitle">Yesterday, <a href="https://medium.com/freely-sharing-the-sum-of-all-knowledge/wikipedia-page-previews-738cddac7a21" data-href="https://medium.com/freely-sharing-the-sum-of-all-knowledge/wikipedia-page-previews-738cddac7a21" class="markup--anchor markup--h4-anchor" target="_blank">my team completed the launch of</a> “<a href="https://www.mediawiki.org/wiki/Page_Previews" data-href="https://www.mediawiki.org/wiki/Page_Previews" class="markup--anchor markup--h4-anchor" rel="noopener" target="_blank">page previews”</a> — a feature now deployed to hundreds of language editions of Wikipedia. We are seeing <a href="https://grafana.wikimedia.org/dashboard/db/reading-web-page-previews?refresh=1m&amp;orgId=1&amp;panelId=2&amp;fullscreen" data-href="https://grafana.wikimedia.org/dashboard/db/reading-web-page-previews?refresh=1m&amp;orgId=1&amp;panelId=2&amp;fullscreen" class="markup--anchor markup--h4-anchor" rel="noopener" target="_blank">up to half a million hits every minute to our API</a> to serve those cards that show when you hover over any link.</h4><figure name="eb69" id="eb69" class="graf graf--figure graf-after--h4"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 480px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 68.60000000000001%;"></div><img class="graf-image" data-image-id="1*IcpMIcv0sbKZwRoMUW7NXw.png" data-width="1096" data-height="752" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*IcpMIcv0sbKZwRoMUW7NXw.png"></div><figcaption class="imageCaption">Preview cards now show when you hover over a link ohhh yeeehh (and yes, I use Wikipedia’s mobile skin for my desktop browsing). Text from the Wikipedia articles on <a href="https://en.wikipedia.org/wiki/Iceberg" data-href="https://en.wikipedia.org/wiki/Iceberg" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">icebergs</a> and <a href="https://en.wikipedia.org/wiki/Water" data-href="https://en.wikipedia.org/wiki/Water" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">water</a>, <a href="https://creativecommons.org/licenses/by-sa/3.0/deed.en" data-href="https://creativecommons.org/licenses/by-sa/3.0/deed.en" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">CC BY-SA 3.0</a>. Images left to right, top to bottom: <a href="https://commons.wikimedia.org/wiki/File:Iceberg_with_hole_near_Sandersons_Hope_2007-07-28_2.jpg" data-href="https://commons.wikimedia.org/wiki/File:Iceberg_with_hole_near_Sandersons_Hope_2007-07-28_2.jpg" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">#1</a> by Kim Hansen, <a href="https://creativecommons.org/licenses/by-sa/3.0/deed.en" data-href="https://creativecommons.org/licenses/by-sa/3.0/deed.en" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">CC BY-SA 3.0</a>; <a href="https://commons.wikimedia.org/wiki/File:Iceberg_in_the_Arctic_with_its_underside_exposed.jpg" data-href="https://commons.wikimedia.org/wiki/File:Iceberg_in_the_Arctic_with_its_underside_exposed.jpg" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">#2</a> by Andreas Weith, <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.en" data-href="https://creativecommons.org/licenses/by-sa/4.0/deed.en" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">CC BY-SA 4.0</a>; <a href="https://commons.wikimedia.org/wiki/File:Grotto_in_an_iceberg.jpg" data-href="https://commons.wikimedia.org/wiki/File:Grotto_in_an_iceberg.jpg" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">#3</a> via the National Library of New Zealand, <a href="https://creativecommons.org/publicdomain/zero/1.0/deed.en" data-href="https://creativecommons.org/publicdomain/zero/1.0/deed.en" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">CC0</a>.</figcaption></figure><p name="1793" id="1793" class="graf graf--p graf-after--figure">On the surface it looks quite simple. It’s something many websites have already. It has an image and some text and shows when you hover over a link. Hardly groundbreaking stuff … or so it may seem.</p><p name="693d" id="693d" class="graf graf--p graf-after--p">The original idea was conceived four years ago, based on an idea <a href="https://en.wikipedia.org/wiki/Wikipedia:Tools/Navigation_popups" data-href="https://en.wikipedia.org/wiki/Wikipedia:Tools/Navigation_popups" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">from a volunteer/editor</a> many years before that.</p><p name="d3d6" id="d3d6" class="graf graf--p graf-after--p">It’s thus taken a few years for us to get this out to everyone. That might seem strange, but like an iceberg, once you start looking below it, it all makes sense.</p><h1 name="3319" id="3319" class="graf graf--h3 graf-after--p">We had to choose a thumbnail</h1><p name="e4fa" id="e4fa" class="graf graf--p graf-after--h3">We have several millions of pages, all stored as raw wikitext. We couldn’t expect every single article to be edited to designate a thumbnail.</p><p name="57d0" id="57d0" class="graf graf--p graf-after--p">Way back in 2012, Max Semenik, a software engineer on our <a href="https://www.mediawiki.org/wiki/Community_Tech" data-href="https://www.mediawiki.org/wiki/Community_Tech" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Community Tech team</a>, built <a href="https://www.mediawiki.org/wiki/Extension:PageImages" data-href="https://www.mediawiki.org/wiki/Extension:PageImages" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">an extension</a> that would algorithmically work out the most appropriate image for an article.</p><p name="7ebb" id="7ebb" class="graf graf--p graf-after--p">As with all algorithms, it wasn’t perfect and since it wasn’t designed for the use case of page previews, it also required tweaking.</p><p name="0b2d" id="0b2d" class="graf graf--p graf-after--p">We had to make updates to limit the image to the first section of the article. Working with algorithms is hard, but for this purpose essential.</p><h1 name="5031" id="5031" class="graf graf--h3 graf-after--p">We had to generate a summary</h1><p name="ba7e" id="ba7e" class="graf graf--p graf-after--h3">We have several millions of pages, all stored as <a href="https://www.mediawiki.org/wiki/Wikitext" data-href="https://www.mediawiki.org/wiki/Wikitext" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">raw wikitext</a>. How to summarise that without asking our editors to go in and painstakingly do that for every article?</p><p name="e926" id="e926" class="graf graf--p graf-after--p">The busy Max Semenik who helped us with the thumbnails, also wrote <a href="https://www.mediawiki.org/wiki/Extension:TextExtracts" data-href="https://www.mediawiki.org/wiki/Extension:TextExtracts" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">an extension to generate extracts of articles</a>. It was originally written primarily for <a href="https://en.wikipedia.org/wiki/Plain_text" data-href="https://en.wikipedia.org/wiki/Plain_text" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">plain text</a> summaries. Our initial versions of page previews used this, but we realised it wasn’t the best fit for what we were trying to do.</p><p name="7b34" id="7b34" class="graf graf--p graf-after--p">So we stopped using this.</p><p name="1614" id="1614" class="graf graf--p graf-after--p">We realised HTML was very important. For instance chemistry articles featured chemical formulae which needs subscript which requires HTML.</p><figure name="5443" id="5443" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 347px; max-height: 429px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 123.6%;"></div><img class="graf-image" data-image-id="1*q1UxqCeIGatceXZhGQ-lUA.png" data-width="347" data-height="429" src="https://cdn-images-1.medium.com/max/800/1*q1UxqCeIGatceXZhGQ-lUA.png"></div><figcaption class="imageCaption">Consider how HTML is needed to generate summaries for content where subscript is important such as the chemical formula of water, shown here. <em class="markup--em markup--figure-em">Text from the English Wikipedia article on </em><a href="https://en.wikipedia.org/wiki/Water" data-href="https://en.wikipedia.org/wiki/Water" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank"><em class="markup--em markup--figure-em">water</em></a><em class="markup--em markup--figure-em">, </em><a href="https://creativecommons.org/licenses/by-sa/3.0/deed.en" data-href="https://creativecommons.org/licenses/by-sa/3.0/deed.en" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank"><em class="markup--em markup--figure-em">CC BY-SA 3.0</em></a><em class="markup--em markup--figure-em">; </em><a href="https://commons.wikimedia.org/wiki/File:Iceberg_with_hole_near_Sandersons_Hope_2007-07-28_2.jpg" data-href="https://commons.wikimedia.org/wiki/File:Iceberg_with_hole_near_Sandersons_Hope_2007-07-28_2.jpg" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank"><em class="markup--em markup--figure-em">image</em></a><em class="markup--em markup--figure-em"> by Kim Hansen, </em><a href="https://creativecommons.org/licenses/by-sa/3.0/deed.en" data-href="https://creativecommons.org/licenses/by-sa/3.0/deed.en" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank"><em class="markup--em markup--figure-em">CC BY-SA 3.0</em></a><em class="markup--em markup--figure-em">.</em></figcaption></figure><p name="7947" id="7947" class="graf graf--p graf-after--figure">Many of our articles, begin with location information and pronunciation information. A lot of this content didn’t belong in our summaries and for other content it was less clear what belonged. The summaries had <a href="https://medium.com/freely-sharing-the-sum-of-all-knowledge/how-we-designed-page-previews-for-wikipedia-and-what-could-be-done-with-them-in-the-future-7a5fa6b07b96" data-href="https://medium.com/freely-sharing-the-sum-of-all-knowledge/how-we-designed-page-previews-for-wikipedia-and-what-could-be-done-with-them-in-the-future-7a5fa6b07b96" class="markup--anchor markup--p-anchor" target="_blank">a lot of design input</a> and we identified which content shouldn’t appear inside a preview. We wrote up <a href="https://www.mediawiki.org/wiki/Page_Previews/API_Specification" data-href="https://www.mediawiki.org/wiki/Page_Previews/API_Specification" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">a specification capturing the required behaviour</a>.</p><figure name="a7fe" id="a7fe" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 210px; max-height: 55px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 26.200000000000003%;"></div><img class="graf-image" data-image-id="1*xyyRTHJGQ6_AMY9k56SzYw.png" data-width="210" data-height="55" src="https://cdn-images-1.medium.com/max/800/1*xyyRTHJGQ6_AMY9k56SzYw.png"></div><figcaption class="imageCaption">Location information features at the beginning of many articles proving problematic for summarising Wikipedia articles…</figcaption></figure><figure name="dbba" id="dbba" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 396px; max-height: 54px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 13.600000000000001%;"></div><img class="graf-image" data-image-id="1*AApSExUOe4QZIiDhxyMFxw.png" data-width="396" data-height="54" src="https://cdn-images-1.medium.com/max/800/1*AApSExUOe4QZIiDhxyMFxw.png"></div><figcaption class="imageCaption">… as does pronunciation information. Text via the English Wikipedia’s article on <a href="https://en.wikipedia.org/wiki/Inle_Lake" data-href="https://en.wikipedia.org/wiki/Inle_Lake" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">Inle Lake</a>, <a href="https://creativecommons.org/licenses/by-sa/3.0/deed.en" data-href="https://creativecommons.org/licenses/by-sa/3.0/deed.en" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">CC BY-SA 3.0</a>.</figcaption></figure><p name="4060" id="4060" class="graf graf--p graf-after--figure">In the end we decided to build on top of an <a href="https://en.m.wikipedia.org/wiki/Application_programming_interface" data-href="https://en.m.wikipedia.org/wiki/Application_programming_interface" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">API</a> that was originally built for our native Android and iOS apps. We created a new API specifically for this purpose.</p><p name="8833" id="8833" class="graf graf--p graf-after--p">We now generate the summary from the entire article HTML. We parse it just like a browser and <a href="https://www.mediawiki.org/wiki/Page_Previews/API_Specification" data-href="https://www.mediawiki.org/wiki/Page_Previews/API_Specification" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">per the specification</a> identify the first “non-empty” lead paragraph of every article.</p><p name="750b" id="750b" class="graf graf--p graf-after--p">One of the big challenges here, was the decision to strip content inside parentheses. Since we support over 300 languages this had to be localised (not everyone uses the same character set!).</p><p name="0b0a" id="0b0a" class="graf graf--p graf-after--p">Not only that, but of course some parentheses are vital… edge cases are everywhere. We had to think about all their potential usage and how best to do them.</p><figure name="8a5d" id="8a5d" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 332px; max-height: 410px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 123.50000000000001%;"></div><img class="graf-image" data-image-id="1*__tMmPvrhcIILrPIwcg3qQ.png" data-width="332" data-height="410" src="https://cdn-images-1.medium.com/max/800/1*__tMmPvrhcIILrPIwcg3qQ.png"></div><figcaption class="imageCaption">Sometimes content inside parentheses is important, as this example suggests. Identifying when they are important is hard. <em class="markup--em markup--figure-em">Text from the English Wikipedia article on the </em><a href="https://en.wikipedia.org/wiki/Periodic_table" data-href="https://en.wikipedia.org/wiki/Periodic_table" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank"><em class="markup--em markup--figure-em">periodic table</em></a><em class="markup--em markup--figure-em">, </em><a href="https://creativecommons.org/licenses/by-sa/3.0/deed.en" data-href="https://creativecommons.org/licenses/by-sa/3.0/deed.en" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank"><em class="markup--em markup--figure-em">CC BY-SA 3.0</em></a><em class="markup--em markup--figure-em">; </em><a href="https://commons.wikimedia.org/wiki/File:Simple_Periodic_Table_Chart-en.svg" data-href="https://commons.wikimedia.org/wiki/File:Simple_Periodic_Table_Chart-en.svg" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank"><em class="markup--em markup--figure-em">image</em></a><em class="markup--em markup--figure-em"> by Offnfopt, public domain.</em></figcaption></figure><p name="7bfa" id="7bfa" class="graf graf--p graf-after--figure">Stripping parenthetical elements from user-generated HTML also turned out to be quite difficult. Whereas doing so in plain text requires a simple regular expression, things get more complicated when you consider nested HTML.</p><p name="4092" id="4092" class="graf graf--p graf-after--p">It was important to ensure the content continued to make sense with the content inside parentheses stripped and that we that we didn’t add any security vulnerabilities.</p><p name="649f" id="649f" class="graf graf--p graf-after--p">Thanks go to our <a href="https://www.mediawiki.org/wiki/Wikimedia_Reading_Infrastructure_team" data-href="https://www.mediawiki.org/wiki/Wikimedia_Reading_Infrastructure_team" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Infrastructure team</a> for helping us build out this API.</p><h1 name="5038" id="5038" class="graf graf--h3 graf-after--p">We work with our community</h1><p name="9c5f" id="9c5f" class="graf graf--p graf-after--h3">Our editing community cares a lot about our product. That’s why they write articles for you in their spare time for no monetary gain.</p><p name="20ea" id="20ea" class="graf graf--p graf-after--p">We include them in every part of the process, working with them tirelessly to fix every edge case (whether it be broken summaries, or inappropriate images) and to reassure them we know what we are doing, the impact of why we are doing and why we are continuing to do it.</p><p name="d2b3" id="d2b3" class="graf graf--p graf-after--p">Our initial version wasn’t good enough. Our community asked us <a href="https://en.wikipedia.org/wiki/Wikipedia:Village_pump_%28proposals%29/Archive_131#Proposal:_Enable_Hovercards_by_default" data-href="https://en.wikipedia.org/wiki/Wikipedia:Village_pump_(proposals)/Archive_131#Proposal:_Enable_Hovercards_by_default" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">not to go ahead</a> with it. We answered by listening to them and making it better.</p><p name="8a24" id="8a24" class="graf graf--p graf-after--p">Thank you community and our community liaisons who helped facilitate those conversations!</p><h1 name="92a1" id="92a1" class="graf graf--h3 graf-after--p">Design design design</h1><p name="7a6a" id="7a6a" class="graf graf--p graf-after--h3">We did a lot of it. Our designer, Nirzar did <a href="https://medium.com/freely-sharing-the-sum-of-all-knowledge/how-we-designed-page-previews-for-wikipedia-and-what-could-be-done-with-them-in-the-future-7a5fa6b07b96" data-href="https://medium.com/freely-sharing-the-sum-of-all-knowledge/how-we-designed-page-previews-for-wikipedia-and-what-could-be-done-with-them-in-the-future-7a5fa6b07b96" class="markup--anchor markup--p-anchor" target="_blank">a great write up</a> so I won’t bother sharing any more here, but design was at every step of the process whether it was the initial prototypes (thanks <a href="https://wikimediafoundation.org/wiki/Staff_and_contractors" data-href="https://wikimediafoundation.org/wiki/Staff_and_contractors" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Prateek Saxena</a>!); discussing performance of the feature with our performance team; perfecting thumbnails and summaries; or talking to our community.</p><p name="bfa4" id="bfa4" class="graf graf--p graf-after--p">Thank you <a href="https://www.mediawiki.org/wiki/Design" data-href="https://www.mediawiki.org/wiki/Design" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">design team</a>!</p><h1 name="70ed" id="70ed" class="graf graf--h3 graf-after--p">We had to instrument it</h1><p name="52bf" id="52bf" class="graf graf--p graf-after--h3">This was a big change to how people interact with our content. We care a lot about privacy in Wikimedia. We are likely to be one of the few (only?!) major websites who don’t install third party scripts to track you.</p><p name="2c0b" id="2c0b" class="graf graf--p graf-after--p">Our <a href="https://wikimediafoundation.org/wiki/Privacy_policy" data-href="https://wikimediafoundation.org/wiki/Privacy_policy" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">privacy policy</a> forbids us from giving away data about you.</p><p name="8d9d" id="8d9d" class="graf graf--p graf-after--p">We don’t use vendors to A/B test or analyse our user’s behaviour.</p><p name="e5b5" id="e5b5" class="graf graf--p graf-after--p">Yet, despite all this, we don’t cut corners.</p><p name="9613" id="9613" class="graf graf--p graf-after--p">We don’t want to make dumb risky changes.</p><p name="d4ea" id="d4ea" class="graf graf--p graf-after--p">Every time we build something major we have to build out the infrastructure to evaluate it. We construct hypothesizes and tests to test those hypothesizes. We build it. We test it. We listen to the data. We adapt. We test again.</p><p name="269b" id="269b" class="graf graf--p graf-after--p">This means we juggle being a product team and an analytics team. Our development team wear multiple hats. Given the scale we work at have to deal with bugs. Occasionally, <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1379762" data-href="https://bugzilla.mozilla.org/show_bug.cgi?id=1379762" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">we find major bugs in browser vendors</a>.</p><p name="69f1" id="69f1" class="graf graf--p graf-after--p">Our final A/B test by Tilman Bayer gave us many answers. It’s a <a href="https://www.mediawiki.org/wiki/Page_Previews/2017-18_A/B_Tests" data-href="https://www.mediawiki.org/wiki/Page_Previews/2017-18_A/B_Tests" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">great read</a>!</p><p name="f304" id="f304" class="graf graf--p graf-after--p">Given the findings of that A/B test we also decided to start measuring “page preview views” as an additional metric to page views. That metric is firing <a href="https://grafana.wikimedia.org/dashboard/db/eventlogging-schema?orgId=1&amp;var-datasource=eqiad%20prometheus%2Fops&amp;var-schema=VirtualPageView&amp;from=now-7d&amp;to=now" data-href="https://grafana.wikimedia.org/dashboard/db/eventlogging-schema?orgId=1&amp;var-datasource=eqiad%20prometheus%2Fops&amp;var-schema=VirtualPageView&amp;from=now-7d&amp;to=now" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">1000 events per second</a> and our <a href="https://wikitech.wikimedia.org/wiki/Analytics" data-href="https://wikitech.wikimedia.org/wiki/Analytics" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">analytics team</a> is kicking ass dealing with that sort of scale.</p><p name="cd25" id="cd25" class="graf graf--p graf-after--p">Thank you analysts, thank you analytics team!</p><h1 name="3ca3" id="3ca3" class="graf graf--h3 graf-after--p">We had to scale our API to support you</h1><p name="cecd" id="cecd" class="graf graf--p graf-after--h3">We are seeing <a href="https://grafana.wikimedia.org/dashboard/db/reading-web-page-previews?refresh=1m&amp;orgId=1&amp;panelId=2&amp;fullscreen" data-href="https://grafana.wikimedia.org/dashboard/db/reading-web-page-previews?refresh=1m&amp;orgId=1&amp;panelId=2&amp;fullscreen" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">0.5 million hits to our API a minute</a>.</p><p name="28aa" id="28aa" class="graf graf--p graf-after--p">We are seeing <a href="https://grafana.wikimedia.org/dashboard/db/reading-web-page-previews?refresh=1m&amp;orgId=1&amp;panelId=2&amp;fullscreen" data-href="https://grafana.wikimedia.org/dashboard/db/reading-web-page-previews?refresh=1m&amp;orgId=1&amp;panelId=2&amp;fullscreen" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">0.5 million hits to our API a minute</a>.</p><p name="b8f1" id="b8f1" class="graf graf--p graf-after--p">I say that twice because that’s a high volume of traffic.</p><p name="7487" id="7487" class="graf graf--p graf-after--p">Our <a href="https://www.mediawiki.org/wiki/API:Main_page" data-href="https://www.mediawiki.org/wiki/API:Main_page" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">traditional APIs</a> were originally built for bots to help clean up your edits. They weren’t designed for readers.</p><p name="4e99" id="4e99" class="graf graf--p graf-after--p">The <a href="https://www.mediawiki.org/wiki/Wikimedia_Services" data-href="https://www.mediawiki.org/wiki/Wikimedia_Services" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Wikimedia services team</a> has been vital to the success of this project by providing the infrastructure to deal with, dealing with a lot of the caching (we rely heavily on <a href="https://en.wikipedia.org/wiki/Varnish_%28software%29" data-href="https://en.wikipedia.org/wiki/Varnish_(software)" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Varnish</a>) and making sure when content gets edited new summaries get generated. It’s well known that <a href="https://en.wikipedia.org/wiki/Cache_invalidation" data-href="https://en.wikipedia.org/wiki/Cache_invalidation" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">cache invalidation</a> is one of the harder Computer Science problems.</p><p name="4a0b" id="4a0b" class="graf graf--p graf-after--p">Thank you services team!!</p><h1 name="602f" id="602f" class="graf graf--h3 graf-after--p">Thank you thank you thank you</h1><p name="5c5f" id="5c5f" class="graf graf--p graf-after--h3">Shipping something always feels good. I hope the “simple” preview my team with the help of many teams across the Wikimedia Foundation has shipped enriches your experience.</p><p name="ae68" id="ae68" class="graf graf--p graf-after--p">Lot’s of us have obviously been involved and we’re proud of what we’ve put out.</p><p name="b8a3" id="b8a3" class="graf graf--p graf-after--p">We’re not done. Software is never done.</p><p name="c33a" id="c33a" class="graf graf--p graf-after--p">We have code to clean up and <a href="https://medium.com/freely-sharing-the-sum-of-all-knowledge/how-we-designed-page-previews-for-wikipedia-and-what-could-be-done-with-them-in-the-future-7a5fa6b07b96" data-href="https://medium.com/freely-sharing-the-sum-of-all-knowledge/how-we-designed-page-previews-for-wikipedia-and-what-could-be-done-with-them-in-the-future-7a5fa6b07b96" class="markup--anchor markup--p-anchor" target="_blank">new ideas</a> for how to grow this small little feature.</p><p name="6d7e" id="6d7e" class="graf graf--p graf-after--p graf--trailing">Some might say we’re only seeing the tip of the iceberg.</p></div></div></section><section name="5723" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="9d4a" id="9d4a" class="graf graf--p graf--leading">The Wikimedia Foundation is a non-profit and relies on donations from people like you to keep the site up and running in such a way that it lives up to our values. To help us continue to build features like this, <a href="https://wikimediafoundation.org/wiki/Ways_to_Give" data-href="https://wikimediafoundation.org/wiki/Ways_to_Give" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">please consider donating to us</a>.</p><p name="dcea" id="dcea" class="graf graf--p graf-after--p graf--trailing"><a href="https://www.mediawiki.org/wiki/User:Jdlrobson" data-href="https://www.mediawiki.org/wiki/User:Jdlrobson" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><em class="markup--em markup--p-em">Jon Robson</em></a><em class="markup--em markup--p-em">, Senior Software Engineer, Desktop &amp; Mobile Web</em><br><em class="markup--em markup--p-em">Wikimedia Foundation</em></p></div></div></section><section name="dc4e" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="8505" id="8505" class="graf graf--p graf--leading"><em class="markup--em markup--p-em">You can also read this post on </em><a href="https://blog.wikimedia.org/2018/04/20/why-it-took-a-long-time-to-build-that-tiny-link-preview-on-wikipedia/" data-href="https://blog.wikimedia.org/2018/04/20/why-it-took-a-long-time-to-build-that-tiny-link-preview-on-wikipedia/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><em class="markup--em markup--p-em">our WordPress blog</em></a><em class="markup--em markup--p-em">. Both posts have been edited to fix a typo — our API is receiving half a million hits per minute, not five thousand.</em></p><p name="a3f1" id="a3f1" class="graf graf--p graf-after--p graf--trailing"><em class="markup--em markup--p-em">Want to learn more? See our </em><a href="https://medium.com/freely-sharing-the-sum-of-all-knowledge/wikipedia-page-previews-738cddac7a21" data-href="https://medium.com/freely-sharing-the-sum-of-all-knowledge/wikipedia-page-previews-738cddac7a21" class="markup--anchor markup--p-anchor" target="_blank"><em class="markup--em markup--p-em">original announcement</em></a><em class="markup--em markup--p-em">.</em></p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@dlyall" class="p-author h-card">Jon Robson (David Lyall)</a> on <a href="https://medium.com/p/d5bd734df8fe"><time class="dt-published" datetime="2018-04-18T17:48:20.809Z">April 18, 2018</time></a>.</p><p><a href="https://medium.com/@dlyall/why-it-took-a-long-time-to-build-that-tiny-link-preview-on-wikipedia-d5bd734df8fe" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on January 14, 2020.</p></footer></article></body></html>