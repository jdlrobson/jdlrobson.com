<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Letting the browser speak — the Web Speech API</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Letting the browser speak — the Web Speech API</h1>
</header>
<section data-field="subtitle" class="p-summary">
In my spare time I’ve been learning Chinese and I’ve been making a flashcard application. At Smashing Conference San Francisco a few weeks…
</section>
<section data-field="body" class="e-content">
<section name="ecbb" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="62a3" id="62a3" class="graf graf--h3 graf--leading graf--title">Letting the browser speak — the Web Speech API</h3><p name="ea8e" id="ea8e" class="graf graf--p graf-after--h3">In my spare time I’ve been learning Chinese and I’ve been making <a href="https://github.com/jdlrobson/DivideAndConcur" data-href="https://github.com/jdlrobson/DivideAndConcur" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">a flashcard application</a>. At <a href="https://smashingconf.com/sf-2018/" data-href="https://smashingconf.com/sf-2018/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Smashing Conference San Francisco</a> a few weeks ago, I met a few people doing the same. It seems like flash card apps are the new version of the “todo” app engineers like to make when wanting to learn new technology.</p><blockquote name="187f" id="187f" class="graf graf--pullquote graf--startsWithDoubleQuote graf-after--p">“making your own cards and personalizing them will greatly increase your ability to remember new material and learn things that are important specifically to you.”</blockquote><p name="c54d" id="c54d" class="graf graf--p graf-after--pullquote">I’m designing my app around the idea of <a href="https://qz.com/1211561/how-to-learn-a-language-use-spaced-repetition/" data-href="https://qz.com/1211561/how-to-learn-a-language-use-spaced-repetition/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">spaced repetition</a> and the fact I’m making the app and making the flashcards my own is helping me learn the things that are important to me. As developers, I feel we should always be looking to combine our non-technical goals with our technical goals. The magic is where two interests/passions unite!</p><p name="b976" id="b976" class="graf graf--p graf-after--p">I’ve been showing digital flashcards of Simplified Chinese characters and their corresponding English translations and <a href="https://en.wikipedia.org/wiki/Pinyin" data-href="https://en.wikipedia.org/wiki/Pinyin" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Hanyu Pinyin</a> to help me learn how to say them and it seems to be helping me remember them. However, I felt a voice was missing — I wanted a way to hear all the words that would support <a href="https://en.wikipedia.org/wiki/Auditory_learning" data-href="https://en.wikipedia.org/wiki/Auditory_learning" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">auditory learning</a>.</p><h4 name="2ce4" id="2ce4" class="graf graf--h4 graf-after--p"><strong class="markup--strong markup--h4-strong">How to support auditory learning with the web</strong></h4><p name="3c3f" id="3c3f" class="graf graf--p graf-after--h4">I looked at what others are doing — and most websites/apps are using MP3s or not using them at all. The website <a href="https://www.duolingo.com" data-href="https://www.duolingo.com" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Duolingo</a> for instance appears to have sound in its app but not in its website. I’ve been trying to keep my app package size down as much as possible with the exception of the data — my goal with this app is for it to work offline. The idea of lots of MP3s for all the possible sounds worried me a little in terms of download size as well as needing to find and source the recordings!</p><p name="1231" id="1231" class="graf graf--p graf-after--p">So, I looked to the browsers which always seem to have thought of these things before me and I found <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Speech_API" data-href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Speech_API" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">the Web Speech API</a>.</p><p name="b179" id="b179" class="graf graf--p graf-after--p">As expected, browser support was quite low. Firefox and Chrome support with a bit of Safari sprinkled in and it was very experimental. I’m all for progressive enhancement, so it wasn’t the end of the world, if my app only played sound in newer browsers so I had a play with it.</p><p name="dfed" id="dfed" class="graf graf--p graf-after--p">It was pretty straightforward to use.</p><pre name="20fe" id="20fe" class="graf graf--pre graf-after--p">const word = &#39;音乐&#39;;</pre><pre name="a0fd" id="a0fd" class="graf graf--pre graf-after--pre">// Feature detect<br>if (<br>  window.speechSynthesis &amp;&amp;<br>  typeof SpeechSynthesisUtterance !== undefined<br>) {<br>  const synth = window.speechSynthesis;</pre><pre name="2e7c" id="2e7c" class="graf graf--pre graf-after--pre">  // get all the voices available on your browser<br>  const voices = synth.getVoices();<br>  // find a voice that can speak chinese<br>  const voice = voices.<br>    filter((voice) =&gt; voice.lang.indexOf(&#39;zh&#39;) === 0)[0];</pre><pre name="6c53" id="6c53" class="graf graf--pre graf-after--pre">  // make the browser speak!<br>  const utterThis = new SpeechSynthesisUtterance(word);<br>  utterThis.voice = voice;<br>  synth.speak(utterThis);<br>}</pre><p name="c354" id="c354" class="graf graf--p graf-after--pre">While this worked wonderfully on my desktop browser, when I loaded it on to mobile, I hit a snag — the flash card game did not play any of the lovely sounds it did on my desktop.</p><h4 name="85ab" id="85ab" class="graf graf--h4 graf-after--p">Troubleshooting missing voices on Android</h4><p name="10e6" id="10e6" class="graf graf--p graf-after--h4">I was confident in my feature detection, so I was a little perplexed to what was going on here. I dug a little deeper and realised that my mobile browser didn’t have a voice that could speak Chinese. I improved my code:</p><pre name="6d7b" id="6d7b" class="graf graf--pre graf-after--p">// find a voice that can speak chinese<br>const voice = voices.<br>  filter((voice) =&gt; voice.lang.indexOf(&#39;zh&#39;) === 0)[0];</pre><pre name="5050" id="5050" class="graf graf--pre graf-after--pre">// make the browser speak if it can!<br>if ( voice ) {<br>  const utterThis = new SpeechSynthesisUtterance(word);<br>  utterThis.voice = voice;<br>  synth.speak(utterThis);<br>} else {<br>  const utterThis = new SpeechSynthesisUtterance(word);<br>  utterThis.voice = voices[0];<br>  synth.speak(&#39;I\&#39;m afraid I cannot speak Mandarin yet.&#39;);<br>}</pre><p name="261e" id="261e" class="graf graf--p graf-after--pre">I found this useful webpage for detecting what voices were available on a device:<br><a href="https://mdn.github.io/web-speech-api/speak-easy-synthesis/" data-href="https://mdn.github.io/web-speech-api/speak-easy-synthesis/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">https://mdn.github.io/web-speech-api/speak-easy-synthesis/</a></p><p name="ba30" id="ba30" class="graf graf--p graf-after--p">According to this page, my mobile device only had English and Spanish installed. Typically my phone is not running in Chinese and I’m not viewing Chinese websites and didn’t realise I needed this support until right now and for this specific app, but my app did want it and it had no way to communicate that to me other than being broken.</p><h4 name="d7cd" id="d7cd" class="graf graf--h4 graf-after--p">Installing language support</h4><p name="93a5" id="93a5" class="graf graf--p graf-after--h4">Installing Chinese was a cumbersome process. I had to fiddle with my Android settings and add the Chinese language and restart my browser.</p><figure name="f7c9" id="f7c9" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 1439px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 205.6%;"></div><img class="graf-image" data-image-id="1*kWPoSgsk0NME00MQjz32EA.jpeg" data-width="1080" data-height="2220" src="https://cdn-images-1.medium.com/max/800/1*kWPoSgsk0NME00MQjz32EA.jpeg"></div><figcaption class="imageCaption">Making it possible to get Chinese voices installed on my phone involved adding lanuage support…</figcaption></figure><figure name="ae5a" id="ae5a" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 1439px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 205.6%;"></div><img class="graf-image" data-image-id="1*-obdmmMXH2TLDkiphum_mg.jpeg" data-width="1080" data-height="2220" src="https://cdn-images-1.medium.com/max/800/1*-obdmmMXH2TLDkiphum_mg.jpeg"></div><figcaption class="imageCaption">… as well as fiddling with voice to text settings.</figcaption></figure><p name="14e1" id="14e1" class="graf graf--p graf-after--figure">While I or another developer could do this, it wasn’t a great experience, if I wanted to share my app with a non-technical audience, there would be no easy way for them to do this, without having to send them detailed instructions. This made me sad.</p><p name="8bc1" id="8bc1" class="graf graf--p graf-after--p">I am reminded of the Nespresso coffee machine in our office which has functional buttons that go red when it has a common problem, that need the manual for deciphering. Its interface confuses everyone around it, who know it is broken but do not know how to fix it.</p><figure name="49ed" id="49ed" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 394px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 56.3%;"></div><img class="graf-image" data-image-id="1*nveUe2J-k-EY_UiTCbLDYw.png" data-width="1280" data-height="720" src="https://cdn-images-1.medium.com/max/800/1*nveUe2J-k-EY_UiTCbLDYw.png"></div><figcaption class="imageCaption">Interfaces like <a href="https://www.youtube.com/watch?v=B2toP697HPk" data-href="https://www.youtube.com/watch?v=B2toP697HPk" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">Nespresso’s error message</a> that have no way of expressing their exact needs, only their broken states make me sad</figcaption></figure><p name="756b" id="756b" class="graf graf--p graf-after--figure">A mark of a fully thought out API is one that has thought about every step of the process. This is an experimental API so this wasn’t really a suprise.</p><h4 name="a13a" id="a13a" class="graf graf--h4 graf-after--p">Imagining the API I’d like</h4><p name="d630" id="d630" class="graf graf--p graf-after--h4">This annoyed me a little. The capability was there, but it hadn’t been prioritised. What I really wanted was an API that would allow me to request a language and take care of the installation if necessary in a similar way to how I request permission for the user to use their current location or to send them push notifications.</p><figure name="d75c" id="d75c" class="graf graf--figure graf--layoutOutsetLeft graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 323px; max-height: 137px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 42.4%;"></div><img class="graf-image" data-image-id="1*baYddlsrACH1N1InyAo5Hw.png" data-width="323" data-height="137" src="https://cdn-images-1.medium.com/max/600/1*baYddlsrACH1N1InyAo5Hw.png"></div><figcaption class="imageCaption">What I’d like to see is a permissions base model which downloads language packs as needed. Imagine if we a website tells you it wants to “install Chinese language support” giving you the options to block or allow</figcaption></figure><p name="137e" id="137e" class="graf graf--p graf-after--figure">If my user didn’t have a Chinese language installed, this script could prompt them to add support for it. They could say yes, and now they would hear the words spoken to them. If they said no, I would be able to let them know what they’re missing out on.</p><p name="1214" id="1214" class="graf graf--p graf-after--p">I imagine that would look like this:</p><pre name="4b39" id="4b39" class="graf graf--pre graf-after--p"><br>  window.speechSynthesis.getVoicesForLanguage(&#39;zh&#39;).then(()=&gt; {<br>    speakMandarin();<br>  }, () =&gt; {<br>    notifyUserSoundIsDisabled();<br>  });</pre><h4 name="6f58" id="6f58" class="graf graf--h4 graf-after--pre">Conclusions</h4><p name="a088" id="a088" class="graf graf--p graf-after--h4">The WebSpeech API is pretty interesting. It promises voice detection and text to speech, but like most APIs that are experimental and still on the standards track, it has some areas for improvement.</p><p name="b6a1" id="b6a1" class="graf graf--p graf-after--p">Like many things built by engineers, the places I feel it really needs polish are around connecting developers to end users in such a way that we can create smooth beautiful experiences.</p><p name="a501" id="a501" class="graf graf--p graf-after--p">Given the API’s conception dates back to 2012 and <a href="https://developers.google.com/web/updates/2014/01/Web-apps-that-talk-Introduction-to-the-Speech-Synthesis-API" data-href="https://developers.google.com/web/updates/2014/01/Web-apps-that-talk-Introduction-to-the-Speech-Synthesis-API" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">landed in Chrome in 2014</a>, I worry none of this will happen any time soon, but it seems like it could play an important role in the web and provide a powerful open alternative to native apps when it does.</p><p name="0350" id="0350" class="graf graf--p graf-after--p">Hopefully my app will be able to make use of it when it finally does.</p><h4 name="aa43" id="aa43" class="graf graf--h4 graf-after--p">Further reading</h4><p name="5b6d" id="5b6d" class="graf graf--p graf-after--h4">If the API interests you, I found the following links useful:</p><ul class="postList"><li name="046a" id="046a" class="graf graf--li graf-after--p"><a href="https://www.smashingmagazine.com/2017/02/experimenting-with-speechsynthesis/" data-href="https://www.smashingmagazine.com/2017/02/experimenting-with-speechsynthesis/" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">Experimenting with speechSynthesis</a></li><li name="64bb" id="64bb" class="graf graf--li graf-after--li"><a href="https://developers.google.com/web/updates/2013/01/Voice-Driven-Web-Apps-Introduction-to-the-Web-Speech-API" data-href="https://developers.google.com/web/updates/2013/01/Voice-Driven-Web-Apps-Introduction-to-the-Web-Speech-API" class="markup--anchor markup--li-anchor" rel="nofollow noopener" target="_blank">Voice Driven Web Apps: Introduction to the Web Speech API</a></li><li name="4967" id="4967" class="graf graf--li graf-after--li graf--trailing"><a href="https://developers.google.com/web/updates/2014/01/Web-apps-that-talk-Introduction-to-the-Speech-Synthesis-API" data-href="https://developers.google.com/web/updates/2014/01/Web-apps-that-talk-Introduction-to-the-Speech-Synthesis-API" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">Web apps that talk — Introduction to the Speech Synthesis API</a></li></ul></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@dlyall" class="p-author h-card">Jon Robson (David Lyall)</a> on <a href="https://medium.com/p/1df6048f4816"><time class="dt-published" datetime="2018-04-30T15:12:02.975Z">April 30, 2018</time></a>.</p><p><a href="https://medium.com/@dlyall/letting-the-browser-speak-the-web-speech-api-1df6048f4816" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on January 14, 2020.</p></footer></article></body></html>